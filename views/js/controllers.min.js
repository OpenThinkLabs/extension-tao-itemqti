define("taoQtiItem/controller/routes",[],function(){return{QtiPreview:{actions:{index:"taoItems/controller/preview/itemRunner"}}}}),define("taoQtiItem/qtiItem/helper/util",["lodash"],function(t){var e={buildSerial:function(t){for(var e=t||"",i="abcdefghijklmnopqrstuvwxyz0123456789",n=0;22>n;n++)e+=i.charAt(Math.floor(Math.random()*i.length));return e},fullpath:function(t,e){return t=t||"",e=e||"",t&&(t=t.replace(/^\//,""),t.match(/^http/i)||(e&&!e.match(/\/$/)&&(e+="/"),t=e+t)),t},findInCollection:function(e,i,n){var a=null;if(t.isString(i)&&(i=[i]),!t.isArray(i))throw new Error("invalid argument : colllectionNames must be an array or a string");return t.each(i,function(i){var r=e;t.each(i.split("."),function(t){r=r[t]});var o=r[n];return o?(a={parent:e,element:o},!1):(t.each(r,function(e){return t.isFunction(e.find)&&(a=e.find(n))?!1:void 0}),a?!1:void 0)}),a}};return e}),define("taoQtiItem/qtiItem/helper/rendererConfig",["lodash","jquery"],function(t,e){var i={};return i.getOptionsFromArguments=function(i){var n={data:{},placeholder:null,subclass:"",renderer:null};return t.each(i,function(a){a&&(a.isRenderer?n.renderer=a:a instanceof e&&a.length?n.placeholder=a:t.isString(a)?n.subclass=a:t.isPlainObject(a)?n.data=a:console.log("invalid arg",a,i))}),n},i}),define("taoQtiItem/qtiItem/core/Element",["class","lodash","taoQtiItem/qtiItem/helper/util","taoQtiItem/qtiItem/helper/rendererConfig"],function(t,e,i,n){var a={},r=t.extend({qtiClass:"",serial:"",relatedItem:null,init:function(t,e){if(this.attributes={},this.metaData={},"object"==typeof t&&(e=t,t=""),t||(t=i.buildSerial(this.qtiClass+"_")),t&&("string"!=typeof t||!t.match(/^[a-z_0-9]*$/i)))throw"invalid QTI serial : ("+typeof t+") "+t;if(a[t])throw"a QTI Element with the same serial already exists "+t;a[t]=this,this.serial=t,this.setAttributes(e||{}),"function"==typeof this.initContainer&&this.initContainer(arguments[2]||""),"function"==typeof this.initObject&&this.initObject()},is:function(t){return t===this.qtiClass},placeholder:function(){return"{{"+this.serial+"}}"},getSerial:function(){return this.serial},getUsedIdentifiers:function(){var t={},e=this.getComposingElements();for(var i in e){var n=e[i],a=n.attr("identifier");a&&(t[a]=n)}return t},attr:function(t,e){if(t)if(void 0!==e)this.attributes[t]=e;else if("object"==typeof t)for(var i in t)this.attr(i,t[i]);else if("string"==typeof t)return void 0===this.attributes[t]?void 0:this.attributes[t];return this},data:function(t,e){if(t)if(void 0!==e)this.metaData[t]=e,$(document).trigger("metaChange.qti-widget",{element:this,key:t,value:e});else if("object"==typeof t)for(var i in t)this.data(i,t[i]);else if("string"==typeof t)return void 0===this.metaData[t]?void 0:this.metaData[t];return this},removeData:function(t){return delete this.metaData[t],this},removeAttr:function(t){return this.removeAttributes(t)},setAttributes:function(t){return this.attributes=t,this},getAttributes:function(){return e.clone(this.attributes)},removeAttributes:function(t){"string"==typeof t&&(t=[t]);for(var e in t)delete this.attributes[t[e]];return this},getComposingElements:function(){var t={};if("function"==typeof this.initContainer){var i=this.getBody();t[i.getSerial()]=i,t=e.extend(t,i.getComposingElements())}if("function"==typeof this.initObject){var n=this.getObject();t[n.getSerial()]=n,t=e.extend(t,n.getComposingElements())}return t},getUsedClasses:function(){var t=[this.qtiClass],i=this.getComposingElements();return e.each(i,function(e){t.push(e.qtiClass)}),e.uniq(t)},find:function(t){var e=null;if("function"==typeof this.initObject){var i=this.getObject();i.serial===t&&(e={parent:this,element:i,location:"object"})}return e||"function"!=typeof this.initContainer||(e=this.getBody().find(t,this)),e},parent:function(){var t=this.getRelatedItem();if(t){var e=t.find(this.getSerial());if(e)return e.parent}return null},setRelatedItem:function(t,e){if(e="undefined"==typeof e?!0:e,r.isA(t,"assessmentItem")){this.relatedItem=t;var i=this.getComposingElements();for(var n in i)i[n].setRelatedItem(t,!1)}},getRelatedItem:function(){var t=null;return r.isA(this.relatedItem,"assessmentItem")&&(t=this.relatedItem),t},setRenderer:function(t){if(!t||!t.isRenderer)throw"invalid qti rendering engine";this.renderer=t;var e=this.getComposingElements();for(var i in e)e[i].setRenderer(t)},getRenderer:function(){return this.renderer},render:function(){var t=n.getOptionsFromArguments(arguments),i=t.renderer||this.getRenderer(),a={},r={tag:this.qtiClass,serial:this.serial,attributes:this.getAttributes()};if(!i)throw"render: no renderer found for the element "+this.qtiClass+":"+this.serial;if("function"==typeof this.initContainer&&(r.body=this.getBody().render(i)),"function"==typeof this.initObject){r.object={attributes:this.object.getAttributes()};var o=r.object.attributes.data,s=i.getOption("baseUrl");s&&(/^http(s)?:\/\//.test(o)||(r.object.attributes.data=s+o))}a=e.merge(r,t.data||{}),a=i.getData(this,a,t.subclass);var l=i.renderTpl(this,a,t.subclass);return t.placeholder&&t.placeholder.replaceWith(l),l},postRender:function(t,e,i){if(i=i||this.getRenderer(),"function"==typeof this.initContainer&&this.getBody().postRender({},"",i),i)return i.postRender(this,t,e);throw"postRender: no renderer found for the element "+this.qtiClass+":"+this.serial},getContainer:function(t,e){var i=this.getRenderer();if(i)return i.getContainer(this,t,e);throw"getContainer: no renderer found for the element "+this.qtiClass+":"+this.serial},toArray:function(){var t={serial:this.serial,type:this.qtiClass,attributes:this.getAttributes()};return"function"==typeof this.initContainer&&(t.body=this.getBody().toArray()),"function"==typeof this.initObject&&(t.object=this.object.toArray()),t},remove:function(t,e){if(console.log("element.remove() : deprecated method"),this[t]){var i="";"string"==typeof e?i=e:e instanceof r&&(i=e.getSerial()),i&&delete this[t][i]}return this},isEmpty:function(){return!1},addClass:function(t){var e=this.attr("class")||"";o(e,t)||this.attr("class",e+(e.length?" ":"")+t)},hasClass:function(t){return o(this.attr("class"),t)},removeClass:function(t){var e=this.attr("class")||"";if(e){var i=new RegExp("(?:^|\\s)"+t+"(?:\\s|$)","");e=e.replace(i,"").replace(/^\s+/,""),e?this.attr("class",e):this.removeAttr("class")}}}),o=function(t,e){var i=new RegExp("(?:^|\\s)"+e+"(?:\\s|$)","");return t&&i.test(t)};return r.isA=function(t,e){return t instanceof r&&t.is(e)},r.getElementBySerial=function(t){return a[t]},r.unsetElement=function(t){delete a[t]},r}),define("taoQtiItem/qtiItem/helper/interactionHelper",["lodash","taoQtiItem/qtiItem/core/Element"],function(t,e){return{convertChoices:function(i,n){var a=[],r=this;return t.each(i,function(i){if(e.isA(i,"choice"))switch(n){case"serial":a.push(i.getSerial());break;case"identifier":a.push(i.id());break;default:a.push(i)}else t.isArray(i)&&a.push(r.convertChoices(i,n))}),a},findChoices:function(e,i,n){var a=[],r=this;return t.each(i,function(i){var o;t.isString(i)?"serial"===n?(o=e.getChoice(i),o&&a.push(o)):"identifier"===n?(o=e.getChoiceByIdentifier(i),o&&a.push(o)):a.push(i):a.push(t.isArray(i)?r.findChoices(e,i,n):i)}),a},shuffleChoices:function(t){var i=[],n={},a=0;for(var r in t){if(!e.isA(t[r],"choice"))throw"invalid element in array: is not a qti choice";var o=t[r];o.attr("fixed")&&(n[a]=o),i.push(o),a++}for(var s=0;s<i.length-1;s++)if(!n[s]){var l=-1;do l=s+Math.floor(Math.random()*(i.length-s));while(n[l]);var c=i[l];i[l]=i[s],i[s]=c}return i},serialToIdentifier:function(t,e){var i=t.getChoice(e);return i?i.id():""}}}),define("taoQtiItem/qtiRunner/core/Renderer",["lodash","jquery","handlebars","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/interactionHelper"],function(t,e,i,n,a){var r=function(e){var i=!0;if("object"!=typeof e)return!1;var n=!1;if(e.qtiClass)if(t.indexOf(o,e.qtiClass)>=0)n=!0;else{var a=e.qtiClass.indexOf(".");if(a>0){var r=e.qtiClass.slice(0,a),s=e.qtiClass.slice(a+1);l[r]&&t.indexOf(l[r],s)>=0&&(n=!0)}}if(!n)throw i=!1,new Error("invalid qti class name in renderer declaration : "+e.qtiClass);if(!e.template)throw i=!1,new Error("missing template in renderer declaration : "+e.qtiClass);return i},o=["_container","assessmentItem","stylesheet","responseDeclaration","outcomeDeclaration","responseProcessing","_simpleFeedbackRule","img","math","object","modalFeedback","rubricBlock","associateInteraction","choiceInteraction","extendedTextInteraction","gapMatchInteraction","graphicAssociateInteraction","graphicGapMatchInteraction","graphicOrderInteraction","hotspotInteraction","hottextInteraction","inlineChoiceInteraction","matchInteraction","mediaInteraction","orderInteraction","selectPointInteraction","sliderInteraction","textEntryInteraction","uploadInteraction","endAttemptInteraction","prompt","associableHotspot","gap","gapImg","gapText","hotspotChoice","hottext","inlineChoice","simpleAssociableChoice","simpleChoice"],s={associateInteraction:["simpleAssociableChoice"],choiceInteraction:["simpleChoice"],gapMatchInteraction:["gap","gapText"],graphicAssociateInteraction:["associableHotspot"],graphicGapMatchInteraction:["associableHotspot","gapImg"],graphicOrderInteraction:["hotspotChoice"],hotspotInteraction:["hotspotChoice"],hottextInteraction:["hottext"],inlineChoiceInteraction:["inlineChoice"],matchInteraction:["simpleAssociableChoice"],orderInteraction:["simpleChoice"]},l={simpleAssociableChoice:["associateInteraction","matchInteraction"],simpleChoice:["choiceInteraction","orderInteraction"]},c=["_container","prompt","modalFeedback"],d=function(d){d=d||{},this.isRenderer=!0,this.name="",this.shuffleChoices=void 0!==d.shuffleChoices?d.shuffleChoices:!0,this.shuffledChoices=[];var h={},u={},p=function(t){var e=null;if(u[t])e=u[t];else{var i=t.indexOf(".");i>0&&(t=t.slice(0,i),u[t]&&(e=u[t]))}return e};this.setOption=function(t,e){return"string"==typeof t&&(d[t]=e),this},this.setOptions=function(e){return t.extend(d,e),this},this.getOption=function(t){return"string"==typeof t&&d[t]?d[t]:null},this.renderTpl=function(t,e,i){var n="",a=!1,r=i||t.qtiClass,o=p(r);if(o&&"function"==typeof o.template&&(n=o.template(e),a=!0),!a)throw new Error("no renderer template loaded under the class name : "+r);return n},this.getData=function(t,e,i){var n=e,a=i||t.qtiClass,r=p(a);return r&&"function"==typeof r.getData&&(n=r.getData.call(this,t,e)),n},this.renderDirect=function(t,e){return i.compile(t)(e)},this.getContainer=function(t,e,i){var n=null,a=i||t.qtiClass,r=p(a);if(!r)throw"no renderer found for the class : "+t.qtiClass;return n=r.getContainer(t,e)},this.postRender=function(t,e,i){var n=!1,a=i||t.qtiClass,r=p(a);return r&&"function"==typeof r.render&&(n=r.render.call(this,t,e)),n},this.setResponse=function(t,i,n){var a=!1,r=n||t.qtiClass,o=p(r);if(!o)throw"no renderer registered under the name : "+r;if("function"==typeof o.setResponse){a=o.setResponse.call(this,t,i);var s=o.getContainer.call(this,t);s instanceof e&&s.length&&s.trigger("responseSet",[t,i])}return a},this.getResponse=function(t,e){var i=!1,n=e||t.qtiClass,a=p(n);if(!a)throw"no renderer registered under the name : "+n;return"function"==typeof a.getResponse&&(i=a.getResponse.call(this,t)),i},this.resetResponse=function(t,e){var i=!1,n=e||t.qtiClass,a=p(n);if(!a)throw"no renderer registered under the name : "+n;return"function"==typeof a.resetResponse&&(i=a.resetResponse.call(this,t)),i},this.getLoadedRenderers=function(){return u},this.register=function(e){t.extend(h,e)},this.load=function(e,i){var n=[];if(i){if(!t.isArray(i))throw new Error('invalid argument type: expected array for arg "requireClasses"');i=t.intersection(i,o),i=t.union(i,c),t.each(i,function(e){var n=s[e];n&&(i=t.union(i,n))});for(var a in i){var d=i[a];if(l[d]){var p=t.intersection(i,l[d]);t.each(p,function(t){if(h[d+"."+t])n.push(h[d+"."+t]);else{if(!h[d])throw new Error(this.name+" : missing qti class location declaration: "+d+", subclass: "+t);n.push(h[d])}})}else if(h[d]===!1)u[d]=!1;else{if(!h[d])throw new Error(this.name+" : missing qti class location declaration: "+d);n.push(h[d])}}}else n=t.values(h);var f=this;return require(n,function(){t.each(arguments,function(t){r(t)&&(u[t.qtiClass]=t)}),"function"==typeof e&&e.call(f,u)}),this},this.setShuffledChoices=function(t,e,i){n.isA(t,"interaction")&&(this.shuffledChoices[t.getSerial()]=a.findChoices(t,e,i))},this.getShuffledChoices=function(e,i,r){var o,s=[];if(n.isA(e,"interaction")){var l=e.getSerial();if(!this.shuffledChoices[l]||i)if(n.isA(e,"matchInteraction")){this.shuffledChoices[l]=[];for(var c=0;2>c;c++)this.shuffledChoices[l].push(a.shuffleChoices(e.getChoices(c)))}else this.shuffledChoices[l]=a.shuffleChoices(e.getChoices());o=this.shuffledChoices[l],s="serial"===r||"identifier"===r?a.convertChoices(o,r):t.clone(o)}return s},this.getRenderers=function(){return u},this.getLocations=function(){return h}};return{build:function(t,e){var i=function(){d.apply(this,arguments),this.register(t),this.name=e||""};return i.prototype=d.prototype,i},getElementRenderer:function(t,e){if(e.qtiClass===t.qtiClass){e.getRenderer()}}}}),define("taoQtiItem/qtiDefaultRenderer/renderers/config",[],function(){return{name:"defaultRenderer",locations:{_container:"taoQtiItem/qtiDefaultRenderer/renderers/Container",assessmentItem:"taoQtiItem/qtiDefaultRenderer/renderers/Item",stylesheet:"taoQtiItem/qtiDefaultRenderer/renderers/Stylesheet",outcomeDeclaration:"taoQtiItem/qtiDefaultRenderer/renderers/OutcomeDeclaration",responseDeclaration:"taoQtiItem/qtiDefaultRenderer/renderers/ResponseDeclaration",responseProcessing:"taoQtiItem/qtiDefaultRenderer/renderers/ResponseProcessing",math:"taoQtiItem/qtiDefaultRenderer/renderers/Math",object:"taoQtiItem/qtiDefaultRenderer/renderers/Object",modalFeedback:"taoQtiItem/qtiDefaultRenderer/renderers/ModalFeedback",rubricBlock:"taoQtiItem/qtiDefaultRenderer/renderers/RubricBlock",associateInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/AssociateInteraction",choiceInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/ChoiceInteraction",extendedTextInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/ExtendedTextInteraction",gapMatchInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/GapMatchInteraction",graphicAssociateInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/GraphicAssociateInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/GraphicGapMatchInteraction",graphicOrderInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/GraphicOrderInteraction",hotspotInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/HotspotInteraction",hottextInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/HottextInteraction",inlineChoiceInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/InlineChoiceInteraction",matchInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/MatchInteraction",mediaInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/MediaInteraction",orderInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/OrderInteraction",selectPointInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/SelectPointInteraction",sliderInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/SliderInteraction",textEntryInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/TextEntryInteraction",prompt:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/Prompt",associableHotspot:"taoQtiItem/qtiDefaultRenderer/renderers/choices/AssociableHotspot",gap:"taoQtiItem/qtiDefaultRenderer/renderers/choices/Gap",gapImg:"taoQtiItem/qtiDefaultRenderer/renderers/choices/GapImg",gapText:"taoQtiItem/qtiDefaultRenderer/renderers/choices/GapText",hotspotChoice:"taoQtiItem/qtiDefaultRenderer/renderers/choices/HotspotChoice",hottext:"taoQtiItem/qtiDefaultRenderer/renderers/choices/Hottext",inlineChoice:"taoQtiItem/qtiDefaultRenderer/renderers/choices/InlineChoice",simpleAssociableChoice:"taoQtiItem/qtiDefaultRenderer/renderers/choices/SimpleAssociableChoice",simpleChoice:"taoQtiItem/qtiDefaultRenderer/renderers/choices/SimpleChoice"}}}),define("taoQtiItem/qtiCommonRenderer/renderers/config",["lodash","taoQtiItem/qtiDefaultRenderer/renderers/config"],function(t,e){var i=t.extend(t.clone(e.locations),{assessmentItem:"taoQtiItem/qtiCommonRenderer/renderers/Item",_container:"taoQtiItem/qtiCommonRenderer/renderers/Container",_simpleFeedbackRule:!1,stylesheet:"taoQtiItem/qtiCommonRenderer/renderers/Stylesheet",img:"taoQtiItem/qtiCommonRenderer/renderers/Img",math:"taoQtiItem/qtiCommonRenderer/renderers/Math",rubricBlock:"taoQtiItem/qtiCommonRenderer/renderers/RubricBlock",modalFeedback:"taoQtiItem/qtiCommonRenderer/renderers/ModalFeedback",prompt:"taoQtiItem/qtiCommonRenderer/renderers/interactions/Prompt",choiceInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/ChoiceInteraction",extendedTextInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction",orderInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/OrderInteraction",associateInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/AssociateInteraction",matchInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/MatchInteraction",textEntryInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/TextEntryInteraction",sliderInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/SliderInteraction",inlineChoiceInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/InlineChoiceInteraction","simpleChoice.choiceInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.ChoiceInteraction","simpleChoice.orderInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.OrderInteraction",hottext:"taoQtiItem/qtiCommonRenderer/renderers/choices/Hottext",gap:"taoQtiItem/qtiCommonRenderer/renderers/choices/Gap",gapText:"taoQtiItem/qtiCommonRenderer/renderers/choices/GapText","simpleAssociableChoice.matchInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.MatchInteraction","simpleAssociableChoice.associateInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.AssociateInteraction",inlineChoice:"taoQtiItem/qtiCommonRenderer/renderers/choices/InlineChoice",hottextInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/HottextInteraction",hotspotInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction",gapMatchInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GapMatchInteraction",selectPointInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/SelectPointInteraction",graphicOrderInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicOrderInteraction",mediaInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/MediaInteraction",uploadInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/UploadInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction",gapImg:"taoQtiItem/qtiCommonRenderer/renderers/choices/GapImg",graphicAssociateInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction"});return{name:"commonRenderer",locations:i}}),define("taoQtiItem/qtiCommonRenderer/renderers/Renderer",["taoQtiItem/qtiRunner/core/Renderer","taoQtiItem/qtiCommonRenderer/renderers/config","css!taoQtiItem_css/qti","css!tao_css/tao-main-style"],function(t,e){return t.build(e.locations,e.name)}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/instruction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l="function",c=this.escapeExpression;return s+='<div id="',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'" class="small feedback-info item-instruction">\n    <span class="icon-info icon"></span><span class="instruction-message">',(o=i.message)?r=o.call(e,{hash:{},data:a}):(o=e&&e.message,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+"</span>\n</div>"})}),define("taoQtiItem/qtiCommonRenderer/helpers/Instruction",["lodash","taoQtiItem/qtiItem/helper/util","tpl!taoQtiItem/qtiCommonRenderer/tpl/instruction"],function(t,e,i){var n=["info","warning","error","success"],a=function(t,i,n){this.interaction=t,this.defaultMessage=i||"",this.currentMessage="",this.level="info",this.serial=e.buildSerial("instruction_"),this.callback=n,this.$dom=null,this.state=!1};return a.isValidLevel=function(e){return t.indexOf(n,e)>=0},a.prototype.setState=function(t){this.state=t},a.prototype.checkState=function(t){return this.state===t},a.prototype.getId=function(){return this.serial},a.prototype.create=function(t){t.append(i({message:this.defaultMessage,serial:this.serial})),this.$dom=t.find("#"+this.serial)},a.prototype.update=function(t){var e=t&&t.level?t.level:"",i=t&&t.message?t.message:"",n=t&&t.timeout?t.timeout:0,r=t&&"function"==typeof t.start?t.start:null,o=t&&"function"==typeof t.stop?t.stop:null;if(e&&a.isValidLevel(e)&&(this.$dom.removeClass("feedback-"+this.level).addClass("feedback-"+e),this.$dom.find(".icon").removeClass("icon-"+this.level).addClass("icon-"+e),this.level=e),i&&(this.$dom.find(".instruction-message").html(i),this.currentMessage=i),n){var s=this;r&&r.call(s),s.timer=setTimeout(function(){o&&o.call(s),s.timer=null},n)}},a.prototype.setLevel=function(t,e){var i={level:t};e&&(i.timeout=parseInt(e),i.stop=function(){this.setLevel("info")}),this.update(i)},a.prototype.getLevel=function(){return this.level},a.prototype.setMessage=function(t,e){this.update({message:t,timeout:e})},a.prototype.reset=function(){this.update({level:"info",message:this.defaultMessage}),this.state=!1},a.prototype.validate=function(t){"function"==typeof this.callback&&this.callback.call(this,t)},a}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/notification",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s,l="",c="function",d=this.escapeExpression,h=i.helperMissing;return l+='<div class="small feedback-',(o=i.level)?r=o.call(e,{hash:{},data:a}):(o=e&&e.level,r=typeof o===c?o.call(e,{hash:{},data:a}):o),l+=d(r)+' item-notification">\n    <span class="icon-',(o=i.level)?r=o.call(e,{hash:{},data:a}):(o=e&&e.level,r=typeof o===c?o.call(e,{hash:{},data:a}):o),l+=d(r)+'"></span><span class="feedback-message">',(o=i.message)?r=o.call(e,{hash:{},data:a}):(o=e&&e.message,r=typeof o===c?o.call(e,{hash:{},data:a}):o),l+=d(r)+'</span>\n    <span title="'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Remove Message",s):h.call(e,"__","Remove Message",s)))+'" class="icon-close close-trigger"></span>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/helpers/Helper",["lodash","jquery","i18n","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCommonRenderer/helpers/Instruction","tpl!taoQtiItem/qtiCommonRenderer/tpl/notification"],function(t,e,i,n,a,r){var o={},s={},l=e(),c=function(t){var e=t.getSerial(),i="[data-serial="+e+"]";return n.isA(t,"choice")?i=".qti-choice"+i:n.isA(t,"interaction")&&(i=".qti-interaction"+i),i};return{setContext:function(t){l=t},getContainer:function(t,i){var n=t.getSerial();return i instanceof e&&i.length?i.find(c(t)):l instanceof e&&l.length?l.find(c(t)):((!o[n]||o[n].length)&&(o[n]=e(c(t))),o[n])},validateInstructions:function(e,i){var n=e.getSerial();s[n]&&t.each(s[n],function(t){t.validate(i)})},appendInstruction:function(t,e,i){var n=t.getSerial(),r=new a(t,e,i);return s[n]||(s[n]={}),s[n][r.getId()]=r,r.create(this.getContainer(t).find(".instruction-container")),r},removeInstructions:function(t){s[t.getSerial()]={},this.getContainer(t).find(".instruction-container").empty()},resetInstructions:function(e){var i=e.getSerial();s[i]&&t.each(s[i],function(t){t.reset()})},minMaxChoiceInstructions:function(e,n){var a,r=this,o=n.min||0,s=n.max||0,l=n.getResponse,c=n.onError||t.noop(),d=n.choiceCount===!1?!1:t.size(e.getChoices()),h=!1;if(!t.isFunction(l))throw"invalid parameter getResponse";s>0&&(d===!1||d>s)&&(s===o?(h=!0,a=1>=s?i("You must select exactly %d choice",s):i("You must select exactly %d choices",s),r.appendInstruction(e,a,function(t){l(e).length>=s?(this.setLevel("success"),this.checkState("fulfilled")&&this.update({level:"warning",message:i("Maximum choices reached"),timeout:2e3,start:function(){c(t)},stop:function(){this.update({level:"success",message:a})}}),this.setState("fulfilled")):this.reset()})):s>o&&(a=1>=s?i("You can select maximum %d choice",s):i("You can select maximum %d choices",s),r.appendInstruction(e,a,function(t){l(e).length>=s?(this.setLevel("success"),this.setMessage(i("Maximum choices reached")),this.checkState("fulfilled")&&this.update({level:"warning",timeout:2e3,start:function(){c(t)},stop:function(){this.setLevel("info")}}),this.setState("fulfilled")):this.reset()}))),!h&&o>0&&(d===!1||d>o)&&(a=1>=o?i("You must at least %d choice",o):i("You must select at least %d choices",s),r.appendInstruction(e,a,function(){l(e).length>=o?this.setLevel("success"):this.reset()}))},appendNotification:function(t,e,i){if(i=i||"info",a.isValidLevel(i)){var n=this.getContainer(t);n.find(".notification-container").prepend(r({level:i,message:e}));var o=n.find(".item-notification:first"),s=function(){o.fadeOut()};return o.find(".close-trigger").on("click",s),setTimeout(s,2e3),o}},removeNotifications:function(t){this.getContainer(t).find(".item-notification").remove()},triggerResponseChangeEvent:function(t,e){this.getContainer(t).trigger("responseChange",[{interaction:t,response:t.getResponse()},e])},targetBlank:function(t){t.on("click","a",function(t){t.preventDefault();var i=e(this).attr("href");i&&i.match(/^http/i)&&window.open(i,"_blank")})}}}),define("taoQtiItem/qtiCreator/helper/commonRenderer",["taoQtiItem/qtiCommonRenderer/renderers/Renderer","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){var i=null,n=new t({baseUrl:"",shuffleChoices:!0}),a={render:function(t,e){a.setContext(e),n.load(function(){e.append(t.render(this)),t.postRender({},"",this)},t.getUsedClasses())},get:function(){return n},setOption:function(t,e){n.setOption(t,e)},setOptions:function(t){n.setOptions(t)},setContext:function(t){i=t,e.setContext(t)},restoreContext:function(){e.setContext(i),i=null}};return a}),define("json!taoQtiItem/qtiCreator/editor/resources/device-list.json",function(){return{tablets:{"193986c3715c81838870f908fa98d69a":{label:"Amazon Kindle Fire HDX 7″",width:960,height:600},"4e8eafab11aad1486992d7ee2c8c16ca":{label:"Apple iPad",width:1024,height:768},"5aac2932d9ad00d6d8a1604b8f9e4e8d":{label:"Google Nexus 10, Motorola Xoom, Xyboard",width:1280,height:800},"9805d9753ad08c7630a9ee5418aa6c6c":{label:"Google Nexus 7",width:966,height:604},d4a431cedf4705d6bf2cba6d5788378b:{label:"Samsung Galaxy Tab 7.7, 8.9, 10.1",width:1280,height:800}},phones:{"1b89338531ef0155c8d6abc2ac02c81a":{label:"Apple iPhone 3GS",width:320,height:480,scaleFactor:1,dpWidth:320,dpHeight:480},"3f89da99d84214cde7df87ebe0699a6f":{label:"Apple iPhone 4",width:640,height:960,scaleFactor:2,dpWidth:320,dpHeight:1920},"0d36971a5b98b367f54ced708c9af849":{label:"Apple iPhone 5",width:640,height:1136,scaleFactor:2,dpWidth:320,dpHeight:2272},"026beffcc051af995660ebdede986ace":{label:"BlackBerry Z10",width:768,height:1280,scaleFactor:2,dpWidth:384,dpHeight:2560},fd2dd53e667d6d49e4fa73356fa941dd:{label:"BlackBerry Z30",width:720,height:1280,scaleFactor:2,dpWidth:360,dpHeight:2560},"707584c1ae17d9b5b2cbe8603c91c147":{label:"Google Nexus 4",width:768,height:1280,scaleFactor:2,dpWidth:384,dpHeight:2560},"91823264de952e7f2347e07db5c4058b":{label:"Google Nexus 5",width:1080,height:1920,scaleFactor:3,dpWidth:360,dpHeight:5760},cd69817a6e147e8a4677389e56fcf568:{label:"Google Nexus S",width:480,height:800,scaleFactor:1.5,dpWidth:320,dpHeight:1200},"75994faa6a38e31e99b53fcd75534a33":{label:"HTC Evo, Touch HD, Desire HD, Desire",width:480,height:800,scaleFactor:1.5,dpWidth:320,dpHeight:1200},"0cab4dfccdfc880687cb608cfe4159db":{label:"HTC One X, EVO LTE",width:720,height:1280,scaleFactor:2,dpWidth:360,dpHeight:2560},c4ff41fcba24d74fc21dc3490ca1edc9:{label:"HTC Sensation, Evo 3D",width:540,height:960,scaleFactor:1.5,dpWidth:360,dpHeight:1440},fa969a5e0dd2de53700eeee4ba4ba142:{label:"LG Optimus 2X, Optimus 3D, Optimus Black",width:480,height:800,scaleFactor:1.5,dpWidth:320,dpHeight:1200},"33c4f9364e295ec03531f3a3425819cf":{label:"LG Optimus G",width:768,height:1280,scaleFactor:2,dpWidth:384,dpHeight:2560},bc47f5275f0efd56fee52d43a8082981:{label:"LG Optimus LTE, Optimus 4X HD",width:720,height:1280,scaleFactor:1.7,dpWidth:424,dpHeight:2176},"0732887e6e324fd10777b735520a34cf":{label:"LG Optimus One",width:320,height:480,scaleFactor:1.5,dpWidth:213,dpHeight:720},"2e38a78364f09d0da0e9e1a3a68e7fb0":{label:"Motorola Defy, Droid, Droid X, Milestone",width:480,height:854,scaleFactor:1.5,dpWidth:320,dpHeight:1281},bd4b78dddc7c9625a4141a1b1ddabb87:{label:"Motorola Droid 3, Droid 4, Droid Razr, Atrix 4G, Atrix 2",width:540,height:960,scaleFactor:1,dpWidth:540,dpHeight:960},"3bf1edf21cfa81006183d2b02974c84e":{label:"Motorola Droid Razr HD",width:720,height:1280,scaleFactor:1,dpWidth:720,dpHeight:1280},ab5a352e0e016b97dac986f06c394f55:{label:"Nokia C5, C6, C7, N97, N8, X7",width:360,height:640,scaleFactor:1,dpWidth:360,dpHeight:640},"4826fb7d7257aeaac992ce699df41b3c":{label:"Nokia Lumia 7X0, Lumia 8XX, Lumia 900, N800, N810, N900",width:480,height:800,scaleFactor:1.5,dpWidth:320,dpHeight:1200},"0a691ab20add7c432200f8fa6527b488":{label:"Samsung Galaxy Note",width:800,height:1280,scaleFactor:2,dpWidth:400,dpHeight:2560},"9c23ee31be29960fbac9e9bbfc2fc7b0":{label:"Samsung Galaxy Note 3",width:1080,height:1920,scaleFactor:2,dpWidth:540,dpHeight:3840},"92177c0508c1d73905a58e2338f2a81f":{label:"Samsung Galaxy Note II",width:720,height:1280,scaleFactor:2,dpWidth:360,dpHeight:2560},"5222b8866dc4cc606725e16ffcc0a783":{label:"Samsung Galaxy S III, Galaxy Nexus",width:720,height:1280,scaleFactor:2,dpWidth:360,dpHeight:2560},"37c1541e2bd55cfd0f4073b0ccdf68b3":{label:"Samsung Galaxy S, S II, W",width:480,height:800,scaleFactor:1.5,dpWidth:320,dpHeight:1200},"2f7f64b7dda0144907ff300e83eed465":{label:"Samsung Galaxy S4",width:1080,height:1920,scaleFactor:3,dpWidth:360,dpHeight:5760},"9c24f9057744dad56043702a9703127f":{label:"Sony Xperia S, Ion",width:720,height:1280,scaleFactor:2,dpWidth:360,dpHeight:2560},"0a8b2732a016a9395c3af5f12dd9c0da":{label:"Sony Xperia Sola, U",width:480,height:854,scaleFactor:1,dpWidth:480,dpHeight:854},"5a153d7f53d82dcb0801f041574a6a43":{label:"Sony Xperia Z, Z1",width:1080,height:1920,scaleFactor:3,dpWidth:360,dpHeight:5760}},screens:{"9e523ae15b61dc766f5c818726881ecf":{label:"1920 × 1080",width:1920,height:1080,dpWidth:1920,dpHeight:1080,scaleFactor:1},"07769cd8d0a7d09818b2f0b018042fb7":{label:"1366 × 768",width:1366,height:768,dpWidth:1366,dpHeight:768,scaleFactor:1},"72d5478a24194f98b9378e8e0fd65737":{label:"1280 × 1024",width:1280,height:1024,dpWidth:1280,dpHeight:1024,scaleFactor:1},b7a6dd5900cc72e61f0d3479c7e314ec:{label:"1280 × 800",width:1280,height:800,dpWidth:1280,dpHeight:800,scaleFactor:1},"43193b0ff671a37d8232ab664190a125":{label:"1024 × 768",width:1024,height:768,dpWidth:1024,dpHeight:768,scaleFactor:1},c29e48814af5443ff5688d9e967ce917:{label:"800 × 600",width:800,height:600,dpWidth:800,dpHeight:600,scaleFactor:1}}}}),define("tpl!taoQtiItem/qtiCreator/tpl/preview/preview",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a,r="";return r+='\r\n                            <option value="',(a=i.value)?n=a.call(t,{hash:{},data:e}):(a=t&&t.value,n=typeof a===h?a.call(t,{hash:{},data:e}):a),r+=u(n)+'" ',n=i["if"].call(t,t&&t.selected,{hash:{},inverse:p.noop,fn:p.program(2,o,e),data:e}),(n||0===n)&&(r+=n),r+=">",(a=i.label)?n=a.call(t,{hash:{},data:e}):(a=t&&t.label,n=typeof a===h?a.call(t,{hash:{},data:e}):a),r+=u(n)+"</option>\r\n                            "
}function o(){return'selected="selected"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var s,l,c,d="",h="function",u=this.escapeExpression,p=this,f=i.helperMissing;return d+='<div class="preview-overlay tao-scope overlay preview-',(l=i.previewType)?s=l.call(e,{hash:{},data:a}):(l=e&&e.previewType,s=typeof l===h?l.call(e,{hash:{},data:a}):l),d+=u(s)+' item-no-print"\r\n     style="overflow-x: hidden;display:none">\r\n    <div class="preview-container-outer">\r\n        <div class="preview-canvas">\r\n            <form class="preview-utility-bar plain">\r\n                <div class="preview-utility-bar-inner grid-row">\r\n\r\n                    <div class="col-4">\r\n                        <input type="hidden" value="',(l=i.naturalItemSize)?s=l.call(e,{hash:{},data:a}):(l=e&&e.naturalItemSize,s=typeof l===h?l.call(e,{hash:{},data:a}):l),d+=u(s)+'" class="standard-device-selector preview-device-selector" data-target="standard">\r\n                        <select class="preview-type-selector">\r\n                            ',s=i.each.call(e,e&&e.previewTypes,{hash:{},inverse:p.noop,fn:p.program(1,r,a),data:a}),(s||0===s)&&(d+=s),d+='\r\n                        </select>\r\n                    </div>\r\n                    <div class="col-6 standard-only device-type-and-orientation"></div>\r\n                    <div class="col-6 desktop-only device-type-and-orientation">\r\n                        <select class="desktop-device-selector preview-device-selector" data-target="desktop">\r\n                            ',s=i.each.call(e,e&&e.desktopDevices,{hash:{},inverse:p.noop,fn:p.program(1,r,a),data:a}),(s||0===s)&&(d+=s),d+='\r\n                        </select>\r\n                    </div>\r\n                    <div class="col-6 mobile-only device-type-and-orientation">\r\n                        <select class="mobile-device-selector preview-device-selector" data-target="mobile">\r\n                            ',s=i.each.call(e,e&&e.mobileDevices,{hash:{},inverse:p.noop,fn:p.program(1,r,a),data:a}),(s||0===s)&&(d+=s),d+='\r\n                        </select>\r\n                        <select tabindex="-1" class="mobile-orientation-selector orientation-selector"\r\n                                data-target="mobile">\r\n                            <option value="landscape">'+u((l=i.__||e&&e.__,c={hash:{},data:a},l?l.call(e,"Landscape",c):f.call(e,"__","Landscape",c)))+'</option>\r\n                            <option value="portrait">'+u((l=i.__||e&&e.__,c={hash:{},data:a},l?l.call(e,"Portrait",c):f.call(e,"__","Portrait",c)))+'</option>\r\n                        </select>\r\n                    </div>\r\n                    <div class="col-2">\r\n                            <span class="btn-info small preview-closer rgt">\r\n                                '+u((l=i.__||e&&e.__,c={hash:{},data:a},l?l.call(e,"Close",c):f.call(e,"__","Close",c)))+'\r\n                                <span class="icon-close r"></span>\r\n                            </span>\r\n                    </div>\r\n                </div>\r\n                <div class="preview-message-box">\r\n                    <div class="feedback-info small">\r\n                        <span class="icon-info"></span>\r\n                        '+u((l=i.__||e&&e.__,c={hash:{},data:a},l?l.call(e,"This preview may be scaled to fit your screen. The final rendering may differ.",c):f.call(e,"__","This preview may be scaled to fit your screen. The final rendering may differ.",c)))+'\r\n                        <a href="#">'+u((l=i.__||e&&e.__,c={hash:{},data:a},l?l.call(e,"Don’t show this again!",c):f.call(e,"__","Don’t show this again!",c)))+'</a>\r\n                        <span title="'+u((l=i.__||e&&e.__,c={hash:{},data:a},l?l.call(e,"Remove this message",c):f.call(e,"__","Remove this message",c)))+'" class="icon-close close-trigger"></span>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n            <div class="preview-scale-container">\r\n                <div class="',(l=i.previewType)?s=l.call(e,{hash:{},data:a}):(l=e&&e.previewType,s=typeof l===h?l.call(e,{hash:{},data:a}):l),d+=u(s)+"-preview-frame preview-outer-frame ",(l=i.previewType)?s=l.call(e,{hash:{},data:a}):(l=e&&e.previewType,s=typeof l===h?l.call(e,{hash:{},data:a}):l),d+=u(s)+'-preview-landscape">\r\n                    <div class="',(l=i.previewType)?s=l.call(e,{hash:{},data:a}):(l=e&&e.previewType,s=typeof l===h?l.call(e,{hash:{},data:a}):l),d+=u(s)+'-preview-container preview-container">\r\n                        <iframe class="preview-iframe"></iframe>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'})}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/cssToggler",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a,r="";return r+='\n<li data-css-res="',(a=i.path)?n=a.call(t,{hash:{},data:e}):(a=t&&t.path,n=typeof a===s?a.call(t,{hash:{},data:e}):a),r+=l(n)+'">\n    <span class="icon-preview style-sheet-toggler" title="',(a=i.title)?n=a.call(t,{hash:{},data:e}):(a=t&&t.title,n=typeof a===s?a.call(t,{hash:{},data:e}):a),r+=l(n)+'"></span>\n    <span class="file-label truncate" title="',(a=i.editLabelTxt)?n=a.call(t,{hash:{},data:e}):(a=t&&t.editLabelTxt,n=typeof a===s?a.call(t,{hash:{},data:e}):a),r+=l(n)+'">',(a=i.label)?n=a.call(t,{hash:{},data:e}):(a=t&&t.label,n=typeof a===s?a.call(t,{hash:{},data:e}):a),r+=l(n)+'</span>\n    <input type="text" class="style-sheet-label-editor" value="',(a=i.label)?n=a.call(t,{hash:{},data:e}):(a=t&&t.label,n=typeof a===s?a.call(t,{hash:{},data:e}):a),r+=l(n)+'">\n    <span class="icon-bin" title="',(a=i.deleteTxt)?n=a.call(t,{hash:{},data:e}):(a=t&&t.deleteTxt,n=typeof a===s?a.call(t,{hash:{},data:e}):a),r+=l(n)+'" data-role="css-delete"></span>\n    <span class="icon-download" title="',(a=i.downloadTxt)?n=a.call(t,{hash:{},data:e}):(a=t&&t.downloadTxt,n=typeof a===s?a.call(t,{hash:{},data:e}):a),r+=l(n)+'" data-role="css-download"></span>\n</li>\n'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s="function",l=this.escapeExpression,c=this;return o=i.each.call(e,e&&e.stylesheets,{hash:{},inverse:c.noop,fn:c.program(1,r,a),data:a}),o||0===o?o:""})}),function(t){t.extend({fileDownload:function(e,i){function n(){if(-1!=document.cookie.indexOf(l.cookieName+"="+l.cookieValue)){m.onSuccess(e);var i=new Date(1e3);return document.cookie=l.cookieName+"=; expires="+i.toUTCString()+"; path="+l.cookiePath,void r(!1)}if(v||g)try{var o;if(o=v?v.document:a(g),o&&null!=o.body&&o.body.innerHTML.length>0){var s=!0;if(I&&I.length>0){var c=t(o.body).contents().first();c.length>0&&c[0]===I[0]&&(s=!1)}if(s)return m.onFail(o.body.innerHTML,e),void r(!0)}}catch(d){return m.onFail("",e),void r(!0)}setTimeout(n,l.checkInterval)}function a(t){var e=t[0].contentWindow||t[0].contentDocument;return e.document&&(e=e.document),e}function r(t){setTimeout(function(){v&&(h&&v.close(),d&&(t?(v.focus(),v.close()):v.focus()))},0)}function o(t){return t.replace(/&/gm,"&amp;").replace(/\n/gm,"&#10;").replace(/\r/gm,"&#13;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;").replace(/'/gm,"&apos;")}var s=function(){alert("A file download error has occurred, please try again.")},l=t.extend({preparingMessageHtml:null,failMessageHtml:null,androidPostUnsupportedMessageHtml:"Unfortunately your Android browser doesn't support this type of file download. Please try again with a different browser.",dialogOptions:{modal:!0},successCallback:function(){},failCallback:s,httpMethod:"GET",data:null,checkInterval:100,cookieName:"fileDownload",cookieValue:"true",cookiePath:"/",popupWindowTitle:"Initiating file download...",encodeHTMLEntities:!0},i),c=(navigator.userAgent||navigator.vendor||window.opera).toLowerCase(),d=!1,h=!1,u=!1;/ip(ad|hone|od)/.test(c)?d=!0:-1!=c.indexOf("android")?h=!0:u=/avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|playbook|silk|iemobile|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(c)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(c.substr(0,4));var p=l.httpMethod.toUpperCase();if(h&&"GET"!=p)return void(t().dialog?t("<div>").html(l.androidPostUnsupportedMessageHtml).dialog(l.dialogOptions):alert(l.androidPostUnsupportedMessageHtml));var f=null;l.preparingMessageHtml&&(f=t("<div>").html(l.preparingMessageHtml).dialog(l.dialogOptions));var m={onSuccess:function(t){f&&f.dialog("close"),l.successCallback(t)},onFail:function(e,i){f&&f.dialog("close"),l.failMessageHtml?(t("<div>").html(l.failMessageHtml).dialog(l.dialogOptions),l.failCallback!=s&&l.failCallback(e,i)):l.failCallback(e,i)}};null!==l.data&&"string"!=typeof l.data&&(l.data=t.param(l.data));var g,v,C,I;if("GET"===p){if(null!==l.data){var b=e.indexOf("?");-1!=b?"&"!==e.substring(e.length-1)&&(e+="&"):e+="?",e+=l.data}d||h?(v=window.open(e),v.document.title=l.popupWindowTitle,window.focus()):u?window.location(e):g=t("<iframe>").hide().attr("src",e).appendTo("body")}else{var E="";null!==l.data&&t.each(l.data.replace(/\+/g," ").split("&"),function(){var t=this.split("="),e=l.encodeHTMLEntities?o(decodeURIComponent(t[0])):decodeURIComponent(t[0]);if(e){var i=t[1]||"";i=l.encodeHTMLEntities?o(decodeURIComponent(t[1])):decodeURIComponent(t[1]),E+='<input type="hidden" name="'+e+'" value="'+i+'" />'}}),u?(I=t("<form>").appendTo("body"),I.hide().attr("method",l.httpMethod).attr("action",e).html(E)):(d?(v=window.open("about:blank"),v.document.title=l.popupWindowTitle,C=v.document,window.focus()):(g=t("<iframe style='display: none' src='about:blank'></iframe>").appendTo("body"),C=a(g)),C.write("<html><head></head><body><form method='"+l.httpMethod+"' action='"+e+"'>"+E+"</form>"+l.popupWindowTitle+"</body></html>"),I=t(C).find("form")),I.submit()}setTimeout(n,l.checkInterval)}})}(jQuery),define("lib/jquery.fileDownload",function(){}),define("taoQtiItem/qtiCreator/editor/styleEditor/styleEditor",["jquery","lodash","helpers","i18n","tpl!taoQtiItem/qtiCreator/tpl/toolbars/cssToggler","lib/jquery.fileDownload"],function(t,e,i,n,a){var r,o=function(t){return i._url(t,"QtiCssAuthoring","taoQtiItem")},s=function(t){return t.substring(t.lastIndexOf("/")+1)},l=function(t,i){var l,c={},d=function(){var e=t("<style>",{id:"item-editor-user-styles"});return t("head").append(e),e}(),h={title:n("Disable this stylesheet temporarily"),deleteTxt:n("Delete this stylesheet"),editLabelTxt:n("Edit stylesheet label"),downloadTxt:n("Download this stylesheet"),preparingMessageHtml:n("Preparing CSS, please wait…"),failMessageHtml:n("There was a problem downloading your CSS, please try again."),listing:t("#style-sheet-toggler")},u="",p=function(t){var i,n,a,r,o="";if(e.isEmpty(c))return m();for(i in c)if(c.hasOwnProperty(i)){o+=i+"{";for(n in c[i])if(c[i].hasOwnProperty(n))if(e.isPlainObject(c[i][n]))for(a in c[i][n]){o+=n+"{";for(r in c[i][n])o+=r+":"+c[i][n][a]+";";o+="}"}else o+=n+":"+c[i][n]+";";o+="}\n"}return t||d.text(o),o},f=function(t,i,n){c[t]=c[t]||{},n?c[t][i]=n:(delete c[t][i],0===e.size(c[t])&&delete c[t]),p()},m=function(){return c={},d.text(""),!1},g=function(){return C(),t.post(o("save"),e.extend({},r,{cssJson:JSON.stringify(c),stylesheetUri:u.attr("href")}))},v=function(i){C(),t.fileDownload(o("download"),{preparingMessageHtml:h.preparingMessageHtml,failMessageHtml:h.failMessageHtml,successCallback:function(){},httpMethod:"POST",data:e.extend({},r,{stylesheetUri:i})})},C=function(){if(!r)throw new Error("Missing itemConfig, did you call styleEditor.init()?");return!0},I=function(i){var n,r,o,c=[];e.isString(i)&&(i=l.createStyleSheet(i)),n=s(i.attr("href")),r=t(i.render()),d.before(r),c.push({path:i.attr("href"),label:i.attr("title")||n,title:h.title,deleteTxt:h.deleteTxt,downloadTxt:h.downloadTxt,editLabelTxt:h.editLabelTxt}),o=t(a({stylesheets:c})),o.data("stylesheetObj",i),h.listing.append(o)},b=function(){var t;for(var e in l.stylesheets)l.stylesheets.hasOwnProperty(e)&&(t=l.stylesheets[e],"tao-user-styles.css"!==s(t.attr("href"))?I(l.stylesheets[e]):u=t);u||(u=l.createStyleSheet("style/custom/tao-user-styles.css"))},E=function(){return l},y=function(n,a){l=n,r={uri:a.uri,lang:a.lang,baseUrl:a.baseUrl},b();var s=o("load")+"?",d=t("#item-editor-item-resizer").data("target"),h=u.attr("href");l.data("responsive",!0),s+=t.param(e.extend({},r,{stylesheetUri:h})),require(["json!"+s],function(e){c=e,p(),l.data("responsive",!(!c[d]||!c[d].width)),t(i).trigger("customcssloaded.styleeditor",[c])})},T=function(){return c};return{apply:f,save:g,download:v,erase:m,init:y,create:p,getItem:E,getStyle:T,addStylesheet:I}}(t,document);return l}),jQuery.cookie=function(t,e,i){if("undefined"==typeof e){var n=null;if(document.cookie&&""!=document.cookie)for(var a=document.cookie.split(";"),r=0;r<a.length;r++){var o=jQuery.trim(a[r]);if(o.substring(0,t.length+1)==t+"="){n=decodeURIComponent(o.substring(t.length+1));break}}return n}i=i||{},null===e&&(e="",i.expires=-1);var s="";if(i.expires&&("number"==typeof i.expires||i.expires.toUTCString)){var l;"number"==typeof i.expires?(l=new Date,l.setTime(l.getTime()+24*i.expires*60*60*1e3)):l=i.expires,s="; expires="+l.toUTCString()}var c=i.path?"; path="+i.path:"",d=i.domain?"; domain="+i.domain:"",h=i.secure?"; secure":"";document.cookie=[t,"=",encodeURIComponent(e),s,c,d,h].join("")},define("jquery.cookie",function(){}),define("taoQtiItem/qtiCreator/editor/preview",["jquery","lodash","i18n","taoQtiItem/qtiCreator/helper/commonRenderer","json!taoQtiItem/qtiCreator/editor/resources/device-list.json","tpl!taoQtiItem/qtiCreator/tpl/preview/preview","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","helpers","ui/modal","select2","jquery.cookie"],function(t,e,i,n,a,r,o,s){"use strict";var l,c,d,h,u="landscape",p="desktop",f={desktop:i("Desktop preview"),mobile:i("Mobile preview"),standard:i("Standard preview")},m=t(document),g=t(window),v=t(document.body),C={width:g.innerWidth(),height:g.innerHeight()},I={width:0,height:0},b=1,E=!1,y=function(t){var i="mobile"===t?a.tablets:a.screens,n=[];return e.forEach(i,function(t){I={width:Math.max(I.width,t.width),height:Math.max(I.height,t.height)},n.push({value:[t.width,t.height].join(","),label:t.label,selected:p===t.label})}),n},T=function(){d=l.add(l.find(".preview-scale-container").find('[class*="'+p+'"]'))},R=function(t){if(t!==p){var e=new RegExp(p,"g");d.each(function(){this.className=this.className.replace(e,t)}),p=t}},w=function(e){if(e!==u){var i=new RegExp(u,"g"),n=t(".preview-outer-frame")[0];n.className=n.className.replace(i,e),u=e}},O=function(){var e=t(".preview-scale-container"),i="standard"===p?1:b,n=e.width()*i,a=(C.width-n)/2;e.css({left:a,"-webkit-transform":"scale("+i+","+i+")","-ms-transform":"scale("+i+","+i+")",transform:"scale("+i+","+i+")","-webkit-transform-origin":"0 0","-ms-transform-origin":"0 0","transform-origin":"0 0"}),t(".preview-utility-bar, .preview-message-box").width(C.width)},_=function(){var t={x:1,y:1},e={width:I.width+150,height:I.height+250};e.width>C.width&&(t.x=C.width/e.width),e.height>C.height&&(t.y=C.height/e.height),b=Math.min(t.x,t.y)},D=function(){var e=l.find(".preview-device-selector");e.on("change",function(){var e,i=t(this),n=i.data("target"),a=i.val().split(","),r=a.length,o=l.find("."+n+"-preview-container");for(l.find(".preview-iframe");r--;)a[r]=parseFloat(a[r]);return e="mobile"===n&&"portrait"===u?{width:a[1],height:a[0]}:{width:a[0],height:a[1]},e.width===o.width()&&e.height===o.height()?!1:(o.css(e),R(n),void O())}),e.each(function(){"select"===this.nodeName.toLowerCase()&&t(this).select2({minimumResultsForSearch:-1})})},x=function(){t("select.orientation-selector").on("change",function(){var e,i=t(this).data("target"),n=t("."+i+"-preview-frame"),a=n.find("."+i+"-preview-container"),r=(l.find(".preview-iframe"),t(this).val());return r===u?!1:(e={height:a.width(),width:a.height()},a.css(e),O(),void w(r))}).select2({minimumResultsForSearch:-1})},k=function(){var e=l.find(".preview-closer"),i=h.find(".close-trigger"),a=h.find("a");e.on("click",function(){n.setContext(t(".item-editor-item")),l.hide()}),m.keyup(function(t){27==t.keyCode&&e.trigger("click")}),i.on("click",function(){h.hide()}),a.on("click",function(e){e.preventDefault(),t.cookie("hidePreviewFeedback",!0,{expires:1e3,path:"/"}),i.trigger("click")})},K=function(){var t=[];return e(f).forEach(function(e,i){t.push({value:i,label:e,selected:p===i})}),t},q=function(){t("select.preview-type-selector").on("change",function(){var e=t(this),i=e.val();R(i),t("."+i+"-device-selector").trigger("change")}).select2({minimumResultsForSearch:-1})},S=function(){var e=t("#item-editor-panel .qti-item");return e.outerWidth().toString()+",auto"},N=function(){t(".preview-overlay").remove(),c=null,l=t(r({mobileDevices:y("mobile"),desktopDevices:y("desktop"),previewTypes:K(),previewType:p,naturalItemSize:S()})),v.append(l),h=l.find(".preview-message-box"),t.cookie("hidePreviewFeedback")&&h.hide(),T(),D(),x(),q(),k(),_(),R(p),w(u),g.on("resize, orientationchange",function(){l.is(":visible")&&(_(),O())})},A=function(){{var e=t(".preview-modal-feedback"),i=e.find(".cancel"),n=e.find(".save");e.find(".modal-close")}e.modal({width:500}),n.on("click",function(){E=!0,l.trigger("save.preview"),e.modal("close")}),i.on("click",function(){e.modal("close")})},Q=function(e,i){var n=function(){var n=s._url("index","QtiPreview","taoQtiItem")+"?uri="+encodeURIComponent(i.itemUri)+"&quick=1";return t(".preview-iframe").attr("src",n),t.when(o.save(),i.save()).done(function(){p=t(e).data("preview-type")||"desktop",l.show(),l.height(m.outerHeight()),l.find("select:visible").trigger("change"),O()}),!0};return E?n():(A(),void l.on("save.preview",function(){return l.off("save.preview"),n()}))};return function(t){var e=function(e,i){N(),t(e).on("click",function(){Q(this,i)})};return{init:e}}(t)}),define("taoQtiItem/qtiCreator/editor/preparePrint",["jquery"],function(t){"use strict";var e=function(){function e(e){return e.siblings().each(function(){t(this).addClass("item-no-print")}),e.parent()}for(var i=e(t("#item-editor-scope").parent());i.length&&"body"!==i.get(0).nodeName.toLowerCase();)i=e(i);t("#item-editor-toolbar, .item-editor-sidebar").addClass("item-no-print")};return t("#print-trigger").on("click",function(){window.print()}),e}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/tooltip",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l="function",c=this.escapeExpression;return s+='<div>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">\n        ',(o=i.message)?r=o.call(e,{hash:{},data:a}):(o=e&&e.message,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+"\n    </div>\n</div>"})}),define("taoQtiItem/qtiCreator/editor/editor",["jquery","i18n","tpl!taoQtiItem/qtiCreator/tpl/toolbars/tooltip","ui/tooltipster"],function(t,e,i,n){var a=function(){var a={},r=function(){var e,i={scope:"#item-editor-scope",toolbar:"#item-editor-toolbar",toolbarInner:"#item-editor-toolbar-inner",sidebars:".item-editor-sidebar",itemBar:"#item-editor-item-bar",itemPanel:"#item-editor-panel"};for(e in i)a[e]=t(i[e])},o="h2",s="section",l="hr, .panel",c="closed",d="accordion",h=function(){a.sidebars.find("[data-sub-group]").each(function(){var e,i,n,a=t(this),r=a.parents("section"),o=a.data("sub-group");o&&(e=r.find(".sub-group."+o),i=e.find(".tool-list"),e.length||(e=t("<div>",{"class":"panel clearfix sub-group "+o}),i=t("<ul>",{"class":"tool-list plain clearfix"}),e.append(i),r.append(e),n=t("<div>",{"class":"sub-group-cover blocking"}),e.append(n),e.data("cover",n)),i.append(a))}),E()},u=function(){a.sidebars.each(function(){var e=t(this),i=e.find(s),n=(e.children(l).hide(),e.find(o));return 0===n.length?!0:(n.each(function(){var e=t(this),i=e.parents(s),n=i.children(l),a=t("<span>",{"class":"icon-up"}),r=t("<span>",{"class":"icon-down"}),o=n.is(":visible")?"open":"close";e.append(a).append(r).addClass(c),n.on("panelclose."+d+" panelopen."+d,function(t,e){var i="panelclose"===t.type?"add":"remove";e.heading[i+"Class"](c)}),n.trigger("panel"+o+"."+d,{heading:e})}),void i.each(function(){t(this).find(o).on("click",function(e,i){var n,a,r=t(this),o=r.parents(s).children(l),h=(!(!i||!i.preserveOthers),{close:"hide",open:"fadeIn"}),u=i&&i.forceState?i.forceState:!1;u&&(a="open"===u?"addClass":"removeClass",r[a](c)),n=r.hasClass(c)?"open":"close",o.trigger("panel"+n+"."+d,{heading:r})[h[n]]()})}))})},p=function(e,i,n){e.each(function(){t(this).find(o).trigger("click",{preserveOthers:i,forceState:n})})},f=function(t,e){p(t,!!e,"close")},m=function(t,e){p(t,!!e,"open")},g=function(e,i){e.each(function(){var e=t(this);i?(e.css("display",e.prop("old-display")),e.css("opacity",e.prop("old-opacity")),e.removeProp("old-display"),e.removeProp("old-opacity")):(e.prop("old-display",e.css("display")),e.prop("old-opacity",e.css("opacity")),e.css("display","block"),e.css("opacity",0))})},v=function(){var e=0;a.sidebars.add(a.itemPanel).each(function(){var i=t(this),n=i.add(i.find("section hr .panel"));g(n),e=Math.max(i.height(),e),g(n,!0)}).height(e)},C=function(e,i){if(e=t("."+e),e.length){var n="disable"===i?"addClass":"removeClass";e.data("cover")[n]("blocking")}},I=function(t){C(t,"enable")},b=function(t){C(t,"disable")},E=function(){var a,r=t("#sidebar-left-section-inline-interactions .inline-interactions"),o=t(i({message:e("Inline interactions need to be inserted into a text block.")}));r.append(o),n(r),o.css({position:"absolute",zIndex:11,top:0,right:10}),r.on("mouseenter",".sub-group-cover",function(){a=setTimeout(function(){o.find("[data-tooltip]").tooltipster("show")},300)}).on("mouseleave",".sub-group-cover",function(){o.find("[data-tooltip]").tooltipster("hide"),clearTimeout(a)})},y=function(){r(),h(),u(),f(a.sidebars.find(s)),v(),m(t("#sidebar-left-section-common-interactions"),!1),a.itemPanel.addClass("has-item")};return{initGui:y,openSections:m,closeSections:f,adaptHeight:v,enableSubGroup:I,disableSubGroup:b}}();return a}),define("taoQtiItem/qtiCreator/helper/panel",["jquery","lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/editor/editor"],function(t,e,i,n){var a=function(){return t("#item-editor-panel")},r=function(t,e){t.show(),n.openSections(t.children("section")),e&&e.length&&n.closeSections(e.children("section"))},o=function(){t(document).off(".panel"),n.adaptHeight();var o=a(),l={img:"Image",object:"Media",rubricBlock:"Rubric Block",math:"Math"},c=t("#item-editor-interaction-property-bar"),d=t("#item-editor-choice-property-bar"),h=t("#item-editor-response-property-bar"),u=t("#item-editor-item-property-bar"),p=t("#item-editor-body-element-property-bar"),f=t("#item-editor-text-property-bar"),m=t("#item-editor-modal-feedback-property-bar"),g=t("#item-style-editor-bar"),v=t("#appearance-trigger"),C=function(t){t?(v.addClass("active"),g.show(),u.hide(),o.trigger("styleedit"),r(g)):(v.removeClass("active"),g.hide(),r(u))};v.on("click",function(){C(v.hasClass("active")?!1:!0)}),e.delay(function(){r(u)},200),t(document).on("afterStateInit.qti-widget.panel",function(t,e,n){switch(n.name){case"active":C(!1),i.isA(e,"assessmentItem")||u.hide();var a=l[e.qtiClass];a?(p.find("h2").html(a+" Properties"),r(p)):"_container"===e.qtiClass&&r(f),"modalFeedback"===e.qtiClass&&(r(m),h.hide());break;case"question":r(c);break;case"choice":r(d,c);break;case"answer":r(h);break;case"sleep":l[e.qtiClass]?p.hide():"_container"===e.qtiClass&&f.hide(),i.isA(e,"choice")||o.find(".widget-box.edit-active").length||r(u)}}).on("beforeStateExit.qti-widget.panel",function(t,e,i){switch(i.name){case"active":"modalFeedback"===e.qtiClass&&(r(h),m.hide());break;case"question":c.hide();break;case"choice":d.hide();break;case"answer":h.hide()}}).on("elementCreated.qti-widget.panel",function(t,e){"_container"===e.element.qtiClass&&n.enableSubGroup("inline-interactions")}).on("deleted.qti-widget.panel",function(t,e){"_container"===e.element.qtiClass&&s()})},s=function(){var t=a();t.find(".widget-textBlock").length?n.enableSubGroup("inline-interactions"):n.disableSubGroup("inline-interactions")};return{initFormVisibilityListener:o,showPanel:r,toggleInlineInteractionGroup:s}}),define("taoQtiItem/qtiItem/core/qtiClasses",[],function(){return{_container:"taoQtiItem/qtiItem/core/Container",assessmentItem:"taoQtiItem/qtiItem/core/Item",responseProcessing:"taoQtiItem/qtiItem/core/ResponseProcessing",_simpleFeedbackRule:"taoQtiItem/qtiItem/core/response/SimpleFeedbackRule",stylesheet:"taoQtiItem/qtiItem/core/Stylesheet",math:"taoQtiItem/qtiItem/core/Math",img:"taoQtiItem/qtiItem/core/Img",object:"taoQtiItem/qtiItem/core/Object",outcomeDeclaration:"taoQtiItem/qtiItem/core/variables/OutcomeDeclaration",responseDeclaration:"taoQtiItem/qtiItem/core/variables/ResponseDeclaration",rubricBlock:"taoQtiItem/qtiItem/core/RubricBlock",associableHotspot:"taoQtiItem/qtiItem/core/choices/AssociableHotspot",gap:"taoQtiItem/qtiItem/core/choices/Gap",gapImg:"taoQtiItem/qtiItem/core/choices/GapImg",gapText:"taoQtiItem/qtiItem/core/choices/GapText",hotspotChoice:"taoQtiItem/qtiItem/core/choices/HotspotChoice",hottext:"taoQtiItem/qtiItem/core/choices/Hottext",inlineChoice:"taoQtiItem/qtiItem/core/choices/InlineChoice",simpleAssociableChoice:"taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice",simpleChoice:"taoQtiItem/qtiItem/core/choices/SimpleChoice",associateInteraction:"taoQtiItem/qtiItem/core/interactions/AssociateInteraction",choiceInteraction:"taoQtiItem/qtiItem/core/interactions/ChoiceInteraction",endAttemptInteraction:"taoQtiItem/qtiItem/core/interactions/EndAttemptInteraction",extendedTextInteraction:"taoQtiItem/qtiItem/core/interactions/ExtendedTextInteraction",gapMatchInteraction:"taoQtiItem/qtiItem/core/interactions/GapMatchInteraction",graphicAssociateInteraction:"taoQtiItem/qtiItem/core/interactions/GraphicAssociateInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiItem/core/interactions/GraphicGapMatchInteraction",graphicOrderInteraction:"taoQtiItem/qtiItem/core/interactions/GraphicOrderInteraction",hotspotInteraction:"taoQtiItem/qtiItem/core/interactions/HotspotInteraction",hottextInteraction:"taoQtiItem/qtiItem/core/interactions/HottextInteraction",inlineChoiceInteraction:"taoQtiItem/qtiItem/core/interactions/InlineChoiceInteraction",matchInteraction:"taoQtiItem/qtiItem/core/interactions/MatchInteraction",mediaInteraction:"taoQtiItem/qtiItem/core/interactions/MediaInteraction",orderInteraction:"taoQtiItem/qtiItem/core/interactions/OrderInteraction",prompt:"taoQtiItem/qtiItem/core/interactions/Prompt",selectPointInteraction:"taoQtiItem/qtiItem/core/interactions/SelectPointInteraction",sliderInteraction:"taoQtiItem/qtiItem/core/interactions/SliderInteraction",textEntryInteraction:"taoQtiItem/qtiItem/core/interactions/TextEntryInteraction",uploadInteraction:"taoQtiItem/qtiItem/core/interactions/UploadInteraction",feedbackBlock:"taoQtiItem/qtiItem/core/feedbacks/FeedbackBlock",feedbackInline:"taoQtiItem/qtiItem/core/feedbacks/FeedbackInline",modalFeedback:"taoQtiItem/qtiItem/core/feedbacks/ModalFeedback"}}),define("taoQtiItem/qtiItem/core/Loader",["lodash","class","taoQtiItem/qtiItem/core/qtiClasses","taoQtiItem/qtiItem/core/Element"],function(t,e,i,n){var a=e.extend({init:function(t,e){this.qti={},this.classesLocation={},this.item=t||null,this.setClassesLocation(e||i)},setClassesLocation:function(e){return t.extend(this.classesLocation,e),this},getRequiredClasses:function(e){var i=[];for(var n in e)"qtiClass"===n&&"_container"!==e[n]&&"relatedItem"!==n?i.push(e[n]):"object"==typeof e[n]&&(i=t.union(i,this.getRequiredClasses(e[n])));return i},loadRequiredClasses:function(e,i,n){var a=this.getRequiredClasses(e,n),r=[];for(var o in a){var s=a[o];if(!this.classesLocation[s])throw new Error("missing qti class location declaration : "+s);r.push(this.classesLocation[s])}var l=this;require(r,function(){t.each(arguments,function(t){l.qti[t.prototype.qtiClass]=t}),i.call(l,l.qti)})},getLoadedClasses:function(){return t.keys(this.qti)},loadItemData:function(e,i){var n=this;n.loadRequiredClasses(e,function(a){if("object"==typeof e&&"assessmentItem"===e.qtiClass){n.item=new a.assessmentItem(e.serial,e.attributes||{}),n.loadContainer(n.item.getBody(),e.body);for(var r in e.outcomes){var o=n.buildOutcome(e.outcomes[r]);o&&n.item.addOutcomeDeclaration(o)}for(var r in e.feedbacks){var s=n.buildElement(e.feedbacks[r]);s&&n.item.addModalFeedback(s)}for(var r in e.stylesheets){var l=n.buildElement(e.stylesheets[r]);l&&n.item.addStylesheet(l)}for(var r in e.responses){var c=n.buildResponse(e.responses[r]);if(c){n.item.addResponseDeclaration(c);var d=e.responses[r].feedbackRules;d&&t.forIn(d,function(t,e){c.feedbackRules[e]=n.buildSimpleFeedbackRule(t)})}}e.responseProcessing&&n.item.setResponseProcessing(n.buildResponseProcessing(e.responseProcessing)),n.item.setNamespaces(e.namespaces)}"function"==typeof i&&i.call(n,n.item)})},loadElement:function(t,e){var i=this;i.loadRequiredClasses(t,function(){var n=i.buildElement(t);"function"==typeof e&&e.call(i,n)})},loadElements:function(t,e){var i=this;if(!i.item)throw"QtiLoader : cannot load elements in empty item";this.loadRequiredClasses(t,function(){var n=i.item.getComposingElements();for(var a in t){var r=t[a];r&&r.qtiClass&&r.serial&&n[r.serial]&&i.loadElementData(n[r.serial],r)}"function"==typeof e&&e.call(i,i.item)})},buildResponse:function(e){var i=this.buildElement(e);return i.template=e.howMatch||null,i.defaultValue=e.defaultValue||null,i.correctResponse=e.correctResponses||null,i.mapEntries=t.size(e.mapping)?e.mapping:t.size(e.areaMapping)?e.areaMapping:{},i.mappingAttributes=e.mappingAttributes||{},i},buildSimpleFeedbackRule:function(t){var e=this.buildElement(t);return t.condition&&(e.condition=t.condition),t.comparedValue&&(e.comparedValue=t.comparedValue),e.comparedOutcome=this.item.responses[t.comparedOutcome]||null,e.feedbackOutcome=this.item.outcomes[t.feedbackOutcome]||null,e.feedbackThen=this.item.modalFeedbacks[t.feedbackThen]||null,e.feedbackElse=this.item.modalFeedbacks[t.feedbackElse]||null,e},buildOutcome:function(t){var e=this.buildElement(t);return e.defaultValue=t.defaultValue||null,e
},buildResponseProcessing:function(t){var e=this.buildElement(t);return t&&t.processingType&&("custom"===t.processingType?(e.xml=t.data,e.processingType="custom"):e.processingType="templateDriven"),e},loadContainer:function(t,e){if(!n.isA(t,"_container"))throw"bodyObject must be a QTI Container";if(!e||"string"!=typeof e.body||"array"!=typeof e.elements&&"object"!=typeof e.elements)throw"wrong bodydata format";for(var i in e.elements){var a=e.elements[i],r=this.buildElement(a);r&&t.setElement(r,e.body)}t.body(e.body)},buildElement:function(t){var e=null;if(!(t&&t.qtiClass&&t.serial))throw"wrong elementData format";var i=t.qtiClass;if(!this.qti[i])throw"the qti element class does not exist: "+i;return e=new this.qti[i](t.serial),this.loadElementData(e,t),e},loadElementData:function(e,i){return e.setAttributes(t.clone(i.attributes)||{}),e.body&&i.body&&e.bdy&&this.loadContainer(e.getBody(),i.body),e.object&&i.object&&e.object&&this.loadObjectData(e.object,i.object),n.isA(e,"interaction")?this.loadInteractionData(e,i):n.isA(e,"choice")?this.loadChoiceData(e,i):n.isA(e,"math")&&this.loadMathData(e,i),e},loadInteractionData:function(t,e){n.isA(t,"blockInteraction")&&e.prompt&&this.loadContainer(t.prompt.getBody(),e.prompt),this.buildInteractionChoices(t,e)},buildInteractionChoices:function(t,e){if(e.choices){if(n.isA(t,"matchInteraction"))for(var i=0;2>i;i++){if(!e.choices[i])throw"missing match set #"+i;var a=e.choices[i];for(var r in a){var o=this.buildElement(a[r]);o&&t.addChoice(o,i)}}else for(var r in e.choices){var o=this.buildElement(e.choices[r]);o&&t.addChoice(o)}if(n.isA(t,"graphicGapMatchInteraction")&&e.gapImgs)for(var r in e.gapImgs){var s=this.buildElement(e.gapImgs[r]);s&&t.addGapImg(s)}}},loadChoiceData:function(t,e){n.isA(t,"textVariableChoice")?t.val(e.text):n.isA(t,"gapImg")||n.isA(t,"containerChoice")},loadObjectData:function(t,e){t.setAttributes(e.attributes),e._alt&&(t._alt="object"===e._alt.qtiClass?a.buildElement(e._alt):e._alt)},loadMathData:function(t,e){t.ns=e.ns||{},t.setMathML(e.mathML||""),t.annotations=e.annotations||{}}});return a}),define("taoQtiItem/qtiCreator/model/helper/event",["jquery","taoQtiItem/qtiItem/core/Element"],function(t,e){return{choiceCreated:function(e,i){t(document).trigger("choiceCreated.qti-widget",{choice:e,interaction:i})},deleted:function(i,n){e.unsetElement(i.getSerial()),t(document).off("."+i.getSerial()),t(document).trigger("deleted.qti-widget",{element:i,parent:n})}}}),define("taoQtiItem/qtiCreator/model/mixin/editable",["lodash","jquery","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/model/helper/event"],function(t,e,i,n){var a=function(e){var a=!1,r=e.getRelatedItem();if(!r)throw"no related item found";var o=r.find(e.getSerial());if(o){var s=o.parent;i.isA(s,"interaction")?("gapImg"===e.qtiClass?s.removeGapImg(e):i.isA(e,"choice")&&s.removeChoice(e),a=!0):"function"==typeof s.initContainer&&"body"===o.location&&(t.isFunction(e.beforeRemove)&&e.beforeRemove(),s.getBody().removeElement(e),a=!0),a&&n.deleted(e,s)}return a},r=function(t,e,n){if(t[e]){var a="";"string"==typeof n?a=n:n instanceof i&&(a=n.getSerial()),a&&(delete t[e][a],i.unsetElement(a))}return t},o={init:function(e,i){"object"==typeof e&&(i=e,e="");var n={};t.isFunction(this.getDefaultAttributes)&&t.extend(n,this.getDefaultAttributes()),t.extend(n,i),this._super(e,n)},attr:function(t,i){var n=this._super(t,i);return void 0!==t&&void 0!==i&&e(document).trigger("attributeChange.qti-widget",{element:this,key:t,value:i}),n},remove:function(){if(0===arguments.length)return a(this);if(2===arguments.length)return r(this,arguments[0],arguments[1]);throw"invalid number of argument given"}};return o}),define("taoQtiItem/qtiCreator/model/qtiClasses",["lodash","taoQtiItem/qtiItem/core/qtiClasses"],function(t,e){return t.defaults({assessmentItem:"taoQtiItem/qtiCreator/model/Item",_container:"taoQtiItem/qtiCreator/model/Container",img:"taoQtiItem/qtiCreator/model/Img",math:"taoQtiItem/qtiCreator/model/Math",rubricBlock:"taoQtiItem/qtiCreator/model/RubricBlock",modalFeedback:"taoQtiItem/qtiCreator/model/feedbacks/ModalFeedback",choiceInteraction:"taoQtiItem/qtiCreator/model/interactions/ChoiceInteraction",orderInteraction:"taoQtiItem/qtiCreator/model/interactions/OrderInteraction",associateInteraction:"taoQtiItem/qtiCreator/model/interactions/AssociateInteraction",matchInteraction:"taoQtiItem/qtiCreator/model/interactions/MatchInteraction",inlineChoiceInteraction:"taoQtiItem/qtiCreator/model/interactions/InlineChoiceInteraction",simpleChoice:"taoQtiItem/qtiCreator/model/choices/SimpleChoice",simpleAssociableChoice:"taoQtiItem/qtiCreator/model/choices/SimpleAssociableChoice",inlineChoice:"taoQtiItem/qtiCreator/model/choices/InlineChoice",mediaInteraction:"taoQtiItem/qtiCreator/model/interactions/MediaInteraction",uploadInteraction:"taoQtiItem/qtiCreator/model/interactions/UploadInteraction",textEntryInteraction:"taoQtiItem/qtiCreator/model/interactions/TextEntryInteraction",sliderInteraction:"taoQtiItem/qtiCreator/model/interactions/SliderInteraction",extendedTextInteraction:"taoQtiItem/qtiCreator/model/interactions/ExtendedTextInteraction",hotspotInteraction:"taoQtiItem/qtiCreator/model/interactions/HotspotInteraction",selectPointInteraction:"taoQtiItem/qtiCreator/model/interactions/SelectPointInteraction",graphicInteraction:"taoQtiItem/qtiCreator/model/interactions/GraphicOrderInteraction",graphicAssociateInteraction:"taoQtiItem/qtiCreator/model/interactions/GraphicAssociateInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiCreator/model/interactions/GraphicGapMatchInteraction",graphicOrderInteraction:"taoQtiItem/qtiCreator/model/interactions/GraphicOrderInteraction",hotspotChoice:"taoQtiItem/qtiCreator/model/choices/HotspotChoice",gapImg:"taoQtiItem/qtiCreator/model/choices/GapImg",associableHotspot:"taoQtiItem/qtiCreator/model/choices/AssociableHotspot",responseDeclaration:"taoQtiItem/qtiCreator/model/variables/ResponseDeclaration",responseProcessing:"taoQtiItem/qtiCreator/model/ResponseProcessing"},e)}),define("taoQtiItem/qtiCreator/model/helper/container",["lodash","taoQtiItem/qtiCreator/model/qtiClasses"],function(t,e){var i={createElements:function(i,n,a){var r=/{{([a-z0-9_]*):new}}/gi,o={};n.replace(r,function(t,i){if(!e[i])throw"missing required class : "+i;o[i]=e[i]}),require(t.values(o),function(){var t={};for(var e in arguments)t[arguments[e].prototype.qtiClass]=arguments[e];var o={},s=n.replace(r,function(e,n){if(t[n]){var a=new t[n];return i.getRenderer()&&a.setRenderer(i.getRenderer()),o[a.getSerial()]=a,a.placeholder()}return e});i.setElements(o,s);for(var e in o){var l=o[e];"function"==typeof l.buildIdentifier&&l.buildIdentifier(),"function"==typeof l.afterCreate&&l.afterCreate(),$(document).trigger("elementCreated.qti-widget",{parent:i.parent(),element:l})}"function"==typeof a&&a.call(i,o)})}};return i}),define("taoQtiItem/qtiCreator/model/mixin/editableContainer",["taoQtiItem/qtiCreator/model/helper/container"],function(t){var e={createElements:function(e,i){var n=this;t.createElements(n.getBody(),e,function(t){i.call(n,t)})}};return e}),define("taoQtiItem/qtiItem/core/IdentifiedElement",["taoQtiItem/qtiItem/core/Element"],function(t){var e=t.extend({buildIdentifier:function(t,e){void 0===e&&(e=!0);var i=this.getRelatedItem();if(!i)throw"cannot build identifier of an element that is not attached to an assessment item";var n="",a=1,r=i.getUsedIdentifiers();t?(t=t.replace(/_[0-9]+$/gi,"_"),t=t.replace(/[^a-zA-Z0-9_]/gi,"_"),t=t.replace(/(_)+/gi,"_"),e&&(n="_"+a)):(t=this.qtiClass,n="_"+a);do{var o=!1,s=t+n;r[s]&&(o=!0,n="_"+a,a++)}while(o);return this.attr("identifier",s),this},id:function(t){return t||this.attr("identifier")||this.buildIdentifier(t),this.attr("identifier",t)}});return e}),define("taoQtiItem/qtiItem/mixin/Mixin",[],function(){return{augment:function(t,e,i){if("function"==typeof t&&"object"==typeof e)for(var n in e)if(Object.hasOwnProperty(t.prototype,n)){if(i&&i.append){var a=t.prototype[n];t.prototype[n]=function(){return e[n].apply(this,arguments),a.apply(this,arguments)}}}else t.prototype[n]=e[n]}}}),define("taoQtiItem/qtiItem/core/Container",["taoQtiItem/qtiItem/core/Element","lodash","jquery","taoQtiItem/qtiItem/helper/rendererConfig"],function(t,e,i,n){var a=t.extend({qtiClass:"_container",init:function(t){if(t&&"string"!=typeof t)throw"the body of a container must be a string";this.bdy="",this.body(t||""),this.elements={},this._super()},body:function(t){if("undefined"==typeof t)return this.bdy;if("string"!=typeof t)throw"body must be a string";this.bdy=t,i(document).trigger("containerBodyChange",{body:t,container:this})},setElements:function(e,n){var a=!1;for(var r in e){var o=e[r];if(!(o instanceof t))throw a=!1,"expected a qti element";-1===n.indexOf(o.placeholder())&&(n+=o.placeholder()),o.setRelatedItem(this.getRelatedItem()||null),this.elements[o.getSerial()]=o,i(document).trigger("containerElementAdded",{element:o,container:this}),a=!0}return this.body(n),a},setElement:function(t,e){return this.setElements([t],e)},removeElement:function(e){var i="";return"string"==typeof e?i=e:e instanceof t&&(i=e.getSerial()),delete this.elements[i],this.body(this.body().replace("{{"+i+"}}","")),this},getElements:function(i){var n={};if("string"==typeof i)for(var a in this.elements)t.isA(this.elements[a],i)&&(n[a]=this.elements[a]);else n=e.clone(this.elements);return n},getElement:function(t){return this.elements[t]?this.elements[t]:null},getComposingElements:function(){var t=this.getElements(),i={};for(var n in t)i[n]=t[n],i=e.extend(i,t[n].getComposingElements());return i},render:function(){var t=n.getOptionsFromArguments(arguments),e=t.renderer||this.getRenderer(),i=[],a=this.body();for(var r in this.elements){var o=this.elements[r];if("function"!=typeof o.render)throw"render() is not defined for the qti element: "+r;"_container"===o.qtiClass?a=a.replace(o.placeholder(),o.render(e)):(a=a.replace(o.placeholder(),"{{{"+r+"}}}"),i[r]=o.render(e))}if(e.isRenderer)return this._super({body:e.renderDirect(a,i),contentModel:this.contentModel||"flow"},e,t.placeholder);throw"invalid qti renderer for qti container"},postRender:function(t,e,i){i=i||this.getRenderer();for(var n in this.elements){var a=this.elements[n];"function"==typeof a.postRender&&a.postRender(t,"",i)}this._super(t,e,i)},toArray:function(){var t={serial:this.serial,body:this.bdy,elements:{}};for(var e in this.elements)t.elements[e]=this.elements[e].toArray();return t},find:function(t,i){var n=null;return this.elements[t]?n={parent:i||this,element:this.elements[t],location:"body"}:e.each(this.elements,function(e){return n=e.find(t),n?!1:void 0}),n}});return a}),define("taoQtiItem/qtiItem/mixin/Container",["taoQtiItem/qtiItem/mixin/Mixin","taoQtiItem/qtiItem/core/Container"],function(t,e){var i={initContainer:function(t){this.bdy=new e(t||""),this.bdy.setRelatedItem(this.getRelatedItem()||null),this.bdy.contentModel="blockStatic"},getBody:function(){return this.bdy},body:function(t){var e=this.bdy.body(t);return t?this:e},setElement:function(t,e){return this.bdy.setElement(t,e),this},removeElement:function(t){return this.bdy.removeElement(t)}};return{augment:function(e){t.augment(e,i)},methods:i}}),define("taoQtiItem/qtiItem/mixin/ContainerItemBody",["taoQtiItem/qtiItem/mixin/Mixin","taoQtiItem/qtiItem/mixin/Container","lodash"],function(t,e,i){var n={};return i.extend(n,e.methods),i.extend(n,{initContainer:function(t){e.methods.initContainer.call(this,t),this.bdy.contentModel="itemBody"}}),{augment:function(e){t.augment(e,n)},methods:n}}),define("taoQtiItem/qtiItem/core/Item",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/core/IdentifiedElement","taoQtiItem/qtiItem/mixin/ContainerItemBody","lodash","taoQtiItem/qtiItem/helper/util"],function(t,e,i,n,a){var r=e.extend({qtiClass:"assessmentItem",init:function(t,e){this._super(t,e),this.relatedItem=this,this.stylesheets={},this.responses={},this.outcomes={},this.modalFeedbacks={},this.responseProcessing=null},getInteractions:function(){var e=[],i=this.getComposingElements();for(var n in i)t.isA(i[n],"interaction")&&e.push(i[n]);return e},addResponseDeclaration:function(e){if(!t.isA(e,"responseDeclaration"))throw"is not a qti response declaration";return e.setRelatedItem(this),this.responses[e.getSerial()]=e,this},getResponseDeclaration:function(t){for(var e in this.responses)if(this.responses[e].attr("identifier")===t)return this.responses[e];return null},addOutcomeDeclaration:function(e){if(!t.isA(e,"outcomeDeclaration"))throw"is not a qti outcome declaration";return e.setRelatedItem(this),this.outcomes[e.getSerial()]=e,this},addModalFeedback:function(e){if(!t.isA(e,"modalFeedback"))throw"is not a qti modal feedback";return e.setRelatedItem(this),this.modalFeedbacks[e.getSerial()]=e,this},getComposingElements:function(){var e=this._super(),i=this;return n.each(["responses","outcomes","modalFeedbacks","stylesheets"],function(t){for(var a in i[t]){var r=i[t][a];e[a]=r,e=n.extend(e,r.getComposingElements())}}),this.responseProcessing instanceof t&&(e[this.responseProcessing.getSerial()]=this.responseProcessing),e},find:function(t){var e=this._super(t);return e||(e=a.findInCollection(this,["responses","outcomes","modalFeedbacks","stylesheets"],t)),e},getResponses:function(){return n.clone(this.responses)},getRelatedItem:function(){return this},setNamespaces:function(t){this.namespaces=t},getNamespaces:function(){return n.clone(this.namespaces)},addStylesheet:function(e){if(!t.isA(e,"stylesheet"))throw"is not a qti stylesheet declaration";return e.setRelatedItem(this),this.stylesheets[e.getSerial()]=e,this},setResponseProcessing:function(e){if(!t.isA(e,"responseProcessing"))throw"is not a response processing";return e.setRelatedItem(this),this.responseProcessing=e,this},toArray:function(){var t=this._super();t.outcomes={};for(var e in this.outcomes)t.outcomes[e]=this.outcomes[e].toArray();t.responses={};for(var e in this.responses)t.responses[e]=this.responses[e].toArray();return t.namespaces=this.namespaces,t.stylesheets=this.stylesheets,t}});return i.augment(r),r}),define("taoQtiItem/qtiItem/core/Stylesheet",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(t,e,i){var n=t.extend({qtiClass:"stylesheet",render:function(){var t=i.getOptionsFromArguments(arguments),n=t.renderer||this.getRenderer(),a={},r=n.getOption("baseUrl")||"",o=this.attr("href");return o.match(/^http/i)||(a.attributes={href:r+o}),this._super(e.merge(a,t.data),t.placeholder,t.subclass,n)}});return n}),define("taoQtiItem/qtiCreator/model/Stylesheet",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/Stylesheet"],function(t,e,i){var n={};return t.extend(n,e),t.extend(n,{getDefaultAttributes:function(){return{href:"css/tao-user-styles.css",title:"",type:"text/css",media:"all"}}}),i.extend(n)}),define("taoQtiItem/qtiItem/core/ResponseProcessing",["taoQtiItem/qtiItem/core/Element","lodash"],function(t){var e=t.extend({qtiClass:"responseProcessing",processingType:"",xml:""});return e}),define("taoQtiItem/qtiCreator/model/ResponseProcessing",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/ResponseProcessing"],function(t,e,i){var n={};return t.extend(n,e),t.extend(n,{getDefaultAttributes:function(){return{}},setProcessingType:function(e){this.processingType!==e&&("custom"===this.processingType&&t.each(this.getRelatedItem().getResponses(),function(t){t.setTemplate("MATCH_CORRECT")}),this.processingType=e)}}),i.extend(n)}),define("taoQtiItem/qtiItem/core/variables/VariableDeclaration",["taoQtiItem/qtiItem/core/IdentifiedElement"],function(t){var e=t.extend({init:function(t,e){this._super(t,e),this.defaultValue=null},is:function(t){return"variableDeclaration"===t||this._super(t)},toArray:function(){var t=this._super();return t.defaultValue=this.defaultValue,t}});return e}),define("taoQtiItem/qtiItem/core/variables/OutcomeDeclaration",["taoQtiItem/qtiItem/core/variables/VariableDeclaration"],function(t){return t.extend({qtiClass:"outcomeDeclaration"})}),define("taoQtiItem/qtiCreator/model/variables/OutcomeDeclaration",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/variables/OutcomeDeclaration"],function(t,e,i){var n={};return t.extend(n,e),i.extend(n)}),define("taoQtiItem/qtiItem/core/feedbacks/ModalFeedback",["taoQtiItem/qtiItem/core/IdentifiedElement","taoQtiItem/qtiItem/mixin/Container"],function(t,e){var i=t.extend({qtiClass:"modalFeedback",is:function(t){return"feedback"===t||this._super(t)}});return e.augment(i),i}),define("taoQtiItem/qtiCreator/model/feedbacks/ModalFeedback",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/feedbacks/ModalFeedback"],function(t,e,i){var n={};return t.extend(n,e),t.extend(n,{getDefaultAttributes:function(){return{title:"modal feedback title",showHide:"show"}}}),i.extend(n)}),define("taoQtiItem/qtiCreator/model/Item",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableContainer","taoQtiItem/qtiItem/core/Item","taoQtiItem/qtiCreator/model/Stylesheet","taoQtiItem/qtiCreator/model/ResponseProcessing","taoQtiItem/qtiCreator/model/variables/OutcomeDeclaration","taoQtiItem/qtiCreator/model/feedbacks/ModalFeedback"],function(t,e,i,n,a,r,o,s){var l={};return t.extend(l,e),t.extend(l,i),t.extend(l,{getDefaultAttributes:function(){return{identifier:"myItem_1",title:"Item title",adaptive:!1,timeDependent:!1}},createResponseProcessing:function(){var t=new r;return t.processingType="templateDriven",this.setResponseProcessing(t),t},createStyleSheet:function(e){if(e&&t.isString(e)){var i=new a({href:e});return i.setRenderer(this.getRenderer()),this.addStylesheet(i),i}throw'missing or invalid type for the required arg "href"'},createOutcomeDeclaration:function(t){var e=t.identifier||"";delete t.identifier;var i=new o(t);return this.addOutcomeDeclaration(i),i.buildIdentifier(e),i},createModalFeedback:function(t){var e=t.identifier||"";delete t.identifier;var i=new s(t);return this.addModalFeedback(i),i.buildIdentifier(e),i.body("Some feedback text."),i},deleteResponseDeclaration:function(e){var i;return t.isString(e)?i=e:e&&"responseDeclaration"===e.qtiClass&&(i=e.getSerial()),delete this.responses[i],this}}),n.extend(l)}),define("taoQtiItem/qtiCreator/helper/itemLoader",["jquery","helpers","taoQtiItem/qtiItem/core/Loader","taoQtiItem/qtiCreator/model/Item","taoQtiItem/qtiCreator/model/qtiClasses"],function(t,e,i,n,a){var r=function(t){var e=t.lastIndexOf("#");return t.substr(e+1)},o={loadItem:function(o,s){o.uri&&t.ajax({url:e._url("getItemData","QtiCreator","taoQtiItem"),dataType:"json",data:{uri:o.uri}}).done(function(t){if(t.itemData&&"assessmentItem"===t.itemData.qtiClass){var e=(new i).setClassesLocation(a),l=t.itemData;e.loadItemData(l,function(t){s(t,this.getLoadedClasses())})}else{var c=(new n).id(r(o.uri));c.createOutcomeDeclaration({identifier:"SCORE",cardinality:"single",baseType:"float"}),c.createResponseProcessing(),s(c)}})}};return o}),define("taoQtiItem/qtiCreator/renderers/config",["lodash","taoQtiItem/qtiCommonRenderer/renderers/config"],function(t,e){var i=t.defaults({_container:"taoQtiItem/qtiCreator/renderers/Container",assessmentItem:"taoQtiItem/qtiCreator/renderers/Item",rubricBlock:"taoQtiItem/qtiCreator/renderers/RubricBlock",img:"taoQtiItem/qtiCreator/renderers/Img",math:"taoQtiItem/qtiCreator/renderers/Math",modalFeedback:"taoQtiItem/qtiCreator/renderers/ModalFeedback",choiceInteraction:"taoQtiItem/qtiCreator/renderers/interactions/ChoiceInteraction",orderInteraction:"taoQtiItem/qtiCreator/renderers/interactions/OrderInteraction",matchInteraction:"taoQtiItem/qtiCreator/renderers/interactions/MatchInteraction",associateInteraction:"taoQtiItem/qtiCreator/renderers/interactions/AssociateInteraction",inlineChoiceInteraction:"taoQtiItem/qtiCreator/renderers/interactions/InlineChoiceInteraction",textEntryInteraction:"taoQtiItem/qtiCreator/renderers/interactions/TextEntryInteraction",hotspotInteraction:"taoQtiItem/qtiCreator/renderers/interactions/HotspotInteraction",selectPointInteraction:"taoQtiItem/qtiCreator/renderers/interactions/SelectPointInteraction",graphicOrderInteraction:"taoQtiItem/qtiCreator/renderers/interactions/GraphicOrderInteraction",graphicAssociateInteraction:"taoQtiItem/qtiCreator/renderers/interactions/GraphicAssociateInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiCreator/renderers/interactions/GraphicGapMatchInteraction",mediaInteraction:"taoQtiItem/qtiCreator/renderers/interactions/MediaInteraction",uploadInteraction:"taoQtiItem/qtiCreator/renderers/interactions/UploadInteraction",sliderInteraction:"taoQtiItem/qtiCreator/renderers/interactions/SliderInteraction",extendedTextInteraction:"taoQtiItem/qtiCreator/renderers/interactions/ExtendedTextInteraction","simpleChoice.choiceInteraction":"taoQtiItem/qtiCreator/renderers/choices/SimpleChoice.ChoiceInteraction","simpleChoice.orderInteraction":"taoQtiItem/qtiCreator/renderers/choices/SimpleChoice.OrderInteraction","simpleAssociableChoice.associateInteraction":"taoQtiItem/qtiCreator/renderers/choices/SimpleAssociableChoice.AssociateInteraction","simpleAssociableChoice.matchInteraction":"taoQtiItem/qtiCreator/renderers/choices/SimpleAssociableChoice.MatchInteraction"},e.locations);return{name:"creatorRenderer",locations:i}}),define("taoQtiItem/qtiCreator/renderers/Renderer",["taoQtiItem/qtiRunner/core/Renderer","taoQtiItem/qtiCreator/renderers/config"],function(t,e){return t.build(e.locations,e.name)}),define("taoQtiItem/qtiCreator/helper/creatorRenderer",["taoQtiItem/qtiCreator/renderers/Renderer","helpers","jquery"],function(t,e,i){var n=null,a=function(){return n&&n.getOption("interactionOptionForm")&&i.contains(document,n.getOption("interactionOptionForm")[0])||(n=new t({baseUrl:"",lang:"",uri:"",shuffleChoices:!1,itemOptionForm:i("#item-editor-item-property-bar .panel"),interactionOptionForm:i("#item-editor-interaction-property-bar .panel"),choiceOptionForm:i("#item-editor-choice-property-bar .panel"),responseOptionForm:i("#item-editor-response-property-bar .panel"),bodyElementOptionForm:i("#item-editor-body-element-property-bar .panel"),textOptionForm:i("#item-editor-text-property-bar .panel"),modalFeedbackOptionForm:i("#item-editor-modal-feedback-property-bar .panel"),mediaManager:{appendContainer:"#mediaManager",browseUrl:e._url("files","ItemContent","taoItems"),uploadUrl:e._url("upload","ItemContent","taoItems"),deleteUrl:e._url("delete","ItemContent","taoItems"),downloadUrl:e._url("download","ItemContent","taoItems")}})),n};return{get:function(){return a()},setOption:function(t,e){a().setOption(t,e)},setOptions:function(t){a().setOptions(t)}}}),define("json!taoQtiItem/qtiCreator/editor/resources/font-stacks.json",function(){return{"sans-serif":['Arial, "Helvetica Neue", Helvetica, sans-serif','"Avant Garde", Avantgarde, "Century Gothic", CenturyGothic, "AppleGothic", sans-serif','Calibri, Candara, Segoe, "Segoe UI", Optima, Arial, sans-serif','Candara, Calibri, Segoe, "Segoe UI", Optima, Arial, sans-serif','"Century Gothic", CenturyGothic, AppleGothic, sans-serif','Corbel, "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", "DejaVu Sans", "Bitstream Vera Sans", "Liberation Sans", Verdana, "Verdana Ref", sans-serif','"Franklin Gothic Medium", "Franklin Gothic", "ITC Franklin Gothic", Arial, sans-serif','Frutiger, "Frutiger Linotype", Univers, Calibri, "Gill Sans", "Gill Sans MT", "Myriad Pro", Myriad, "DejaVu Sans Condensed", "Liberation Sans", "Nimbus Sans L", Tahoma, Geneva, "Helvetica Neue", Helvetica, Arial, sans-serif','Futura, "Century Gothic", AppleGothic, "Trebuchet MS", sans-serif','Geneva, Verdana, "Lucida Sans", "Lucida Grande", "Lucida Sans Unicode", sans-serif','"Gill Sans", "Gill Sans MT", Calibri, sans-serif','"Helvetica Neue", Helvetica, Arial, sans-serif','Impact, Haettenschweiler, "Franklin Gothic Bold", Charcoal, "Helvetica Inserat", "Bitstream Vera Sans Bold", "Arial Black", sans-serif','"Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", Geneva, Verdana, sans-serif','Optima, Segoe, "Segoe UI", Candara, Calibri, Arial, sans-serif','"Segoe UI", Candara, "Bitstream Vera Sans", "DejaVu Sans", "Bitstream Vera Sans", "Trebuchet MS", Verdana, "Verdana Ref", sans-serif',"Tahoma, Verdana, Segoe, sans-serif",'"Trebuchet MS", "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", Tahoma, sans-serif',"Verdana, Geneva, Tahoma, sans-serif"],serif:['Baskerville, "Baskerville Old Face", "Hoefler Text", Garamond, "Times New Roman", serif','"Big Caslon", "Book Antiqua", "Palatino Linotype", Georgia, serif','"Bodoni MT", Didot, "Didot LT STD", "Hoefler Text", Garamond, "Times New Roman", serif','"Book Antiqua", Palatino, "Palatino Linotype", "Palatino LT STD", Georgia, serif','"Calisto MT", "Bookman Old Style", Bookman, "Goudy Old Style", Garamond, "Hoefler Text", "Bitstream Charter", Georgia, serif','Cambria, "Hoefler Text", Utopia, "Liberation Serif", "Nimbus Roman No9 L Regular", Times, "Times New Roman", serif','Constantia, "Lucida Bright", Lucidabright, "Lucida Serif", Lucida, "DejaVu Serif", "Bitstream Vera Serif", "Liberation Serif", Georgia, serif','Didot, "Didot LT STD", "Hoefler Text", Garamond, "Times New Roman", serif','Garamond, Baskerville, "Baskerville Old Face", "Hoefler Text", "Times New Roman", serif','Georgia, Palatino," Palatino Linotype", Times, "Times New Roman", serif','"Goudy Old Style", Garamond, "Big Caslon", "Times New Roman", serif','"Hoefler Text", "Baskerville old face", Garamond, "Times New Roman", serif','"Lucida Bright", Georgia, serif','"Palatino Linotype", Palatino, Palladio, "URW Palladio L", "Book Antiqua", Baskerville, "Bookman Old Style", "Bitstream Charter", "Nimbus Roman No9 L", Garamond, "Apple Garamond", "ITC Garamond Narrow", "New Century Schoolbook", "Century Schoolbook", "Century Schoolbook L", Georgia, serif','Perpetua, Baskerville, "Big Caslon", "Palatino Linotype", Palatino, "URW Palladio L", "Nimbus Roman No9 L", serif','Rockwell, "Courier Bold", Courier, Georgia, Times, "Times New Roman", serif','"Times New Roman", TimesNewRoman, Times, Baskerville, Georgia, serif'],monospace:['"Andale Mono", AndaleMono, monospace','Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace','"Courier New", Courier, "Lucida Sans Typewriter", "Lucida Typewriter", monospace','"Lucida Console", "Lucida Sans Typewriter", Monaco, "Bitstream Vera Sans Mono", monospace','Monaco, Consolas, "Lucida Console", monospace','"Rockwell Extra Bold", "Rockwell Bold", monospace']}}),define("taoQtiItem/qtiCreator/editor/styleEditor/fontSelector",["jquery","json!taoQtiItem/qtiCreator/editor/resources/font-stacks.json","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","i18n","select2"],function(t,e,i,n){"use strict";var a=function(){var a,r,o,s,l=t("select#item-editor-font-selector"),c=l.data("target"),d=t(c),h=function(t){return t.replace(/"/g,"'").replace(/, /g,",")},u=function(t){return t.substring(0,t.indexOf(",")).replace(/'/g,"")},p=l.parent().find('[data-role="font-selector-reset"]'),f=0,m=function(t){return t=t.replace(/-/g," "),(t+"").replace(/^([a-z\u00E0-\u00FC])|\s+([a-z\u00E0-\u00FC])/g,function(t){return t.toUpperCase()})},g=function(e){var i=e.element;return e.id?'<span style="font-size: 12px;'+t(i).attr("style")+'">'+e.text+"</span>":e.text},v=function(){i.apply(c,"font-family"),l.select2("val",d.css("font-family"))};l.append('<option value="">'+n("Default")+"</option>");for(a in e)if(e.hasOwnProperty(a)){for(r=t("<optgroup>",{label:m(a)}),s=e[a].length,f=0;s>f;f++)e[a][f]=h(e[a][f]),o=t("<option>",{value:e[a][f],text:u(e[a][f])}).css({fontFamily:e[a][f]}),r.append(o);l.append(r)}p.on("click",v),l.select2({formatResult:g,formatSelection:g,width:"resolve"}),t(document).on("customcssloaded.styleeditor",function(t,e){}),l.on("change",function(){i.apply(c,"font-family",t(this).val())})};return a}),jQuery.fn.farbtastic=function(t){return $.farbtastic(this,t),this},jQuery.farbtastic=function(t,e){if(t.length){var t=$(t).get(0);return t.farbtastic||(t.farbtastic=new jQuery._farbtastic(t,e))}},jQuery._farbtastic=function(t,e){var i=this,n=$("<div>",{"class":"farbtastic"}),a=$("<div>",{"class":"color"}),r=$("<div>",{"class":"wheel"}),o=$("<div>",{"class":"overlay"}),s=$("<div>",{"class":"h-marker marker"}),l=$("<div>",{"class":"sl-marker marker"});t=$(t),$(n).append(a),$(n).append(r),$(n).append(o),$(n).append(s),$(n).append(l),t.append(n),i.wheel=r.get(0),i.radius=70,i.square=o.width(),i.width=n.width(),i.linkTo=function(t){return"object"==typeof i.callback&&$(i.callback).unbind("keyup",i.updateValue),i.color=null,"function"==typeof t?i.callback=t:("object"==typeof t||"string"==typeof t)&&(i.callback=$(t),i.callback.bind("keyup",i.updateValue),i.callback.get(0).value&&i.setColor(i.callback.get(0).value)),this},i.updateValue=function(){this.value&&this.value!=i.color&&i.setColor(this.value)},i.setColor=function(t){var e=i.unpack(t);return i.color!=t&&e&&(i.color=t,i.rgb=e,i.hsl=i.RGBToHSL(i.rgb),i.updateDisplay()),this},i.setHSL=function(t){return i.hsl=t,i.rgb=i.HSLToRGB(t),i.color=i.pack(i.rgb),i.updateDisplay(),this},i.widgetCoords=function(t){var e,n,a=t.target||t.srcElement,r=i.wheel;if("undefined"!=typeof t.offsetX){for(var o={x:t.offsetX,y:t.offsetY},s=a;s;)s.mouseX=o.x,s.mouseY=o.y,o.x+=s.offsetLeft,o.y+=s.offsetTop,s=s.offsetParent;for(var s=r,l={x:0,y:0};s;){if("undefined"!=typeof s.mouseX){e=s.mouseX-l.x,n=s.mouseY-l.y;break}l.x+=s.offsetLeft,l.y+=s.offsetTop,s=s.offsetParent}for(s=a;s;)s.mouseX=void 0,s.mouseY=void 0,s=s.offsetParent}else{var o=i.absolutePosition(r);e=(t.pageX||0*(t.clientX+$("html").get(0).scrollLeft))-o.x,n=(t.pageY||0*(t.clientY+$("html").get(0).scrollTop))-o.y}return{x:e-i.width/2,y:n-i.width/2}},i.mousedown=function(t){document.dragging||($(document).bind("mousemove",i.mousemove).bind("mouseup",i.mouseup),document.dragging=!0);var e=i.widgetCoords(t);return i.circleDrag=2*Math.max(Math.abs(e.x),Math.abs(e.y))>i.square,i.mousemove(t),!1},i.mousemove=function(t){var e=i.widgetCoords(t);if(i.circleDrag){var n=Math.atan2(e.x,-e.y)/6.28;0>n&&(n+=1),i.setHSL([n,i.hsl[1],i.hsl[2]])}else{var a=Math.max(0,Math.min(1,-(e.x/i.square)+.5)),r=Math.max(0,Math.min(1,-(e.y/i.square)+.5));i.setHSL([i.hsl[0],a,r])}return!1},i.mouseup=function(){$(document).unbind("mousemove",i.mousemove),$(document).unbind("mouseup",i.mouseup),document.dragging=!1},i.updateDisplay=function(){var e=6.28*i.hsl[0];$(".h-marker",n).css({left:Math.round(Math.sin(e)*i.radius+i.width/2)+"px",top:Math.round(-Math.cos(e)*i.radius+i.width/2)+"px"}),$(".sl-marker",n).css({left:Math.round(i.square*(.5-i.hsl[1])+i.width/2)+"px",top:Math.round(i.square*(.5-i.hsl[2])+i.width/2)+"px"}),$(".color",n).css("backgroundColor",i.pack(i.HSLToRGB([i.hsl[0],1,.5]))),"object"==typeof i.callback?($(i.callback).css({backgroundColor:i.color,color:i.hsl[2]>.5?"#000":"#fff"}),$(i.callback).each(function(){this.value&&this.value!=i.color&&(this.value=i.color)})):"function"==typeof i.callback&&i.callback.call(i,i.color),t.trigger("colorchange.farbtastic",[i.color])},i.absolutePosition=function(t){var e={x:t.offsetLeft,y:t.offsetTop};if(t.offsetParent){var n=i.absolutePosition(t.offsetParent);e.x+=n.x,e.y+=n.y}return e},i.pack=function(t){var e=Math.round(255*t[0]),i=Math.round(255*t[1]),n=Math.round(255*t[2]);return"#"+(16>e?"0":"")+e.toString(16)+(16>i?"0":"")+i.toString(16)+(16>n?"0":"")+n.toString(16)},i.unpack=function(t){return 7==t.length?[parseInt("0x"+t.substring(1,3))/255,parseInt("0x"+t.substring(3,5))/255,parseInt("0x"+t.substring(5,7))/255]:4==t.length?[parseInt("0x"+t.substring(1,2))/15,parseInt("0x"+t.substring(2,3))/15,parseInt("0x"+t.substring(3,4))/15]:void 0},i.HSLToRGB=function(t){var e,i,n=t[0],a=t[1],r=t[2];return i=.5>=r?r*(a+1):r+a-r*a,e=2*r-i,[this.hueToRGB(e,i,n+.33333),this.hueToRGB(e,i,n),this.hueToRGB(e,i,n-.33333)]
},i.hueToRGB=function(t,e,i){return i=0>i?i+1:i>1?i-1:i,1>6*i?t+(e-t)*i*6:1>2*i?e:2>3*i?t+(e-t)*(.66666-i)*6:t},i.RGBToHSL=function(t){var e,i,n,a,r,o,s=t[0],l=t[1],c=t[2];return e=Math.min(s,Math.min(l,c)),i=Math.max(s,Math.max(l,c)),n=i-e,o=(e+i)/2,r=0,o>0&&1>o&&(r=n/(.5>o?2*o:2-2*o)),a=0,n>0&&(i==s&&i!=l&&(a+=(l-c)/n),i==l&&i!=c&&(a+=2+(c-s)/n),i==c&&i!=s&&(a+=4+(s-l)/n),a/=6),[a,r,o]},$("*",n).mousedown(i.mousedown),i.setColor("#123456"),e&&i.linkTo(e)},define("taoQtiItem/qtiCreator/editor/styleEditor/farbtastic/farbtastic",function(){}),define("taoQtiItem/qtiCreator/editor/styleEditor/colorSelector",["jquery","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","i18n","taoQtiItem/qtiCreator/editor/styleEditor/farbtastic/farbtastic"],function(t,e,i){"use strict";function n(t){if(!_.isString(t))return t;var e=/rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i.exec(t);return _.isArray(e)&&4===e.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):t}var a=function(){var a,r=t("#item-editor-color-picker"),o=r.find(".color-picker"),s=r.find("#color-picker-container"),l=r.find("#color-picker-title"),c=r.find("#color-picker-input"),d=r.find(".reset-button"),h=r.find(".color-trigger"),u=r.find("label"),p="color",f=t(document),m=function(t,e){l.text(e.parent().find("label").text())},g=function(){h.each(function(){var a,r=t(this),o=r.data("target"),s=t(o),l=e.getStyle()||{};l[o]&&l[o][r.data("value")]?(a=l[o][r.data("value")],r.css("background-color",a),r.attr("title",n(a))):s.css(r.data("value"))?(a=s.css(r.data("value")),r.css("background-color",a),r.attr("title",n(a))):(r.css("background-color",""),r.attr("title",i("No value set")))})};a=t.farbtastic(o).linkTo(c),o.on("colorchange.farbtastic",function(t,i){e.apply(o.prop("target"),p,i),g()}),g(),h.add(u).on("click",function(){{var e=t(this),i="label"===this.nodeName.toLowerCase()?e.parent().find(".color-trigger"):e;i.css("background-color")}o.prop("target",i.data("target")),s.hide(),p=i.data("value"),m(p,i),a.setColor(n(i.css("background-color"))),s.show()}),f.on("mouseup",function(e){return t(e.target).hasClass("closer")?(s.hide(),!1):s.is(e.target)||0!==s.has(e.target).length?void 0:(s.hide(),!1)}),f.on("keyup",function(t){return 27===t.keyCode?(s.hide(),!1):void 0}),d.on("click",function(){var i=t(this),n=i.parent().find(".color-trigger"),a=n.data("target"),r=n.data("value");e.apply(a,r),g()}),f.on("customcssloaded.styleeditor",g)};return a}),define("taoQtiItem/qtiCreator/editor/styleEditor/fontSizeChanger",["jquery","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor"],function(t,e){"use strict";var i=function(){var i=t("#item-editor-font-size-changer"),n=i.data("target"),a=n+" .item-title",r=n+" .qti-itemBody",o=parseInt(t(a).css("font-size"),10),s=parseInt(t(r).css("font-size"),10),l=o-s,c=i.parents(".reset-group").find('[data-role="font-size-reset"]'),d=t("#item-editor-font-size-text"),h=function(){var t=s+l;e.apply(a,"font-size",t.toString()+"px"),e.apply(r,"font-size",s.toString()+"px")};i.find("a").on("click",function(e){if(e.preventDefault(),"reduce"===t(this).data("action")){if(10>=s)return;s--}else s++;h(),d.val(s),t(this).parent().blur()}),d.on("keydown",function(t){var e=t.keyCode;return _.contains([8,37,39,46],e)||e>=48&&57>=e||e>=96&&105>=e}),d.on("blur",function(){s=parseInt(this.value,10),h()}),d.on("keydown",function(t){var e=t.keyCode;13===e&&d.trigger("blur")}),c.on("click",function(){d.val(""),e.apply(a,"font-size"),e.apply(r,"font-size")}),t(document).on("customcssloaded.styleeditor",function(){d.val(parseInt(t(r).css("font-size"),10)),d.trigger("blur")})};return i}),function(t){function e(t){throw new RangeError("noUiSlider: "+t)}function i(t,i,n){(t[i]||t[n])&&t[i]===t[n]&&e("(Link) '"+i+"' can't match '"+n+"'.'")}function n(t){return Math.max(Math.min(t,100),0)}function a(t,e){return Math.round(t/e)*e}function r(t,e){return 100/(e-t)}function o(t,e){return typeof t==typeof e}function s(e){return e instanceof t||t.zepto&&t.zepto.isZ(e)}function l(t){return"number"==typeof t&&!isNaN(t)&&isFinite(t)}function c(e){return t.isArray(e)?e:[e]}function d(t,e,i){t.addClass(e),setTimeout(function(){t.removeClass(e)},i)}function h(t,e){return 100*e/(t[1]-t[0])}function u(t,e){return h(t,t[0]<0?e+Math.abs(t[0]):e-t[0])}function p(t,e){return e*(t[1]-t[0])/100+t[0]}function f(t,e){if(e>=t.xVal.slice(-1)[0])return 100;for(var i,n,a,o,s=1;e>=t.xVal[s];)s++;return i=t.xVal[s-1],n=t.xVal[s],a=t.xPct[s-1],o=t.xPct[s],a+u([i,n],e)/r(a,o)}function m(t,e){if(e>=100)return t.xVal.slice(-1)[0];for(var i,n,a,o,s=1;e>=t.xPct[s];)s++;return i=t.xVal[s-1],n=t.xVal[s],a=t.xPct[s-1],o=t.xPct[s],p([i,n],(e-a)*r(a,o))}function g(t,e){for(var i,n,r=1;e>=t.xPct[r];)r++;return t.snap?(i=t.xPct[r-1],n=t.xPct[r],e-i>(n-i)/2?n:i):t.xSteps[r-1]?t.xPct[r-1]+a(e-t.xPct[r-1],t.xSteps[r-1]):e}function v(t){t.preventDefault();var e,i,n=0===t.type.indexOf("touch"),a=0===t.type.indexOf("mouse"),r=0===t.type.indexOf("pointer"),o=t;return 0===t.type.indexOf("MSPointer")&&(r=!0),t.originalEvent&&(t=t.originalEvent),n&&(e=t.changedTouches[0].pageX,i=t.changedTouches[0].pageY),(a||r)&&(r||void 0!==window.pageXOffset||(window.pageXOffset=document.documentElement.scrollLeft,window.pageYOffset=document.documentElement.scrollTop),e=t.clientX+window.pageXOffset,i=t.clientY+window.pageYOffset),o.points=[e,i],o.cursor=a,o}function C(n){void 0===n&&(n={}),"object"!=typeof n&&e("(Format) 'format' option must be an object.");var a={};t(U).each(function(t,i){void 0===n[i]?a[i]=W[t]:o(n[i],W[t])?("decimals"===i&&(n[i]<0||n[i]>7)&&e("(Format) 'format.decimals' option must be between 0 and 7."),a[i]=n[i]):e("(Format) 'format."+i+"' must be a "+typeof W[t]+".")}),i(a,"mark","thousand"),i(a,"prefix","negative"),i(a,"prefix","negativeBefore"),this.settings=a}function I(e,i){if(!(this instanceof I))throw new Error("Link: Don't use Link as a function. Use the 'new' keyword.");if(!e)throw new RangeError("Link: missing parameters.");this.formatting=e.format||{},this.update=!i;var n=this,a=e.target||function(){},r=e.method,o="string"==typeof a&&0===a.indexOf("-tooltip-"),l="string"==typeof a&&0!==a.indexOf("-"),c="function"==typeof a,d=s(a),h=d&&a.is("input, select, textarea"),u=d&&"function"==typeof r,p=d&&"string"==typeof r&&a[r];if(o)return this.method=r||"html",void(this.el=t(a.replace("-tooltip-","")||"<div/>")[0]);if(l)return this.method="val",this.el=document.createElement("input"),this.el.name=a,void(this.el.type="hidden");if(c)return this.target=!1,void(this.method=a);if(d){if(r&&(u||p))return this.target=a,void(this.method=r);if(!r&&h)return this.method="val",this.target=a,void this.target.on("change",function(e){function i(t,e,i){return[i?t:e,i?e:t]}var a=i(null,t(e.target).val(),n.N);n.obj.val(a,{link:n})});if(!r&&!h)return this.method="html",void(this.target=a)}throw new RangeError("Link: Invalid Link.")}function b(t,i){l(i)||e("'step' is not numeric."),t.xSteps[0]=i}function E(i,n){("object"!=typeof n||t.isArray(n))&&e("'range' is not an object."),t.each(n,function(n,a){var r;"number"==typeof a&&(a=[a]),t.isArray(a)||e("'range' contains invalid value."),r="min"===n?0:"max"===n?100:parseFloat(n),l(r)&&l(a[0])||e("'range' value isn't numeric."),i.xPct.push(r),i.xVal.push(a[0]),r?i.xSteps.push(isNaN(a[1])?!1:a[1]):isNaN(a[1])||(i.xSteps[0]=a[1])}),t.each(i.xSteps,function(t,e){return e?void(i.xSteps[t]=h([i.xVal[t],i.xVal[t+1]],e)/r(i.xPct[t],i.xPct[t+1])):!0})}function y(i,n){"number"==typeof n&&(n=[n]),(!t.isArray(n)||!n.length||n.length>2)&&e("'start' option is incorrect."),i.handles=n.length,i.start=n}function T(t,i){t.snap=i,"boolean"!=typeof i&&e("'snap' option must be a boolean.")}function R(t,i){"lower"===i&&1===t.handles?t.connect=1:"upper"===i&&1===t.handles?t.connect=2:i===!0&&2===t.handles?t.connect=3:i===!1?t.connect=0:e("'connect' option was doesn't match handle count.")}function w(t,i){switch(i){case"horizontal":t.ort=0;break;case"vertical":t.ort=1;break;default:e("'orientation' option is invalid.")}}function O(t,i){t.xPct.length>2&&e("'margin' option is only supported on linear sliders."),t.margin=h(t.xVal,i),l(i)||e("'margin' option must be numeric.")}function _(t,i){switch(i){case"ltr":t.dir=0;break;case"rtl":t.dir=1,t.connect=[0,2,1,3][t.connect];break;default:e("'direction' option was not recognized.")}}function D(t,i){"string"!=typeof i&&e("'behaviour' must be a string containing options.");var n=i.indexOf("tap")>=0,a=i.indexOf("extend")>=0,r=i.indexOf("drag")>=0,o=i.indexOf("fixed")>=0,s=i.indexOf("snap")>=0;t.events={tap:n||s,extend:a,drag:r,fixed:o,snap:s}}function x(i,n,a){i.ser=[n.lower,n.upper],i.formatting=new C(n.format),t.each(i.ser,function(i,r){t.isArray(r)||e("'serialization."+(i?"upper":"lower")+"' must be an array."),t.each(r,function(){this instanceof I||e("'serialization."+(i?"upper":"lower")+"' can only contain Link instances."),this.N=i,this.obj=a,this.scope=this.scope||a,this.formatting=new C(t.extend({},n.format,this.formatting))})}),i.dir&&i.handles>1&&i.ser.reverse()}function k(i,n){var a,r={xPct:[],xVal:[],xSteps:[!1],margin:0};return a={step:{r:!1,t:b},range:{r:!0,t:E},start:{r:!0,t:y},snap:{r:!1,t:T},connect:{r:!0,t:R},orientation:{r:!1,t:w},margin:{r:!1,t:O},direction:{r:!0,t:_},behaviour:{r:!0,t:D},serialization:{r:!0,t:x}},i=t.extend({connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal"},i),i.serialization=t.extend({lower:[],upper:[],format:{}},i.serialization),t.each(a,function(t,a){if(void 0===i[t]){if(!a.r)return!0;e("'"+t+"' is required.")}a.t(r,i[t],n)}),r.style=r.ort?"top":"left",r}function K(e,i){var n=t("<div><div/></div>").addClass(z[2]),a=["-lower","-upper"];return e.dir&&a.reverse(),n.children().addClass(z[3]+" "+z[3]+a[i]),n}function q(e,i){return i.el&&(i=new I({target:t(i.el).clone().appendTo(e),method:i.method,format:i.formatting},!0)),i}function S(t,e,i){var n,a=[];for(a.push(new I({format:i},!0)),n=0;n<t.length;n++)a.push(q(e,t[n]));return a}function N(t,e){var i,n=[];for(i=0;i<t.handles;i++)n[i]=S(t.ser[i],e[i].children(),t.formatting);return n}function A(t,e,i){switch(t){case 1:e.addClass(z[7]),i[0].addClass(z[6]);break;case 3:i[1].addClass(z[6]);case 2:i[0].addClass(z[7]);case 0:e.addClass(z[6])}}function Q(t,e){var i,n=[];for(i=0;i<t.handles;i++)n.push(K(t,i).appendTo(e));return n}function M(e,i){return i.addClass([z[0],z[8+e.dir],z[4+e.ort]].join(" ")),t("<div/>").appendTo(i).addClass(z[1])}function P(e,i,a){function r(){return E[["width","height"][i.ort]]()}function o(t){var e,i=[R.val()];for(e=0;e<t.length;e++)R.trigger(t[e],i)}function s(e,a,r){var o=e[0]!==T[0][0]?1:0,s=w[0]+i.margin,l=w[1]-i.margin;return r&&T.length>1&&(a=o?Math.max(a,s):Math.min(a,l)),100>a&&(a=g(i,a)),a=n(parseFloat(a.toFixed(7))),a===w[o]?1===T.length?!1:a===s||a===l?0:!1:(e.css(i.style,a+"%"),e.is(":first-child")&&e.toggleClass(z[17],a>50),w[o]=a,i.dir&&(a=100-a),t(y[o]).each(function(){this.write(i,a,e.children(),R)}),!0)}function l(t,e,i){var a=t+e[0],r=t+e[1];return i?(0>a&&(r+=Math.abs(a)),r>100&&(a-=r-100),[n(a),n(r)]):[a,r]}function c(t,e,i){i||d(R,z[14],300),s(t,e,!1),o(["slide","set","change"])}function h(t,e,n,a){return t=t.replace(/\s/g,F+" ")+F,e.on(t,function(t){var e=R.attr("disabled");return e=!(void 0===e||null===e),R.hasClass(z[14])||e?!1:(t=v(t),t.calcPoint=t.points[i.ort],void n(t,a))})}function u(t,e){var i,n=e.handles||T,a=!1,c=100*(t.calcPoint-e.start)/r(),d=n[0][0]!==T[0][0]?1:0;i=l(c,e.positions,n.length>1),a=s(n[0],i[d],1===n.length),n.length>1&&(a=s(n[1],i[d?0:1],!1)||a),a&&o(["slide"])}function p(e){t("."+z[15]).removeClass(z[15]),e.cursor&&t("body").css("cursor","").off(F),$.off(F),R.removeClass(z[12]),o(["set","change"])}function m(e,i){1===i.handles.length&&i.handles[0].children().addClass(z[15]),e.stopPropagation(),h(j.move,$,u,{start:e.calcPoint,handles:i.handles,positions:[w[0],w[T.length-1]]}),h(j.end,$,p,null),e.cursor&&(t("body").css("cursor",t(e.target).css("cursor")),T.length>1&&R.addClass(z[12]),t("body").on("selectstart"+F,!1))}function C(e){var n,a=e.calcPoint,o=0;e.stopPropagation(),t.each(T,function(){o+=this.offset()[i.style]}),o=o/2>a||1===T.length?0:1,a-=E.offset()[i.style],n=100*a/r(),c(T[o],n,i.events.snap),i.events.snap&&m(e,{handles:[T[o]]})}function I(t){var e=t.calcPoint<E.offset()[i.style],n=e?0:100;e=e?0:T.length-1,c(T[e],n,!1)}function b(t){var e,i;if(!t.fixed)for(e=0;e<T.length;e++)h(j.start,T[e].children(),m,{handles:[T[e]]});t.tap&&h(j.start,E,C,{handles:T}),t.extend&&(R.addClass(z[16]),t.tap&&h(j.start,R,I,{handles:T})),t.drag&&(i=E.find("."+z[7]).addClass(z[10]),t.fixed&&(i=i.add(E.children().not(i).children())),h(j.start,i,m,{handles:T}))}var E,y,T,R=t(e),w=[-1,-1];if(!R.is(":empty"))throw new Error("Slider was already initialized.");E=M(i,R),T=Q(i,E),y=N(i,T),A(i.connect,R,T),b(i.events),e.vSet=function(e,n,a,r,l){var c,h;for(i.dir&&i.handles>1&&e.reverse(),l&&d(R,z[14],300),c=0;c<(T.length>1?3:1);c++)h=a||y[c%2][0],h=h.valueOf(e[c%2]),h!==!1&&(h=f(i,h),i.dir&&(h=100-h),s(T[c%2],h,!0)!==!0&&t(y[c%2]).each(function(){this.write(i,w[c%2],T[c%2].children(),R,r)}));return n===!0&&o(["set"]),this},e.vGet=function(){var t,e=[];for(t=0;t<i.handles;t++)e[t]=y[t][0].saved;return 1===e.length?e[0]:i.dir&&i.handles>1?e.reverse():e},e.destroy=function(){return t.each(y,function(){t.each(this,function(){this.target&&this.target.off(F)})}),t(this).off(F).removeClass(z.join(" ")).empty(),a},R.val(i.start)}function L(t){if(this.length){var e=k(t,this);return this.each(function(){P(this,e,t)})}}function B(e){return this.each(function(){var i=t(this).val(),n=this.destroy(),a=t.extend({},n,e);t(this).noUiSlider(a),n.start===a.start&&t(this).val(i)})}var $=t(document),F=".nui",H=t.fn.val,j=window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"},z=["noUi-target","noUi-base","noUi-origin","noUi-handle","noUi-horizontal","noUi-vertical","noUi-background","noUi-connect","noUi-ltr","noUi-rtl","noUi-dragable","","noUi-state-drag","","noUi-state-tap","noUi-active","noUi-extended","noUi-stacking"],U=["decimals","mark","thousand","prefix","postfix","encoder","decoder","negative","negativeBefore"],W=[2,".","","","",function(t){return t},function(t){return t},"-",""];C.prototype.v=function(t){return this.settings[t]},C.prototype.to=function(t){function e(t){return t.split("").reverse().join("")}t=this.v("encoder")(t);var i="",n="",a="",r="";return 0>t&&(i=this.v("negative"),n=this.v("negativeBefore")),t=Math.abs(t).toFixed(this.v("decimals")).toString(),t=t.split("."),0===parseFloat(t)&&(t[0]="0"),this.v("thousand")?(a=e(t[0]).match(/.{1,3}/g),a=e(a.join(e(this.v("thousand"))))):a=t[0],this.v("mark")&&t.length>1&&(r=this.v("mark")+t[1]),n+this.v("prefix")+i+a+r+this.v("postfix")},C.prototype.from=function(t){function e(t){return t.replace(/[\-\/\\\^$*+?.()|\[\]{}]/g,"\\$&")}var i;return null===t||void 0===t?!1:(t=t.toString(),i=t.replace(new RegExp("^"+e(this.v("negativeBefore"))),""),t!==i?(t=i,i="-"):i="",t=t.replace(new RegExp("^"+e(this.v("prefix"))),""),this.v.negative&&(i="",t=t.replace(new RegExp("^"+e(this.v("negative"))),"-")),t=t.replace(new RegExp(e(this.v("postfix"))+"$"),"").replace(new RegExp(e(this.v("thousand")),"g"),"").replace(this.v("mark"),"."),t=this.v("decoder")(parseFloat(i+t)),isNaN(t)?!1:t)},I.prototype.write=function(t,e,i,n,a){this.update&&a===!1||(e=m(t,e),e=this.format(e),this.saved=e,"function"==typeof this.method?this.method.call(this.target[0]||n[0],e,i,n):this.target[this.method](e,i,n))},I.prototype.format=function(t){return this.formatting.to(t)},I.prototype.valueOf=function(t){return this.formatting.from(t)},t.noUiSlider={Link:I},t.fn.noUiSlider=function(t,e){return(e?B:L).call(this,t)},t.fn.val=function(){var e,i,n,a,r=Array.prototype.slice.call(arguments,0);return r.length?("object"==typeof r[1]?(e=r[1].set,i=r[1].link,n=r[1].update,a=r[1].animate):r[1]===!0&&(e=!0),this.each(function(){t(this).hasClass(z[0])?this.vSet(c(r[0]),e,i,n,a):H.apply(t(this),r)})):this.hasClass(z[0])?this[0].vGet():H.apply(this)}}(window.jQuery||window.Zepto),define("nouislider",function(){}),define("taoQtiItem/qtiCreator/editor/styleEditor/itemResizer",["jquery","lodash","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","nouislider","jqueryui"],function(t,e,i){var n=function(n){var a=t("#item-editor-item-resizer"),r=a.data("target"),o=t(r),s=o.width(),l=a.find('[name="item-width-prompt"]'),c=a.find(".slider-box"),d=a.find("#item-editor-item-resizer-slider"),h=t("#item-editor-item-resizer-text"),u=a.find('[data-role="item-width-reset"]'),p={range:{min:Math.min(768,s),max:Math.max(1200,s)},start:s},f=function(){a.find('[value="no-slider"]').trigger("click")},m=function(t){t=parseInt(t).toString()+"px",i.apply(r,"width",t),i.apply(r,"max-width","none")};l.on("click",function(){"slider"===this.value?(m(o.width()),h.val(o.width()),c.slideDown(),d.val(o.width()).trigger("slide"),n.data("responsive",!1)):(d.val(p.start),c.slideUp(),h.val(""),i.apply(r,"width"),i.apply(r,"max-width"),n.data("responsive",!0))}),d.noUiSlider(p),d.on("slide",function(){var t=Math.round(d.val());h.val(t),m(t)}),h.on("keydown",function(t){var i=t.keyCode;return e.contains([8,37,39,46],i)||i>=48&&57>=i||i>=96&&105>=i}),h.on("blur",function(){m(this.value)}),u.on("click",f),t(document).on("customcssloaded.styleeditor",function(t,e){var i;e[r]&&e[r].width?(i=parseInt(e[r].width,10),h.val(i),d.val(i),a.find('[value="slider"]').trigger("click")):a.find('[value="no-slider"]').trigger("click")})};return n}),define("taoQtiItem/qtiCreator/editor/styleEditor/styleSheetToggler",["jquery","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","i18n","helpers","lodash","ui/resourcemgr"],function(t,e,i,n){"use strict";var a=function(){var a=function(a){var r=t("#style-sheet-toggler"),o=t("#stylesheet-uploader"),s=t("[data-custom-css]"),l=function(e){e=t(e);var i=e.closest("li"),n=i.data("stylesheetObj");return{li:i,isCustomCss:!!i.data("custom-css"),isDisabled:i.find(".icon-preview").hasClass("disabled"),stylesheetObj:n,cssUri:n.attr("href")}};o.on("click",function(){o.resourcemgr({appendContainer:"#mediaManager",root:"/",browseUrl:n._url("files","ItemContent","taoItems"),uploadUrl:n._url("upload","ItemContent","taoItems"),deleteUrl:n._url("delete","ItemContent","taoItems"),downloadUrl:n._url("download","ItemContent","taoItems"),params:{uri:a.uri,lang:a.lang,filters:"text/css"},pathParam:"path",select:function(t,i){var n,a=i.length;for(n=0;a>n;n++)e.addStylesheet(i[n].file)}})});var c=function(n){var a=l(n),r=a.isDisabled?"disabled-href":"href";confirm(i("Are you sure you want to delete this stylesheet?\nWarning: This action cannot be undone!"))&&(e.getItem().remove(),t("link["+r+'$="'+a.cssUri+'"]').remove(),a.li.remove())},d=function(e){var i=t(e),n=i.next(".style-sheet-label-editor");i.hide(),n.show()},h=function(t){e.download(l(t).cssUri)},u=function(e){var i=t(e),n=l(e),a=i.prev(".file-label"),r=t.trim(i.val());return r?(n.stylesheetObj.attr("title",r),i.hide(),void a.html(r).show()):(n.stylesheetObj.attr("title",""),!1)},p=function(i){var n,a=l(i),r="disabled-href",o="href";a.isCustomCss?a.isDisabled?(e.create(),s.removeClass("not-available")):(e.erase(),s.addClass("not-available")):(a.isDisabled&&(r="href",o="disabled-href"),n=t("link["+o+'$="'+a.cssUri+'"]'),n.attr(r,n.attr(o)).removeAttr(o)),t(i).toggleClass("disabled")};r.on("click",function(t){var e=t.target,i=e.className;i.indexOf("icon-bin")>-1?c(t.target):i.indexOf("file-label")>-1?d(t.target):i.indexOf("icon-preview")>-1?p(t.target):i.indexOf("icon-download")>-1&&h(t.target)}),r.on("keydown","input",function(e){13===e.keyCode&&t(e.target).trigger("blur")}),r.on("blur","input",function(t){u(t.target)})};return{init:a}}();return a}),define("taoQtiItem/controller/creator/main",["jquery","lodash","taoQtiItem/qtiCreator/editor/preview","taoQtiItem/qtiCreator/editor/preparePrint","taoQtiItem/qtiCreator/helper/panel","taoQtiItem/qtiCreator/helper/itemLoader","taoQtiItem/qtiCreator/helper/creatorRenderer","taoQtiItem/qtiCreator/helper/commonRenderer","taoQtiItem/qtiCreator/editor/styleEditor/fontSelector","taoQtiItem/qtiCreator/editor/styleEditor/colorSelector","taoQtiItem/qtiCreator/editor/styleEditor/fontSizeChanger","taoQtiItem/qtiCreator/editor/styleEditor/itemResizer","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","taoQtiItem/qtiCreator/editor/styleEditor/styleSheetToggler","taoQtiItem/qtiCreator/editor/editor"],function(t,e,i,n,a,r,o,s,l,c,d,h,u,p,f){var m=t("#ajax-loading"),g=m.css("left"),v=function(e,a){m.css("left","-10000px"),u.init(e.element,a),p.init(a),l(),c(),d(),h(e.element),i.init(t(".preview-trigger"),e),n(),f.initGui(),m.css("left",g)};return{start:function(i){var n=t("#tabs"),l=t("ul.ui-tabs-nav > li",n),c=n.tabs("option","selected");r.loadItem({uri:i.uri},function(r){var d=t("#item-editor-panel");s.setOption("baseUrl",i.baseUrl),s.setContext(d),o.setOptions(i),o.get().load(function(){var o;r.setRenderer(this),d.append(r.render()),o=r.postRender(e.clone(i)),v(o,i),a.initFormVisibilityListener(),a.toggleInlineInteractionGroup(),n.off("tabsselect.qti-creator").on("tabsselect.qti-creator",function(){var e=l.index(t(this).parents("li"));e!==c&&(t(window).off(".qti-widget"),t(document).off(".qti-widget"),n.off("tabsselect.qti-creator"))})},r.getUsedClasses())})}}}),define("taoQtiItem/qtiItem/core/Img",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/util"],function(t,e,i,n){var a=t.extend({qtiClass:"img",render:function(){var t=i.getOptionsFromArguments(arguments),a=t.renderer||this.getRenderer(),r=a.getOption("baseUrl")||"",o=this.attr("src")||"",s={attributes:{src:n.fullpath(o,r)}};return this._super(e.merge(s,t.data),t.placeholder,t.subclass,a)},isEmpty:function(){return!this.attr("src")}});return a}),define("taoQtiItem/qtiItem/core/Math",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/rendererConfig"],function(t,e,i){var n=function(t,e){var i=new RegExp("<(/)?"+(e?e+":":"")+"math[^>]*>","g");return t.replace(i,"").replace(/^\s*[\r\n]/gm,"").replace(/\s*[\r\n]$/gm,"")},a=function(t,e){var i=new RegExp("<(/)?"+(e?e+":":""),"g");return t.replace(i,"<$1")},r=e.extend({qtiClass:"math",defaultNsName:"m",defaultNsUri:"http://www.w3.org/1998/Math/MathML",init:function(t,e){this._super(t,e),this.ns=null,this.mathML="",this.annotations={}},getNamespace:function(){if(this.ns&&this.ns.name&&this.ns.uri)return t.clone(this.ns);var e=this.getRelatedItem();if(e){var i=e.getNamespaces();for(ns in i)if(i[ns].indexOf("MathML")>0)return{name:ns,uri:i[ns]};return e.namespaces[this.defaultNsName]=this.defaultNsUri,{name:this.defaultNsName,uri:this.defaultNsUri}}return{}},setNamespace:function(t,e){this.ns={name:t,uri:e}},setAnnotation:function(t,e){this.annotations[t]=e},getAnnotation:function(t){return this.annotations[t]},removeAnnotation:function(t){delete this.annotations[t]},setMathML:function(t){var e=this.getNamespace(),i=e.name&&e.uri?e.name:"";t=n(t,i),e&&(t=a(t,i)),this.mathML=t},getMathML:function(){return this.mathML},render:function(){var e=i.getOptionsFromArguments(arguments),n=e.renderer||this.getRenderer(),a=this.qtiClass,r=this.mathML,o=r,s=this.getNamespace(),l="";for(var c in this.annotations)l+='<annotation encoding="'+c+'">'+this.annotations[c]+"</annotation>";l&&(r=r.indexOf("</semantics>")>0?r.replace("</semantics>",l+"</semantics>"):"<semantics>"+r+l+"</semantics>"),s&&s.name&&(o=r.replace(/<(\/)?([^!])/g,"<$1"+s.name+":$2"),a=s.name+":"+a);var d={block:"block"===this.attr("display")?!0:!1,body:o,raw:r,tag:a,ns:s};return this._super(t.merge(d,e.data),e.placeholder,e.subclass,n)},isEmpty:function(){return o(this.mathML)&&(!this.annotations.latex||!this.annotations.latex.trim())}}),o=function(t){var e=!1;if(t&&t.trim()){var i=$(t);e=!!i.text()}return!e};return r}),define("taoQtiItem/qtiItem/core/Object",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/util"],function(t,e,i,n){var a=t.extend({qtiClass:"object",getMediaType:function(){var t="undefined",e=this.attr("type");return e&&(t=0===e.indexOf("video")?"video":0===e.indexOf("audio")?"audio":0===e.indexOf("image")?"image":"object"),t},render:function(){var t=i.getOptionsFromArguments(arguments),a=t.renderer||this.getRenderer(),r={},o=a.getOption("baseUrl")||"",s=this.attr("data")||"";switch(this.getMediaType()){case"video":r.video=!0;break;case"audio":r.audio=!0;break;case"image":default:r.object=!0}return r.attributes={data:n.fullpath(s,o)},r.body=this._alt,this._super(e.merge(r,t.data),t.placeholder,t.subclass,a)},isEmpty:function(){return!this.attr("data")}});return a}),define("taoQtiItem/qtiItem/core/RubricBlock",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/Container"],function(t,e){var i=t.extend({qtiClass:"rubricBlock"});return e.augment(i),i}),define("taoQtiItem/qtiItem/core/choices/Choice",["taoQtiItem/qtiItem/core/IdentifiedElement"],function(t){var e=t.extend({init:function(t,e){this._super(t,e)},is:function(t){return"choice"===t||this._super(t)},getInteraction:function(){var t,e=null,i=this.getRelatedItem();return i&&(t=i.find(this.serial),t&&(e=t.parent)),e}});return e}),define("taoQtiItem/qtiItem/core/choices/Hotspot",["taoQtiItem/qtiItem/core/choices/Choice"],function(t){var e=t.extend({});return e}),define("taoQtiItem/qtiItem/core/choices/AssociableHotspot",["taoQtiItem/qtiItem/core/choices/Hotspot"],function(t){var e=t.extend({qtiClass:"associableHotspot"});return e}),define("taoQtiItem/qtiItem/core/choices/ContainerChoice",["taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/mixin/Container"],function(t,e){var i=t.extend({init:function(t,e){this._super(t,e)},is:function(t){return"containerChoice"===t||this._super(t)}});return e.augment(i),i}),define("taoQtiItem/qtiItem/core/choices/Gap",["taoQtiItem/qtiItem/core/choices/Choice"],function(t){var e=t.extend({qtiClass:"gap"});return e}),define("taoQtiItem/qtiItem/core/choices/GapImg",["taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/core/Object"],function(t,e){var i=t.extend({qtiClass:"gapImg",initObject:function(t){this.object=t||new e},getObject:function(){return this.object}});return i}),define("taoQtiItem/qtiItem/core/choices/TextVariableChoice",["taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/helper/rendererConfig"],function(t,e){var i=t.extend({init:function(t,e,i){this._super(t,e),this.val(i||"")},is:function(t){return"textVariableChoice"===t||this._super(t)},val:function(t){if("undefined"==typeof t)return this.text;if("string"!=typeof t)throw"text must be a string";return this.text=t,$(document).trigger("choiceTextChange",{choice:this,text:t}),this},render:function(){var t=e.getOptionsFromArguments(arguments),i=t.renderer||this.getRenderer(),n={body:this.text};return this._super(_.merge(n,t.data),t.placeholder,t.subclass,i)}});return i}),define("taoQtiItem/qtiItem/core/choices/GapText",["taoQtiItem/qtiItem/core/choices/TextVariableChoice"],function(t){var e=t.extend({qtiClass:"gapText"});return e}),define("taoQtiItem/qtiItem/core/choices/HotspotChoice",["taoQtiItem/qtiItem/core/choices/Hotspot"],function(t){var e=t.extend({qtiClass:"hotspotChoice"});return e}),define("taoQtiItem/qtiItem/core/choices/Hottext",["taoQtiItem/qtiItem/core/choices/ContainerChoice"],function(t){var e=t.extend({qtiClass:"hottext"});return e}),define("taoQtiItem/qtiItem/core/choices/InlineChoice",["taoQtiItem/qtiItem/core/choices/TextVariableChoice"],function(t){var e=t.extend({qtiClass:"inlineChoice"});return e}),define("taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice",["taoQtiItem/qtiItem/core/choices/ContainerChoice"],function(t){var e=t.extend({qtiClass:"simpleAssociableChoice"});return e}),define("taoQtiItem/qtiItem/core/choices/SimpleChoice",["taoQtiItem/qtiItem/core/choices/ContainerChoice"],function(t){var e=t.extend({qtiClass:"simpleChoice"});return e}),define("taoQtiItem/qtiItem/core/choices/TextEntry",["taoQtiItem/qtiItem/core/choices/TextVariableChoice"],function(t){var e=t.extend({qtiClass:"textEntry"});return e}),define("taoQtiItem/qtiItem/core/feedbacks/Feedback",["taoQtiItem/qtiItem/core/IdentifiedElement"],function(t){var e=t.extend({is:function(t){return"feedback"===t||this._super(t)}});return e}),define("taoQtiItem/qtiItem/core/feedbacks/FeedbackBlock",["taoQtiItem/qtiItem/core/feedbacks/Feedback"],function(t){var e=t.extend({});return e}),define("taoQtiItem/qtiItem/core/feedbacks/FeedbackInline",["taoQtiItem/qtiItem/core/feedbacks/Feedback"],function(t){var e=t.extend({});return e}),define("taoQtiItem/qtiItem/core/interactions/Interaction",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/util"],function(t,e,i,n){var a=t.extend({init:function(t,e){this._super(t,e),this.choices={}},is:function(t){return"interaction"===t||this._super(t)},addChoice:function(t){return t.setRelatedItem(this.getRelatedItem()||null),this.choices[t.getSerial()]=t,this},getChoices:function(){var t={};for(var e in this.choices)t[e]=this.choices[e];return t},getChoice:function(t){var e=null;return this.choices[t]&&(e=this.choices[t]),e},getChoiceByIdentifier:function(t){for(var e in this.choices)if(this.choices[e].id()===t)return this.choices[e];return null},getComposingElements:function(){var i=this._super();for(var n in this.choices)t.isA(this.choices[n],"choice")&&(i[n]=this.choices[n],i=e.extend(i,this.choices[n].getComposingElements()));return i},find:function(t){var e=this._super(t);return e||(e=n.findInCollection(this,"choices",t)),e},getResponseDeclaration:function(){var t=null,e=this.attr("responseIdentifier");if(e){var i=this.getRelatedItem();if(!i)throw"cannot get response of an interaction out of its item context";t=i.getResponseDeclaration(e)}return t},render:function(){var n=i.getOptionsFromArguments(arguments),a=n.renderer||this.getRenderer(),r={_type:this.qtiClass.replace(/([A-Z])/g,function(t){return"_"+t.toLowerCase()}),choices:[],choiceShuffle:!0};if(!a)throw"no renderer found for the interaction "+this.qtiClass;var o=this.attr("shuffle")&&a.shuffleChoices?a.getShuffledChoices(this):this.getChoices(),s={interaction:{serial:this.serial,attributes:this.attributes}},l=this;e.each(o,function(i){if(t.isA(i,"choice"))try{var n=i.render(e.clone(s,!0),null,i.qtiClass+"."+l.qtiClass,a);r.choices.push(n)}catch(o){}});var c=n.subclass?this.qtiClass+"."+n.subclass:this.qtiClass;return this._super(e.merge(r,n.data),n.placeholder,c,a)},postRender:function(e,i,n){n=n||this.getRenderer();var a=this.getChoices();for(var r in a){var o=a[r];t.isA(o,"choice")&&o.postRender({},o.qtiClass+"."+this.qtiClass,n)}return this._super(e,i,n)},setResponse:function(t){var e=null,i=this.getRenderer();if(!i)throw"no renderer found for the interaction "+this.qtiClass;return e=i.setResponse(this,t)},getResponse:function(){var t=null,e=this.getRenderer();if(!e)throw"no renderer found for the interaction "+this.qtiClass;return t=e.getResponse(this)},resetResponse:function(){var t=null,e=this.getRenderer();if(!e)throw"no renderer found for the interaction "+this.qtiClass;return t=e.resetResponse(this)},toArray:function(){var e=this._super();e.choices={};for(var i in this.choices)t.isA(this.choices[i],"choice")&&(e.choices[i]=this.choices[i].toArray());return e}});return a}),define("taoQtiItem/qtiItem/mixin/ContainerInline",["taoQtiItem/qtiItem/mixin/Mixin","taoQtiItem/qtiItem/mixin/Container","lodash"],function(t,e,i){var n={};return i.extend(n,e.methods),i.extend(n,{initContainer:function(t){e.methods.initContainer.call(this,t),this.bdy.contentModel="inlineStatic"}}),{augment:function(e){t.augment(e,n)},methods:n}}),define("taoQtiItem/qtiItem/core/interactions/Prompt",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/ContainerInline"],function(t,e){var i=t.extend({qtiClass:"prompt"});
return e.augment(i),i}),define("taoQtiItem/qtiItem/core/interactions/BlockInteraction",["taoQtiItem/qtiItem/core/interactions/Interaction","taoQtiItem/qtiItem/core/interactions/Prompt","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(t,e,i,n){var a=t.extend({init:function(t,i){this._super(t,i),this.prompt=new e("")},is:function(t){return"blockInteraction"===t||this._super(t)},getComposingElements:function(){var t=this._super();return t=i.extend(t,this.prompt.getComposingElements()),t[this.prompt.getSerial()]=this.prompt,t},find:function(t){return this._super(t)||this.prompt.find(t)},render:function(){var t=n.getOptionsFromArguments(arguments),e=t.renderer||this.getRenderer(),a={prompt:this.prompt.render(e)};return this._super(i.merge(a,t.data),t.placeholder,t.subclass,e)},postRender:function(t,e,i){return i=i||this.getRenderer(),this.prompt.postRender({},"",i),this._super(t,e,i)},toArray:function(){var t=this._super();return t.prompt=this.prompt.toArray(),t}});return a}),define("taoQtiItem/qtiItem/core/interactions/AssociateInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction"],function(t){var e=t.extend({qtiClass:"associateInteraction"});return e}),define("taoQtiItem/qtiItem/core/interactions/ChoiceInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction"],function(t){var e=t.extend({qtiClass:"choiceInteraction"});return e}),define("taoQtiItem/qtiItem/core/interactions/ContainerInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/mixin/Container"],function(t,e){var i=t.extend({});return e.augment(i),i}),define("taoQtiItem/qtiItem/core/interactions/InlineInteraction",["taoQtiItem/qtiItem/core/interactions/Interaction"],function(t){return t.extend({})}),define("taoQtiItem/qtiItem/core/interactions/EndAttemptInteraction",["taoQtiItem/qtiItem/core/interactions/InlineInteraction"],function(t){return t.extend({qtiClass:"endAttemptInteraction"})}),define("taoQtiItem/qtiItem/core/interactions/ExtendedTextInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(t,e,i){var n=t.extend({qtiClass:"extendedTextInteraction",render:function(){var t=i.getOptionsFromArguments(arguments),n=t.renderer||this.getRenderer(),a={multiple:!1,maxStringLoop:[]},r=this.getResponseDeclaration();if(this.attr("maxStrings")&&("multiple"===r.attr("cardinality")||"ordered"===r.attr("cardinality"))){a.multiple=!0;for(var o=0;o<this.attr("maxStrings");o++)a.maxStringLoop.push(o+"")}return this._super(e.merge(a,t.data),t.placeholder,t.subclass,n)}});return n}),define("taoQtiItem/qtiItem/core/interactions/GapMatchInteraction",["taoQtiItem/qtiItem/core/interactions/ContainerInteraction"],function(t){var e=t.extend({qtiClass:"gapMatchInteraction"});return e}),define("taoQtiItem/qtiItem/core/interactions/ObjectInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/core/Object"],function(t,e){var i=t.extend({initObject:function(t){this.object=t||new e},getObject:function(){return this.object}});return i}),define("taoQtiItem/qtiItem/core/interactions/GraphicInteraction",["taoQtiItem/qtiItem/core/interactions/ObjectInteraction","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(t,e,i){var n=t.extend({render:function(){var t=i.getOptionsFromArguments(arguments),n=t.renderer||this.getRenderer(),a={backgroundImage:this.object.getAttributes(),object:this.object.render(n)};return this._super(e.merge(a,t.data),t.placeholder,t.subclass,n)}});return n}),define("taoQtiItem/qtiItem/core/interactions/GraphicAssociateInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction"],function(t){var e=t.extend({qtiClass:"graphicAssociateInteraction"});return e}),define("taoQtiItem/qtiItem/core/interactions/GraphicGapMatchInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction","taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(t,e,i,n){var a=t.extend({qtiClass:"graphicGapMatchInteraction",init:function(t,e){this._super(t,e),this.gapImgs={}},addGapImg:function(t){e.isA(t,"gapImg")&&(t.setRelatedItem(this.getRelatedItem()||null),this.gapImgs[t.getSerial()]=t)},removeGapImg:function(t){var i="";return"string"==typeof t?i=t:e.isA(t,"gapImg")&&(i=t.getSerial()),delete this.gapImgs[i],this},getGapImgs:function(){return i.clone(this.gapImgs)},getGapImg:function(t){return this.gapImgs[t]},getComposingElements:function(){var t=this._super();for(var e in this.gapImgs)t[e]=this.gapImgs[e],t=i.extend(t,this.gapImgs[e].getComposingElements());return t},find:function(t){var e=this._super(t);return e||this.gapImgs[t]&&(e={parent:this,element:this.gapImgs[t]}),e},render:function(){var t=n.getOptionsFromArguments(arguments),a=t.renderer||this.getRenderer(),r={gapImgs:[]},o=this.getGapImgs();for(var s in o)e.isA(o[s],"choice")&&r.gapImgs.push(o[s].render({},null,"",a));return this._super(i.merge(r,t.data),t.placeholder,t.subclass,a)},toArray:function(){var t=this._super();t.gapImgs={};var e=this.getGapImgs();for(var i in e)t.gapImgs[i]=e[i].toArray();return t}});return a}),define("taoQtiItem/qtiItem/core/interactions/GraphicOrderInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction"],function(t){var e=t.extend({qtiClass:"graphicOrderInteraction"});return e}),define("taoQtiItem/qtiItem/core/interactions/HotspotInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction"],function(t){var e=t.extend({qtiClass:"hotspotInteraction"});return e}),define("taoQtiItem/qtiItem/core/interactions/HottextInteraction",["taoQtiItem/qtiItem/core/interactions/ContainerInteraction","taoQtiItem/qtiItem/core/Element"],function(t,e){var i=t.extend({qtiClass:"hottextInteraction",getChoices:function(){return this.getBody().getElements("Hottext")},getChoice:function(t){var i=this.getBody().getElement(t);return e.isA(i,"choice")?i:null}});return i}),define("taoQtiItem/qtiItem/core/interactions/InlineChoiceInteraction",["taoQtiItem/qtiItem/core/interactions/InlineInteraction"],function(t){var e=t.extend({qtiClass:"inlineChoiceInteraction"});return e}),define("taoQtiItem/qtiItem/core/interactions/MatchInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/util"],function(t,e,i,n,a){var r=t.extend({qtiClass:"matchInteraction",init:function(t,e){this._super(t,e),this.choices=[{},{}]},addChoice:function(t,e){e=parseInt(e),this.choices[e]&&(t.setRelatedItem(this.getRelatedItem()||null),this.choices[e][t.getSerial()]=t)},getChoices:function(t){return t=parseInt(t),i.clone(this.choices[t]?this.choices[t]:this.choices)},getChoice:function(t){return this.choices[0][t]||this.choices[1][t]||null},getComposingElements:function(){for(var t=this._super(),n=0;2>n;n++){var a=this.getChoices(n);for(var r in a)a[r]instanceof e&&(t[r]=a[r],t=i.extend(t,a[r].getComposingElements()))}return t},find:function(t){var e=this._super(t);return e||(e=a.findInCollection(this,["choices.0","choices.1"],t)),e},render:function(){var t,a=n.getOptionsFromArguments(arguments),r=a.renderer||this.getRenderer(),o={matchSet1:[],matchSet2:[]},s={interaction:{serial:this.serial,attributes:this.attributes}};if(!r)throw"no renderer found for the interaction "+this.qtiClass;t=this.attr("shuffle")&&r.shuffleChoices?r.getShuffledChoices(this):this.getChoices();for(var l=0;2>l;l++){var c=t[l];for(var d in c)c[d]instanceof e&&o["matchSet"+(l+1)].push(c[d].render(i.clone(s,!0),null,"simpleAssociableChoice.matchInteraction",r))}return this._super(i.merge(o,a.data),a.placeholder,a.subclass,r)},postRender:function(t,n,a){a=a||this.getRenderer();for(var r=this.getChoices(),o=0;2>o;o++)i.forIn(r[o],function(t){t instanceof e&&t.postRender({},"simpleAssociableChoice.matchInteraction",a)});return this._super(t,n,a)},toArray:function(){var t=this._super();t.choices={0:{},1:{}};for(var i=0;2>i;i++){var n=this.getChoices(i);for(var a in n)n[a]instanceof e&&(t.choices[i][a]=n[a].toArray())}return t}});return r}),define("taoQtiItem/qtiItem/core/interactions/MediaInteraction",["taoQtiItem/qtiItem/core/interactions/ObjectInteraction","taoQtiItem/qtiItem/helper/rendererConfig"],function(t,e){var i=t.extend({qtiClass:"mediaInteraction",render:function(){var t=e.getOptionsFromArguments(arguments),i=t.renderer||this.getRenderer(),n={media:this.object.render({},null,"",i)};return this._super(_.merge(n,t.data),t.placeholder,t.subclass,i)}});return i}),define("taoQtiItem/qtiItem/core/interactions/OrderInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction"],function(t){var e=t.extend({qtiClass:"orderInteraction"});return e}),define("taoQtiItem/qtiItem/core/interactions/SelectPointInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction"],function(t){var e=t.extend({qtiClass:"selectPointInteraction"});return e}),define("taoQtiItem/qtiItem/core/interactions/SliderInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction"],function(t){var e=t.extend({qtiClass:"sliderInteraction"});return e}),define("taoQtiItem/qtiItem/core/interactions/TextEntryInteraction",["taoQtiItem/qtiItem/core/interactions/InlineInteraction"],function(t){var e=t.extend({qtiClass:"textEntryInteraction"});return e}),define("taoQtiItem/qtiItem/core/interactions/UploadInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction"],function(t){var e=t.extend({qtiClass:"uploadInteraction"});return e}),define("taoQtiItem/qtiItem/core/response/SimpleFeedbackRule",["taoQtiItem/qtiItem/core/Element"],function(t){var e=t.extend({qtiClass:"_simpleFeedbackRule",serial:"",relatedItem:null,init:function(e,i,n,a){this._super(e,{}),this.condition="correct",this.comparedOutcome=null,this.comparedValue=0,this.feedbackOutcome=i,this.feedbackThen=t.isA(n,"feedback")?n:null,this.feedbackElse=t.isA(a,"feedback")?n:null},setCondition:function(e,i,n){if(!t.isA(e,"variableDeclaration"))throw"invalid outcome type: must be a variableDeclaration";switch(i){case"correct":case"incorrect":if(!t.isA(e,"responseDeclaration"))throw"invalid outcome type: must be a responseDeclaration";this.comparedOutcome=e,this.condition=i;break;case"lt":case"lte":case"equal":case"gte":case"gt":if(null===n||void 0===n)throw"compared value must not be null";this.comparedOutcome=e,this.condition=i,this.comparedValue=n;break;default:throw"unknown condition type : ".condition}return this},setFeedbackElse:function(e){t.isA(e,"feedback")&&(this.feedbackElse=e)}});return e}),define("taoQtiItem/qtiItem/core/variables/ResponseDeclaration",["taoQtiItem/qtiItem/core/variables/VariableDeclaration","lodash"],function(t,e){var i=t.extend({qtiClass:"responseDeclaration",init:function(t,e){this._super(t,e),this.template="",this.mappingAttributes={},this.mapEntries={},this.correctResponse=null,this.feedbackRules={}},getFeedbackRules:function(){return[]},getComposingElements:function(){var t=this._super();return t=e.extend(t,this.getFeedbackRules())},toArray:function(){var t=this._super();return t.howMatch=this.template,t.correctResponses=this.correctResponse,t.mapping=this.mapEntries,t.mappingAttributes=this.mappingAttributes,t}});return i}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/container",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a,r="";return r+='<div class="qti-block">',(a=i.body)?n=a.call(t,{hash:{},data:e}):(a=t&&t.body,n=typeof a===d?a.call(t,{hash:{},data:e}):a),(n||0===n)&&(r+=n),r+="</div>"}function o(t,e){var n,a,r="";return(a=i.body)?n=a.call(t,{hash:{},data:e}):(a=t&&t.body,n=typeof a===d?a.call(t,{hash:{},data:e}):a),(n||0===n)&&(r+=n),r}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var s,l,c,d="function",h=this,u=i.helperMissing;return l=i.equal||e&&e.equal,c={hash:{},inverse:h.program(3,o,a),fn:h.program(1,r,a),data:a},s=l?l.call(e,e&&e.contentModel,"blockStatic",c):u.call(e,"equal",e&&e.contentModel,"blockStatic",c),s||0===s?s:""})}),define("taoQtiItem/qtiCommonRenderer/renderers/Container",["tpl!taoQtiItem/qtiCommonRenderer/tpl/container"],function(t){return{qtiClass:"_container",template:t,qitCommonR:!0}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/img",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t){var e,i="";return i+='id="'+p((e=t&&t.attributes,e=null==e||e===!1?e:e.id,typeof e===u?e.apply(t):e))+'"'}function o(t){var e,i="";return i+='class="'+p((e=t&&t.attributes,e=null==e||e===!1?e:e["class"],typeof e===u?e.apply(t):e))+'"'}function s(t){var e,i="";return i+='height="'+p((e=t&&t.attributes,e=null==e||e===!1?e:e.height,typeof e===u?e.apply(t):e))+'" '}function l(t){var e,i="";return i+='width="'+p((e=t&&t.attributes,e=null==e||e===!1?e:e.width,typeof e===u?e.apply(t):e))+'" '}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var c,d,h="",u="function",p=this.escapeExpression,f=this;return h+='<img \n    data-serial="',(d=i.serial)?c=d.call(e,{hash:{},data:a}):(d=e&&e.serial,c=typeof d===u?d.call(e,{hash:{},data:a}):d),h+=p(c)+'" \n    data-qti-class="img" \n    src="'+p((c=e&&e.attributes,c=null==c||c===!1?c:c.src,typeof c===u?c.apply(e):c))+'" \n    alt="'+p((c=e&&e.attributes,c=null==c||c===!1?c:c.alt,typeof c===u?c.apply(e):c))+'" \n    ',c=i["if"].call(e,(c=e&&e.attributes,null==c||c===!1?c:c.id),{hash:{},inverse:f.noop,fn:f.program(1,r,a),data:a}),(c||0===c)&&(h+=c),h+="\n    ",c=i["if"].call(e,(c=e&&e.attributes,null==c||c===!1?c:c["class"]),{hash:{},inverse:f.noop,fn:f.program(3,o,a),data:a}),(c||0===c)&&(h+=c),h+="\n    ",c=i["if"].call(e,(c=e&&e.attributes,null==c||c===!1?c:c.height),{hash:{},inverse:f.noop,fn:f.program(5,s,a),data:a}),(c||0===c)&&(h+=c),h+="\n    ",c=i["if"].call(e,(c=e&&e.attributes,null==c||c===!1?c:c.width),{hash:{},inverse:f.noop,fn:f.program(7,l,a),data:a}),(c||0===c)&&(h+=c),h+="\n    />"})}),define("taoQtiItem/qtiCommonRenderer/renderers/Img",["tpl!taoQtiItem/qtiCommonRenderer/tpl/img","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"img",template:t,getContainer:e.getContainer}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/item",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(){return" attributes.id"}function o(){return" attributes.class"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var s,l,c="",d="function",h=this.escapeExpression,u=this;return c+='<div class="qti-item tao-scope runtime" data-serial="',(l=i.serial)?s=l.call(e,{hash:{},data:a}):(l=e&&e.serial,s=typeof l===d?l.call(e,{hash:{},data:a}):l),c+=h(s)+'" data-identifier="'+h((s=e&&e.attributes,s=null==s||s===!1?s:s.identifier,typeof s===d?s.apply(e):s))+'">\n    <div',s=i["if"].call(e,(s=e&&e.attributes,null==s||s===!1?s:s.id),{hash:{},inverse:u.noop,fn:u.program(1,r,a),data:a}),(s||0===s)&&(c+=s),c+=' class="qti-itemBody',s=i["if"].call(e,(s=e&&e.attributes,null==s||s===!1?s:s["class"]),{hash:{},inverse:u.noop,fn:u.program(3,o,a),data:a}),(s||0===s)&&(c+=s),c+='">',(l=i.body)?s=l.call(e,{hash:{},data:a}):(l=e&&e.body,s=typeof l===d?l.call(e,{hash:{},data:a}):l),(s||0===s)&&(c+=s),c+='</div>\n    <div id="modalFeedbacks"></div>\n</div>'})}),define("taoQtiItem/qtiCommonRenderer/helpers/itemStylesheetHandler",["jquery","lodash"],function(t,e){var i=function(){var i=function(i){var n=t("head");t("body").addClass("tao-scope"),e(i).forEach(function(e){n.append(t(e.render()))})};return{attach:i}}();return i}),define("taoQtiItem/qtiCommonRenderer/renderers/Item",["tpl!taoQtiItem/qtiCommonRenderer/tpl/item","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/itemStylesheetHandler"],function(t,e,i){return{qtiClass:"assessmentItem",template:t,getContainer:e.getContainer,render:function(t){e.targetBlank(e.getContainer(t)),i.attach(t.stylesheets)}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/math",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a,r="";return r+='\n<span data-serial="',(a=i.serial)?n=a.call(t,{hash:{},data:e}):(a=t&&t.serial,n=typeof a===l?a.call(t,{hash:{},data:e}):a),r+=c(n)+'" data-qti-class="math">\n    <math display = "block">',(a=i.raw)?n=a.call(t,{hash:{},data:e}):(a=t&&t.raw,n=typeof a===l?a.call(t,{hash:{},data:e}):a),(n||0===n)&&(r+=n),r+="</math>\n</span>\n"}function o(t,e){var n,a,r="";return r+='\n<span data-serial="',(a=i.serial)?n=a.call(t,{hash:{},data:e}):(a=t&&t.serial,n=typeof a===l?a.call(t,{hash:{},data:e}):a),r+=c(n)+'" data-qti-class="math">\n    <math>',(a=i.raw)?n=a.call(t,{hash:{},data:e}):(a=t&&t.raw,n=typeof a===l?a.call(t,{hash:{},data:e}):a),(n||0===n)&&(r+=n),r+="</math>\n</span>   \n"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var s,l="function",c=this.escapeExpression,d=this;return s=i["if"].call(e,e&&e.block,{hash:{},inverse:d.program(3,o,a),fn:d.program(1,r,a),data:a}),s||0===s?s:""})}),define("taoQtiItem/qtiCommonRenderer/renderers/Math",["tpl!taoQtiItem/qtiCommonRenderer/tpl/math","taoQtiItem/qtiCommonRenderer/helpers/Helper","mathJax"],function(t,e,i){return{qtiClass:"math",template:t,getContainer:e.getContainer,render:function(t){"undefined"!=typeof i&&i&&i.Hub.Queue(["Typeset",i.Hub,e.getContainer(t).parent()[0]])}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/modalFeedback",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l="function",c=this.escapeExpression;return s+='<div id="',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'" data-identifier="'+c((r=e&&e.attributes,r=null==r||r===!1?r:r.identifier,typeof r===l?r.apply(e):r))+'" class="modal qti-modalFeedback">\n    <h1 class="qti-title modal-title">'+c((r=e&&e.attributes,r=null==r||r===!1?r:r.title,typeof r===l?r.apply(e):r))+'</h1>\n    <div class="modal-body">',(o=i.body)?r=o.call(e,{hash:{},data:a}):(o=e&&e.body,r=typeof o===l?o.call(e,{hash:{},data:a}):o),(r||0===r)&&(s+=r),s+="</div>\n</div>"})}),define("taoQtiItem/qtiCommonRenderer/helpers/sizeFinder",["jquery"],function(t){var e=function(){var e=function(e){var i;e.each(function(){i=t(this),i.data("originalProperties",{position:i.css("position"),left:i.css("left"),display:i.css("display")}),i.css({position:"relative",left:"-10000px"}).show()})},i=function(e){var i,n;e.each(function(){i=t(this),n=i.data("originalProperties"),i.css({position:n.position,left:n.left}).hide(),i.removeData("originalProperties")})},n=function(t){return{width:t.outerWidth(),height:t.outerHeight()}},a=function(a,r,o){var s,l,c=["img","video"],d=t();return r&&(c=c.concat(r)),l=c.length,a instanceof t||(a=t(a)),d=d.add(a).add(a.find(c.join(","))),e(d),s=n(a),i(d),o.call(a[0],s),a.trigger("measured.sizeFinder",s),s};return{measure:a}}();return e}),define("taoQtiItem/qtiCommonRenderer/renderers/ModalFeedback",["lodash","tpl!taoQtiItem/qtiCommonRenderer/tpl/modalFeedback","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/sizeFinder","ui/modal"],function(t,e,i,n){var a={qtiClass:"modalFeedback",template:e,getContainer:i.getContainer,maxWidth:800,render:function(e,i){i=i||{};var r=$("#"+e.getSerial());n.measure(r,null,function(e){r.modal({startClosed:!1,width:Math.min(e.width,a.maxWidth)}),r.on("closed.modal",function(){t.isFunction(i.callback)&&i.callback.call(this)})})}};return a}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/rubricBlock",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l="function",c=this.escapeExpression;return s+='<div class="grid-row qti-rubricBlock" data-use="'+c((r=e&&e.attributes,r=null==r||r===!1?r:r.use,typeof r===l?r.apply(e):r))+'" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'" data-qti-class="rubricBlock">\n    <div class="col-12">\n        <div class="qti-rubricBlock-body">',(o=i.body)?r=o.call(e,{hash:{},data:a}):(o=e&&e.body,r=typeof o===l?o.call(e,{hash:{},data:a}):o),(r||0===r)&&(s+=r),s+="</div>\n    </div>\n</div>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/RubricBlock",["tpl!taoQtiItem/qtiCommonRenderer/tpl/rubricBlock","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"rubricBlock",getContainer:e.getContainer,template:t}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/stylesheet",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t){var e,i="";return i+='media="'+d((e=t&&t.attributes,e=null==e||e===!1?e:e.media,typeof e===c?e.apply(t):e))+'"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l="",c="function",d=this.escapeExpression,h=this;return l+='<link \n    href="'+d((o=e&&e.attributes,o=null==o||o===!1?o:o.href,typeof o===c?o.apply(e):o))+'" \n    type="'+d((o=e&&e.attributes,o=null==o||o===!1?o:o.type,typeof o===c?o.apply(e):o))+'" \n    data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.serial,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'" \n    ',o=i["if"].call(e,(o=e&&e.attributes,null==o||o===!1?o:o.media),{hash:{},inverse:h.noop,fn:h.program(1,r,a),data:a}),(o||0===o)&&(l+=o),l+="\n    />"})}),define("taoQtiItem/qtiCommonRenderer/renderers/Stylesheet",["tpl!taoQtiItem/qtiCommonRenderer/tpl/stylesheet","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"stylesheet",template:t,getContainer:e.getContainer}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gap",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o="",s="function",l=this.escapeExpression;return o+='<span class="gapmatch">\r\n    <span data-identifier="'+l((r=e&&e.attributes,r=null==r||r===!1?r:r.identifier,typeof r===s?r.apply(e):r))+'" class="gapmatch-content"></span>\r\n</span>'})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/Gap",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gap"],function(t){return{qtiClass:"gap",template:t}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gapImg",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t){var e,i="";return i+='alt="'+d((e=t&&t.attributes,e=null==e||e===!1?e:e.objetLabel,typeof e===c?e.apply(t):e))+'" '}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l="",c="function",d=this.escapeExpression,h=this;return l+='<li class="selectable" data-identifier="'+d((o=e&&e.attributes,o=null==o||o===!1?o:o.identifier,typeof o===c?o.apply(e):o))+'" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.serial,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'">\n    <img src="'+d((o=e&&e.object,o=null==o||o===!1?o:o.attributes,o=null==o||o===!1?o:o.data,typeof o===c?o.apply(e):o))+'" \n         width="'+d((o=e&&e.object,o=null==o||o===!1?o:o.attributes,o=null==o||o===!1?o:o.width,typeof o===c?o.apply(e):o))+'"\n         height="'+d((o=e&&e.object,o=null==o||o===!1?o:o.attributes,o=null==o||o===!1?o:o.height,typeof o===c?o.apply(e):o))+'"\n         ',o=i["if"].call(e,(o=e&&e.attributes,null==o||o===!1?o:o.objectLabel),{hash:{},inverse:h.noop,fn:h.program(1,r,a),data:a}),(o||0===o)&&(l+=o),l+="\n    />\n</li>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/GapImg",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gapImg"],function(t){return{qtiClass:"gapImg",template:t}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l="function",c=this.escapeExpression;return s+='<li class="qti-choice" data-identifier="'+c((r=e&&e.attributes,r=null==r||r===!1?r:r.identifier,typeof r===l?r.apply(e):r))+'" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'">',(o=i.body)?r=o.call(e,{hash:{},data:a}):(o=e&&e.body,r=typeof o===l?o.call(e,{hash:{},data:a}):o),(r||0===r)&&(s+=r),s+="</li>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/GapText",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice"],function(t){return{qtiClass:"gapText",template:t}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/hottext",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l="function",c=this.escapeExpression;return s+='<span class="hottext" data-identifier="'+c((r=e&&e.attributes,r=null==r||r===!1?r:r.identifier,typeof r===l?r.apply(e):r))+'" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'">\r\n    <label class="hottext-checkmark">\r\n        <input type="checkbox" value="'+c((r=e&&e.attributes,r=null==r||r===!1?r:r.identifier,typeof r===l?r.apply(e):r))+'">\r\n        <span class="icon-checkbox small"></span>\r\n    </label>\r\n    <span class="hottext-content">',(o=i.body)?r=o.call(e,{hash:{},data:a}):(o=e&&e.body,r=typeof o===l?o.call(e,{hash:{},data:a}):o),(r||0===r)&&(s+=r),s+="</span>\r\n</span>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/Hottext",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/hottext","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"hottext",getContainer:e.getContainer,template:t}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/inlineChoice",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l="function",c=this.escapeExpression;return s+='<option data-identifier="'+c((r=e&&e.attributes,r=null==r||r===!1?r:r.identifier,typeof r===l?r.apply(e):r))+'" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'" value="'+c((r=e&&e.attributes,r=null==r||r===!1?r:r.identifier,typeof r===l?r.apply(e):r))+'">',(o=i.body)?r=o.call(e,{hash:{},data:a}):(o=e&&e.body,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+"</option>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/InlineChoice",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/inlineChoice","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"inlineChoice",getContainer:e.getContainer,template:t}}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.AssociateInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"simpleAssociableChoice.associateInteraction",getContainer:e.getContainer,template:t}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleAssociableChoice.matchInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l="function",c=this.escapeExpression;return s+='<th class="qti-choice qti-associableChoice qti-simpleAssociableChoice" data-identifier="'+c((r=e&&e.attributes,r=null==r||r===!1?r:r.identifier,typeof r===l?r.apply(e):r))+'" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'">',(o=i.body)?r=o.call(e,{hash:{},data:a}):(o=e&&e.body,r=typeof o===l?o.call(e,{hash:{},data:a}):o),(r||0===r)&&(s+=r),s+="</th>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.MatchInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleAssociableChoice.matchInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"simpleAssociableChoice.matchInteraction",getContainer:e.getContainer,template:t}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleChoice.choiceInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t){var e,i="";return i+='\n            <input type="radio" name="response-'+h((e=t&&t.interaction,e=null==e||e===!1?e:e.serial,typeof e===d?e.apply(t):e))+'" value="'+h((e=t&&t.attributes,e=null==e||e===!1?e:e.identifier,typeof e===d?e.apply(t):e))+'">\n            <span class="icon-radio"></span>\n            '}function o(t){var e,i="";return i+='\n            <input type="checkbox" name="response-'+h((e=t&&t.interaction,e=null==e||e===!1?e:e.serial,typeof e===d?e.apply(t):e))+'" value="'+h((e=t&&t.attributes,e=null==e||e===!1?e:e.identifier,typeof e===d?e.apply(t):e))+'">\n            <span class="icon-checkbox"></span>\n            '}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var s,l,c="",d="function",h=this.escapeExpression,u=this;return c+='<li class="qti-choice qti-simpleChoice" data-identifier="'+h((s=e&&e.attributes,s=null==s||s===!1?s:s.identifier,typeof s===d?s.apply(e):s))+'" data-serial="',(l=i.serial)?s=l.call(e,{hash:{},data:a}):(l=e&&e.serial,s=typeof l===d?l.call(e,{hash:{},data:a}):l),c+=h(s)+'">\n    <div class="pseudo-label-box">\n        <label class="real-label">\n            ',s=i["if"].call(e,e&&e.unique,{hash:{},inverse:u.program(3,o,a),fn:u.program(1,r,a),data:a}),(s||0===s)&&(c+=s),c+='\n        </label>\n        <div class="label-box">\n            <div class="label-content clear" contenteditable="false">\n                ',(l=i.body)?s=l.call(e,{hash:{},data:a}):(l=e&&e.body,s=typeof l===d?l.call(e,{hash:{},data:a}):l),(s||0===s)&&(c+=s),c+="\n            </div>\n        </div>\n    </div>\n</li>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.ChoiceInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleChoice.choiceInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"simpleChoice.choiceInteraction",getContainer:e.getContainer,getData:function(t,e){return e.unique=1===parseInt(e.interaction.attributes.maxChoices),e},template:t}}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.OrderInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"simpleChoice.orderInteraction",getContainer:e.getContainer,template:t}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a;return(a=i.prompt)?n=a.call(t,{hash:{},data:e}):(a=t&&t.prompt,n=typeof a===h?a.call(t,{hash:{},data:e}):a),n||0===n?n:""}function o(t){var e;return e=typeof t===h?t.apply(t):t,e||0===e?e:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var s,l,c,d="",h="function",u=this.escapeExpression,p=this,f=i.blockHelperMissing;return d+='<div class="qti-interaction qti-blockInteraction qti-associateInteraction" data-serial="',(l=i.serial)?s=l.call(e,{hash:{},data:a}):(l=e&&e.serial,s=typeof l===h?l.call(e,{hash:{},data:a}):l),d+=u(s)+'" data-qti-class="associateInteraction">\n    ',s=i["if"].call(e,e&&e.prompt,{hash:{},inverse:p.noop,fn:p.program(1,r,a),data:a}),(s||0===s)&&(d+=s),d+='\n    <div class="instruction-container"></div>\n    <ul class="choice-area clearfix  none block-listing solid horizontal source" data-eyecatcher=">li">\n        ',c={hash:{},inverse:p.noop,fn:p.program(3,o,a),data:a},(l=i.choices)?s=l.call(e,c):(l=e&&e.choices,s=typeof l===h?l.call(e,c):l),i.choices||(s=f.call(e,s,{hash:{},inverse:p.noop,fn:p.program(3,o,a),data:a})),(s||0===s)&&(d+=s),d+='\n    </ul>\n    <ul class="result-area none target clearfix">\n    </ul>\n    <div class="notification-container"></div>\n</div>'})}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction.pair",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(){return"incomplete-pair"
}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s="",l=this;return s+='<li class="',o=i["if"].call(e,e&&e.empty,{hash:{},inverse:l.noop,fn:l.program(1,r,a),data:a}),(o||0===o)&&(s+=o),s+='">\n    <div class="target lft"></div>\n    <div class="target rgt"></div>\n</li>\n'})}),define("taoQtiItem/qtiCommonRenderer/helpers/PciResponse",["lodash"],function(t){var e={single:"base",multiple:"list",ordered:"list",record:"record"},i=function(t,e){var e="undefined"!=typeof e?e:!0,i="";if("undefined"!=typeof t.base.boolean)i+=1==e?"(boolean) ":"",i+=1==t.base.boolean?"true":"false";else if("undefined"!=typeof t.base.integer)i+=1==e?"(integer) ":"",i+=t.base.integer;else if("undefined"!=typeof t.base.float)i+=1==e?"(float) ":"",i+=t.base.float;else if("undefined"!=typeof t.base.string)i+=1==e?"(string) ":"",i+=""==t.base.string?"NULL":'"'+t.base.string+'"';else if("undefined"!=typeof t.base.point)i+=1==e?"(point) ":"",i+="["+t.base.point[0]+", "+t.base.point[1]+"]";else if("undefined"!=typeof t.base.pair)i+=1==e?"(pair) ":"",i+="["+t.base.pair[0]+", "+t.base.pair[1]+"]";else if("undefined"!=typeof t.base.directedPair)i+=1==e?"(directedPair) ":"",i+="["+t.base.pair[0]+", "+t.base.pair[1]+"]";else if("undefined"!=typeof t.base.duration)i+=1==e?"(duration) ":"",i+=t.base.duration;else if("undefined"!=typeof t.base.file)i+=1==e?"(file) ":"",i+="binary data";else if("undefined"!=typeof t.base.uri)i+=1==e?"(uri) ":"",i+=t.base.uri;else if("undefined"!=typeof t.base.intOrIdentifier)i+=1==e?"(intOrIdentifier) ":"",i+=t.base.intOrIdentifier;else{if("undefined"==typeof t.base.identifier)throw"Unknown PCI JSON BaseType";i+=1==e?"(identifier) ":"",i+=t.base.identifier}return i};return{unserialize:function(i,n){var a,r=[],o=n.getResponseDeclaration(),s=o.attr("baseType"),l=o.attr("cardinality");if(!e[l])throw"unknown cardinality in the responseDeclaration of the interaction";a=e[l];var c=i[a];if(null===c)r=[];else{if(!t.isObject(c))throw"invalid response cardinality, expected "+l+" ("+a+")";if(void 0===c[s])throw"invalid response baseType";r=c[s],r=t.isArray(r)?r:[r]}return r},serialize:function(i,n){if(!t.isArray(i))throw"invalid argument : responseValues must be an Array";var a,r={},o=n.getResponseDeclaration(),s=o.attr("baseType"),l=o.attr("cardinality");if(!e[l])throw"unknown cardinality in the responseDeclaration of the interaction";return a=e[l],"base"===a?0===i.length?r.base=null:(r.base={},r.base[s]=i[0]):(r[a]={},r[a][s]=i),r},isEmpty:function(e){return null===e||t.isEmpty(e)||null===e.base||t.isArray(e.list)&&t.isEmpty(e.list)||t.isArray(e.record)&&t.isEmpty(e.record)},prettyPrint:function(t){var e="";if("undefined"!=typeof t.base)e+=i(t,!0);else if("undefined"!=typeof t.list);else if("undefined"==typeof t.record)throw"Not a valid PCI JSON Response";return e}}}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/AssociateInteraction",["lodash","i18n","jquery","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction.pair","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","eyecatcher"],function(t,e,i,n,a,r,o){var s={},l=function(n,o,l){var c=o.data("serial"),d=n.getChoice(c);if(!c)throw"empty choice serial";s[c]||(s[c]=0),s[c]++;var h=function(){l.data("serial",c).html(o.html()).addClass("filled"),!n.responseMappingMode&&d.attr("matchMax")&&s[c]>=d.attr("matchMax")&&o.addClass("deactivated")};if(l.siblings("div").hasClass("filled")){var u=r.getContainer(n).find(".result-area"),p=l.parent(),f=[l.siblings("div").data("serial"),c],m=i();u.children().not(p).each(function(){var e=i(this).children(".filled");if(2===e.length){var n=[i(e[0]).data("serial"),i(e[1]).data("serial")];if(2===t.intersection(f,n).length)return m=e,!1}}),0===m.length?(h(),r.triggerResponseChangeEvent(n,{type:"added",$pair:p,choices:f}),r.validateInstructions(n,{choice:o,target:l}),(n.responseMappingMode||0===parseInt(n.attr("maxAssociations")))&&(p.removeClass("incomplete-pair"),u.children(".incomplete-pair").length||(u.append(a({empty:!0})),u.children(".incomplete-pair").fadeIn(600,function(){i(this).show()})))):(m.css("border","1px solid orange"),l.html(e("identical pair already exists")).css({color:"orange",border:"1px solid orange"}),setTimeout(function(){m.removeAttr("style"),l.empty().removeAttr("style")},2e3))}else h()},c=function(t,e,n){var a=e.data("serial"),o=r.getContainer(t);if(o.find(".choice-area [data-serial="+a+"]").removeClass("deactivated"),s[a]--,e.removeClass("filled").removeData("serial").empty(),!t.swapping&&(r.triggerResponseChangeEvent(t,{type:"removed",$pair:e.parent()}),r.validateInstructions(t,{choice:e}),!e.siblings("div").hasClass("filled")&&(0===parseInt(t.attr("maxAssociations"))||t.responseMappingMode))){var l=e.parent();l.hasClass("incomplete-pair")||(n?l.addClass("removing").fadeOut(500,function(){i(this).remove()}):l.remove())}},d=function(t,e){var i=t.getChoiceByIdentifier(e);if(!i)throw new Error("cannot find a choice with the identifier : "+e);return r.getContainer(t).find(".choice-area [data-serial="+i.getSerial()+"]")},h=function(t){var e=parseInt(t.attr("maxAssociations")),i=r.getContainer(t).find(".result-area");if(t.responseMappingMode||0===e)i.append(a({empty:!0})),i.children(".incomplete-pair").show();else for(var n=0;e>n;n++)i.append(a())},u=function(t){h(t);var n=r.getContainer(t),a=n.find(".choice-area"),o=n.find(".result-area"),s=null,d=function(t){return a.find("[data-serial="+t+"]")},u=function(e,i){l(t,e,i)},f=function(){s&&(o.find(".remove-choice").remove(),s.removeClass("active"),n.find(".empty").removeClass("empty"),s=null)},m=function(e){c(t,e,!0)},g=function(){return s&&s.data("identifier")},v=function(){return s&&!s.data("identifier")};n.on("mousedown.commonRenderer",function(){f()}),a.on("mousedown.commonRenderer",">li",function(e){return e.stopPropagation(),i(this).hasClass("deactivated")?void e.preventDefault():void(v()?(t.swapping=!0,m(s),u(i(this),s),f(),t.swapping=!1):i(this).hasClass("active")?f():(f(),s=i(this),i(this).addClass("active"),o.find(">li>.target").addClass("empty")))}),o.on("mousedown.commonRenderer",">li>div",function(n){if(n.stopPropagation(),g()){var r=i(this),l=s.data("serial"),c=r.data("serial");c!==l&&(r.hasClass("filled")&&(t.swapping=!0),c&&m(r),u(s,r),t.swapping=!1),f()}else if(v()){var r=i(this),c=r.data("serial"),l=s.data("serial");c!==l&&((r.hasClass("filled")||s.siblings("div")[0]===r[0])&&(t.swapping=!0),m(s),c&&(m(r),u(d(c),s)),u(d(l),r),t.swapping=!1),f()}else if(i(this).data("serial")){var h=i(this).data("serial");s=i(this),s.addClass("active"),o.find(">li>.target").filter(function(){return i(this).data("serial")!==h}).addClass("empty"),a.find(">li:not(.deactivated)").filter(function(){return i(this).data("serial")!==h}).addClass("empty");var p=i("<span>",{"class":"icon-undo remove-choice",title:e("remove")});p.on("mousedown",function(t){t.stopPropagation(),m(s),f()}),i(this).append(p)}}),t.responseMappingMode||p(t)},p=function(t){var i=parseInt(t.attr("minAssociations")),n=parseInt(t.attr("maxAssociations"));if(0===i)0===n&&r.appendInstruction(t,e("You may make as many association pairs as you want."));else{0===n&&r.appendInstruction(t,e("The maximum number of association is unlimited."));var a=e("You need to make at least")+" ";a+=i>1?i+" "+e("association pairs"):e("one association pair"),r.appendInstruction(t,a,function(){v(t).length>=i?this.setLevel("success"):this.reset()})}},f=function(t){r.getContainer(t).find(".result-area>li>div").each(function(){c(t,i(this))})},m=function(e,n){var a=0,o=r.getContainer(e).find(".result-area>li:first");return t.each(n,function(t){if(!o.length)return!1;var n=o.children("div");l(e,d(e,t[0]),i(n[0])),l(e,d(e,t[1]),i(n[1])),a++,o=o.next("li")}),a},g=function(t,e){m(t,o.unserialize(e,t))},v=function(t){var e=[];return r.getContainer(t).find(".result-area>li").each(function(){var n=[];i(this).find("div").each(function(){var e=i(this).data("serial");e&&n.push(t.getChoice(e).id())}),2===n.length&&e.push(n)}),e},C=function(t){return o.serialize(v(t),t)},I=function(t){var e=r.getContainer(t);e.find(".result-area .active").mousedown(),i(document).off(".commonRenderer"),e.find(".choice-area, .result-area").andSelf().off(".commonRenderer"),f(t),r.removeInstructions(t),r.getContainer(t).find(".result-area").empty()};return{qtiClass:"associateInteraction",template:n,render:u,getContainer:r.getContainer,setResponse:g,getResponse:C,resetResponse:f,destroy:I,renderEmptyPairs:h}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/choiceInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a;return(a=i.prompt)?n=a.call(t,{hash:{},data:e}):(a=t&&t.prompt,n=typeof a===u?a.call(t,{hash:{},data:e}):a),n||0===n?n:""}function o(){return" horizontal"}function s(t){var e;return e=typeof t===u?t.apply(t):t,e||0===e?e:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var l,c,d,h="",u="function",p=this.escapeExpression,f=this,m=i.blockHelperMissing;return h+='<div class="qti-interaction qti-blockInteraction qti-choiceInteraction" data-serial="',(c=i.serial)?l=c.call(e,{hash:{},data:a}):(c=e&&e.serial,l=typeof c===u?c.call(e,{hash:{},data:a}):c),h+=p(l)+'" data-qti-class="choiceInteraction">\n  ',l=i["if"].call(e,e&&e.prompt,{hash:{},inverse:f.noop,fn:f.program(1,r,a),data:a}),(l||0===l)&&(h+=l),h+='\n  <div class="instruction-container"></div>\n  <ol class="plain block-listing solid choice-area',l=i["if"].call(e,e&&e.horizontal,{hash:{},inverse:f.noop,fn:f.program(3,o,a),data:a}),(l||0===l)&&(h+=l),h+='">\n      ',d={hash:{},inverse:f.noop,fn:f.program(5,s,a),data:a},(c=i.choices)?l=c.call(e,d):(c=e&&e.choices,l=typeof c===u?c.call(e,d):c),i.choices||(l=m.call(e,l,{hash:{},inverse:f.noop,fn:f.program(5,s,a),data:a})),(l||0===l)&&(h+=l),h+='\n  </ol>\n  <div class="notification-container"></div>\n</div>'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/ChoiceInteraction",["lodash","jquery","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/choiceInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(t,e,i,n,a,r){var o=function(t){var i=a.getContainer(t);i.off(".commonRenderer"),i.on("click.commonRenderer",".qti-choice",function(i){i.preventDefault(),i.stopPropagation();var n=e(this),r=n.find("input:radio").not("[disabled]").not(".disabled"),o=n.find("input:checkbox").not("[disabled]").not(".disabled");r.length&&(r.not(":checked").prop("checked",!0),r.trigger("change")),o.length&&(o.prop("checked",!o.prop("checked")),o.trigger("change")),a.validateInstructions(t,{choice:n}),a.triggerResponseChangeEvent(t)})},s=function(t){o(t),l(t)},l=function(e){var n=e.attr("minChoices"),r=e.attr("maxChoices"),o=t.size(e.getChoices()),s=!1;if(r>1&&o>r){var l=function(t){var e=t.find(".real-label > input"),i=t.css("color","#BA122B"),n=t.find(".real-label > span").css("color","#BA122B").addClass("cross error");setTimeout(function(){e.prop("checked",!1),i.removeAttr("style"),n.removeAttr("style").removeClass("cross")},150)};if(r===n){s=!0;var c=i("You must select exactly")+" "+r+" "+i("choices");a.appendInstruction(e,c,function(t){h(e).length>=r?(this.setLevel("success"),this.checkState("fulfilled")&&this.update({level:"warning",message:i("Maximum choices reached"),timeout:2e3,start:function(){l(t.choice)},stop:function(){this.update({level:"success",message:c})}}),this.setState("fulfilled")):this.reset()})}else r>n&&a.appendInstruction(e,i("You can select maximum")+" "+r+" "+i("choices"),function(t){h(e).length>=r?(this.setMessage(i("Maximum choices reached")),this.checkState("fulfilled")&&this.update({level:"warning",timeout:2e3,start:function(){l(t.choice)},stop:function(){this.setLevel("info")}}),this.setState("fulfilled")):this.reset()})}!s&&n>0&&o>n&&a.appendInstruction(e,i("You must select at least")+" "+n+" "+i("choices"),function(){h(e).length>=n?this.setLevel("success"):this.reset()})},c=function(t){a.getContainer(t).find(".real-label > input").prop("checked",!1)},d=function(e,i){var n=a.getContainer(e);try{t.each(r.unserialize(i,e),function(t){n.find(".real-label > input[value="+t+"]").prop("checked",!0)}),a.validateInstructions(e)}catch(o){throw new Error("wrong response format in argument : "+o)}},h=function(t){var i=[];return a.getContainer(t).find(".real-label > input[name=response-"+t.getSerial()+"]:checked").each(function(){i.push(e(this).val())}),i},u=function(t){return r.serialize(h(t),t)},p=function(e,i){return t.merge(i||{},{horizontal:"horizontal"===e.attr("orientation")})},f=function(t){e(document).off(".commonRenderer"),a.getContainer(t).off(".commonRenderer"),c(t),a.removeInstructions(t)};return{qtiClass:"choiceInteraction",template:n,getData:p,render:s,getContainer:a.getContainer,setResponse:d,getResponse:u,resetResponse:c,destroy:f}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/extendedTextInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a;return(a=i.prompt)?n=a.call(t,{hash:{},data:e}):(a=t&&t.prompt,n=typeof a===p?a.call(t,{hash:{},data:e}):a),n||0===n?n:""}function o(t,e){var n,a,r,o="";return o+='\r\n    <div id="'+f((n=t&&t.attributes,n=null==n||n===!1?n:n.identifier,typeof n===p?n.apply(t):n))+'">\r\n        ',r={hash:{},inverse:m.noop,fn:m.program(4,s,e),data:e},(a=i.maxStringLoop)?n=a.call(t,r):(a=t&&t.maxStringLoop,n=typeof a===p?a.call(t,r):a),i.maxStringLoop||(n=g.call(t,n,{hash:{},inverse:m.noop,fn:m.program(4,s,e),data:e})),(n||0===n)&&(o+=n),o+="\r\n    </div>\r\n    "}function s(t){var e,i="";return i+='<input id="'+f((e=t&&t.attributes,e=null==e||e===!1?e:e.identifier,typeof e===p?e.apply(t):e))+"_"+f(typeof t===p?t.apply(t):t)+'" name="'+f((e=t&&t.attributes,e=null==e||e===!1?e:e.identifier,typeof e===p?e.apply(t):e))+"_"+f(typeof t===p?t.apply(t):t)+'"/><br />'}function l(t,e){var n,a="";return a+='\r\n        <div id="text-container">\r\n            <textarea id="'+f((n=t&&t.attributes,n=null==n||n===!1?n:n.identifier,typeof n===p?n.apply(t):n))+'" class="solid',n=i["if"].call(t,(n=t&&t.attributes,null==n||n===!1?n:n["class"]),{hash:{},inverse:m.noop,fn:m.program(7,c,e),data:e}),(n||0===n)&&(a+=n),a+='" cols="72"></textarea>\r\n        </div>\r\n    '}function c(){return" attributes.class"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var d,h,u="",p="function",f=this.escapeExpression,m=this,g=i.blockHelperMissing;return u+='<div class="qti-interaction qti-blockInteraction qti-extendedTextInteraction" data-serial="',(h=i.serial)?d=h.call(e,{hash:{},data:a}):(h=e&&e.serial,d=typeof h===p?h.call(e,{hash:{},data:a}):h),u+=f(d)+'" data-qti-class="extendedTextInteraction">\r\n    ',d=i["if"].call(e,e&&e.prompt,{hash:{},inverse:m.noop,fn:m.program(1,r,a),data:a}),(d||0===d)&&(u+=d),u+='\r\n    <div class="instruction-container"></div>\r\n    ',d=i["if"].call(e,e&&e.multiple,{hash:{},inverse:m.program(6,l,a),fn:m.program(3,o,a),data:a}),(d||0===d)&&(u+=d),u+="\r\n</div>"})}),function(){window.CKEDITOR&&window.CKEDITOR.dom||(window.CKEDITOR||(window.CKEDITOR=function(){var t={timestamp:"E2VD",version:"4.3.4 DEV",revision:"0",rnd:Math.floor(900*Math.random())+100,_:{pending:[]},status:"unloaded",basePath:function(){var t=window.CKEDITOR_BASEPATH||"";if(!t)for(var e=document.getElementsByTagName("script"),i=0;i<e.length;i++){var n=e[i].src.match(/(^|.*[\\\/])ckeditor(?:_basic)?(?:_source)?.js(?:\?.*)?$/i);if(n){t=n[1];break}}if(-1==t.indexOf(":/")&&"//"!=t.slice(0,2)&&(t=0===t.indexOf("/")?location.href.match(/^.*?:\/\/[^\/]*/)[0]+t:location.href.match(/^[^\?]*\/(?:)/)[0]+t),!t)throw'The CKEditor installation path could not be automatically detected. Please set the global variable "CKEDITOR_BASEPATH" before creating editor instances.';return t}(),getUrl:function(t){return-1==t.indexOf(":/")&&0!==t.indexOf("/")&&(t=this.basePath+t),this.timestamp&&"/"!=t.charAt(t.length-1)&&!/[&?]t=/.test(t)&&(t+=(0<=t.indexOf("?")?"&":"?")+"t="+this.timestamp),t},domReady:function(){function t(){try{document.addEventListener?(document.removeEventListener("DOMContentLoaded",t,!1),e()):document.attachEvent&&"complete"===document.readyState&&(document.detachEvent("onreadystatechange",t),e())}catch(i){}}function e(){for(var t;t=i.shift();)t()}var i=[];return function(e){if(i.push(e),"complete"===document.readyState&&setTimeout(t,1),1==i.length)if(document.addEventListener)document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1);else if(document.attachEvent){document.attachEvent("onreadystatechange",t),window.attachEvent("onload",t),e=!1;try{e=!window.frameElement}catch(n){}if(document.documentElement.doScroll&&e){var a=function(){try{document.documentElement.doScroll("left")}catch(e){return void setTimeout(a,1)}t()};a()}}}}()},e=window.CKEDITOR_GETURL;if(e){var i=t.getUrl;t.getUrl=function(n){return e.call(t,n)||i.call(t,n)}}return t}()),CKEDITOR.event||(CKEDITOR.event=function(){},CKEDITOR.event.implementOn=function(t){var e,i=CKEDITOR.event.prototype;for(e in i)void 0==t[e]&&(t[e]=i[e])},CKEDITOR.event.prototype=function(){function t(t){var n=e(this);return n[t]||(n[t]=new i(t))}var e=function(t){return t=t.getPrivate&&t.getPrivate()||t._||(t._={}),t.events||(t.events={})},i=function(t){this.name=t,this.listeners=[]};return i.prototype={getListenerIndex:function(t){for(var e=0,i=this.listeners;e<i.length;e++)if(i[e].fn==t)return e;return-1}},{define:function(e,i){var n=t.call(this,e);CKEDITOR.tools.extend(n,i,!0)},on:function(e,i,n,a,r){function o(t,r,o,l){return t={name:e,sender:this,editor:t,data:r,listenerData:a,stop:o,cancel:l,removeListener:s},i.call(n,t)===!1?!1:t.data}function s(){c.removeListener(e,i)}var l=t.call(this,e);if(l.getListenerIndex(i)<0){l=l.listeners,n||(n=this),isNaN(r)&&(r=10);var c=this;o.fn=i,o.priority=r;for(var d=l.length-1;d>=0;d--)if(l[d].priority<=r)return l.splice(d+1,0,o),{removeListener:s};l.unshift(o)}return{removeListener:s}},once:function(){var t=arguments[1];return arguments[1]=function(e){return e.removeListener(),t.apply(this,arguments)},this.on.apply(this,arguments)},capture:function(){CKEDITOR.event.useCapture=1;var t=this.on.apply(this,arguments);return CKEDITOR.event.useCapture=0,t},fire:function(){var t=0,i=function(){t=1},n=0,a=function(){n=1};return function(r,o,s){var l=e(this)[r],r=t,c=n;if(t=n=0,l){var d=l.listeners;if(d.length)for(var h,d=d.slice(0),u=0;u<d.length;u++){if(l.errorProof)try{h=d[u].call(this,s,o,i,a)}catch(p){}else h=d[u].call(this,s,o,i,a);if(h===!1?n=1:"undefined"!=typeof h&&(o=h),t||n)break}}return o=n?!1:"undefined"==typeof o?!0:o,t=r,n=c,o}}(),fireOnce:function(t,i,n){return i=this.fire(t,i,n),delete e(this)[t],i},removeListener:function(t,i){var n=e(this)[t];if(n){var a=n.getListenerIndex(i);a>=0&&n.listeners.splice(a,1)}},removeAllListeners:function(){var t,i=e(this);for(t in i)delete i[t]},hasListeners:function(t){return(t=e(this)[t])&&t.listeners.length>0}}}()),CKEDITOR.editor||(CKEDITOR.editor=function(){CKEDITOR._.pending.push([this,arguments]),CKEDITOR.event.call(this)},CKEDITOR.editor.prototype.fire=function(t,e){return t in{instanceReady:1,loaded:1}&&(this[t]=!0),CKEDITOR.event.prototype.fire.call(this,t,e,this)},CKEDITOR.editor.prototype.fireOnce=function(t,e){return t in{instanceReady:1,loaded:1}&&(this[t]=!0),CKEDITOR.event.prototype.fireOnce.call(this,t,e,this)},CKEDITOR.event.implementOn(CKEDITOR.editor.prototype)),CKEDITOR.env||(CKEDITOR.env=function(){var t=navigator.userAgent.toLowerCase(),e=window.opera,i={ie:t.indexOf("trident/")>-1,opera:!!e&&e.version,webkit:t.indexOf(" applewebkit/")>-1,air:t.indexOf(" adobeair/")>-1,mac:t.indexOf("macintosh")>-1,quirks:"BackCompat"==document.compatMode&&(!document.documentMode||document.documentMode<10),mobile:t.indexOf("mobile")>-1,iOS:/(ipad|iphone|ipod)/.test(t),isCustomDomain:function(){if(!this.ie)return!1;var t=document.domain,e=window.location.hostname;return t!=e&&t!="["+e+"]"},secure:"https:"==location.protocol};i.gecko="Gecko"==navigator.product&&!i.webkit&&!i.opera&&!i.ie,i.webkit&&(t.indexOf("chrome")>-1?i.chrome=!0:i.safari=!0);var n=0;if(i.ie&&(n=i.quirks||!document.documentMode?parseFloat(t.match(/msie (\d+)/)[1]):document.documentMode,i.ie9Compat=9==n,i.ie8Compat=8==n,i.ie7Compat=7==n,i.ie6Compat=7>n||i.quirks),i.gecko){var a=t.match(/rv:([\d\.]+)/);a&&(a=a[1].split("."),n=1e4*a[0]+100*(a[1]||0)+1*(a[2]||0))}return i.opera&&(n=parseFloat(e.version())),i.air&&(n=parseFloat(t.match(/ adobeair\/(\d+)/)[1])),i.webkit&&(n=parseFloat(t.match(/ applewebkit\/(\d+)/)[1])),i.version=n,i.isCompatible=i.iOS&&n>=534||!i.mobile&&(i.ie&&n>6||i.gecko&&n>=10801||i.opera&&n>=9.5||i.air&&n>=1||i.webkit&&n>=522||!1),i.hidpi=window.devicePixelRatio>=2,i.needsBrFiller=i.gecko||i.webkit||i.ie&&n>10,i.needsNbspFiller=i.ie&&11>n,i.cssClass="cke_browser_"+(i.ie?"ie":i.gecko?"gecko":i.opera?"opera":i.webkit?"webkit":"unknown"),i.quirks&&(i.cssClass=i.cssClass+" cke_browser_quirks"),i.ie&&(i.cssClass=i.cssClass+(" cke_browser_ie"+(i.quirks||i.version<7?"6":i.version)),i.quirks&&(i.cssClass=i.cssClass+" cke_browser_iequirks")),i.gecko&&(10900>n?i.cssClass=i.cssClass+" cke_browser_gecko18":11e3>=n&&(i.cssClass=i.cssClass+" cke_browser_gecko19")),i.air&&(i.cssClass=i.cssClass+" cke_browser_air"),i.iOS&&(i.cssClass=i.cssClass+" cke_browser_ios"),i.hidpi&&(i.cssClass=i.cssClass+" cke_hidpi"),i}()),"unloaded"==CKEDITOR.status&&function(){CKEDITOR.event.implementOn(CKEDITOR),CKEDITOR.loadFullCore=function(){if("basic_ready"!=CKEDITOR.status)CKEDITOR.loadFullCore._load=1;else{delete CKEDITOR.loadFullCore;var t=document.createElement("script");t.type="text/javascript",t.src=CKEDITOR.basePath+"ckeditor.js",document.getElementsByTagName("head")[0].appendChild(t)}},CKEDITOR.loadFullCoreTimeout=0,CKEDITOR.add=function(t){(this._.pending||(this._.pending=[])).push(t)},function(){CKEDITOR.domReady(function(){var t=CKEDITOR.loadFullCore,e=CKEDITOR.loadFullCoreTimeout;t&&(CKEDITOR.status="basic_ready",t&&t._load?t():e&&setTimeout(function(){CKEDITOR.loadFullCore&&CKEDITOR.loadFullCore()},1e3*e))})}(),CKEDITOR.status="basic_loaded"}(),CKEDITOR.dom={},function(){var t=[],e=CKEDITOR.env.gecko?"-moz-":CKEDITOR.env.webkit?"-webkit-":CKEDITOR.env.opera?"-o-":CKEDITOR.env.ie?"-ms-":"";CKEDITOR.on("reset",function(){t=[]}),CKEDITOR.tools={arrayCompare:function(t,e){if(!t&&!e)return!0;if(!t||!e||t.length!=e.length)return!1;for(var i=0;i<t.length;i++)if(t[i]!=e[i])return!1;return!0},clone:function(t){var e;if(t&&t instanceof Array){e=[];for(var i=0;i<t.length;i++)e[i]=CKEDITOR.tools.clone(t[i]);return e}if(null===t||"object"!=typeof t||t instanceof String||t instanceof Number||t instanceof Boolean||t instanceof Date||t instanceof RegExp)return t;e=new t.constructor;for(i in t)e[i]=CKEDITOR.tools.clone(t[i]);return e},capitalize:function(t,e){return t.charAt(0).toUpperCase()+(e?t.slice(1):t.slice(1).toLowerCase())},extend:function(t){var e,i,n=arguments.length;"boolean"==typeof(e=arguments[n-1])?n--:"boolean"==typeof(e=arguments[n-2])&&(i=arguments[n-1],n-=2);for(var a=1;n>a;a++){var r,o=arguments[a];for(r in o)(e===!0||void 0==t[r])&&(!i||r in i)&&(t[r]=o[r])}return t},prototypedCopy:function(t){var e=function(){};return e.prototype=t,new e},copy:function(t){var e,i={};for(e in t)i[e]=t[e];return i},isArray:function(t){return"[object Array]"==Object.prototype.toString.call(t)},isEmpty:function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},cssVendorPrefix:function(t,i,n){return n?e+t+":"+i+";"+t+":"+i:(n={},n[t]=i,n[e+t]=i,n)},cssStyleToDomStyle:function(){var t=document.createElement("div").style,e="undefined"!=typeof t.cssFloat?"cssFloat":"undefined"!=typeof t.styleFloat?"styleFloat":"float";return function(t){return"float"==t?e:t.replace(/-./g,function(t){return t.substr(1).toUpperCase()})}}(),buildStyleHtml:function(t){for(var e,t=[].concat(t),i=[],n=0;n<t.length;n++)(e=t[n])&&i.push(/@import|[{}]/.test(e)?"<style>"+e+"</style>":'<link type="text/css" rel=stylesheet href="'+e+'">');return i.join("")},htmlEncode:function(t){return(""+t).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")},htmlEncodeAttr:function(t){return t.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},htmlDecodeAttr:function(t){return t.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">")},getNextNumber:function(){var t=0;return function(){return++t}}(),getNextId:function(){return"cke_"+this.getNextNumber()},override:function(t,e){var i=e(t);return i.prototype=t.prototype,i},setTimeout:function(t,e,i,n,a){return a||(a=window),i||(i=a),a.setTimeout(function(){n?t.apply(i,[].concat(n)):t.apply(i)},e||0)},trim:function(){var t=/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g;return function(e){return e.replace(t,"")}}(),ltrim:function(){var t=/^[ \t\n\r]+/g;return function(e){return e.replace(t,"")}}(),rtrim:function(){var t=/[ \t\n\r]+$/g;return function(e){return e.replace(t,"")}}(),indexOf:function(t,e){if("function"==typeof e){for(var i=0,n=t.length;n>i;i++)if(e(t[i]))return i}else{if(t.indexOf)return t.indexOf(e);for(i=0,n=t.length;n>i;i++)if(t[i]===e)return i}return-1},search:function(t,e){var i=CKEDITOR.tools.indexOf(t,e);return i>=0?t[i]:null},bind:function(t,e){return function(){return t.apply(e,arguments)}},createClass:function(t){var e=t.$,i=t.base,n=t.privates||t._,a=t.proto,t=t.statics;if(!e&&(e=function(){i&&this.base.apply(this,arguments)}),n)var r=e,e=function(){var t,e=this._||(this._={});for(t in n){var i=n[t];e[t]="function"==typeof i?CKEDITOR.tools.bind(i,this):i}r.apply(this,arguments)};return i&&(e.prototype=this.prototypedCopy(i.prototype),e.prototype.constructor=e,e.base=i,e.baseProto=i.prototype,e.prototype.base=function(){this.base=i.prototype.base,i.apply(this,arguments),this.base=arguments.callee}),a&&this.extend(e.prototype,a,!0),t&&this.extend(e,t,!0),e},addFunction:function(e,i){return t.push(function(){return e.apply(i||this,arguments)})-1},removeFunction:function(e){t[e]=null},callFunction:function(e){var i=t[e];return i&&i.apply(window,Array.prototype.slice.call(arguments,1))},cssLength:function(){var t,e=/^-?\d+\.?\d*px$/;return function(i){return t=CKEDITOR.tools.trim(i+"")+"px",e.test(t)?t:i||""}}(),convertToPx:function(){var t;return function(e){return t||(t=CKEDITOR.dom.element.createFromHtml('<div style="position:absolute;left:-9999px;top:-9999px;margin:0px;padding:0px;border:0px;"></div>',CKEDITOR.document),CKEDITOR.document.getBody().append(t)),/%$/.test(e)?e:(t.setStyle("width",e),t.$.clientWidth)}}(),repeat:function(t,e){return Array(e+1).join(t)},tryThese:function(){for(var t,e=0,i=arguments.length;i>e;e++){var n=arguments[e];try{t=n();break}catch(a){}}return t},genKey:function(){return Array.prototype.slice.call(arguments).join("-")},defer:function(t){return function(){var e=arguments,i=this;window.setTimeout(function(){t.apply(i,e)},0)}},normalizeCssText:function(t,e){var i,n=[],a=CKEDITOR.tools.parseCssText(t,!0,e);for(i in a)n.push(i+":"+a[i]);return n.sort(),n.length?n.join(";")+";":""},convertRgbToHex:function(t){return t.replace(/(?:rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\))/gi,function(t,e,i,n){for(t=[e,i,n],e=0;3>e;e++)t[e]=("0"+parseInt(t[e],10).toString(16)).slice(-2);return"#"+t.join("")})},parseCssText:function(t,e,i){var n={};return i&&(i=new CKEDITOR.dom.element("span"),i.setAttribute("style",t),t=CKEDITOR.tools.convertRgbToHex(i.getAttribute("style")||"")),t&&";"!=t?(t.replace(/&quot;/g,'"').replace(/\s*([^:;\s]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(t,i,a){e&&(i=i.toLowerCase(),"font-family"==i&&(a=a.toLowerCase().replace(/["']/g,"").replace(/\s*,\s*/g,",")),a=CKEDITOR.tools.trim(a)),n[i]=a}),n):n},writeCssText:function(t,e){var i,n=[];for(i in t)n.push(i+":"+t[i]);return e&&n.sort(),n.join("; ")},objectCompare:function(t,e,i){var n;if(!t&&!e)return!0;if(!t||!e)return!1;for(n in t)if(t[n]!=e[n])return!1;if(!i)for(n in e)if(t[n]!=e[n])return!1;return!0},objectKeys:function(t){var e,i=[];for(e in t)i.push(e);return i},convertArrayToObject:function(t,e){var i={};1==arguments.length&&(e=!0);for(var n=0,a=t.length;a>n;++n)i[t[n]]=e;return i},fixDomain:function(){for(var t;;)try{t=window.parent.document.domain;break}catch(e){if(t=t?t.replace(/.+?(?:\.|$)/,""):document.domain,!t)break;document.domain=t}return!!t},eventsBuffer:function(t,e){function i(){a=(new Date).getTime(),n=!1,e()}var n,a=0;return{input:function(){if(!n){var e=(new Date).getTime()-a;t>e?n=setTimeout(i,t-e):i()}},reset:function(){n&&clearTimeout(n),n=a=0}}},enableHtml5Elements:function(t,e){for(var i,n=["abbr","article","aside","audio","bdi","canvas","data","datalist","details","figcaption","figure","footer","header","hgroup","mark","meter","nav","output","progress","section","summary","time","video"],a=n.length;a--;)i=t.createElement(n[a]),e&&t.appendChild(i)}}}(),CKEDITOR.dtd=function(){var t=CKEDITOR.tools.extend,e=function(t,e){for(var i=CKEDITOR.tools.clone(t),n=1;n<arguments.length;n++){var a,e=arguments[n];for(a in e)delete i[a]}return i},i={},n={},a={address:1,article:1,aside:1,blockquote:1,details:1,div:1,dl:1,fieldset:1,figure:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,hr:1,menu:1,nav:1,ol:1,p:1,pre:1,section:1,table:1,ul:1},r={command:1,link:1,meta:1,noscript:1,script:1,style:1},o={},s={"#":1},l={center:1,dir:1,noframes:1};return t(i,{a:1,abbr:1,area:1,audio:1,b:1,bdi:1,bdo:1,br:1,button:1,canvas:1,cite:1,code:1,command:1,datalist:1,del:1,dfn:1,em:1,embed:1,i:1,iframe:1,img:1,input:1,ins:1,kbd:1,keygen:1,label:1,map:1,mark:1,meter:1,noscript:1,object:1,output:1,progress:1,q:1,ruby:1,s:1,samp:1,script:1,select:1,small:1,span:1,strong:1,sub:1,sup:1,textarea:1,time:1,u:1,"var":1,video:1,wbr:1},s,{acronym:1,applet:1,basefont:1,big:1,font:1,isindex:1,strike:1,style:1,tt:1}),t(n,a,i,l),e={a:e(i,{a:1,button:1}),abbr:i,address:n,area:o,article:t({style:1},n),aside:t({style:1},n),audio:t({source:1,track:1},n),b:i,base:o,bdi:i,bdo:i,blockquote:n,body:n,br:o,button:e(i,{a:1,button:1}),canvas:i,caption:n,cite:i,code:i,col:o,colgroup:{col:1},command:o,datalist:t({option:1},i),dd:n,del:i,details:t({summary:1},n),dfn:i,div:t({style:1},n),dl:{dt:1,dd:1},dt:n,em:i,embed:o,fieldset:t({legend:1},n),figcaption:n,figure:t({figcaption:1},n),footer:n,form:n,h1:i,h2:i,h3:i,h4:i,h5:i,h6:i,head:t({title:1,base:1},r),header:n,hgroup:{h1:1,h2:1,h3:1,h4:1,h5:1,h6:1},hr:o,html:t({head:1,body:1},n,r),i:i,iframe:s,img:o,input:o,ins:i,kbd:i,keygen:o,label:i,legend:i,li:n,link:o,map:n,mark:i,menu:t({li:1},n),meta:o,meter:e(i,{meter:1}),nav:n,noscript:t({link:1,meta:1,style:1},i),object:t({param:1},i),ol:{li:1},optgroup:{option:1},option:s,output:i,p:i,param:o,pre:i,progress:e(i,{progress:1}),q:i,rp:i,rt:i,ruby:t({rp:1,rt:1},i),s:i,samp:i,script:s,section:t({style:1},n),select:{optgroup:1,option:1},small:i,source:o,span:i,strong:i,style:s,sub:i,summary:i,sup:i,table:{caption:1,colgroup:1,thead:1,tfoot:1,tbody:1,tr:1},tbody:{tr:1},td:n,textarea:s,tfoot:{tr:1},th:n,thead:{tr:1},time:e(i,{time:1}),title:s,tr:{th:1,td:1},track:o,u:i,ul:{li:1},"var":i,video:t({source:1,track:1},n),wbr:o,acronym:i,applet:t({param:1},n),basefont:o,big:i,center:n,dialog:o,dir:{li:1},font:i,isindex:o,noframes:n,strike:i,tt:i},t(e,{$block:t({audio:1,dd:1,dt:1,figcaption:1,li:1,video:1},a,l),$blockLimit:{article:1,aside:1,audio:1,body:1,caption:1,details:1,dir:1,div:1,dl:1,fieldset:1,figcaption:1,figure:1,footer:1,form:1,header:1,hgroup:1,menu:1,nav:1,ol:1,section:1,table:1,td:1,th:1,tr:1,ul:1,video:1},$cdata:{script:1,style:1},$editable:{address:1,article:1,aside:1,blockquote:1,body:1,details:1,div:1,fieldset:1,figcaption:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,nav:1,p:1,pre:1,section:1},$empty:{area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1},$inline:i,$list:{dl:1,ol:1,ul:1},$listItem:{dd:1,dt:1,li:1},$nonBodyContent:t({body:1,head:1,html:1},e.head),$nonEditable:{applet:1,audio:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,param:1,script:1,textarea:1,video:1},$object:{applet:1,audio:1,button:1,hr:1,iframe:1,img:1,input:1,object:1,select:1,table:1,textarea:1,video:1},$removeEmpty:{abbr:1,acronym:1,b:1,bdi:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,mark:1,meter:1,output:1,q:1,ruby:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,time:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},$transparent:{a:1,audio:1,canvas:1,del:1,ins:1,map:1,noscript:1,object:1,video:1},$intermediate:{caption:1,colgroup:1,dd:1,dt:1,figcaption:1,legend:1,li:1,optgroup:1,option:1,rp:1,rt:1,summary:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1}}),e
}(),CKEDITOR.dom.event=function(t){this.$=t},CKEDITOR.dom.event.prototype={getKey:function(){return this.$.keyCode||this.$.which},getKeystroke:function(){var t=this.getKey();return(this.$.ctrlKey||this.$.metaKey)&&(t+=CKEDITOR.CTRL),this.$.shiftKey&&(t+=CKEDITOR.SHIFT),this.$.altKey&&(t+=CKEDITOR.ALT),t},preventDefault:function(t){var e=this.$;e.preventDefault?e.preventDefault():e.returnValue=!1,t&&this.stopPropagation()},stopPropagation:function(){var t=this.$;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},getTarget:function(){var t=this.$.target||this.$.srcElement;return t?new CKEDITOR.dom.node(t):null},getPhase:function(){return this.$.eventPhase||2},getPageOffset:function(){var t=this.getTarget().getDocument().$;return{x:this.$.pageX||this.$.clientX+(t.documentElement.scrollLeft||t.body.scrollLeft),y:this.$.pageY||this.$.clientY+(t.documentElement.scrollTop||t.body.scrollTop)}}},CKEDITOR.CTRL=1114112,CKEDITOR.SHIFT=2228224,CKEDITOR.ALT=4456448,CKEDITOR.EVENT_PHASE_CAPTURING=1,CKEDITOR.EVENT_PHASE_AT_TARGET=2,CKEDITOR.EVENT_PHASE_BUBBLING=3,CKEDITOR.dom.domObject=function(t){t&&(this.$=t)},CKEDITOR.dom.domObject.prototype=function(){var t=function(t,e){return function(i){"undefined"!=typeof CKEDITOR&&t.fire(e,new CKEDITOR.dom.event(i))}};return{getPrivate:function(){var t;return(t=this.getCustomData("_"))||this.setCustomData("_",t={}),t},on:function(e){var i=this.getCustomData("_cke_nativeListeners");return i||(i={},this.setCustomData("_cke_nativeListeners",i)),i[e]||(i=i[e]=t(this,e),this.$.addEventListener?this.$.addEventListener(e,i,!!CKEDITOR.event.useCapture):this.$.attachEvent&&this.$.attachEvent("on"+e,i)),CKEDITOR.event.prototype.on.apply(this,arguments)},removeListener:function(t){if(CKEDITOR.event.prototype.removeListener.apply(this,arguments),!this.hasListeners(t)){var e=this.getCustomData("_cke_nativeListeners"),i=e&&e[t];i&&(this.$.removeEventListener?this.$.removeEventListener(t,i,!1):this.$.detachEvent&&this.$.detachEvent("on"+t,i),delete e[t])}},removeAllListeners:function(){var t,e=this.getCustomData("_cke_nativeListeners");for(t in e){var i=e[t];this.$.detachEvent?this.$.detachEvent("on"+t,i):this.$.removeEventListener&&this.$.removeEventListener(t,i,!1),delete e[t]}CKEDITOR.event.prototype.removeAllListeners.call(this)}}}(),function(t){var e={};CKEDITOR.on("reset",function(){e={}}),t.equals=function(t){try{return t&&t.$===this.$}catch(e){return!1}},t.setCustomData=function(t,i){var n=this.getUniqueId();return(e[n]||(e[n]={}))[t]=i,this},t.getCustomData=function(t){var i=this.$["data-cke-expando"];return(i=i&&e[i])&&t in i?i[t]:null},t.removeCustomData=function(t){var i,n,a=this.$["data-cke-expando"],a=a&&e[a];return a&&(i=a[t],n=t in a,delete a[t]),n?i:null},t.clearCustomData=function(){this.removeAllListeners();var t=this.$["data-cke-expando"];t&&delete e[t]},t.getUniqueId=function(){return this.$["data-cke-expando"]||(this.$["data-cke-expando"]=CKEDITOR.tools.getNextNumber())},CKEDITOR.event.implementOn(t)}(CKEDITOR.dom.domObject.prototype),CKEDITOR.dom.node=function(t){return t?new CKEDITOR.dom[t.nodeType==CKEDITOR.NODE_DOCUMENT?"document":t.nodeType==CKEDITOR.NODE_ELEMENT?"element":t.nodeType==CKEDITOR.NODE_TEXT?"text":t.nodeType==CKEDITOR.NODE_COMMENT?"comment":t.nodeType==CKEDITOR.NODE_DOCUMENT_FRAGMENT?"documentFragment":"domObject"](t):this},CKEDITOR.dom.node.prototype=new CKEDITOR.dom.domObject,CKEDITOR.NODE_ELEMENT=1,CKEDITOR.NODE_DOCUMENT=9,CKEDITOR.NODE_TEXT=3,CKEDITOR.NODE_COMMENT=8,CKEDITOR.NODE_DOCUMENT_FRAGMENT=11,CKEDITOR.POSITION_IDENTICAL=0,CKEDITOR.POSITION_DISCONNECTED=1,CKEDITOR.POSITION_FOLLOWING=2,CKEDITOR.POSITION_PRECEDING=4,CKEDITOR.POSITION_IS_CONTAINED=8,CKEDITOR.POSITION_CONTAINS=16,CKEDITOR.tools.extend(CKEDITOR.dom.node.prototype,{appendTo:function(t,e){return t.append(this,e),t},clone:function(t,e){var i=this.$.cloneNode(t),n=function(i){if(i["data-cke-expando"]&&(i["data-cke-expando"]=!1),i.nodeType==CKEDITOR.NODE_ELEMENT&&(e||i.removeAttribute("id",!1),t))for(var i=i.childNodes,a=0;a<i.length;a++)n(i[a])};return n(i),new CKEDITOR.dom.node(i)},hasPrevious:function(){return!!this.$.previousSibling},hasNext:function(){return!!this.$.nextSibling},insertAfter:function(t){return t.$.parentNode.insertBefore(this.$,t.$.nextSibling),t},insertBefore:function(t){return t.$.parentNode.insertBefore(this.$,t.$),t},insertBeforeMe:function(t){return this.$.parentNode.insertBefore(t.$,this.$),t},getAddress:function(t){for(var e=[],i=this.getDocument().$.documentElement,n=this.$;n&&n!=i;){var a=n.parentNode;a&&e.unshift(this.getIndex.call({$:n},t)),n=a}return e},getDocument:function(){return new CKEDITOR.dom.document(this.$.ownerDocument||this.$.parentNode.ownerDocument)},getIndex:function(t){var e,i=this.$,n=-1;if(!this.$.parentNode)return n;do(!t||i==this.$||i.nodeType!=CKEDITOR.NODE_TEXT||!e&&i.nodeValue)&&(n++,e=i.nodeType==CKEDITOR.NODE_TEXT);while(i=i.previousSibling);return n},getNextSourceNode:function(t,e,i){if(i&&!i.call)var n=i,i=function(t){return!t.equals(n)};var a,t=!t&&this.getFirst&&this.getFirst();if(!t){if(this.type==CKEDITOR.NODE_ELEMENT&&i&&i(this,!0)===!1)return null;t=this.getNext()}for(;!t&&(a=(a||this).getParent());){if(i&&i(a,!0)===!1)return null;t=a.getNext()}return!t||i&&i(t)===!1?null:e&&e!=t.type?t.getNextSourceNode(!1,e,i):t},getPreviousSourceNode:function(t,e,i){if(i&&!i.call)var n=i,i=function(t){return!t.equals(n)};var a,t=!t&&this.getLast&&this.getLast();if(!t){if(this.type==CKEDITOR.NODE_ELEMENT&&i&&i(this,!0)===!1)return null;t=this.getPrevious()}for(;!t&&(a=(a||this).getParent());){if(i&&i(a,!0)===!1)return null;t=a.getPrevious()}return!t||i&&i(t)===!1?null:e&&t.type!=e?t.getPreviousSourceNode(!1,e,i):t},getPrevious:function(t){var e,i=this.$;do e=(i=i.previousSibling)&&10!=i.nodeType&&new CKEDITOR.dom.node(i);while(e&&t&&!t(e));return e},getNext:function(t){var e,i=this.$;do e=(i=i.nextSibling)&&new CKEDITOR.dom.node(i);while(e&&t&&!t(e));return e},getParent:function(t){var e=this.$.parentNode;return e&&(e.nodeType==CKEDITOR.NODE_ELEMENT||t&&e.nodeType==CKEDITOR.NODE_DOCUMENT_FRAGMENT)?new CKEDITOR.dom.node(e):null},getParents:function(t){var e=this,i=[];do i[t?"push":"unshift"](e);while(e=e.getParent());return i},getCommonAncestor:function(t){if(t.equals(this))return this;if(t.contains&&t.contains(this))return t;var e=this.contains?this:this.getParent();do if(e.contains(t))return e;while(e=e.getParent());return null},getPosition:function(t){var e=this.$,i=t.$;if(e.compareDocumentPosition)return e.compareDocumentPosition(i);if(e==i)return CKEDITOR.POSITION_IDENTICAL;if(this.type==CKEDITOR.NODE_ELEMENT&&t.type==CKEDITOR.NODE_ELEMENT){if(e.contains){if(e.contains(i))return CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_PRECEDING;if(i.contains(e))return CKEDITOR.POSITION_IS_CONTAINED+CKEDITOR.POSITION_FOLLOWING}if("sourceIndex"in e)return e.sourceIndex<0||i.sourceIndex<0?CKEDITOR.POSITION_DISCONNECTED:e.sourceIndex<i.sourceIndex?CKEDITOR.POSITION_PRECEDING:CKEDITOR.POSITION_FOLLOWING}for(var e=this.getAddress(),t=t.getAddress(),i=Math.min(e.length,t.length),n=0;i-1>=n;n++)if(e[n]!=t[n]){if(i>n)return e[n]<t[n]?CKEDITOR.POSITION_PRECEDING:CKEDITOR.POSITION_FOLLOWING;break}return e.length<t.length?CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_PRECEDING:CKEDITOR.POSITION_IS_CONTAINED+CKEDITOR.POSITION_FOLLOWING},getAscendant:function(t,e){var i,n=this.$;for(e||(n=n.parentNode);n;){if(n.nodeName&&(i=n.nodeName.toLowerCase(),"string"==typeof t?i==t:i in t))return new CKEDITOR.dom.node(n);try{n=n.parentNode}catch(a){n=null}}return null},hasAscendant:function(t,e){var i=this.$;for(e||(i=i.parentNode);i;){if(i.nodeName&&i.nodeName.toLowerCase()==t)return!0;i=i.parentNode}return!1},move:function(t,e){t.append(this.remove(),e)},remove:function(t){var e=this.$,i=e.parentNode;if(i){if(t)for(;t=e.firstChild;)i.insertBefore(e.removeChild(t),e);i.removeChild(e)}return this},replace:function(t){this.insertBefore(t),t.remove()},trim:function(){this.ltrim(),this.rtrim()},ltrim:function(){for(var t;this.getFirst&&(t=this.getFirst());){if(t.type==CKEDITOR.NODE_TEXT){var e=CKEDITOR.tools.ltrim(t.getText()),i=t.getLength();if(!e){t.remove();continue}e.length<i&&(t.split(i-e.length),this.$.removeChild(this.$.firstChild))}break}},rtrim:function(){for(var t;this.getLast&&(t=this.getLast());){if(t.type==CKEDITOR.NODE_TEXT){var e=CKEDITOR.tools.rtrim(t.getText()),i=t.getLength();if(!e){t.remove();continue}e.length<i&&(t.split(e.length),this.$.lastChild.parentNode.removeChild(this.$.lastChild))}break}CKEDITOR.env.needsBrFiller&&(t=this.$.lastChild)&&1==t.type&&"br"==t.nodeName.toLowerCase()&&t.parentNode.removeChild(t)},isReadOnly:function(){var t=this;if(this.type!=CKEDITOR.NODE_ELEMENT&&(t=this.getParent()),t&&"undefined"!=typeof t.$.isContentEditable)return!(t.$.isContentEditable||t.data("cke-editable"));for(;t&&!t.data("cke-editable");){if("false"==t.getAttribute("contentEditable"))return!0;if("true"==t.getAttribute("contentEditable"))break;t=t.getParent()}return!t}}),CKEDITOR.dom.window=function(t){CKEDITOR.dom.domObject.call(this,t)},CKEDITOR.dom.window.prototype=new CKEDITOR.dom.domObject,CKEDITOR.tools.extend(CKEDITOR.dom.window.prototype,{focus:function(){this.$.focus()},getViewPaneSize:function(){var t=this.$.document,e="CSS1Compat"==t.compatMode;return{width:(e?t.documentElement.clientWidth:t.body.clientWidth)||0,height:(e?t.documentElement.clientHeight:t.body.clientHeight)||0}},getScrollPosition:function(){var t=this.$;return"pageXOffset"in t?{x:t.pageXOffset||0,y:t.pageYOffset||0}:(t=t.document,{x:t.documentElement.scrollLeft||t.body.scrollLeft||0,y:t.documentElement.scrollTop||t.body.scrollTop||0})},getFrame:function(){var t=this.$.frameElement;return t?new CKEDITOR.dom.element.get(t):null}}),CKEDITOR.dom.document=function(t){CKEDITOR.dom.domObject.call(this,t)},CKEDITOR.dom.document.prototype=new CKEDITOR.dom.domObject,CKEDITOR.tools.extend(CKEDITOR.dom.document.prototype,{type:CKEDITOR.NODE_DOCUMENT,appendStyleSheet:function(t){if(this.$.createStyleSheet)this.$.createStyleSheet(t);else{var e=new CKEDITOR.dom.element("link");e.setAttributes({rel:"stylesheet",type:"text/css",href:t}),this.getHead().append(e)}},appendStyleText:function(t){if(this.$.createStyleSheet){var e=this.$.createStyleSheet("");e.cssText=t}else{var i=new CKEDITOR.dom.element("style",this);i.append(new CKEDITOR.dom.text(t,this)),this.getHead().append(i)}return e||i.$.sheet},createElement:function(t,e){var i=new CKEDITOR.dom.element(t,this);return e&&(e.attributes&&i.setAttributes(e.attributes),e.styles&&i.setStyles(e.styles)),i},createText:function(t){return new CKEDITOR.dom.text(t,this)},focus:function(){this.getWindow().focus()},getActive:function(){return new CKEDITOR.dom.element(this.$.activeElement)},getById:function(t){return(t=this.$.getElementById(t))?new CKEDITOR.dom.element(t):null},getByAddress:function(t,e){for(var i=this.$.documentElement,n=0;i&&n<t.length;n++){var a=t[n];if(e)for(var r=-1,o=0;o<i.childNodes.length;o++){var s=i.childNodes[o];if((e!==!0||3!=s.nodeType||!s.previousSibling||3!=s.previousSibling.nodeType)&&(r++,r==a)){i=s;break}}else i=i.childNodes[a]}return i?new CKEDITOR.dom.node(i):null},getElementsByTag:function(t,e){return(!CKEDITOR.env.ie||document.documentMode>8)&&e&&(t=e+":"+t),new CKEDITOR.dom.nodeList(this.$.getElementsByTagName(t))},getHead:function(){var t=this.$.getElementsByTagName("head")[0];return t=t?new CKEDITOR.dom.element(t):this.getDocumentElement().append(new CKEDITOR.dom.element("head"),!0)},getBody:function(){return new CKEDITOR.dom.element(this.$.body)},getDocumentElement:function(){return new CKEDITOR.dom.element(this.$.documentElement)},getWindow:function(){return new CKEDITOR.dom.window(this.$.parentWindow||this.$.defaultView)},write:function(t){this.$.open("text/html","replace"),CKEDITOR.env.ie&&(t=t.replace(/(?:^\s*<!DOCTYPE[^>]*?>)|^/i,'$&\n<script data-cke-temp="1">('+CKEDITOR.tools.fixDomain+")();</script>")),this.$.write(t),this.$.close()},find:function(t){return new CKEDITOR.dom.nodeList(this.$.querySelectorAll(t))},findOne:function(t){return(t=this.$.querySelector(t))?new CKEDITOR.dom.element(t):null},_getHtml5ShivFrag:function(){var t=this.getCustomData("html5ShivFrag");return t||(t=this.$.createDocumentFragment(),CKEDITOR.tools.enableHtml5Elements(t,!0),this.setCustomData("html5ShivFrag",t)),t}}),CKEDITOR.dom.nodeList=function(t){this.$=t},CKEDITOR.dom.nodeList.prototype={count:function(){return this.$.length},getItem:function(t){return 0>t||t>=this.$.length?null:(t=this.$[t])?new CKEDITOR.dom.node(t):null}},CKEDITOR.dom.element=function(t,e){"string"==typeof t&&(t=(e?e.$:document).createElement(t)),CKEDITOR.dom.domObject.call(this,t)},CKEDITOR.dom.element.get=function(t){return(t="string"==typeof t?document.getElementById(t)||document.getElementsByName(t)[0]:t)&&(t.$?t:new CKEDITOR.dom.element(t))},CKEDITOR.dom.element.prototype=new CKEDITOR.dom.node,CKEDITOR.dom.element.createFromHtml=function(t,e){var i=new CKEDITOR.dom.element("div",e);return i.setHtml(t),i.getFirst().remove()},CKEDITOR.dom.element.setMarker=function(t,e,i,n){var a=e.getCustomData("list_marker_id")||e.setCustomData("list_marker_id",CKEDITOR.tools.getNextNumber()).getCustomData("list_marker_id"),r=e.getCustomData("list_marker_names")||e.setCustomData("list_marker_names",{}).getCustomData("list_marker_names");return t[a]=e,r[i]=1,e.setCustomData(i,n)},CKEDITOR.dom.element.clearAllMarkers=function(t){for(var e in t)CKEDITOR.dom.element.clearMarkers(t,t[e],1)},CKEDITOR.dom.element.clearMarkers=function(t,e,i){var n,a=e.getCustomData("list_marker_names"),r=e.getCustomData("list_marker_id");for(n in a)e.removeCustomData(n);e.removeCustomData("list_marker_names"),i&&(e.removeCustomData("list_marker_id"),delete t[r])},function(){function t(t){var e=!0;return t.$.id||(t.$.id="cke_tmp_"+CKEDITOR.tools.getNextNumber(),e=!1),function(){e||t.removeAttribute("id")}}function e(t,e){return"#"+t.$.id+" "+e.split(/,\s*/).join(", #"+t.$.id+" ")}function i(t){for(var e=0,i=0,a=n[t].length;a>i;i++)e+=parseInt(this.getComputedStyle(n[t][i])||0,10)||0;return e}CKEDITOR.tools.extend(CKEDITOR.dom.element.prototype,{type:CKEDITOR.NODE_ELEMENT,addClass:function(t){var e=this.$.className;e&&(RegExp("(?:^|\\s)"+t+"(?:\\s|$)","").test(e)||(e+=" "+t)),this.$.className=e||t},removeClass:function(t){var e=this.getAttribute("class");return e&&(t=RegExp("(?:^|\\s+)"+t+"(?=\\s|$)","i"),t.test(e)&&((e=e.replace(t,"").replace(/^\s+/,""))?this.setAttribute("class",e):this.removeAttribute("class"))),this},hasClass:function(t){return RegExp("(?:^|\\s+)"+t+"(?=\\s|$)","").test(this.getAttribute("class"))},append:function(t,e){return"string"==typeof t&&(t=this.getDocument().createElement(t)),e?this.$.insertBefore(t.$,this.$.firstChild):this.$.appendChild(t.$),t},appendHtml:function(t){if(this.$.childNodes.length){var e=new CKEDITOR.dom.element("div",this.getDocument());e.setHtml(t),e.moveChildren(this)}else this.setHtml(t)},appendText:function(t){void 0!=this.$.text?this.$.text=this.$.text+t:this.append(new CKEDITOR.dom.text(t))},appendBogus:function(t){if(t||CKEDITOR.env.needsBrFiller||CKEDITOR.env.opera){for(t=this.getLast();t&&t.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.rtrim(t.getText());)t=t.getPrevious();t&&t.is&&t.is("br")||(t=CKEDITOR.env.opera?this.getDocument().createText(""):this.getDocument().createElement("br"),CKEDITOR.env.gecko&&t.setAttribute("type","_moz"),this.append(t))}},breakParent:function(t){var e=new CKEDITOR.dom.range(this.getDocument());e.setStartAfter(this),e.setEndAfter(t),t=e.extractContents(),e.insertNode(this.remove()),t.insertAfterNode(this)},contains:CKEDITOR.env.ie||CKEDITOR.env.webkit?function(t){var e=this.$;return t.type!=CKEDITOR.NODE_ELEMENT?e.contains(t.getParent().$):e!=t.$&&e.contains(t.$)}:function(t){return!!(16&this.$.compareDocumentPosition(t.$))},focus:function(){function t(){try{this.$.focus()}catch(t){}}return function(e){e?CKEDITOR.tools.setTimeout(t,100,this):t.call(this)}}(),getHtml:function(){var t=this.$.innerHTML;return CKEDITOR.env.ie?t.replace(/<\?[^>]*>/g,""):t},getOuterHtml:function(){if(this.$.outerHTML)return this.$.outerHTML.replace(/<\?[^>]*>/,"");var t=this.$.ownerDocument.createElement("div");return t.appendChild(this.$.cloneNode(!0)),t.innerHTML},getClientRect:function(){var t=CKEDITOR.tools.extend({},this.$.getBoundingClientRect());return!t.width&&(t.width=t.right-t.left),!t.height&&(t.height=t.bottom-t.top),t},setHtml:CKEDITOR.env.ie&&CKEDITOR.env.version<9?function(t){try{var e=this.$;if(this.getParent())return e.innerHTML=t;var i=this.getDocument()._getHtml5ShivFrag();return i.appendChild(e),e.innerHTML=t,i.removeChild(e),t}catch(n){for(this.$.innerHTML="",e=new CKEDITOR.dom.element("body",this.getDocument()),e.$.innerHTML=t,e=e.getChildren();e.count();)this.append(e.getItem(0));return t}}:function(t){return this.$.innerHTML=t},setText:function(t){return CKEDITOR.dom.element.prototype.setText=void 0!=this.$.innerText?function(t){return this.$.innerText=t}:function(t){return this.$.textContent=t},this.setText(t)},getAttribute:function(){var t=function(t){return this.$.getAttribute(t,2)};return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)?function(t){switch(t){case"class":t="className";break;case"http-equiv":t="httpEquiv";break;case"name":return this.$.name;case"tabindex":return t=this.$.getAttribute(t,2),0!==t&&0===this.$.tabIndex&&(t=null),t;case"checked":return t=this.$.attributes.getNamedItem(t),(t.specified?t.nodeValue:this.$.checked)?"checked":null;case"hspace":case"value":return this.$[t];case"style":return this.$.style.cssText;case"contenteditable":case"contentEditable":return this.$.attributes.getNamedItem("contentEditable").specified?this.$.getAttribute("contentEditable"):null}return this.$.getAttribute(t,2)}:t}(),getChildren:function(){return new CKEDITOR.dom.nodeList(this.$.childNodes)},getComputedStyle:CKEDITOR.env.ie?function(t){return this.$.currentStyle[CKEDITOR.tools.cssStyleToDomStyle(t)]}:function(t){var e=this.getWindow().$.getComputedStyle(this.$,null);return e?e.getPropertyValue(t):""},getDtd:function(){var t=CKEDITOR.dtd[this.getName()];return this.getDtd=function(){return t},t},getElementsByTag:CKEDITOR.dom.document.prototype.getElementsByTag,getTabIndex:CKEDITOR.env.ie?function(){var t=this.$.tabIndex;return 0===t&&!CKEDITOR.dtd.$tabIndex[this.getName()]&&0!==parseInt(this.getAttribute("tabindex"),10)&&(t=-1),t}:CKEDITOR.env.webkit?function(){var t=this.$.tabIndex;return void 0==t&&(t=parseInt(this.getAttribute("tabindex"),10),isNaN(t)&&(t=-1)),t}:function(){return this.$.tabIndex},getText:function(){return this.$.textContent||this.$.innerText||""},getWindow:function(){return this.getDocument().getWindow()},getId:function(){return this.$.id||null},getNameAtt:function(){return this.$.name||null},getName:function(){var t=this.$.nodeName.toLowerCase();if(CKEDITOR.env.ie&&!(document.documentMode>8)){var e=this.$.scopeName;"HTML"!=e&&(t=e.toLowerCase()+":"+t)}return(this.getName=function(){return t})()},getValue:function(){return this.$.value},getFirst:function(t){var e=this.$.firstChild;return(e=e&&new CKEDITOR.dom.node(e))&&t&&!t(e)&&(e=e.getNext(t)),e},getLast:function(t){var e=this.$.lastChild;return(e=e&&new CKEDITOR.dom.node(e))&&t&&!t(e)&&(e=e.getPrevious(t)),e},getStyle:function(t){return this.$.style[CKEDITOR.tools.cssStyleToDomStyle(t)]},is:function(){var t=this.getName();if("object"==typeof arguments[0])return!!arguments[0][t];for(var e=0;e<arguments.length;e++)if(arguments[e]==t)return!0;return!1},isEditable:function(t){var e=this.getName();return this.isReadOnly()||"none"==this.getComputedStyle("display")||"hidden"==this.getComputedStyle("visibility")||CKEDITOR.dtd.$nonEditable[e]||CKEDITOR.dtd.$empty[e]||this.is("a")&&(this.data("cke-saved-name")||this.hasAttribute("name"))&&!this.getChildCount()?!1:t!==!1?(t=CKEDITOR.dtd[e]||CKEDITOR.dtd.span,!(!t||!t["#"])):!0},isIdentical:function(t){var e=this.clone(0,1),t=t.clone(0,1);if(e.removeAttributes(["_moz_dirty","data-cke-expando","data-cke-saved-href","data-cke-saved-name"]),t.removeAttributes(["_moz_dirty","data-cke-expando","data-cke-saved-href","data-cke-saved-name"]),e.$.isEqualNode)return e.$.style.cssText=CKEDITOR.tools.normalizeCssText(e.$.style.cssText),t.$.style.cssText=CKEDITOR.tools.normalizeCssText(t.$.style.cssText),e.$.isEqualNode(t.$);if(e=e.getOuterHtml(),t=t.getOuterHtml(),CKEDITOR.env.ie&&CKEDITOR.env.version<9&&this.is("a")){var i=this.getParent();i.type==CKEDITOR.NODE_ELEMENT&&(i=i.clone(),i.setHtml(e),e=i.getHtml(),i.setHtml(t),t=i.getHtml())}return e==t},isVisible:function(){var t,e,i=(this.$.offsetHeight||this.$.offsetWidth)&&"hidden"!=this.getComputedStyle("visibility");return i&&(CKEDITOR.env.webkit||CKEDITOR.env.opera)&&(t=this.getWindow(),!t.equals(CKEDITOR.document.getWindow())&&(e=t.$.frameElement)&&(i=new CKEDITOR.dom.element(e).isVisible())),!!i},isEmptyInlineRemoveable:function(){if(!CKEDITOR.dtd.$removeEmpty[this.getName()])return!1;for(var t=this.getChildren(),e=0,i=t.count();i>e;e++){var n=t.getItem(e);if((n.type!=CKEDITOR.NODE_ELEMENT||!n.data("cke-bookmark"))&&(n.type==CKEDITOR.NODE_ELEMENT&&!n.isEmptyInlineRemoveable()||n.type==CKEDITOR.NODE_TEXT&&CKEDITOR.tools.trim(n.getText())))return!1}return!0},hasAttributes:CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)?function(){for(var t=this.$.attributes,e=0;e<t.length;e++){var i=t[e];switch(i.nodeName){case"class":if(this.getAttribute("class"))return!0;case"data-cke-expando":continue;default:if(i.specified)return!0}}return!1}:function(){var t=this.$.attributes,e=t.length,i={"data-cke-expando":1,_moz_dirty:1};return e>0&&(e>2||!i[t[0].nodeName]||2==e&&!i[t[1].nodeName])},hasAttribute:function(){function t(t){return t=this.$.attributes.getNamedItem(t),!(!t||!t.specified)}return CKEDITOR.env.ie&&CKEDITOR.env.version<8?function(e){return"name"==e?!!this.$.name:t.call(this,e)}:t}(),hide:function(){this.setStyle("display","none")},moveChildren:function(t,e){var i=this.$,t=t.$;if(i!=t){var n;if(e)for(;n=i.lastChild;)t.insertBefore(i.removeChild(n),t.firstChild);else for(;n=i.firstChild;)t.appendChild(i.removeChild(n))}},mergeSiblings:function(){function t(t,e,i){if(e&&e.type==CKEDITOR.NODE_ELEMENT){for(var n=[];e.data("cke-bookmark")||e.isEmptyInlineRemoveable();)if(n.push(e),e=i?e.getNext():e.getPrevious(),!e||e.type!=CKEDITOR.NODE_ELEMENT)return;if(t.isIdentical(e)){for(var a=i?t.getLast():t.getFirst();n.length;)n.shift().move(t,!i);e.moveChildren(t,!i),e.remove(),a&&a.type==CKEDITOR.NODE_ELEMENT&&a.mergeSiblings()}}}return function(e){(e===!1||CKEDITOR.dtd.$removeEmpty[this.getName()]||this.is("a"))&&(t(this,this.getNext(),!0),t(this,this.getPrevious()))}}(),show:function(){this.setStyles({display:"",visibility:""})},setAttribute:function(){var t=function(t,e){return this.$.setAttribute(t,e),this};return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)?function(e,i){return"class"==e?this.$.className=i:"style"==e?this.$.style.cssText=i:"tabindex"==e?this.$.tabIndex=i:"checked"==e?this.$.checked=i:"contenteditable"==e?t.call(this,"contentEditable",i):t.apply(this,arguments),this}:CKEDITOR.env.ie8Compat&&CKEDITOR.env.secure?function(e,i){if("src"==e&&i.match(/^http:\/\//))try{t.apply(this,arguments)}catch(n){}else t.apply(this,arguments);return this}:t}(),setAttributes:function(t){for(var e in t)this.setAttribute(e,t[e]);return this},setValue:function(t){return this.$.value=t,this},removeAttribute:function(){var t=function(t){this.$.removeAttribute(t)};return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)?function(t){"class"==t?t="className":"tabindex"==t?t="tabIndex":"contenteditable"==t&&(t="contentEditable"),this.$.removeAttribute(t)}:t}(),removeAttributes:function(t){if(CKEDITOR.tools.isArray(t))for(var e=0;e<t.length;e++)this.removeAttribute(t[e]);else for(e in t)t.hasOwnProperty(e)&&this.removeAttribute(e)},removeStyle:function(t){var e=this.$.style;if(e.removeProperty||"border"!=t&&"margin"!=t&&"padding"!=t)e.removeProperty?e.removeProperty(t):e.removeAttribute(CKEDITOR.tools.cssStyleToDomStyle(t)),this.$.style.cssText||this.removeAttribute("style");else{var i,n=["top","left","right","bottom"];"border"==t&&(i=["color","style","width"]);for(var e=[],a=0;a<n.length;a++)if(i)for(var r=0;r<i.length;r++)e.push([t,n[a],i[r]].join("-"));else e.push([t,n[a]].join("-"));for(t=0;t<e.length;t++)this.removeStyle(e[t])}},setStyle:function(t,e){return this.$.style[CKEDITOR.tools.cssStyleToDomStyle(t)]=e,this},setStyles:function(t){for(var e in t)this.setStyle(e,t[e]);return this},setOpacity:function(t){CKEDITOR.env.ie&&CKEDITOR.env.version<9?(t=Math.round(100*t),this.setStyle("filter",t>=100?"":"progid:DXImageTransform.Microsoft.Alpha(opacity="+t+")")):this.setStyle("opacity",t)},unselectable:function(){if(this.setStyles(CKEDITOR.tools.cssVendorPrefix("user-select","none")),CKEDITOR.env.ie||CKEDITOR.env.opera){this.setAttribute("unselectable","on");for(var t,e=this.getElementsByTag("*"),i=0,n=e.count();n>i;i++)t=e.getItem(i),t.setAttribute("unselectable","on")}},getPositionedAncestor:function(){for(var t=this;"html"!=t.getName();){if("static"!=t.getComputedStyle("position"))return t;t=t.getParent()}return null},getDocumentPosition:function(t){var e=0,i=0,n=this.getDocument(),a=n.getBody(),r="BackCompat"==n.$.compatMode;if(document.documentElement.getBoundingClientRect){var o=this.$.getBoundingClientRect(),s=n.$.documentElement,l=s.clientTop||a.$.clientTop||0,c=s.clientLeft||a.$.clientLeft||0,d=!0;CKEDITOR.env.ie&&(d=n.getDocumentElement().contains(this),n=n.getBody().contains(this),d=r&&n||!r&&d),d&&(e=o.left+(!r&&s.scrollLeft||a.$.scrollLeft),e-=c,i=o.top+(!r&&s.scrollTop||a.$.scrollTop),i-=l)}else for(a=this,n=null;a&&"body"!=a.getName()&&"html"!=a.getName();){for(e+=a.$.offsetLeft-a.$.scrollLeft,i+=a.$.offsetTop-a.$.scrollTop,a.equals(this)||(e+=a.$.clientLeft||0,i+=a.$.clientTop||0);n&&!n.equals(a);)e-=n.$.scrollLeft,i-=n.$.scrollTop,n=n.getParent();n=a,a=(o=a.$.offsetParent)?new CKEDITOR.dom.element(o):null}return t&&(a=this.getWindow(),n=t.getWindow(),!a.equals(n)&&a.$.frameElement&&(t=new CKEDITOR.dom.element(a.$.frameElement).getDocumentPosition(t),e+=t.x,i+=t.y)),document.documentElement.getBoundingClientRect||!CKEDITOR.env.gecko||r||(e+=this.$.clientLeft?1:0,i+=this.$.clientTop?1:0),{x:e,y:i}},scrollIntoView:function(t){var e=this.getParent();if(e)do if((e.$.clientWidth&&e.$.clientWidth<e.$.scrollWidth||e.$.clientHeight&&e.$.clientHeight<e.$.scrollHeight)&&!e.is("body")&&this.scrollIntoParent(e,t,1),e.is("html")){var i=e.getWindow();try{var n=i.$.frameElement;n&&(e=new CKEDITOR.dom.element(n))}catch(a){}}while(e=e.getParent())},scrollIntoParent:function(t,e,i){function n(e,i){/body|html/.test(t.getName())?t.getWindow().$.scrollBy(e,i):(t.$.scrollLeft=t.$.scrollLeft+e,t.$.scrollTop=t.$.scrollTop+i)}function a(t,e){var i={x:0,y:0};if(!t.is(d?"body":"html")){var n=t.$.getBoundingClientRect();i.x=n.left,i.y=n.top}return n=t.getWindow(),n.equals(e)||(n=a(CKEDITOR.dom.element.get(n.$.frameElement),e),i.x=i.x+n.x,i.y=i.y+n.y),i}function r(t,e){return parseInt(t.getComputedStyle("margin-"+e)||0,10)||0}var o,s,l,c;!t&&(t=this.getWindow()),l=t.getDocument();var d="BackCompat"==l.$.compatMode;t instanceof CKEDITOR.dom.window&&(t=d?l.getBody():l.getDocumentElement()),l=t.getWindow(),s=a(this,l);var h=a(t,l),u=this.$.offsetHeight;o=this.$.offsetWidth;var p=t.$.clientHeight,f=t.$.clientWidth;l=s.x-r(this,"left")-h.x||0,c=s.y-r(this,"top")-h.y||0,o=s.x+o+r(this,"right")-(h.x+f)||0,s=s.y+u+r(this,"bottom")-(h.y+p)||0,(0>c||s>0)&&n(0,e===!0?c:e===!1?s:0>c?c:s),i&&(0>l||o>0)&&n(0>l?l:o,0)},setState:function(t,e,i){switch(e=e||"cke",t){case CKEDITOR.TRISTATE_ON:this.addClass(e+"_on"),this.removeClass(e+"_off"),this.removeClass(e+"_disabled"),i&&this.setAttribute("aria-pressed",!0),i&&this.removeAttribute("aria-disabled");break;case CKEDITOR.TRISTATE_DISABLED:this.addClass(e+"_disabled"),this.removeClass(e+"_off"),this.removeClass(e+"_on"),i&&this.setAttribute("aria-disabled",!0),i&&this.removeAttribute("aria-pressed");break;default:this.addClass(e+"_off"),this.removeClass(e+"_on"),this.removeClass(e+"_disabled"),i&&this.removeAttribute("aria-pressed"),i&&this.removeAttribute("aria-disabled")}},getFrameDocument:function(){var t=this.$;try{t.contentWindow.document}catch(e){t.src=t.src}return t&&new CKEDITOR.dom.document(t.contentWindow.document)},copyAttributes:function(t,e){for(var i=this.$.attributes,e=e||{},n=0;n<i.length;n++){var a,r=i[n],o=r.nodeName.toLowerCase();o in e||("checked"==o&&(a=this.getAttribute(o))?t.setAttribute(o,a):(r.specified||CKEDITOR.env.ie&&r.nodeValue&&"value"==o)&&(a=this.getAttribute(o),null===a&&(a=r.nodeValue),t.setAttribute(o,a)))}""!==this.$.style.cssText&&(t.$.style.cssText=this.$.style.cssText)},renameNode:function(t){if(this.getName()!=t){var e=this.getDocument(),t=new CKEDITOR.dom.element(t,e);this.copyAttributes(t),this.moveChildren(t),this.getParent()&&this.$.parentNode.replaceChild(t.$,this.$),t.$["data-cke-expando"]=this.$["data-cke-expando"],this.$=t.$,delete this.getName}},getChild:function(){function t(t,e){var i=t.childNodes;return e>=0&&e<i.length?i[e]:void 0}return function(e){var i=this.$;if(e.slice)for(;e.length>0&&i;)i=t(i,e.shift());else i=t(i,e);return i?new CKEDITOR.dom.node(i):null}}(),getChildCount:function(){return this.$.childNodes.length},disableContextMenu:function(){this.on("contextmenu",function(t){t.data.getTarget().hasClass("cke_enable_context_menu")||t.data.preventDefault()})},getDirection:function(t){return t?this.getComputedStyle("direction")||this.getDirection()||this.getParent()&&this.getParent().getDirection(1)||this.getDocument().$.dir||"ltr":this.getStyle("direction")||this.getAttribute("dir")},data:function(t,e){return t="data-"+t,void 0===e?this.getAttribute(t):(e===!1?this.removeAttribute(t):this.setAttribute(t,e),null)},getEditor:function(){var t,e,i=CKEDITOR.instances;for(t in i)if(e=i[t],e.element.equals(this)&&e.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO)return e;return null},find:function(i){var n=t(this),i=new CKEDITOR.dom.nodeList(this.$.querySelectorAll(e(this,i)));return n(),i},findOne:function(i){var n=t(this),i=this.$.querySelector(e(this,i));return n(),i?new CKEDITOR.dom.element(i):null},forEach:function(t,e,i){if(!(i||e&&this.type!=e))var n=t(this);if(n!==!1)for(var i=this.getChildren(),a=0;a<i.count();a++)n=i.getItem(a),n.type==CKEDITOR.NODE_ELEMENT?n.forEach(t,e):(!e||n.type==e)&&t(n)}});var n={width:["border-left-width","border-right-width","padding-left","padding-right"],height:["border-top-width","border-bottom-width","padding-top","padding-bottom"]};CKEDITOR.dom.element.prototype.setSize=function(t,e,n){"number"==typeof e&&(!n||CKEDITOR.env.ie&&CKEDITOR.env.quirks||(e-=i.call(this,t)),this.setStyle(t,e+"px"))},CKEDITOR.dom.element.prototype.getSize=function(t,e){var n=Math.max(this.$["offset"+CKEDITOR.tools.capitalize(t)],this.$["client"+CKEDITOR.tools.capitalize(t)])||0;return e&&(n-=i.call(this,t)),n}}(),CKEDITOR.dom.documentFragment=function(t){t=t||CKEDITOR.document,this.$=t.type==CKEDITOR.NODE_DOCUMENT?t.$.createDocumentFragment():t},CKEDITOR.tools.extend(CKEDITOR.dom.documentFragment.prototype,CKEDITOR.dom.element.prototype,{type:CKEDITOR.NODE_DOCUMENT_FRAGMENT,insertAfterNode:function(t){t=t.$,t.parentNode.insertBefore(this.$,t.nextSibling)}},!0,{append:1,appendBogus:1,getFirst:1,getLast:1,getParent:1,getNext:1,getPrevious:1,appendTo:1,moveChildren:1,insertBefore:1,insertAfterNode:1,replace:1,trim:1,type:1,ltrim:1,rtrim:1,getDocument:1,getChildCount:1,getChild:1,getChildren:1}),function(){function t(t,e){var i=this.range;if(this._.end)return null;if(!this._.start){if(this._.start=1,i.collapsed)return this.end(),null;i.optimize()}var n,a=i.startContainer;n=i.endContainer;var r,o=i.startOffset,s=i.endOffset,l=this.guard,c=this.type,d=t?"getPreviousSourceNode":"getNextSourceNode";if(!t&&!this._.guardLTR){var h=n.type==CKEDITOR.NODE_ELEMENT?n:n.getParent(),u=n.type==CKEDITOR.NODE_ELEMENT?n.getChild(s):n.getNext();
this._.guardLTR=function(t,e){return!(e&&h.equals(t)||u&&t.equals(u)||t.type==CKEDITOR.NODE_ELEMENT&&e&&t.equals(i.root))}}if(t&&!this._.guardRTL){var p=a.type==CKEDITOR.NODE_ELEMENT?a:a.getParent(),f=a.type==CKEDITOR.NODE_ELEMENT?o?a.getChild(o-1):null:a.getPrevious();this._.guardRTL=function(t,e){return!(e&&p.equals(t)||f&&t.equals(f)||t.type==CKEDITOR.NODE_ELEMENT&&e&&t.equals(i.root))}}var m=t?this._.guardRTL:this._.guardLTR;for(r=l?function(t,e){return m(t,e)===!1?!1:l(t,e)}:m,this.current?n=this.current[d](!1,c,r):(t?n.type==CKEDITOR.NODE_ELEMENT&&(n=s>0?n.getChild(s-1):r(n,!0)===!1?null:n.getPreviousSourceNode(!0,c,r)):(n=a,n.type!=CKEDITOR.NODE_ELEMENT||(n=n.getChild(o))||(n=r(a,!0)===!1?null:a.getNextSourceNode(!0,c,r))),n&&r(n)===!1&&(n=null));n&&!this._.end;){if(this.current=n,this.evaluator&&this.evaluator(n)===!1){if(e&&this.evaluator)return!1}else if(!e)return n;n=n[d](!1,c,r)}return this.end(),this.current=null}function e(e){for(var i,n=null;i=t.call(this,e);)n=i;return n}function i(t){if(c(t))return!1;if(t.type==CKEDITOR.NODE_TEXT)return!0;if(t.type==CKEDITOR.NODE_ELEMENT){if(t.is(CKEDITOR.dtd.$inline)||"false"==t.getAttribute("contenteditable"))return!0;var e;if((e=!CKEDITOR.env.needsBrFiller)&&(e=t.is(d)))t:{e=0;for(var i=t.getChildCount();i>e;++e)if(!c(t.getChild(e))){e=!1;break t}e=!0}if(e)return!0}return!1}CKEDITOR.dom.walker=CKEDITOR.tools.createClass({$:function(t){this.range=t,this._={}},proto:{end:function(){this._.end=1},next:function(){return t.call(this)},previous:function(){return t.call(this,1)},checkForward:function(){return t.call(this,0,1)!==!1},checkBackward:function(){return t.call(this,1,1)!==!1},lastForward:function(){return e.call(this)},lastBackward:function(){return e.call(this,1)},reset:function(){delete this.current,this._={}}}});var n={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},a={absolute:1,fixed:1};CKEDITOR.dom.element.prototype.isBlockBoundary=function(t){return"none"!=this.getComputedStyle("float")||this.getComputedStyle("position")in a||!n[this.getComputedStyle("display")]?!!(this.is(CKEDITOR.dtd.$block)||t&&this.is(t)):!0},CKEDITOR.dom.walker.blockBoundary=function(t){return function(e){return!(e.type==CKEDITOR.NODE_ELEMENT&&e.isBlockBoundary(t))}},CKEDITOR.dom.walker.listItemBoundary=function(){return this.blockBoundary({br:1})},CKEDITOR.dom.walker.bookmark=function(t,e){function i(t){return t&&t.getName&&"span"==t.getName()&&t.data("cke-bookmark")}return function(n){var a,r;return a=n&&n.type!=CKEDITOR.NODE_ELEMENT&&(r=n.getParent())&&i(r),a=t?a:a||i(n),!!(e^a)}},CKEDITOR.dom.walker.whitespaces=function(t){return function(e){var i;return e&&e.type==CKEDITOR.NODE_TEXT&&(i=!CKEDITOR.tools.trim(e.getText())||CKEDITOR.env.webkit&&"​"==e.getText()),!!(t^i)}},CKEDITOR.dom.walker.invisible=function(t){var e=CKEDITOR.dom.walker.whitespaces();return function(i){return e(i)?i=1:(i.type==CKEDITOR.NODE_TEXT&&(i=i.getParent()),i=!i.$.offsetHeight),!!(t^i)}},CKEDITOR.dom.walker.nodeType=function(t,e){return function(i){return!!(e^i.type==t)}},CKEDITOR.dom.walker.bogus=function(t){function e(t){return!o(t)&&!s(t)}return function(i){var n=CKEDITOR.env.needsBrFiller?i.is&&i.is("br"):i.getText&&r.test(i.getText());return n&&(n=i.getParent(),i=i.getNext(e),n=n.isBlockBoundary()&&(!i||i.type==CKEDITOR.NODE_ELEMENT&&i.isBlockBoundary())),!!(t^n)}},CKEDITOR.dom.walker.temp=function(t){return function(e){return e.type!=CKEDITOR.NODE_ELEMENT&&(e=e.getParent()),e=e&&e.hasAttribute("data-cke-temp"),!!(t^e)}};var r=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,o=CKEDITOR.dom.walker.whitespaces(),s=CKEDITOR.dom.walker.bookmark(),l=CKEDITOR.dom.walker.temp();CKEDITOR.dom.walker.ignored=function(t){return function(e){return e=o(e)||s(e)||l(e),!!(t^e)}};var c=CKEDITOR.dom.walker.ignored(),d=function(t){var e,i={};for(e in t)CKEDITOR.dtd[e]["#"]&&(i[e]=1);return i}(CKEDITOR.dtd.$block);CKEDITOR.dom.walker.editable=function(t){return function(e){return!!(t^i(e))}},CKEDITOR.dom.element.prototype.getBogus=function(){var t=this;do t=t.getPreviousSourceNode();while(s(t)||o(t)||t.type==CKEDITOR.NODE_ELEMENT&&t.is(CKEDITOR.dtd.$inline)&&!t.is(CKEDITOR.dtd.$empty));return t&&(CKEDITOR.env.needsBrFiller?t.is&&t.is("br"):t.getText&&r.test(t.getText()))?t:!1}}(),CKEDITOR.dom.range=function(t){this.endOffset=this.endContainer=this.startOffset=this.startContainer=null,this.collapsed=!0;var e=t instanceof CKEDITOR.dom.document;this.document=e?t:t.getDocument(),this.root=e?t.getBody():t},function(){function t(){var t=!1,e=CKEDITOR.dom.walker.whitespaces(),i=CKEDITOR.dom.walker.bookmark(!0),n=CKEDITOR.dom.walker.bogus();return function(a){return i(a)||e(a)?!0:n(a)&&!t?t=!0:a.type==CKEDITOR.NODE_TEXT&&(a.hasAscendant("pre")||CKEDITOR.tools.trim(a.getText()).length)||a.type==CKEDITOR.NODE_ELEMENT&&!a.is(r)?!1:!0}}function e(t){var e=CKEDITOR.dom.walker.whitespaces(),i=CKEDITOR.dom.walker.bookmark(1);return function(n){return i(n)||e(n)?!0:!t&&o(n)||n.type==CKEDITOR.NODE_ELEMENT&&n.is(CKEDITOR.dtd.$removeEmpty)}}function i(t){return function(){var e;return this[t?"getPreviousNode":"getNextNode"](function(t){return!e&&c(t)&&(e=t),l(t)&&!(o(t)&&t.equals(e))})}}var n=function(t){t.collapsed=t.startContainer&&t.endContainer&&t.startContainer.equals(t.endContainer)&&t.startOffset==t.endOffset},a=function(t,e,i,n){t.optimizeBookmark();var a,r,o=t.startContainer,s=t.endContainer,l=t.startOffset,c=t.endOffset;s.type==CKEDITOR.NODE_TEXT?s=s.split(c):s.getChildCount()>0&&(c>=s.getChildCount()?(s=s.append(t.document.createText("")),r=!0):s=s.getChild(c)),o.type==CKEDITOR.NODE_TEXT?(o.split(l),o.equals(s)&&(s=o.getNext())):l?l>=o.getChildCount()?(o=o.append(t.document.createText("")),a=!0):o=o.getChild(l).getPrevious():(o=o.append(t.document.createText(""),1),a=!0);var d,h,u,l=o.getParents(),c=s.getParents();for(d=0;d<l.length&&(h=l[d],u=c[d],h.equals(u));d++);for(var p,f,m,g=i,v=d;v<l.length;v++){for(p=l[v],g&&!p.equals(o)&&(f=g.append(p.clone())),p=p.getNext();p&&(!p.equals(c[v])&&!p.equals(s));)m=p.getNext(),2==e?g.append(p.clone(!0)):(p.remove(),1==e&&g.append(p)),p=m;g&&(g=f)}for(g=i,i=d;i<c.length;i++){if(p=c[i],e>0&&!p.equals(s)&&(f=g.append(p.clone())),!l[i]||p.$.parentNode!=l[i].$.parentNode)for(p=p.getPrevious();p&&(!p.equals(l[i])&&!p.equals(o));)m=p.getPrevious(),2==e?g.$.insertBefore(p.$.cloneNode(!0),g.$.firstChild):(p.remove(),1==e&&g.$.insertBefore(p.$,g.$.firstChild)),p=m;g&&(g=f)}2==e?(h=t.startContainer,h.type==CKEDITOR.NODE_TEXT&&(h.$.data=h.$.data+h.$.nextSibling.data,h.$.parentNode.removeChild(h.$.nextSibling)),t=t.endContainer,t.type==CKEDITOR.NODE_TEXT&&t.$.nextSibling&&(t.$.data=t.$.data+t.$.nextSibling.data,t.$.parentNode.removeChild(t.$.nextSibling))):(h&&u&&(o.$.parentNode!=h.$.parentNode||s.$.parentNode!=u.$.parentNode)&&(e=u.getIndex(),a&&u.$.parentNode==o.$.parentNode&&e--,n&&h.type==CKEDITOR.NODE_ELEMENT?(n=CKEDITOR.dom.element.createFromHtml('<span data-cke-bookmark="1" style="display:none">&nbsp;</span>',t.document),n.insertAfter(h),h.mergeSiblings(!1),t.moveToBookmark({startNode:n})):t.setStart(u.getParent(),e)),t.collapse(!0)),a&&o.remove(),r&&s.$.parentNode&&s.remove()},r={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},o=CKEDITOR.dom.walker.bogus(),s=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,l=CKEDITOR.dom.walker.editable(),c=CKEDITOR.dom.walker.ignored(!0);CKEDITOR.dom.range.prototype={clone:function(){var t=new CKEDITOR.dom.range(this.root);return t.startContainer=this.startContainer,t.startOffset=this.startOffset,t.endContainer=this.endContainer,t.endOffset=this.endOffset,t.collapsed=this.collapsed,t},collapse:function(t){t?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,this.startOffset=this.endOffset),this.collapsed=!0},cloneContents:function(){var t=new CKEDITOR.dom.documentFragment(this.document);return this.collapsed||a(this,2,t),t},deleteContents:function(t){this.collapsed||a(this,0,null,t)},extractContents:function(t){var e=new CKEDITOR.dom.documentFragment(this.document);return this.collapsed||a(this,1,e,t),e},createBookmark:function(t){var e,i,n,a,r=this.collapsed;return e=this.document.createElement("span"),e.data("cke-bookmark",1),e.setStyle("display","none"),e.setHtml("&nbsp;"),t&&(n="cke_bm_"+CKEDITOR.tools.getNextNumber(),e.setAttribute("id",n+(r?"C":"S"))),r||(i=e.clone(),i.setHtml("&nbsp;"),t&&i.setAttribute("id",n+"E"),a=this.clone(),a.collapse(),a.insertNode(i)),a=this.clone(),a.collapse(!0),a.insertNode(e),i?(this.setStartAfter(e),this.setEndBefore(i)):this.moveToPosition(e,CKEDITOR.POSITION_AFTER_END),{startNode:t?n+(r?"C":"S"):e,endNode:t?n+"E":i,serializable:t,collapsed:r}},createBookmark2:function(){function t(t){var e,i=t.container,n=t.offset;e=i;var a=n;if(e=e.type!=CKEDITOR.NODE_ELEMENT||0===a||a==e.getChildCount()?0:e.getChild(a-1).type==CKEDITOR.NODE_TEXT&&e.getChild(a).type==CKEDITOR.NODE_TEXT,e&&(i=i.getChild(n-1),n=i.getLength()),i.type==CKEDITOR.NODE_ELEMENT&&n>1&&(n=i.getChild(n-1).getIndex(!0)+1),i.type==CKEDITOR.NODE_TEXT){for(e=i,a=0;(e=e.getPrevious())&&e.type==CKEDITOR.NODE_TEXT;)a+=e.getLength();n+=a}t.container=i,t.offset=n}return function(e){var i=this.collapsed,n={container:this.startContainer,offset:this.startOffset},a={container:this.endContainer,offset:this.endOffset};return e&&(t(n),i||t(a)),{start:n.container.getAddress(e),end:i?null:a.container.getAddress(e),startOffset:n.offset,endOffset:a.offset,normalized:e,collapsed:i,is2:!0}}}(),moveToBookmark:function(t){if(t.is2){var e=this.document.getByAddress(t.start,t.normalized),i=t.startOffset,n=t.end&&this.document.getByAddress(t.end,t.normalized),t=t.endOffset;this.setStart(e,i),n?this.setEnd(n,t):this.collapse(!0)}else e=(i=t.serializable)?this.document.getById(t.startNode):t.startNode,t=i?this.document.getById(t.endNode):t.endNode,this.setStartBefore(e),e.remove(),t?(this.setEndBefore(t),t.remove()):this.collapse(!0)},getBoundaryNodes:function(){var t,e=this.startContainer,i=this.endContainer,n=this.startOffset,a=this.endOffset;if(e.type==CKEDITOR.NODE_ELEMENT)if(t=e.getChildCount(),t>n)e=e.getChild(n);else if(1>t)e=e.getPreviousSourceNode();else{for(e=e.$;e.lastChild;)e=e.lastChild;e=new CKEDITOR.dom.node(e),e=e.getNextSourceNode()||e}if(i.type==CKEDITOR.NODE_ELEMENT)if(t=i.getChildCount(),t>a)i=i.getChild(a).getPreviousSourceNode(!0);else if(1>t)i=i.getPreviousSourceNode();else{for(i=i.$;i.lastChild;)i=i.lastChild;i=new CKEDITOR.dom.node(i)}return e.getPosition(i)&CKEDITOR.POSITION_FOLLOWING&&(e=i),{startNode:e,endNode:i}},getCommonAncestor:function(t,e){var i=this.startContainer,n=this.endContainer,i=i.equals(n)?t&&i.type==CKEDITOR.NODE_ELEMENT&&this.startOffset==this.endOffset-1?i.getChild(this.startOffset):i:i.getCommonAncestor(n);return e&&!i.is?i.getParent():i},optimize:function(){var t=this.startContainer,e=this.startOffset;t.type!=CKEDITOR.NODE_ELEMENT&&(e?e>=t.getLength()&&this.setStartAfter(t):this.setStartBefore(t)),t=this.endContainer,e=this.endOffset,t.type!=CKEDITOR.NODE_ELEMENT&&(e?e>=t.getLength()&&this.setEndAfter(t):this.setEndBefore(t))},optimizeBookmark:function(){var t=this.startContainer,e=this.endContainer;t.is&&t.is("span")&&t.data("cke-bookmark")&&this.setStartAt(t,CKEDITOR.POSITION_BEFORE_START),e&&e.is&&e.is("span")&&e.data("cke-bookmark")&&this.setEndAt(e,CKEDITOR.POSITION_AFTER_END)},trim:function(t,e){var i=this.startContainer,n=this.startOffset,a=this.collapsed;if((!t||a)&&i&&i.type==CKEDITOR.NODE_TEXT){if(n)if(n>=i.getLength())n=i.getIndex()+1,i=i.getParent();else{var r=i.split(n),n=i.getIndex()+1,i=i.getParent();this.startContainer.equals(this.endContainer)?this.setEnd(r,this.endOffset-this.startOffset):i.equals(this.endContainer)&&(this.endOffset=this.endOffset+1)}else n=i.getIndex(),i=i.getParent();if(this.setStart(i,n),a)return void this.collapse(!0)}i=this.endContainer,n=this.endOffset,e||a||!i||i.type!=CKEDITOR.NODE_TEXT||(n?(n>=i.getLength()||i.split(n),n=i.getIndex()+1):n=i.getIndex(),i=i.getParent(),this.setEnd(i,n))},enlarge:function(t,e){function i(t){return t&&t.type==CKEDITOR.NODE_ELEMENT&&t.hasAttribute("contenteditable")?null:t}var n=RegExp(/[^\s\ufeff]/);switch(t){case CKEDITOR.ENLARGE_INLINE:var a=1;case CKEDITOR.ENLARGE_ELEMENT:if(this.collapsed)break;var r,o,s,l,c,d,h,u=this.getCommonAncestor(),p=this.root,f=!1;d=this.startContainer;var m=this.startOffset;for(d.type==CKEDITOR.NODE_TEXT?(m&&(d=!CKEDITOR.tools.trim(d.substring(0,m)).length&&d,f=!!d),d&&!(l=d.getPrevious())&&(s=d.getParent())):(m&&(l=d.getChild(m-1)||d.getLast()),l||(s=d)),s=i(s);s||l;){if(s&&!l){if(!c&&s.equals(u)&&(c=!0),a?s.isBlockBoundary():!p.contains(s))break;f&&"inline"==s.getComputedStyle("display")||(f=!1,c?r=s:this.setStartBefore(s)),l=s.getPrevious()}for(;l;)if(d=!1,l.type==CKEDITOR.NODE_COMMENT)l=l.getPrevious();else{if(l.type==CKEDITOR.NODE_TEXT)h=l.getText(),n.test(h)&&(l=null),d=/[\s\ufeff]$/.test(h);else if((l.$.offsetWidth>0||e&&l.is("br"))&&!l.data("cke-bookmark"))if(f&&CKEDITOR.dtd.$removeEmpty[l.getName()]){if(h=l.getText(),n.test(h))l=null;else for(var g,m=l.$.getElementsByTagName("*"),v=0;g=m[v++];)if(!CKEDITOR.dtd.$removeEmpty[g.nodeName.toLowerCase()]){l=null;break}l&&(d=!!h.length)}else l=null;if(d&&(f?c?r=s:s&&this.setStartBefore(s):f=!0),l){if(d=l.getPrevious(),!s&&!d){s=l,l=null;break}l=d}else s=null}s&&(s=i(s.getParent()))}d=this.endContainer,m=this.endOffset,s=l=null,c=f=!1;var C=function(t,e){var i=new CKEDITOR.dom.range(p);i.setStart(t,e),i.setEndAt(p,CKEDITOR.POSITION_BEFORE_END);var a,i=new CKEDITOR.dom.walker(i);for(i.guard=function(t){return!(t.type==CKEDITOR.NODE_ELEMENT&&t.isBlockBoundary())};a=i.next();){if(a.type!=CKEDITOR.NODE_TEXT)return!1;if(h=a!=t?a.getText():a.substring(e),n.test(h))return!1}return!0};for(d.type==CKEDITOR.NODE_TEXT?CKEDITOR.tools.trim(d.substring(m)).length?f=!0:(f=!d.getLength(),m==d.getLength()?(l=d.getNext())||(s=d.getParent()):C(d,m)&&(s=d.getParent())):(l=d.getChild(m))||(s=d);s||l;){if(s&&!l){if(!c&&s.equals(u)&&(c=!0),a?s.isBlockBoundary():!p.contains(s))break;f&&"inline"==s.getComputedStyle("display")||(f=!1,c?o=s:s&&this.setEndAfter(s)),l=s.getNext()}for(;l;){if(d=!1,l.type==CKEDITOR.NODE_TEXT)h=l.getText(),C(l,0)||(l=null),d=/^[\s\ufeff]/.test(h);else if(l.type==CKEDITOR.NODE_ELEMENT){if((l.$.offsetWidth>0||e&&l.is("br"))&&!l.data("cke-bookmark"))if(f&&CKEDITOR.dtd.$removeEmpty[l.getName()]){if(h=l.getText(),n.test(h))l=null;else for(m=l.$.getElementsByTagName("*"),v=0;g=m[v++];)if(!CKEDITOR.dtd.$removeEmpty[g.nodeName.toLowerCase()]){l=null;break}l&&(d=!!h.length)}else l=null}else d=1;if(d&&f&&(c?o=s:this.setEndAfter(s)),l){if(d=l.getNext(),!s&&!d){s=l,l=null;break}l=d}else s=null}s&&(s=i(s.getParent()))}r&&o&&(u=r.contains(o)?o:r,this.setStartBefore(u),this.setEndAfter(u));break;case CKEDITOR.ENLARGE_BLOCK_CONTENTS:case CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:s=new CKEDITOR.dom.range(this.root),p=this.root,s.setStartAt(p,CKEDITOR.POSITION_AFTER_START),s.setEnd(this.startContainer,this.startOffset),s=new CKEDITOR.dom.walker(s);var I,b,E=CKEDITOR.dom.walker.blockBoundary(t==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:null),y=null,T=function(t){if(t.type==CKEDITOR.NODE_ELEMENT&&"false"==t.getAttribute("contenteditable"))if(y){if(y.equals(t))return void(y=null)}else y=t;else if(y)return;var e=E(t);return e||(I=t),e},a=function(t){var e=T(t);return!e&&t.is&&t.is("br")&&(b=t),e};if(s.guard=T,s=s.lastBackward(),I=I||p,this.setStartAt(I,!I.is("br")&&(!s&&this.checkStartOfBlock()||s&&I.contains(s))?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_AFTER_END),t==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS){s=this.clone(),s=new CKEDITOR.dom.walker(s);var R=CKEDITOR.dom.walker.whitespaces(),w=CKEDITOR.dom.walker.bookmark();if(s.evaluator=function(t){return!R(t)&&!w(t)},(s=s.previous())&&s.type==CKEDITOR.NODE_ELEMENT&&s.is("br"))break}s=this.clone(),s.collapse(),s.setEndAt(p,CKEDITOR.POSITION_BEFORE_END),s=new CKEDITOR.dom.walker(s),s.guard=t==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS?a:T,I=null,s=s.lastForward(),I=I||p,this.setEndAt(I,!s&&this.checkEndOfBlock()||s&&I.contains(s)?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_BEFORE_START),b&&this.setEndAfter(b)}},shrink:function(t,e,i){if(!this.collapsed){var t=t||CKEDITOR.SHRINK_TEXT,n=this.clone(),a=this.startContainer,r=this.endContainer,o=this.startOffset,s=this.endOffset,l=1,c=1;a&&a.type==CKEDITOR.NODE_TEXT&&(o?o>=a.getLength()?n.setStartAfter(a):(n.setStartBefore(a),l=0):n.setStartBefore(a)),r&&r.type==CKEDITOR.NODE_TEXT&&(s?s>=r.getLength()?n.setEndAfter(r):(n.setEndAfter(r),c=0):n.setEndBefore(r));var n=new CKEDITOR.dom.walker(n),d=CKEDITOR.dom.walker.bookmark();n.evaluator=function(e){return e.type==(t==CKEDITOR.SHRINK_ELEMENT?CKEDITOR.NODE_ELEMENT:CKEDITOR.NODE_TEXT)};var h;return n.guard=function(e,n){return d(e)?!0:t==CKEDITOR.SHRINK_ELEMENT&&e.type==CKEDITOR.NODE_TEXT||n&&e.equals(h)||i===!1&&e.type==CKEDITOR.NODE_ELEMENT&&e.isBlockBoundary()||e.type==CKEDITOR.NODE_ELEMENT&&e.hasAttribute("contenteditable")?!1:(!n&&e.type==CKEDITOR.NODE_ELEMENT&&(h=e),!0)},l&&(a=n[t==CKEDITOR.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(a,e?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_START),c&&(n.reset(),(n=n[t==CKEDITOR.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(n,e?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_AFTER_END)),!(!l&&!c)}},insertNode:function(t){this.optimizeBookmark(),this.trim(!1,!0);var e=this.startContainer,i=e.getChild(this.startOffset);i?t.insertBefore(i):e.append(t),t.getParent()&&t.getParent().equals(this.endContainer)&&this.endOffset++,this.setStartBefore(t)},moveToPosition:function(t,e){this.setStartAt(t,e),this.collapse(!0)},moveToRange:function(t){this.setStart(t.startContainer,t.startOffset),this.setEnd(t.endContainer,t.endOffset)},selectNodeContents:function(t){this.setStart(t,0),this.setEnd(t,t.type==CKEDITOR.NODE_TEXT?t.getLength():t.getChildCount())},setStart:function(t,e){t.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$empty[t.getName()]&&(e=t.getIndex(),t=t.getParent()),this.startContainer=t,this.startOffset=e,this.endContainer||(this.endContainer=t,this.endOffset=e),n(this)},setEnd:function(t,e){t.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$empty[t.getName()]&&(e=t.getIndex()+1,t=t.getParent()),this.endContainer=t,this.endOffset=e,this.startContainer||(this.startContainer=t,this.startOffset=e),n(this)},setStartAfter:function(t){this.setStart(t.getParent(),t.getIndex()+1)},setStartBefore:function(t){this.setStart(t.getParent(),t.getIndex())},setEndAfter:function(t){this.setEnd(t.getParent(),t.getIndex()+1)},setEndBefore:function(t){this.setEnd(t.getParent(),t.getIndex())},setStartAt:function(t,e){switch(e){case CKEDITOR.POSITION_AFTER_START:this.setStart(t,0);break;case CKEDITOR.POSITION_BEFORE_END:t.type==CKEDITOR.NODE_TEXT?this.setStart(t,t.getLength()):this.setStart(t,t.getChildCount());break;case CKEDITOR.POSITION_BEFORE_START:this.setStartBefore(t);break;case CKEDITOR.POSITION_AFTER_END:this.setStartAfter(t)}n(this)},setEndAt:function(t,e){switch(e){case CKEDITOR.POSITION_AFTER_START:this.setEnd(t,0);break;case CKEDITOR.POSITION_BEFORE_END:t.type==CKEDITOR.NODE_TEXT?this.setEnd(t,t.getLength()):this.setEnd(t,t.getChildCount());break;case CKEDITOR.POSITION_BEFORE_START:this.setEndBefore(t);break;case CKEDITOR.POSITION_AFTER_END:this.setEndAfter(t)}n(this)},fixBlock:function(t,e){var i=this.createBookmark(),n=this.document.createElement(e);return this.collapse(t),this.enlarge(CKEDITOR.ENLARGE_BLOCK_CONTENTS),this.extractContents().appendTo(n),n.trim(),n.appendBogus(),this.insertNode(n),this.moveToBookmark(i),n},splitBlock:function(t){var e=new CKEDITOR.dom.elementPath(this.startContainer,this.root),i=new CKEDITOR.dom.elementPath(this.endContainer,this.root),n=e.block,a=i.block,r=null;return e.blockLimit.equals(i.blockLimit)?("br"!=t&&(n||(n=this.fixBlock(!0,t),a=new CKEDITOR.dom.elementPath(this.endContainer,this.root).block),a||(a=this.fixBlock(!1,t))),t=n&&this.checkStartOfBlock(),e=a&&this.checkEndOfBlock(),this.deleteContents(),n&&n.equals(a)&&(e?(r=new CKEDITOR.dom.elementPath(this.startContainer,this.root),this.moveToPosition(a,CKEDITOR.POSITION_AFTER_END),a=null):t?(r=new CKEDITOR.dom.elementPath(this.startContainer,this.root),this.moveToPosition(n,CKEDITOR.POSITION_BEFORE_START),n=null):(a=this.splitElement(n),n.is("ul","ol")||n.appendBogus())),{previousBlock:n,nextBlock:a,wasStartOfBlock:t,wasEndOfBlock:e,elementPath:r}):null},splitElement:function(t){if(!this.collapsed)return null;this.setEndAt(t,CKEDITOR.POSITION_BEFORE_END);var e=this.extractContents(),i=t.clone(!1);return e.appendTo(i),i.insertAfter(t),this.moveToPosition(t,CKEDITOR.POSITION_AFTER_END),i},removeEmptyBlocksAtEnd:function(){function t(t){return function(n){return e(n)||i(n)||n.type==CKEDITOR.NODE_ELEMENT&&n.isEmptyInlineRemoveable()||t.is("table")&&n.is("caption")?!1:!0}}var e=CKEDITOR.dom.walker.whitespaces(),i=CKEDITOR.dom.walker.bookmark(!1);return function(e){for(var i,n=this.createBookmark(),a=this[e?"endPath":"startPath"](),r=a.block||a.blockLimit;r&&!r.equals(a.root)&&!r.getFirst(t(r));)i=r.getParent(),this[e?"setEndAt":"setStartAt"](r,CKEDITOR.POSITION_AFTER_END),r.remove(1),r=i;this.moveToBookmark(n)}}(),startPath:function(){return new CKEDITOR.dom.elementPath(this.startContainer,this.root)},endPath:function(){return new CKEDITOR.dom.elementPath(this.endContainer,this.root)},checkBoundaryOfElement:function(t,i){var n=i==CKEDITOR.START,a=this.clone();return a.collapse(n),a[n?"setStartAt":"setEndAt"](t,n?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END),a=new CKEDITOR.dom.walker(a),a.evaluator=e(n),a[n?"checkBackward":"checkForward"]()},checkStartOfBlock:function(){var e=this.startContainer,i=this.startOffset;return CKEDITOR.env.ie&&i&&e.type==CKEDITOR.NODE_TEXT&&(e=CKEDITOR.tools.ltrim(e.substring(0,i)),s.test(e)&&this.trim(0,1)),this.trim(),e=new CKEDITOR.dom.elementPath(this.startContainer,this.root),i=this.clone(),i.collapse(!0),i.setStartAt(e.block||e.blockLimit,CKEDITOR.POSITION_AFTER_START),e=new CKEDITOR.dom.walker(i),e.evaluator=t(),e.checkBackward()},checkEndOfBlock:function(){var e=this.endContainer,i=this.endOffset;return CKEDITOR.env.ie&&e.type==CKEDITOR.NODE_TEXT&&(e=CKEDITOR.tools.rtrim(e.substring(i)),s.test(e)&&this.trim(1,0)),this.trim(),e=new CKEDITOR.dom.elementPath(this.endContainer,this.root),i=this.clone(),i.collapse(!1),i.setEndAt(e.block||e.blockLimit,CKEDITOR.POSITION_BEFORE_END),e=new CKEDITOR.dom.walker(i),e.evaluator=t(),e.checkForward()},getPreviousNode:function(t,e,i){var n=this.clone();return n.collapse(1),n.setStartAt(i||this.root,CKEDITOR.POSITION_AFTER_START),i=new CKEDITOR.dom.walker(n),i.evaluator=t,i.guard=e,i.previous()},getNextNode:function(t,e,i){var n=this.clone();return n.collapse(),n.setEndAt(i||this.root,CKEDITOR.POSITION_BEFORE_END),i=new CKEDITOR.dom.walker(n),i.evaluator=t,i.guard=e,i.next()},checkReadOnly:function(){function t(t,e){for(;t;){if(t.type==CKEDITOR.NODE_ELEMENT){if("false"==t.getAttribute("contentEditable")&&!t.data("cke-editable"))return 0;if(t.is("html")||"true"==t.getAttribute("contentEditable")&&(t.contains(e)||t.equals(e)))break}t=t.getParent()}return 1}return function(){var e=this.startContainer,i=this.endContainer;return!(t(e,i)&&t(i,e))}}(),moveToElementEditablePosition:function(t,e){if(t.type==CKEDITOR.NODE_ELEMENT&&!t.isEditable(!1))return this.moveToPosition(t,e?CKEDITOR.POSITION_AFTER_END:CKEDITOR.POSITION_BEFORE_START),!0;for(var i=0;t;){if(t.type==CKEDITOR.NODE_TEXT){e&&this.endContainer&&this.checkEndOfBlock()&&s.test(t.getText())?this.moveToPosition(t,CKEDITOR.POSITION_BEFORE_START):this.moveToPosition(t,e?CKEDITOR.POSITION_AFTER_END:CKEDITOR.POSITION_BEFORE_START),i=1;break}if(t.type==CKEDITOR.NODE_ELEMENT)if(t.isEditable())this.moveToPosition(t,e?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_AFTER_START),i=1;else if(e&&t.is("br")&&this.endContainer&&this.checkEndOfBlock())this.moveToPosition(t,CKEDITOR.POSITION_BEFORE_START);else if("false"==t.getAttribute("contenteditable")&&t.is(CKEDITOR.dtd.$block))return this.setStartBefore(t),this.setEndAfter(t),!0;var n=t,a=i,r=void 0;n.type==CKEDITOR.NODE_ELEMENT&&n.isEditable(!1)&&(r=n[e?"getLast":"getFirst"](c)),!a&&!r&&(r=n[e?"getPrevious":"getNext"](c)),t=r}return!!i},moveToClosestEditablePosition:function(t,e){var i,n=new CKEDITOR.dom.range(this.root),a=0,r=[CKEDITOR.POSITION_AFTER_END,CKEDITOR.POSITION_BEFORE_START];return n.moveToPosition(t,r[e?0:1]),t.is(CKEDITOR.dtd.$block)?(i=n[e?"getNextEditableNode":"getPreviousEditableNode"]())&&(a=1,i.type==CKEDITOR.NODE_ELEMENT&&i.is(CKEDITOR.dtd.$block)&&"false"==i.getAttribute("contenteditable")?(n.setStartAt(i,CKEDITOR.POSITION_BEFORE_START),n.setEndAt(i,CKEDITOR.POSITION_AFTER_END)):n.moveToPosition(i,r[e?1:0])):a=1,a&&this.moveToRange(n),!!a},moveToElementEditStart:function(t){return this.moveToElementEditablePosition(t)},moveToElementEditEnd:function(t){return this.moveToElementEditablePosition(t,!0)},getEnclosedNode:function(){var t=this.clone();if(t.optimize(),t.startContainer.type!=CKEDITOR.NODE_ELEMENT||t.endContainer.type!=CKEDITOR.NODE_ELEMENT)return null;var t=new CKEDITOR.dom.walker(t),e=CKEDITOR.dom.walker.bookmark(!1,!0),i=CKEDITOR.dom.walker.whitespaces(!0);t.evaluator=function(t){return i(t)&&e(t)};var n=t.next();return t.reset(),n&&n.equals(t.previous())?n:null},getTouchedStartNode:function(){var t=this.startContainer;return this.collapsed||t.type!=CKEDITOR.NODE_ELEMENT?t:t.getChild(this.startOffset)||t},getTouchedEndNode:function(){var t=this.endContainer;return this.collapsed||t.type!=CKEDITOR.NODE_ELEMENT?t:t.getChild(this.endOffset-1)||t},getNextEditableNode:i(),getPreviousEditableNode:i(1),scrollIntoView:function(){var t,e,i,n=new CKEDITOR.dom.element.createFromHtml("<span>&nbsp;</span>",this.document),a=this.clone();a.optimize(),(i=a.startContainer.type==CKEDITOR.NODE_TEXT)?(e=a.startContainer.getText(),t=a.startContainer.split(a.startOffset),n.insertAfter(a.startContainer)):a.insertNode(n),n.scrollIntoView(),i&&(a.startContainer.setText(e),t.remove()),n.remove()}}}(),CKEDITOR.POSITION_AFTER_START=1,CKEDITOR.POSITION_BEFORE_END=2,CKEDITOR.POSITION_BEFORE_START=3,CKEDITOR.POSITION_AFTER_END=4,CKEDITOR.ENLARGE_ELEMENT=1,CKEDITOR.ENLARGE_BLOCK_CONTENTS=2,CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS=3,CKEDITOR.ENLARGE_INLINE=4,CKEDITOR.START=1,CKEDITOR.END=2,CKEDITOR.SHRINK_ELEMENT=1,CKEDITOR.SHRINK_TEXT=2,function(){function t(t){arguments.length<1||(this.range=t,this.forceBrBreak=0,this.enlargeBr=1,this.enforceRealBlocks=0,this._||(this._={}))}function e(t,e,i){for(t=t.getNextSourceNode(e,null,i);!r(t);)t=t.getNextSourceNode(e,null,i);return t}function i(t){var e=[];return t.forEach(function(t){return"true"==t.getAttribute("contenteditable")?(e.push(t),!1):void 0},CKEDITOR.NODE_ELEMENT,!0),e}function n(t,e,a,r){t:{void 0==r&&(r=i(a));for(var o;o=r.shift();)if(o.getDtd().p){r={element:o,remaining:r};break t}r=null}return r?(o=CKEDITOR.filter.instances[r.element.data("cke-filter")])&&!o.check(e)?n(t,e,a,r.remaining):(e=new CKEDITOR.dom.range(r.element),e.selectNodeContents(r.element),e=e.createIterator(),e.enlargeBr=t.enlargeBr,e.enforceRealBlocks=t.enforceRealBlocks,e.activeFilter=e.filter=o,t._.nestedEditable={element:r.element,container:a,remaining:r.remaining,iterator:e},1):0}var a=/^[\r\n\t ]+$/,r=CKEDITOR.dom.walker.bookmark(!1,!0),o=CKEDITOR.dom.walker.whitespaces(!0),s=function(t){return r(t)&&o(t)};t.prototype={getNextParagraph:function(t){var i,o,l,c,d,t=t||"p";if(this._.nestedEditable){if(i=this._.nestedEditable.iterator.getNextParagraph(t))return this.activeFilter=this._.nestedEditable.iterator.activeFilter,i;if(this.activeFilter=this.filter,n(this,t,this._.nestedEditable.container,this._.nestedEditable.remaining))return this.activeFilter=this._.nestedEditable.iterator.activeFilter,this._.nestedEditable.iterator.getNextParagraph(t);this._.nestedEditable=null}if(!this.range.root.getDtd()[t])return null;if(!this._.started){var h=this.range.clone();if(h.shrink(CKEDITOR.SHRINK_ELEMENT,!0),o=h.endContainer.hasAscendant("pre",!0)||h.startContainer.hasAscendant("pre",!0),h.enlarge(this.forceBrBreak&&!o||!this.enlargeBr?CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:CKEDITOR.ENLARGE_BLOCK_CONTENTS),!h.collapsed){o=new CKEDITOR.dom.walker(h.clone());var u=CKEDITOR.dom.walker.bookmark(!0,!0);o.evaluator=u,this._.nextNode=o.next(),o=new CKEDITOR.dom.walker(h.clone()),o.evaluator=u,o=o.previous(),this._.lastNode=o.getNextSourceNode(!0),this._.lastNode&&this._.lastNode.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.trim(this._.lastNode.getText())&&this._.lastNode.getParent().isBlockBoundary()&&(u=this.range.clone(),u.moveToPosition(this._.lastNode,CKEDITOR.POSITION_AFTER_END),u.checkEndOfBlock()&&(u=new CKEDITOR.dom.elementPath(u.endContainer,u.root),this._.lastNode=(u.block||u.blockLimit).getNextSourceNode(!0))),this._.lastNode&&h.root.contains(this._.lastNode)||(this._.lastNode=this._.docEndMarker=h.document.createText(""),this._.lastNode.insertAfter(o)),h=null}this._.started=1,o=h}for(u=this._.nextNode,h=this._.lastNode,this._.nextNode=null;u;){var p=0,f=u.hasAscendant("pre"),m=u.type!=CKEDITOR.NODE_ELEMENT,g=0;if(m)u.type==CKEDITOR.NODE_TEXT&&a.test(u.getText())&&(m=0);else{var v=u.getName();if(CKEDITOR.dtd.$block[v]&&"false"==u.getAttribute("contenteditable")){i=u,n(this,t,i);break}if(u.isBlockBoundary(this.forceBrBreak&&!f&&{br:1})){if("br"==v)m=1;else if(!o&&!u.getChildCount()&&"hr"!=v){i=u,l=u.equals(h);break}o&&(o.setEndAt(u,CKEDITOR.POSITION_BEFORE_START),"br"!=v&&(this._.nextNode=u)),p=1}else{if(u.getFirst()){o||(o=this.range.clone(),o.setStartAt(u,CKEDITOR.POSITION_BEFORE_START)),u=u.getFirst();continue}m=1}}if(m&&!o&&(o=this.range.clone(),o.setStartAt(u,CKEDITOR.POSITION_BEFORE_START)),l=(!p||m)&&u.equals(h),o&&!p)for(;!u.getNext(s)&&!l;){if(v=u.getParent(),v.isBlockBoundary(this.forceBrBreak&&!f&&{br:1})){p=1,m=0,l||v.equals(h),o.setEndAt(v,CKEDITOR.POSITION_BEFORE_END);break}u=v,m=1,l=u.equals(h),g=1}if(m&&o.setEndAt(u,CKEDITOR.POSITION_AFTER_END),u=e(u,g,h),(l=!u)||p&&o)break}if(!i){if(!o)return this._.docEndMarker&&this._.docEndMarker.remove(),this._.nextNode=null;i=new CKEDITOR.dom.elementPath(o.startContainer,o.root),u=i.blockLimit,p={div:1,th:1,td:1},i=i.block,!i&&u&&!this.enforceRealBlocks&&p[u.getName()]&&o.checkStartOfBlock()&&o.checkEndOfBlock()&&!u.equals(o.root)?i=u:!i||this.enforceRealBlocks&&"li"==i.getName()?(i=this.range.document.createElement(t),o.extractContents().appendTo(i),i.trim(),o.insertNode(i),c=d=!0):"li"!=i.getName()?o.checkStartOfBlock()&&o.checkEndOfBlock()||(i=i.clone(!1),o.extractContents().appendTo(i),i.trim(),d=o.splitBlock(),c=!d.wasStartOfBlock,d=!d.wasEndOfBlock,o.insertNode(i)):l||(this._.nextNode=i.equals(h)?null:e(o.getBoundaryNodes().endNode,1,h))}return c&&(c=i.getPrevious())&&c.type==CKEDITOR.NODE_ELEMENT&&("br"==c.getName()?c.remove():c.getLast()&&"br"==c.getLast().$.nodeName.toLowerCase()&&c.getLast().remove()),d&&(c=i.getLast())&&c.type==CKEDITOR.NODE_ELEMENT&&"br"==c.getName()&&(!CKEDITOR.env.needsBrFiller||c.getPrevious(r)||c.getNext(r))&&c.remove(),this._.nextNode||(this._.nextNode=l||i.equals(h)||!h?null:e(i,1,h)),i}},CKEDITOR.dom.range.prototype.createIterator=function(){return new t(this)}}(),CKEDITOR.command=function(t,e){this.uiItems=[],this.exec=function(i){return this.state!=CKEDITOR.TRISTATE_DISABLED&&this.checkAllowed()?(this.editorFocus&&t.focus(),this.fire("exec")===!1?!0:e.exec.call(this,t,i)!==!1):!1},this.refresh=function(t,i){return!this.readOnly&&t.readOnly?!0:this.context&&!i.isContextFor(this.context)?(this.disable(),!0):this.checkAllowed(!0)?(this.startDisabled||this.enable(),this.modes&&!this.modes[t.mode]&&this.disable(),this.fire("refresh",{editor:t,path:i})===!1?!0:e.refresh&&e.refresh.apply(this,arguments)!==!1):(this.disable(),!0)};var i;this.checkAllowed=function(e){return e||"boolean"!=typeof i?i=t.activeFilter.checkFeature(this):i
},CKEDITOR.tools.extend(this,e,{modes:{wysiwyg:1},editorFocus:1,contextSensitive:!!e.context,state:CKEDITOR.TRISTATE_DISABLED}),CKEDITOR.event.call(this)},CKEDITOR.command.prototype={enable:function(){this.state==CKEDITOR.TRISTATE_DISABLED&&this.checkAllowed()&&this.setState(this.preserveState&&"undefined"!=typeof this.previousState?this.previousState:CKEDITOR.TRISTATE_OFF)},disable:function(){this.setState(CKEDITOR.TRISTATE_DISABLED)},setState:function(t){return this.state==t||t!=CKEDITOR.TRISTATE_DISABLED&&!this.checkAllowed()?!1:(this.previousState=this.state,this.state=t,this.fire("state"),!0)},toggleState:function(){this.state==CKEDITOR.TRISTATE_OFF?this.setState(CKEDITOR.TRISTATE_ON):this.state==CKEDITOR.TRISTATE_ON&&this.setState(CKEDITOR.TRISTATE_OFF)}},CKEDITOR.event.implementOn(CKEDITOR.command.prototype),CKEDITOR.ENTER_P=1,CKEDITOR.ENTER_BR=2,CKEDITOR.ENTER_DIV=3,CKEDITOR.config={customConfig:"config.js",autoUpdateElement:!0,language:"",defaultLanguage:"en",contentsLangDirection:"",enterMode:CKEDITOR.ENTER_P,forceEnterMode:!1,shiftEnterMode:CKEDITOR.ENTER_BR,docType:"<!DOCTYPE html>",bodyId:"",bodyClass:"",fullPage:!1,height:200,extraPlugins:"",removePlugins:"",protectedSource:[],tabIndex:0,width:"",baseFloatZIndex:1e4,blockedKeystrokes:[CKEDITOR.CTRL+66,CKEDITOR.CTRL+73,CKEDITOR.CTRL+85,CKEDITOR.CTRL+89,CKEDITOR.CTRL+90,CKEDITOR.CTRL+CKEDITOR.SHIFT+90]},function(){function t(t,i,n,r,o){var s=i.name;if((r||"function"!=typeof t.elements||t.elements(s))&&(!t.match||t.match(i))){if(r=!o){t:if(t.nothingRequired)r=!0;else{if(o=t.requiredClasses)for(s=i.classes,r=0;r<o.length;++r)if(-1==CKEDITOR.tools.indexOf(s,o[r])){r=!1;break t}r=a(i.styles,t.requiredStyles)&&a(i.attributes,t.requiredAttributes)}r=!r}if(!r&&(t.propertiesOnly||(n.valid=!0),n.allAttributes||(n.allAttributes=e(t.attributes,i.attributes,n.validAttributes)),n.allStyles||(n.allStyles=e(t.styles,i.styles,n.validStyles)),!n.allClasses)){if(t=t.classes,i=i.classes,r=n.validClasses,t)if(t===!0)i=!0;else{for(var l,o=0,s=i.length;s>o;++o)l=i[o],r[l]||(r[l]=t(l));i=!1}else i=!1;n.allClasses=i}}}function e(t,e,i){if(!t)return!1;if(t===!0)return!0;for(var n in e)i[n]||(i[n]=t(n,e[n]));return!1}function i(t,e){if(!t)return!1;if(t===!0)return t;if("string"==typeof t)return t=y(t),"*"==t?!0:CKEDITOR.tools.convertArrayToObject(t.split(e));if(CKEDITOR.tools.isArray(t))return t.length?CKEDITOR.tools.convertArrayToObject(t):!1;var i,n={},a=0;for(i in t)n[i]=t[i],a++;return a?n:!1}function n(e){if(e._.filterFunction)return e._.filterFunction;var i=/^cke:(object|embed|param)$/,n=/^(object|embed|param)$/;return e._.filterFunction=function(a,r,o,s,h,u,p){var f,g=a.name,v=!1;if(h&&(a.name=g=g.replace(i,"$1")),o=o&&o[g]){for(l(a),g=0;g<o.length;++g)m(e,a,o[g]);c(a)}if(r){var g=a.name,o=r.elements[g],C=r.generic,r={valid:!1,validAttributes:{},validClasses:{},validStyles:{},allAttributes:!1,allClasses:!1,allStyles:!1};if(!o&&!C)return s.push(a),!0;if(l(a),o)for(g=0,f=o.length;f>g;++g)t(o[g],a,r,!0,u);if(C)for(g=0,f=C.length;f>g;++g)t(C[g],a,r,!1,u);if(!r.valid)return s.push(a),!0;u=r.validAttributes,g=r.validStyles,o=r.validClasses,f=a.attributes;var I,b,C=a.styles,E=f["class"],y=f.style,T=[],R=[],w=/^data-cke-/,O=!1;if(delete f.style,delete f["class"],!r.allAttributes)for(I in f)u[I]||(w.test(I)?I==(b=I.replace(/^data-cke-saved-/,""))||u[b]||(delete f[I],O=!0):(delete f[I],O=!0));if(r.allStyles)y&&(f.style=y);else{for(I in C)g[I]?T.push(I+":"+C[I]):O=!0;T.length&&(f.style=T.sort().join("; "))}if(r.allClasses)E&&(f["class"]=E);else{for(I in o)o[I]&&R.push(I);R.length&&(f["class"]=R.sort().join(" ")),E&&R.length<E.split(/\s+/).length&&(O=!0)}if(O&&(v=!0),!p&&!d(a))return s.push(a),!0}return h&&(a.name=a.name.replace(n,"cke:$1")),v}}function a(t,e){if(!e)return!0;for(var i=0;i<e.length;++i)if(!(e[i]in t))return!1;return!0}function r(t){if(!t)return{};for(var t=t.split(/\s*,\s*/).sort(),e={};t.length;)e[t.shift()]=T;return e}function o(t){for(var e,i,n,a,r={},o=1,t=y(t);e=t.match(_);)(i=e[2])?(n=s(i,"styles"),a=s(i,"attrs"),i=s(i,"classes")):n=a=i=null,r["$"+o++]={elements:e[1],classes:i,styles:n,attributes:a},t=t.slice(e[0].length);return r}function s(t,e){var i=t.match(D[e]);return i?y(i[1]):null}function l(t){t.styles||(t.styles=CKEDITOR.tools.parseCssText(t.attributes.style||"",1)),t.classes||(t.classes=t.attributes["class"]?t.attributes["class"].split(/\s+/):[])}function c(t){var e,i=t.attributes;delete i.style,delete i["class"],(e=CKEDITOR.tools.writeCssText(t.styles,!0))&&(i.style=e),t.classes.length&&(i["class"]=t.classes.sort().join(" "))}function d(t){switch(t.name){case"a":if(!t.children.length&&!t.attributes.name)return!1;break;case"img":if(!t.attributes.src)return!1}return!0}function h(t){return t?t===!0?!0:function(e){return e in t}:!1}function u(){return new CKEDITOR.htmlParser.element("br")}function p(t){return t.type==CKEDITOR.NODE_ELEMENT&&("br"==t.name||b.$block[t.name])}function f(t,e,i){var n=t.name;if(b.$empty[n]||!t.children.length)"hr"==n&&"br"==e?t.replaceWith(u()):(t.parent&&i.push({check:"it",el:t.parent}),t.remove());else if(b.$block[n]||"tr"==n)if("br"==e)t.previous&&!p(t.previous)&&(e=u(),e.insertBefore(t)),t.next&&!p(t.next)&&(e=u(),e.insertAfter(t)),t.replaceWithChildren();else{var a,n=t.children;t:{a=b[e];for(var r,o=0,s=n.length;s>o;++o)if(r=n[o],r.type==CKEDITOR.NODE_ELEMENT&&!a[r.name]){a=!1;break t}a=!0}if(a)t.name=e,t.attributes={},i.push({check:"parent-down",el:t});else{a=t.parent;for(var l,o=a.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT||"body"==a.name,s=n.length;s>0;)r=n[--s],o&&(r.type==CKEDITOR.NODE_TEXT||r.type==CKEDITOR.NODE_ELEMENT&&b.$inline[r.name])?(l||(l=new CKEDITOR.htmlParser.element(e),l.insertAfter(t),i.push({check:"parent-down",el:l})),l.add(r,0)):(l=null,r.insertAfter(t),a.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT&&r.type==CKEDITOR.NODE_ELEMENT&&!b[a.name][r.name]&&i.push({check:"el-up",el:r}));t.remove()}}else"style"==n?t.remove():(t.parent&&i.push({check:"it",el:t.parent}),t.replaceWithChildren())}function m(t,e,i){var n,a;for(n=0;n<i.length;++n)if(a=i[n],!(a.check&&!t.check(a.check,!1)||a.left&&!a.left(e))){a.right(e,x);break}}function g(t,e){var i,n,a,r,o=e.getDefinition(),s=o.attributes,l=o.styles;if(t.name!=o.element)return!1;for(i in s)if("class"==i){for(o=s[i].split(/\s+/),a=t.classes.join("|");r=o.pop();)if(-1==a.indexOf(r))return!1}else if(t.attributes[i]!=s[i])return!1;for(n in l)if(t.styles[n]!=l[n])return!1;return!0}function v(t,e){var i,n;return"string"==typeof t?i=t:t instanceof CKEDITOR.style?n=t:(i=t[0],n=t[1]),[{element:i,left:n,right:function(t,i){i.transform(t,e)}}]}function C(t){return function(e){return g(e,t)}}function I(t){return function(e,i){i[t](e)}}var b=CKEDITOR.dtd,E=CKEDITOR.tools.copy,y=CKEDITOR.tools.trim,T="cke-test",R=["","p","br","div"];CKEDITOR.filter=function(t){if(this.allowedContent=[],this.disabled=!1,this.editor=null,this.id=CKEDITOR.tools.getNextNumber(),this._={rules:{},transformations:{},cachedTests:{}},CKEDITOR.filter.instances[this.id]=this,t instanceof CKEDITOR.editor){t=this.editor=t,this.customConfig=!0;var e=t.config.allowedContent;e===!0?this.disabled=!0:(e||(this.customConfig=!1),this.allow(e,"config",1),this.allow(t.config.extraAllowedContent,"extra",1),this.allow(R[t.enterMode]+" "+R[t.shiftEnterMode],"default",1))}else this.customConfig=!1,this.allow(t,"default",1)},CKEDITOR.filter.instances={},CKEDITOR.filter.prototype={allow:function(t,e,n){if(this.disabled||this.customConfig&&!n||!t)return!1;this._.cachedChecks={};var a,r;if("string"==typeof t)t=o(t);else if(t instanceof CKEDITOR.style)r=t.getDefinition(),n={},t=r.attributes,n[r.element]=r={styles:r.styles,requiredStyles:r.styles&&CKEDITOR.tools.objectKeys(r.styles)},t&&(t=E(t),r.classes=t["class"]?t["class"].split(/\s+/):null,r.requiredClasses=r.classes,delete t["class"],r.attributes=t,r.requiredAttributes=t&&CKEDITOR.tools.objectKeys(t)),t=n;else if(CKEDITOR.tools.isArray(t)){for(a=0;a<t.length;++a)r=this.allow(t[a],e,n);return r}var s,n=[];for(s in t){r=t[s],r="boolean"==typeof r?{}:"function"==typeof r?{match:r}:E(r),"$"!=s.charAt(0)&&(r.elements=s),e&&(r.featureName=e.toLowerCase());var l=r;l.elements=i(l.elements,/\s+/)||null,l.propertiesOnly=l.propertiesOnly||l.elements===!0;var c=/\s*,\s*/,d=void 0;for(d in w){l[d]=i(l[d],c)||null;var u=l,p=O[d],f=i(l[O[d]],c),m=l[d],g=[],v=!0,C=void 0;f?v=!1:f={};for(C in m)"!"==C.charAt(0)&&(C=C.slice(1),g.push(C),f[C]=!0,v=!1);for(;C=g.pop();)m[C]=m["!"+C],delete m["!"+C];u[p]=(v?!1:f)||null}l.match=l.match||null,this.allowedContent.push(r),n.push(r)}for(e=this._.rules,s=e.elements||{},t=e.generic||[],r=0,l=n.length;l>r;++r){c=E(n[r]),d=c.classes===!0||c.styles===!0||c.attributes===!0,u=c,p=void 0;for(p in w)u[p]=h(u[p]);f=!0;for(p in O)p=O[p],u[p]=CKEDITOR.tools.objectKeys(u[p]),u[p]&&(f=!1);if(u.nothingRequired=f,c.elements===!0||null===c.elements)c.elements=h(c.elements),t[d?"unshift":"push"](c);else{u=c.elements,delete c.elements;for(a in u)s[a]?s[a][d?"unshift":"push"](c):s[a]=[c]}}return e.elements=s,e.generic=t.length?t:null,!0},applyTo:function(t,e,i,a){if(this.disabled)return!1;var r=[],o=!i&&this._.rules,s=this._.transformations,l=n(this),c=this.editor&&this.editor.config.protectedSource,h=!1;t.forEach(function(t){if(t.type==CKEDITOR.NODE_ELEMENT){if("off"==t.attributes["data-cke-filter"])return!1;e&&"span"==t.name&&~CKEDITOR.tools.objectKeys(t.attributes).join("|").indexOf("data-cke-")||l(t,o,s,r,e)&&(h=!0)}else if(t.type==CKEDITOR.NODE_COMMENT&&t.value.match(/^\{cke_protected\}(?!\{C\})/)){var i;t:{var n=decodeURIComponent(t.value.replace(/^\{cke_protected\}/,""));i=[];var a,d,u;if(c)for(d=0;d<c.length;++d)if((u=n.match(c[d]))&&u[0].length==n.length){i=!0;break t}n=CKEDITOR.htmlParser.fragment.fromHtml(n),1==n.children.length&&(a=n.children[0]).type==CKEDITOR.NODE_ELEMENT&&l(a,o,s,i,e),i=!i.length}i||r.push(t)}},null,!0),r.length&&(h=!0);for(var u,t=[],a=R[a||(this.editor?this.editor.enterMode:CKEDITOR.ENTER_P)];i=r.pop();)i.type==CKEDITOR.NODE_ELEMENT?f(i,a,t):i.remove();for(;u=t.pop();)if(i=u.el,i.parent)switch(u.check){case"it":b.$removeEmpty[i.name]&&!i.children.length?f(i,a,t):d(i)||f(i,a,t);break;case"el-up":i.parent.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT&&!b[i.parent.name][i.name]&&f(i,a,t);break;case"parent-down":i.parent.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT&&!b[i.parent.name][i.name]&&f(i.parent,a,t)}return h},checkFeature:function(t){return this.disabled||!t?!0:(t.toFeature&&(t=t.toFeature(this.editor)),!t.requiredContent||this.check(t.requiredContent))},disable:function(){this.disabled=!0},addContentForms:function(t){if(!this.disabled&&t){var e,i,n,a=[];for(e=0;e<t.length&&!n;++e)i=t[e],("string"==typeof i||i instanceof CKEDITOR.style)&&this.check(i)&&(n=i);if(n){for(e=0;e<t.length;++e)a.push(v(t[e],n));this.addTransformations(a)}}},addFeature:function(t){return this.disabled||!t?!0:(t.toFeature&&(t=t.toFeature(this.editor)),this.allow(t.allowedContent,t.name),this.addTransformations(t.contentTransformations),this.addContentForms(t.contentForms),this.customConfig&&t.requiredContent?this.check(t.requiredContent):!0)},addTransformations:function(t){var e,i;if(!this.disabled&&t){var n,a=this._.transformations;for(n=0;n<t.length;++n){e=t[n];var r=void 0,o=void 0,s=void 0,l=void 0,c=void 0,d=void 0;for(i=[],o=0;o<e.length;++o)s=e[o],"string"==typeof s?(s=s.split(/\s*:\s*/),l=s[0],c=null,d=s[1]):(l=s.check,c=s.left,d=s.right),r||(r=s,r=r.element?r.element:l?l.match(/^([a-z0-9]+)/i)[0]:r.left.getDefinition().element),c instanceof CKEDITOR.style&&(c=C(c)),i.push({check:l==r?null:l,left:c,right:"string"==typeof d?I(d):d});e=r,a[e]||(a[e]=[]),a[e].push(i)}}},check:function(t,e,i){if(this.disabled)return!0;if(CKEDITOR.tools.isArray(t)){for(var a=t.length;a--;)if(this.check(t[a],e,i))return!0;return!1}var s,l;if("string"==typeof t){if(l=t+"<"+(e===!1?"0":"1")+(i?"1":"0")+">",l in this._.cachedChecks)return this._.cachedChecks[l];a=o(t).$1,s=a.styles;var d=a.classes;a.name=a.elements,a.classes=d=d?d.split(/\s*,\s*/):[],a.styles=r(s),a.attributes=r(a.attributes),a.children=[],d.length&&(a.attributes["class"]=d.join(" ")),s&&(a.attributes.style=CKEDITOR.tools.writeCssText(a.styles)),s=a}else a=t.getDefinition(),s=a.styles,d=a.attributes||{},s?(s=E(s),d.style=CKEDITOR.tools.writeCssText(s,!0)):s={},s={name:a.element,attributes:d,classes:d["class"]?d["class"].split(/\s+/):[],styles:s,children:[]};var h,d=CKEDITOR.tools.clone(s),u=[];if(e!==!1&&(h=this._.transformations[s.name])){for(a=0;a<h.length;++a)m(this,s,h[a]);c(s)}return n(this)(d,this._.rules,e===!1?!1:this._.transformations,u,!1,!i,!i),e=u.length>0?!1:CKEDITOR.tools.objectCompare(s.attributes,d.attributes,!0)?!0:!1,"string"==typeof t&&(this._.cachedChecks[l]=e),e},getAllowedEnterMode:function(){var t=["p","div","br"],e={p:CKEDITOR.ENTER_P,div:CKEDITOR.ENTER_DIV,br:CKEDITOR.ENTER_BR};return function(i,n){var a,r=t.slice();if(this.check(R[i]))return i;for(n||(r=r.reverse());a=r.pop();)if(this.check(a))return e[a];return CKEDITOR.ENTER_BR}}()};var w={styles:1,attributes:1,classes:1},O={styles:"requiredStyles",attributes:"requiredAttributes",classes:"requiredClasses"},_=/^([a-z0-9*\s]+)((?:\s*\{[!\w\-,\s\*]+\}\s*|\s*\[[!\w\-,\s\*]+\]\s*|\s*\([!\w\-,\s\*]+\)\s*){0,3})(?:;\s*|$)/i,D={styles:/{([^}]+)}/,attrs:/\[([^\]]+)\]/,classes:/\(([^\)]+)\)/},x=CKEDITOR.filter.transformationsTools={sizeToStyle:function(t){this.lengthToStyle(t,"width"),this.lengthToStyle(t,"height")},sizeToAttribute:function(t){this.lengthToAttribute(t,"width"),this.lengthToAttribute(t,"height")},lengthToStyle:function(t,e,i){if(i=i||e,!(i in t.styles)){var n=t.attributes[e];n&&(/^\d+$/.test(n)&&(n+="px"),t.styles[i]=n)}delete t.attributes[e]},lengthToAttribute:function(t,e,i){if(i=i||e,!(i in t.attributes)){var n=t.styles[e],a=n&&n.match(/^(\d+)(?:\.\d*)?px$/);a?t.attributes[i]=a[1]:n==T&&(t.attributes[i]=T)}delete t.styles[e]},alignmentToStyle:function(t){if(!("float"in t.styles)){var e=t.attributes.align;("left"==e||"right"==e)&&(t.styles["float"]=e)}delete t.attributes.align},alignmentToAttribute:function(t){if(!("align"in t.attributes)){var e=t.styles["float"];("left"==e||"right"==e)&&(t.attributes.align=e)}delete t.styles["float"]},matchesStyle:g,transform:function(t,e){if("string"==typeof e)t.name=e;else{var i,n,a,r,o=e.getDefinition(),s=o.styles,l=o.attributes;t.name=o.element;for(i in l)if("class"==i)for(o=t.classes.join("|"),a=l[i].split(/\s+/);r=a.pop();)-1==o.indexOf(r)&&t.classes.push(r);else t.attributes[i]=l[i];for(n in s)t.styles[n]=s[n]}}}}(),function(){CKEDITOR.focusManager=function(t){return t.focusManager?t.focusManager:(this.hasFocus=!1,this.currentActive=null,this._={editor:t},this)},CKEDITOR.focusManager._={blurDelay:200},CKEDITOR.focusManager.prototype={focus:function(t){this._.timer&&clearTimeout(this._.timer),t&&(this.currentActive=t),this.hasFocus||this._.locked||((t=CKEDITOR.currentInstance)&&t.focusManager.blur(1),this.hasFocus=!0,(t=this._.editor.container)&&t.addClass("cke_focus"),this._.editor.fire("focus"))},lock:function(){this._.locked=1},unlock:function(){delete this._.locked},blur:function(t){function e(){if(this.hasFocus){this.hasFocus=!1;var t=this._.editor.container;t&&t.removeClass("cke_focus"),this._.editor.fire("blur")}}if(!this._.locked){this._.timer&&clearTimeout(this._.timer);var i=CKEDITOR.focusManager._.blurDelay;t||!i?e.call(this):this._.timer=CKEDITOR.tools.setTimeout(function(){delete this._.timer,e.call(this)},i,this)}},add:function(t,e){var i=t.getCustomData("focusmanager");if(!i||i!=this){i&&i.remove(t);var i="focus",n="blur";e&&(CKEDITOR.env.ie?(i="focusin",n="focusout"):CKEDITOR.event.useCapture=1);var a={blur:function(){t.equals(this.currentActive)&&this.blur()},focus:function(){this.focus(t)}};t.on(i,a.focus,this),t.on(n,a.blur,this),e&&(CKEDITOR.event.useCapture=0),t.setCustomData("focusmanager",this),t.setCustomData("focusmanager_handlers",a)}},remove:function(t){t.removeCustomData("focusmanager");var e=t.removeCustomData("focusmanager_handlers");t.removeListener("blur",e.blur),t.removeListener("focus",e.focus)}}}(),CKEDITOR.keystrokeHandler=function(t){return t.keystrokeHandler?t.keystrokeHandler:(this.keystrokes={},this.blockedKeystrokes={},this._={editor:t},this)},function(){var t,e=function(e){var e=e.data,i=e.getKeystroke(),n=this.keystrokes[i],a=this._.editor;return t=a.fire("key",{keyCode:i})===!1,t||(n&&(t=a.execCommand(n,{from:"keystrokeHandler"})!==!1),t||(t=!!this.blockedKeystrokes[i])),t&&e.preventDefault(!0),!t},i=function(e){t&&(t=!1,e.data.preventDefault(!0))};CKEDITOR.keystrokeHandler.prototype={attach:function(t){t.on("keydown",e,this),(CKEDITOR.env.opera||CKEDITOR.env.gecko&&CKEDITOR.env.mac)&&t.on("keypress",i,this)}}}(),function(){CKEDITOR.lang={languages:{af:1,ar:1,bg:1,bn:1,bs:1,ca:1,cs:1,cy:1,da:1,de:1,el:1,"en-au":1,"en-ca":1,"en-gb":1,en:1,eo:1,es:1,et:1,eu:1,fa:1,fi:1,fo:1,"fr-ca":1,fr:1,gl:1,gu:1,he:1,hi:1,hr:1,hu:1,id:1,is:1,it:1,ja:1,ka:1,km:1,ko:1,ku:1,lt:1,lv:1,mk:1,mn:1,ms:1,nb:1,nl:1,no:1,pl:1,"pt-br":1,pt:1,ro:1,ru:1,si:1,sk:1,sl:1,sq:1,"sr-latn":1,sr:1,sv:1,th:1,tr:1,ug:1,uk:1,vi:1,"zh-cn":1,zh:1},rtl:{ar:1,fa:1,he:1,ku:1,ug:1},load:function(t,e,i){t&&CKEDITOR.lang.languages[t]||(t=this.detect(e,t)),this[t]?i(t,this[t]):CKEDITOR.scriptLoader.load(CKEDITOR.getUrl("lang/"+t+".js"),function(){this[t].dir=this.rtl[t]?"rtl":"ltr",i(t,this[t])},this)},detect:function(t,e){var i=this.languages,e=e||navigator.userLanguage||navigator.language||t,n=e.toLowerCase().match(/([a-z]+)(?:-([a-z]+))?/),a=n[1],n=n[2];return i[a+"-"+n]?a=a+"-"+n:i[a]||(a=null),CKEDITOR.lang.detect=a?function(){return a}:function(t){return t},a||t}}}(),CKEDITOR.scriptLoader=function(){var t={},e={};return{load:function(i,n,a,r){var o="string"==typeof i;o&&(i=[i]),a||(a=CKEDITOR);var s=i.length,l=[],c=[],d=function(t){n&&(o?n.call(a,t):n.call(a,l,c))};if(0===s)d(!0);else{var h=function(t,e){(e?l:c).push(t),--s<=0&&(r&&CKEDITOR.document.getDocumentElement().removeStyle("cursor"),d(e))},u=function(i,n){t[i]=1;var a=e[i];delete e[i];for(var r=0;r<a.length;r++)a[r](i,n)},p=function(i){if(t[i])h(i,!0);else{var a=e[i]||(e[i]=[]);if(a.push(h),!(a.length>1)){var r=new CKEDITOR.dom.element("script");r.setAttributes({type:"text/javascript",src:i}),n&&(CKEDITOR.env.ie&&CKEDITOR.env.version<11?r.$.onreadystatechange=function(){("loaded"==r.$.readyState||"complete"==r.$.readyState)&&(r.$.onreadystatechange=null,u(i,!0))}:(r.$.onload=function(){setTimeout(function(){u(i,!0)},0)},r.$.onerror=function(){u(i,!1)})),r.appendTo(CKEDITOR.document.getHead())}}};r&&CKEDITOR.document.getDocumentElement().setStyle("cursor","wait");for(var f=0;s>f;f++)p(i[f])}},queue:function(){function t(){var t;(t=e[0])&&this.load(t.scriptUrl,t.callback,CKEDITOR,0)}var e=[];return function(i,n){var a=this;e.push({scriptUrl:i,callback:function(){n&&n.apply(this,arguments),e.shift(),t.call(a)}}),1==e.length&&t.call(this)}}()}}(),CKEDITOR.resourceManager=function(t,e){this.basePath=t,this.fileName=e,this.registered={},this.loaded={},this.externals={},this._={waitingList:{}}},CKEDITOR.resourceManager.prototype={add:function(t,e){if(this.registered[t])throw'[CKEDITOR.resourceManager.add] The resource name "'+t+'" is already registered.';var i=this.registered[t]=e||{};return i.name=t,i.path=this.getPath(t),CKEDITOR.fire(t+CKEDITOR.tools.capitalize(this.fileName)+"Ready",i),this.get(t)},get:function(t){return this.registered[t]||null},getPath:function(t){var e=this.externals[t];return CKEDITOR.getUrl(e&&e.dir||this.basePath+t+"/")},getFilePath:function(t){var e=this.externals[t];return CKEDITOR.getUrl(this.getPath(t)+(e?e.file:this.fileName+".js"))},addExternal:function(t,e,i){for(var t=t.split(","),n=0;n<t.length;n++){var a=t[n];i||(e=e.replace(/[^\/]+$/,function(t){return i=t,""})),this.externals[a]={dir:e,file:i||this.fileName+".js"}}},load:function(t,e,i){CKEDITOR.tools.isArray(t)||(t=t?[t]:[]);for(var n=this.loaded,a=this.registered,r=[],o={},s={},l=0;l<t.length;l++){var c=t[l];if(c)if(n[c]||a[c])s[c]=this.get(c);else{var d=this.getFilePath(c);r.push(d),d in o||(o[d]=[]),o[d].push(c)}}CKEDITOR.scriptLoader.load(r,function(t,a){if(a.length)throw'[CKEDITOR.resourceManager.load] Resource name "'+o[a[0]].join(",")+'" was not found at "'+a[0]+'".';for(var r=0;r<t.length;r++)for(var l=o[t[r]],c=0;c<l.length;c++){var d=l[c];s[d]=this.get(d),n[d]=1}e.call(i,s)},this)}},CKEDITOR.plugins=new CKEDITOR.resourceManager("plugins/","plugin"),CKEDITOR.plugins.load=CKEDITOR.tools.override(CKEDITOR.plugins.load,function(t){var e={};return function(i,n,a){var r={},o=function(i){t.call(this,i,function(t){CKEDITOR.tools.extend(r,t);var i,s=[];for(i in t){var l=t[i],c=l&&l.requires;if(!e[i]){if(l.icons)for(var d=l.icons.split(","),h=d.length;h--;)CKEDITOR.skin.addIcon(d[h],l.path+"icons/"+(CKEDITOR.env.hidpi&&l.hidpi?"hidpi/":"")+d[h]+".png");e[i]=1}if(c)for(c.split&&(c=c.split(",")),l=0;l<c.length;l++)r[c[l]]||s.push(c[l])}if(s.length)o.call(this,s);else{for(i in r)l=r[i],l.onLoad&&!l.onLoad._called&&(l.onLoad()===!1&&delete r[i],l.onLoad._called=1);n&&n.call(a||window,r)}},this)};o.call(this,i)}}),CKEDITOR.plugins.setLang=function(t,e,i){var n=this.get(t),t=n.langEntries||(n.langEntries={}),n=n.lang||(n.lang=[]);n.split&&(n=n.split(",")),-1==CKEDITOR.tools.indexOf(n,e)&&n.push(e),t[e]=i},CKEDITOR.ui=function(t){return t.ui?t.ui:(this.items={},this.instances={},this.editor=t,this._={handlers:{}},this)},CKEDITOR.ui.prototype={add:function(t,e,i){i.name=t.toLowerCase();var n=this.items[t]={type:e,command:i.command||null,args:Array.prototype.slice.call(arguments,2)};CKEDITOR.tools.extend(n,i)},get:function(t){return this.instances[t]},create:function(t){var e=this.items[t],i=e&&this._.handlers[e.type],n=e&&e.command&&this.editor.getCommand(e.command),i=i&&i.create.apply(this,e.args);return this.instances[t]=i,n&&n.uiItems.push(i),i&&!i.type&&(i.type=e.type),i},addHandler:function(t,e){this._.handlers[t]=e},space:function(t){return CKEDITOR.document.getById(this.spaceId(t))},spaceId:function(t){return this.editor.id+"_"+t}},CKEDITOR.event.implementOn(CKEDITOR.ui),function(){function t(t,n,r){if(CKEDITOR.event.call(this),t=t&&CKEDITOR.tools.clone(t),void 0!==n){if(!(n instanceof CKEDITOR.dom.element))throw Error("Expect element of type CKEDITOR.dom.element.");if(!r)throw Error("One of the element modes must be specified.");if(CKEDITOR.env.ie&&CKEDITOR.env.quirks&&r==CKEDITOR.ELEMENT_MODE_INLINE)throw Error("Inline element mode is not supported on IE quirks.");if(!(r==CKEDITOR.ELEMENT_MODE_INLINE?n.is(CKEDITOR.dtd.$editable)||n.is("textarea"):r==CKEDITOR.ELEMENT_MODE_REPLACE?!n.is(CKEDITOR.dtd.$nonBodyContent):1))throw Error('The specified element mode is not supported on element: "'+n.getName()+'".');this.element=n,this.elementMode=r,this.name=this.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO&&(n.getId()||n.getNameAtt())}else this.elementMode=CKEDITOR.ELEMENT_MODE_NONE;this._={},this.commands={},this.templates={},this.name=this.name||e(),this.id=CKEDITOR.tools.getNextId(),this.status="unloaded",this.config=CKEDITOR.tools.prototypedCopy(CKEDITOR.config),this.ui=new CKEDITOR.ui(this),this.focusManager=new CKEDITOR.focusManager(this),this.keystrokeHandler=new CKEDITOR.keystrokeHandler(this),this.on("readOnly",i),this.on("selectionChange",function(t){a(this,t.data.path)}),this.on("activeFilterChange",function(){a(this,this.elementPath(),!0)}),this.on("mode",i),this.on("instanceReady",function(){this.config.startupFocus&&this.focus()}),CKEDITOR.fire("instanceCreated",null,this),CKEDITOR.add(this),CKEDITOR.tools.setTimeout(function(){o(this,t)},0,this)}function e(){do var t="editor"+ ++u;while(CKEDITOR.instances[t]);return t}function i(){var t,e=this.commands;for(t in e)n(this,e[t])}function n(t,e){e[e.startDisabled?"disable":t.readOnly&&!e.readOnly?"disable":e.modes[t.mode]?"enable":"disable"]()}function a(t,e,i){if(e){var n,a,r=t.commands;for(a in r)n=r[a],(i||n.contextSensitive)&&n.refresh(t,e)}}function r(t){var e=t.config.customConfig;if(!e)return!1;var e=CKEDITOR.getUrl(e),i=p[e]||(p[e]={});return i.fn?(i.fn.call(t,t.config),(CKEDITOR.getUrl(t.config.customConfig)==e||!r(t))&&t.fireOnce("customConfigLoaded")):CKEDITOR.scriptLoader.queue(e,function(){i.fn=CKEDITOR.editorConfig?CKEDITOR.editorConfig:function(){},r(t)}),!0}function o(t,e){t.on("customConfigLoaded",function(){if(e){if(e.on)for(var i in e.on)t.on(i,e.on[i]);CKEDITOR.tools.extend(t.config,e,!0),delete t.config.on}i=t.config,t.readOnly=!(!i.readOnly&&!(t.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?t.element.is("textarea")?t.element.hasAttribute("disabled"):t.element.isReadOnly():t.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE&&t.element.hasAttribute("disabled"))),t.blockless=t.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?!(t.element.is("textarea")||CKEDITOR.dtd[t.element.getName()].p):!1,t.tabIndex=i.tabIndex||t.element&&t.element.getAttribute("tabindex")||0,t.activeEnterMode=t.enterMode=t.blockless?CKEDITOR.ENTER_BR:i.enterMode,t.activeShiftEnterMode=t.shiftEnterMode=t.blockless?CKEDITOR.ENTER_BR:i.shiftEnterMode,i.skin&&(CKEDITOR.skinName=i.skin),t.fireOnce("configLoaded"),t.dataProcessor=new CKEDITOR.htmlDataProcessor(t),t.filter=t.activeFilter=new CKEDITOR.filter(t),s(t)}),e&&void 0!=e.customConfig&&(t.config.customConfig=e.customConfig),r(t)||t.fireOnce("customConfigLoaded")}function s(t){CKEDITOR.skin.loadPart("editor",function(){l(t)})}function l(t){CKEDITOR.lang.load(t.config.language,t.config.defaultLanguage,function(e,i){var n=t.config.title;t.langCode=e,t.lang=CKEDITOR.tools.prototypedCopy(i),t.title="string"==typeof n||n===!1?n:[t.lang.editor,t.name].join(", "),CKEDITOR.env.gecko&&CKEDITOR.env.version<10900&&"rtl"==t.lang.dir&&(t.lang.dir="ltr"),t.config.contentsLangDirection||(t.config.contentsLangDirection=t.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?t.element.getDirection(1):t.lang.dir),t.fire("langLoaded"),c(t)})}function c(t){t.getStylesSet(function(e){t.once("loaded",function(){t.fire("stylesSet",{styles:e})},null,null,1),d(t)})}function d(t){var e=t.config,i=e.plugins,n=e.extraPlugins,a=e.removePlugins;if(n)var r=RegExp("(?:^|,)(?:"+n.replace(/\s*,\s*/g,"|")+")(?=,|$)","g"),i=i.replace(r,""),i=i+(","+n);if(a)var o=RegExp("(?:^|,)(?:"+a.replace(/\s*,\s*/g,"|")+")(?=,|$)","g"),i=i.replace(o,"");CKEDITOR.env.air&&(i+=",adobeair"),CKEDITOR.plugins.load(i.split(","),function(i){var n=[],a=[],r=[];t.plugins=i;for(var s in i){var l,c=i[s],d=c.lang,h=null,u=c.requires;if(CKEDITOR.tools.isArray(u)&&(u=u.join(",")),u&&(l=u.match(o)))for(;u=l.pop();)CKEDITOR.tools.setTimeout(function(t,e){throw Error('Plugin "'+t.replace(",","")+'" cannot be removed from the plugins list, because it\'s required by "'+e+'" plugin.')},0,null,[u,s]);d&&!t.lang[s]&&(d.split&&(d=d.split(",")),CKEDITOR.tools.indexOf(d,t.langCode)>=0?h=t.langCode:(h=t.langCode.replace(/-.*/,""),h=h!=t.langCode&&CKEDITOR.tools.indexOf(d,h)>=0?h:CKEDITOR.tools.indexOf(d,"en")>=0?"en":d[0]),c.langEntries&&c.langEntries[h]?(t.lang[s]=c.langEntries[h],h=null):r.push(CKEDITOR.getUrl(c.path+"lang/"+h+".js"))),a.push(h),n.push(c)}CKEDITOR.scriptLoader.load(r,function(){for(var i=["beforeInit","init","afterInit"],r=0;r<i.length;r++)for(var o=0;o<n.length;o++){var s=n[o];0===r&&a[o]&&s.lang&&s.langEntries&&(t.lang[s.name]=s.langEntries[a[o]]),s[i[r]]&&s[i[r]](t)}for(t.fireOnce("pluginsLoaded"),e.keystrokes&&t.setKeystroke(t.config.keystrokes),o=0;o<t.config.blockedKeystrokes.length;o++)t.keystrokeHandler.blockedKeystrokes[t.config.blockedKeystrokes[o]]=1;t.status="loaded",t.fireOnce("loaded"),CKEDITOR.fire("instanceLoaded",null,t)})})}function h(){var t=this.element;if(t&&this.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO){var e=this.getData();return this.config.htmlEncodeOutput&&(e=CKEDITOR.tools.htmlEncode(e)),t.is("textarea")?t.setValue(e):t.setHtml(e),!0}return!1}t.prototype=CKEDITOR.editor.prototype,CKEDITOR.editor=t;var u=0,p={};CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{addCommand:function(t,e){e.name=t.toLowerCase();var i=new CKEDITOR.command(this,e);return this.mode&&n(this,i),this.commands[t]=i},_attachToForm:function(){var t=this,e=t.element,i=new CKEDITOR.dom.element(e.$.form);if(e.is("textarea")&&i){var n=function(i){t.updateElement(),t._.required&&!e.getValue()&&t.fire("required")===!1&&i.data.preventDefault()};i.on("submit",n),i.$.submit&&i.$.submit.call&&i.$.submit.apply&&(i.$.submit=CKEDITOR.tools.override(i.$.submit,function(t){return function(){n(),t.apply?t.apply(this):t()}})),t.on("destroy",function(){i.removeListener("submit",n)})}},destroy:function(t){this.fire("beforeDestroy"),!t&&h.call(this),this.editable(null),this.status="destroyed",this.fire("destroy"),this.removeAllListeners(),CKEDITOR.remove(this),CKEDITOR.fire("instanceDestroyed",null,this)},elementPath:function(t){if(!t){if(t=this.getSelection(),!t)return null;t=t.getStartElement()}return t?new CKEDITOR.dom.elementPath(t,this.editable()):null},createRange:function(){var t=this.editable();return t?new CKEDITOR.dom.range(t):null},execCommand:function(t,e){var i=this.getCommand(t),n={name:t,commandData:e,command:i};return i&&i.state!=CKEDITOR.TRISTATE_DISABLED&&this.fire("beforeCommandExec",n)!==!1&&(n.returnValue=i.exec(n.commandData),!i.async&&this.fire("afterCommandExec",n)!==!1)?n.returnValue:!1},getCommand:function(t){return this.commands[t]},getData:function(t){!t&&this.fire("beforeGetData");var e=this._.data;return"string"!=typeof e&&(e=(e=this.element)&&this.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE?e.is("textarea")?e.getValue():e.getHtml():""),e={dataValue:e},!t&&this.fire("getData",e),e.dataValue},getSnapshot:function(){var t=this.fire("getSnapshot");if("string"!=typeof t){var e=this.element;e&&this.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE&&(t=e.is("textarea")?e.getValue():e.getHtml())}return t},loadSnapshot:function(t){this.fire("loadSnapshot",t)},setData:function(t,e,i){e&&this.on("dataReady",function(t){t.removeListener(),e.call(t.editor)}),t={dataValue:t},!i&&this.fire("setData",t),this._.data=t.dataValue,!i&&this.fire("afterSetData",t)},setReadOnly:function(t){t=void 0==t||t,this.readOnly!=t&&(this.readOnly=t,this.keystrokeHandler.blockedKeystrokes[8]=+t,this.editable().setReadOnly(t),this.fire("readOnly"))},insertHtml:function(t,e){this.fire("insertHtml",{dataValue:t,mode:e})},insertText:function(t){this.fire("insertText",t)},insertElement:function(t){this.fire("insertElement",t)},focus:function(){this.fire("beforeFocus")},checkDirty:function(){return"ready"==this.status&&this._.previousValue!==this.getSnapshot()},resetDirty:function(){this._.previousValue=this.getSnapshot()},updateElement:function(){return h.call(this)},setKeystroke:function(){for(var t,e,i=this.keystrokeHandler.keystrokes,n=CKEDITOR.tools.isArray(arguments[0])?arguments[0]:[[].slice.call(arguments,0)],a=n.length;a--;)t=n[a],e=0,CKEDITOR.tools.isArray(t)&&(e=t[1],t=t[0]),e?i[t]=e:delete i[t]},addFeature:function(t){return this.filter.addFeature(t)},setActiveFilter:function(t){t||(t=this.filter),this.activeFilter!==t&&(this.activeFilter=t,this.fire("activeFilterChange"),t===this.filter?this.setActiveEnterMode(null,null):this.setActiveEnterMode(t.getAllowedEnterMode(this.enterMode),t.getAllowedEnterMode(this.shiftEnterMode,!0)))},setActiveEnterMode:function(t,e){t=t?this.blockless?CKEDITOR.ENTER_BR:t:this.enterMode,e=e?this.blockless?CKEDITOR.ENTER_BR:e:this.shiftEnterMode,(this.activeEnterMode!=t||this.activeShiftEnterMode!=e)&&(this.activeEnterMode=t,this.activeShiftEnterMode=e,this.fire("activeEnterModeChange"))}})}(),CKEDITOR.ELEMENT_MODE_NONE=0,CKEDITOR.ELEMENT_MODE_REPLACE=1,CKEDITOR.ELEMENT_MODE_APPENDTO=2,CKEDITOR.ELEMENT_MODE_INLINE=3,CKEDITOR.htmlParser=function(){this._={htmlPartsRegex:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)-->)|(?:([^\\s>]+)\\s*((?:(?:\"[^\"]*\")|(?:'[^']*')|[^\"'>])*)\\/?>))","g")}},function(){var t=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,e={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1};
CKEDITOR.htmlParser.prototype={onTagOpen:function(){},onTagClose:function(){},onText:function(){},onCDATA:function(){},onComment:function(){},parse:function(i){for(var n,a,r,o=0;n=this._.htmlPartsRegex.exec(i);)if(a=n.index,a>o&&(o=i.substring(o,a),r?r.push(o):this.onText(o)),o=this._.htmlPartsRegex.lastIndex,!(a=n[1])||(a=a.toLowerCase(),r&&CKEDITOR.dtd.$cdata[a]&&(this.onCDATA(r.join("")),r=null),r))if(r)r.push(n[0]);else if(a=n[3]){if(a=a.toLowerCase(),!/="/.test(a)){var s,l={};n=n[4];var c=!(!n||"/"!=n.charAt(n.length-1));if(n)for(;s=t.exec(n);){var d=s[1].toLowerCase();s=s[2]||s[3]||s[4]||"",l[d]=!s&&e[d]?d:CKEDITOR.tools.htmlDecodeAttr(s)}this.onTagOpen(a,l,c),!r&&CKEDITOR.dtd.$cdata[a]&&(r=[])}}else(a=n[2])&&this.onComment(a);else this.onTagClose(a);i.length>o&&this.onText(i.substring(o,i.length))}}}(),CKEDITOR.htmlParser.basicWriter=CKEDITOR.tools.createClass({$:function(){this._={output:[]}},proto:{openTag:function(t){this._.output.push("<",t)},openTagClose:function(t,e){this._.output.push(e?" />":">")},attribute:function(t,e){"string"==typeof e&&(e=CKEDITOR.tools.htmlEncodeAttr(e)),this._.output.push(" ",t,'="',e,'"')},closeTag:function(t){this._.output.push("</",t,">")},text:function(t){this._.output.push(t)},comment:function(t){this._.output.push("<!--",t,"-->")},write:function(t){this._.output.push(t)},reset:function(){this._.output=[],this._.indent=!1},getHtml:function(t){var e=this._.output.join("");return t&&this.reset(),e}}}),function(){CKEDITOR.htmlParser.node=function(){},CKEDITOR.htmlParser.node.prototype={remove:function(){var t=this.parent.children,e=CKEDITOR.tools.indexOf(t,this),i=this.previous,n=this.next;i&&(i.next=n),n&&(n.previous=i),t.splice(e,1),this.parent=null},replaceWith:function(t){var e=this.parent.children,i=CKEDITOR.tools.indexOf(e,this),n=t.previous=this.previous,a=t.next=this.next;n&&(n.next=t),a&&(a.previous=t),e[i]=t,t.parent=this.parent,this.parent=null},insertAfter:function(t){var e=t.parent.children,i=CKEDITOR.tools.indexOf(e,t),n=t.next;e.splice(i+1,0,this),this.next=t.next,this.previous=t,t.next=this,n&&(n.previous=this),this.parent=t.parent},insertBefore:function(t){var e=t.parent.children,i=CKEDITOR.tools.indexOf(e,t);e.splice(i,0,this),this.next=t,(this.previous=t.previous)&&(t.previous.next=this),t.previous=this,this.parent=t.parent},getAscendant:function(t){for(var e=("function"==typeof t?t:"string"==typeof t?function(e){return e.name==t}:function(e){return e.name in t}),i=this.parent;i&&i.type==CKEDITOR.NODE_ELEMENT;){if(e(i))return i;i=i.parent}return null},wrapWith:function(t){return this.replaceWith(t),t.add(this),t},getIndex:function(){return CKEDITOR.tools.indexOf(this.parent.children,this)},getFilterContext:function(t){return t||{}}}}(),CKEDITOR.htmlParser.comment=function(t){this.value=t,this._={isBlockLike:!1}},CKEDITOR.htmlParser.comment.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_COMMENT,filter:function(t,e){var i=this.value;return(i=t.onComment(e,i,this))?"string"!=typeof i?(this.replaceWith(i),!1):(this.value=i,!0):(this.remove(),!1)},writeHtml:function(t,e){e&&this.filter(e),t.comment(this.value)}}),function(){CKEDITOR.htmlParser.text=function(t){this.value=t,this._={isBlockLike:!1}},CKEDITOR.htmlParser.text.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_TEXT,filter:function(t,e){return(this.value=t.onText(e,this.value,this))?void 0:(this.remove(),!1)},writeHtml:function(t,e){e&&this.filter(e),t.text(this.value)}})}(),function(){CKEDITOR.htmlParser.cdata=function(t){this.value=t},CKEDITOR.htmlParser.cdata.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_TEXT,filter:function(){},writeHtml:function(t){t.write(this.value)}})}(),CKEDITOR.htmlParser.fragment=function(){this.children=[],this.parent=null,this._={isBlockLike:!0,hasInlineStarted:!1}},function(){function t(t){return t.attributes["data-cke-survive"]?!1:"a"==t.name&&t.attributes.href||CKEDITOR.dtd.$removeEmpty[t.name]}var e=CKEDITOR.tools.extend({table:1,ul:1,ol:1,dl:1},CKEDITOR.dtd.table,CKEDITOR.dtd.ul,CKEDITOR.dtd.ol,CKEDITOR.dtd.dl),i={ol:1,ul:1},n=CKEDITOR.tools.extend({},{html:1},CKEDITOR.dtd.html,CKEDITOR.dtd.body,CKEDITOR.dtd.head,{style:1,script:1}),a={ul:"li",ol:"li",dl:"dd",table:"tbody",tbody:"tr",thead:"tr",tfoot:"tr",tr:"td"};CKEDITOR.htmlParser.fragment.fromHtml=function(r,o,s){function l(t){var e;if(g.length>0)for(var i=0;i<g.length;i++){var n=g[i],a=n.name,r=CKEDITOR.dtd[a],o=C.name&&CKEDITOR.dtd[C.name];o&&!o[a]||t&&r&&!r[t]&&CKEDITOR.dtd[t]?a==C.name&&(h(C,C.parent,1),i--):(e||(c(),e=1),n=n.clone(),n.parent=C,C=n,g.splice(i,1),i--)}}function c(){for(;v.length;)h(v.shift(),C)}function d(t){if(t._.isBlockLike&&"pre"!=t.name&&"textarea"!=t.name){var e,i=t.children.length,n=t.children[i-1];n&&n.type==CKEDITOR.NODE_TEXT&&((e=CKEDITOR.tools.rtrim(n.value))?n.value=e:t.children.length=i-1)}}function h(e,i,n){var i=i||C||m,a=C;void 0===e.previous&&(u(i,e)&&(C=i,f.onTagOpen(s,{}),e.returnPoint=i=C),d(e),(!t(e)||e.children.length)&&i.add(e),"pre"==e.name&&(b=!1),"textarea"==e.name&&(I=!1)),e.returnPoint?(C=e.returnPoint,delete e.returnPoint):C=n?i:a}function u(t,e){if((t==m||"body"==t.name)&&s&&(!t.name||CKEDITOR.dtd[t.name][s])){var i,n;return(i=e.attributes&&(n=e.attributes["data-cke-real-element-type"])?n:e.name)&&i in CKEDITOR.dtd.$inline&&!(i in CKEDITOR.dtd.head)&&!e.isOrphan||e.type==CKEDITOR.NODE_TEXT}}function p(t,e){return t in CKEDITOR.dtd.$listItem||t in CKEDITOR.dtd.$tableContent?t==e||"dt"==t&&"dd"==e||"dd"==t&&"dt"==e:!1}var f=new CKEDITOR.htmlParser,m=o instanceof CKEDITOR.htmlParser.element?o:"string"==typeof o?new CKEDITOR.htmlParser.element(o):new CKEDITOR.htmlParser.fragment,g=[],v=[],C=m,I="textarea"==m.name,b="pre"==m.name;f.onTagOpen=function(a,r,o,s){if(r=new CKEDITOR.htmlParser.element(a,r),r.isUnknown&&o&&(r.isEmpty=!0),r.isOptionalClose=s,t(r))g.push(r);else{if("pre"==a)b=!0;else{if("br"==a&&b)return void C.add(new CKEDITOR.htmlParser.text("\n"));"textarea"==a&&(I=!0)}if("br"==a)v.push(r);else{for(;s=(o=C.name)?CKEDITOR.dtd[o]||(C._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span):n,!(r.isUnknown||C.isUnknown||s[a]);)if(C.isOptionalClose)f.onTagClose(o);else if(a in i&&o in i)o=C.children,(o=o[o.length-1])&&"li"==o.name||h(o=new CKEDITOR.htmlParser.element("li"),C),!r.returnPoint&&(r.returnPoint=C),C=o;else if(a in CKEDITOR.dtd.$listItem&&!p(a,o))f.onTagOpen("li"==a?"ul":"dl",{},0,1);else if(o in e&&!p(a,o))!r.returnPoint&&(r.returnPoint=C),C=C.parent;else{if(o in CKEDITOR.dtd.$inline&&g.unshift(C),!C.parent){r.isOrphan=1;break}h(C,C.parent,1)}l(a),c(),r.parent=C,r.isEmpty?h(r):C=r}}},f.onTagClose=function(t){for(var e=g.length-1;e>=0;e--)if(t==g[e].name)return void g.splice(e,1);for(var i=[],n=[],a=C;a!=m&&a.name!=t;)a._.isBlockLike||n.unshift(a),i.push(a),a=a.returnPoint||a.parent;if(a!=m){for(e=0;e<i.length;e++){var r=i[e];h(r,r.parent)}C=a,a._.isBlockLike&&c(),h(a,a.parent),a==C&&(C=C.parent),g=g.concat(n)}"body"==t&&(s=!1)},f.onText=function(t){if(C._.hasInlineStarted&&!v.length||b||I||(t=CKEDITOR.tools.ltrim(t),0!==t.length)){var i=C.name,r=i?CKEDITOR.dtd[i]||(C._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span):n;!I&&!r["#"]&&i in e?(f.onTagOpen(a[i]||""),f.onText(t)):(c(),l(),!b&&!I&&(t=t.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," ")),t=new CKEDITOR.htmlParser.text(t),u(C,t)&&this.onTagOpen(s,{},0,1),C.add(t))}},f.onCDATA=function(t){C.add(new CKEDITOR.htmlParser.cdata(t))},f.onComment=function(t){c(),l(),C.add(new CKEDITOR.htmlParser.comment(t))},f.parse(r);for(c();C!=m;)h(C,C.parent,1);return d(m),m},CKEDITOR.htmlParser.fragment.prototype={type:CKEDITOR.NODE_DOCUMENT_FRAGMENT,add:function(t,e){isNaN(e)&&(e=this.children.length);var i=e>0?this.children[e-1]:null;if(i){if(t._.isBlockLike&&i.type==CKEDITOR.NODE_TEXT&&(i.value=CKEDITOR.tools.rtrim(i.value),0===i.value.length))return this.children.pop(),void this.add(t);i.next=t}t.previous=i,t.parent=this,this.children.splice(e,0,t),this._.hasInlineStarted||(this._.hasInlineStarted=t.type==CKEDITOR.NODE_TEXT||t.type==CKEDITOR.NODE_ELEMENT&&!t._.isBlockLike)},filter:function(t,e){e=this.getFilterContext(e),t.onRoot(e,this),this.filterChildren(t,!1,e)},filterChildren:function(t,e,i){if(this.childrenFilteredBy!=t.id)for(i=this.getFilterContext(i),e&&!this.parent&&t.onRoot(i,this),this.childrenFilteredBy=t.id,e=0;e<this.children.length;e++)this.children[e].filter(t,i)===!1&&e--},writeHtml:function(t,e){e&&this.filter(e),this.writeChildrenHtml(t)},writeChildrenHtml:function(t,e,i){var n=this.getFilterContext();for(i&&!this.parent&&e&&e.onRoot(n,this),e&&this.filterChildren(e,!1,n),e=0,i=this.children,n=i.length;n>e;e++)i[e].writeHtml(t)},forEach:function(t,e,i){if(!(i||e&&this.type!=e))var n=t(this);if(n!==!1)for(var i=this.children,a=0;a<i.length;a++)n=i[a],n.type==CKEDITOR.NODE_ELEMENT?n.forEach(t,e):(!e||n.type==e)&&t(n)},getFilterContext:function(t){return t||{}}}}(),function(){function t(){this.rules=[]}function e(e,i,n,a){var r,o;for(r in i)(o=e[r])||(o=e[r]=new t),o.add(i[r],n,a)}CKEDITOR.htmlParser.filter=CKEDITOR.tools.createClass({$:function(e){this.id=CKEDITOR.tools.getNextNumber(),this.elementNameRules=new t,this.attributeNameRules=new t,this.elementsRules={},this.attributesRules={},this.textRules=new t,this.commentRules=new t,this.rootRules=new t,e&&this.addRules(e,10)},proto:{addRules:function(t,i){var n;"number"==typeof i?n=i:i&&"priority"in i&&(n=i.priority),"number"!=typeof n&&(n=10),"object"!=typeof i&&(i={}),t.elementNames&&this.elementNameRules.addMany(t.elementNames,n,i),t.attributeNames&&this.attributeNameRules.addMany(t.attributeNames,n,i),t.elements&&e(this.elementsRules,t.elements,n,i),t.attributes&&e(this.attributesRules,t.attributes,n,i),t.text&&this.textRules.add(t.text,n,i),t.comment&&this.commentRules.add(t.comment,n,i),t.root&&this.rootRules.add(t.root,n,i)},applyTo:function(t){t.filter(this)},onElementName:function(t,e){return this.elementNameRules.execOnName(t,e)},onAttributeName:function(t,e){return this.attributeNameRules.execOnName(t,e)},onText:function(t,e,i){return this.textRules.exec(t,e,i)},onComment:function(t,e,i){return this.commentRules.exec(t,e,i)},onRoot:function(t,e){return this.rootRules.exec(t,e)},onElement:function(t,e){for(var i,n=[this.elementsRules["^"],this.elementsRules[e.name],this.elementsRules.$],a=0;3>a;a++)if(i=n[a]){if(i=i.exec(t,e,this),i===!1)return null;if(i&&i!=e)return this.onNode(t,i);if(e.parent&&!e.name)break}return e},onNode:function(t,e){var i=e.type;return i==CKEDITOR.NODE_ELEMENT?this.onElement(t,e):i==CKEDITOR.NODE_TEXT?new CKEDITOR.htmlParser.text(this.onText(t,e.value)):i==CKEDITOR.NODE_COMMENT?new CKEDITOR.htmlParser.comment(this.onComment(t,e.value)):null},onAttribute:function(t,e,i,n){return(i=this.attributesRules[i])?i.exec(t,n,e,this):n}}}),CKEDITOR.htmlParser.filterRulesGroup=t,t.prototype={add:function(t,e,i){this.rules.splice(this.findIndex(e),0,{value:t,priority:e,options:i})},addMany:function(t,e,i){for(var n=[this.findIndex(e),0],a=0,r=t.length;r>a;a++)n.push({value:t[a],priority:e,options:i});this.rules.splice.apply(this.rules,n)},findIndex:function(t){for(var e=this.rules,i=e.length-1;i>=0&&t<e[i].priority;)i--;return i+1},exec:function(t,e){var i,n,a,r,o=e instanceof CKEDITOR.htmlParser.node||e instanceof CKEDITOR.htmlParser.fragment,s=Array.prototype.slice.call(arguments,1),l=this.rules,c=l.length;for(r=0;c>r;r++)if(o&&(i=e.type,n=e.name),a=l[r],!(t.nonEditable&&!a.options.applyToAll||t.nestedEditable&&a.options.excludeNestedEditable)){if(a=a.value.apply(null,s),a===!1||o&&a&&(a.name!=n||a.type!=i))return a;void 0!=a&&(s[0]=e=a)}return e},execOnName:function(t,e){for(var i,n=0,a=this.rules,r=a.length;e&&r>n;n++)i=a[n],!(t.nonEditable&&!i.options.applyToAll||t.nestedEditable&&i.options.excludeNestedEditable)&&(e=e.replace(i.value[0],i.value[1]));return e}}}(),function(){function t(t,e){function s(t){return t||CKEDITOR.env.needsNbspFiller?new CKEDITOR.htmlParser.text(" "):new CKEDITOR.htmlParser.element("br",{"data-cke-bogus":1})}function l(t,e){return function(a){if(a.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT){var o,l,d=[],h=i(a);if(h)for(c(h,1)&&d.push(h);h;)r(h)&&(o=n(h))&&c(o)&&((l=n(o))&&!r(l)?d.push(o):(s(u).insertAfter(o),o.remove())),h=h.previous;for(h=0;h<d.length;h++)d[h].remove();(d=CKEDITOR.env.opera&&!t||("function"==typeof e?e(a)!==!1:e))&&(u||CKEDITOR.env.needsBrFiller||a.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT?u||CKEDITOR.env.needsBrFiller||!(document.documentMode>7||a.name in CKEDITOR.dtd.tr||a.name in CKEDITOR.dtd.$listItem)?(d=i(a),d=!d||"form"==a.name&&"input"==d.name):d=!1:d=!1),d&&a.add(s(t))}}}function c(t,e){if((!u||CKEDITOR.env.needsBrFiller)&&t.type==CKEDITOR.NODE_ELEMENT&&"br"==t.name&&!t.attributes["data-cke-eol"])return!0;var i;if(t.type==CKEDITOR.NODE_TEXT&&(i=t.value.match(g))){if(i.index&&(new CKEDITOR.htmlParser.text(t.value.substring(0,i.index)).insertBefore(t),t.value=i[0]),!CKEDITOR.env.needsBrFiller&&u&&(!e||t.parent.name in p))return!0;if(!u&&((i=t.previous)&&"br"==i.name||!i||r(i)))return!0}return!1}var d,h={elements:{}},u="html"==e,p=CKEDITOR.tools.extend({},b);for(d in p)"#"in C[d]||delete p[d];for(d in p)h.elements[d]=l(u,t.config.fillEmptyBlocks!==!1);return h.root=l(u),h.elements.br=function(t){return function(e){if(e.parent.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT){var i=e.attributes;if("data-cke-bogus"in i||"data-cke-eol"in i)delete i["data-cke-bogus"];else{for(i=e.next;i&&a(i);)i=i.next;var l=n(e);!i&&r(e.parent)?o(e.parent,s(t)):r(i)&&l&&!r(l)&&s(t).insertBefore(i)}}}}(u),h}function e(t,e){return t!=CKEDITOR.ENTER_BR&&e!==!1?t==CKEDITOR.ENTER_DIV?"div":"p":!1}function i(t){for(t=t.children[t.children.length-1];t&&a(t);)t=t.previous;return t}function n(t){for(t=t.previous;t&&a(t);)t=t.previous;return t}function a(t){return t.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.trim(t.value)||t.type==CKEDITOR.NODE_ELEMENT&&t.attributes["data-cke-bookmark"]}function r(t){return t&&(t.type==CKEDITOR.NODE_ELEMENT&&t.name in b||t.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT)}function o(t,e){var i=t.children[t.children.length-1];t.children.push(e),e.parent=t,i&&(i.next=e,e.previous=i)}function s(t){t=t.attributes,"false"!=t.contenteditable&&(t["data-cke-editable"]=t.contenteditable?"true":1),t.contenteditable="false"}function l(t){switch(t=t.attributes,t["data-cke-editable"]){case"true":t.contenteditable="true";break;case"1":delete t.contenteditable}}function c(t){return t.replace(w,function(t,e,i){return"<"+e+i.replace(O,function(t,e){return _.test(e)&&-1==i.indexOf("data-cke-saved-"+e)?" data-cke-saved-"+t+" data-cke-"+CKEDITOR.rnd+"-"+t:t})+">"})}function d(t,e){return t.replace(e,function(t,e,i){return 0===t.indexOf("<textarea")&&(t=e+p(i).replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</textarea>"),"<cke:encoded>"+encodeURIComponent(t)+"</cke:encoded>"})}function h(t){return t.replace(k,function(t,e){return decodeURIComponent(e)})}function u(t){return t.replace(/<\!--(?!{cke_protected})[\s\S]+?--\>/g,function(t){return"<!--"+v+"{C}"+encodeURIComponent(t).replace(/--/g,"%2D%2D")+"-->"})}function p(t){return t.replace(/<\!--\{cke_protected\}\{C\}([\s\S]+?)--\>/g,function(t,e){return decodeURIComponent(e)})}function f(t,e){var i=e._.dataStore;return t.replace(/<\!--\{cke_protected\}([\s\S]+?)--\>/g,function(t,e){return decodeURIComponent(e)}).replace(/\{cke_protected_(\d+)\}/g,function(t,e){return i&&i[e]||""})}function m(t,e){for(var i=[],n=e.config.protectedSource,a=e._.dataStore||(e._.dataStore={id:1}),r=/<\!--\{cke_temp(comment)?\}(\d*?)--\>/g,n=[/<script[\s\S]*?<\/script>/gi,/<noscript[\s\S]*?<\/noscript>/gi].concat(n),t=t.replace(/<\!--[\s\S]*?--\>/g,function(t){return"<!--{cke_tempcomment}"+(i.push(t)-1)+"-->"}),o=0;o<n.length;o++)t=t.replace(n[o],function(t){return t=t.replace(r,function(t,e,n){return i[n]}),/cke_temp(comment)?/.test(t)?t:"<!--{cke_temp}"+(i.push(t)-1)+"-->"});return t=t.replace(r,function(t,e,n){return"<!--"+v+(e?"{C}":"")+encodeURIComponent(i[n]).replace(/--/g,"%2D%2D")+"-->"}),t.replace(/<\w([^'">]+|'[^']*'|"[^"]*")+>/g,function(t){return t.replace(/<\!--\{cke_protected\}([^>]*)--\>/g,function(t,e){return a[a.id]=decodeURIComponent(e),"{cke_protected_"+a.id++ +"}"})})}CKEDITOR.htmlDataProcessor=function(i){var n,a,r=this;this.editor=i,this.dataFilter=n=new CKEDITOR.htmlParser.filter,this.htmlFilter=a=new CKEDITOR.htmlParser.filter,this.writer=new CKEDITOR.htmlParser.basicWriter,n.addRules(E),n.addRules(y,{applyToAll:!0}),n.addRules(t(i,"data"),{applyToAll:!0}),a.addRules(T),a.addRules(R,{applyToAll:!0}),a.addRules(t(i,"html"),{applyToAll:!0}),i.on("toHtml",function(t){var n,t=t.data,a=t.dataValue,a=m(a,i),a=d(a,x),a=c(a),a=d(a,D),a=a.replace(K,"$1cke:$2"),a=a.replace(S,"<cke:$1$2></cke:$1>"),a=CKEDITOR.env.opera?a:a.replace(/(<pre\b[^>]*>)(\r\n|\n)/g,"$1$2$2"),a=a.replace(/([^a-z0-9<\-])(on\w{3,})(?!>)/gi,"$1data-cke-"+CKEDITOR.rnd+"-$2"),r=t.context||i.editable().getName();CKEDITOR.env.ie&&CKEDITOR.env.version<9&&"pre"==r&&(r="div",a="<pre>"+a+"</pre>",n=1),r=i.document.createElement(r),r.setHtml("a"+a),a=r.getHtml().substr(1),a=a.replace(RegExp("data-cke-"+CKEDITOR.rnd+"-","ig"),""),n&&(a=a.replace(/^<pre>|<\/pre>$/gi,"")),a=a.replace(q,"$1$2"),a=h(a),a=p(a),t.dataValue=CKEDITOR.htmlParser.fragment.fromHtml(a,t.context,t.fixForBody===!1?!1:e(t.enterMode,i.config.autoParagraph))},null,null,5),i.on("toHtml",function(t){t.data.filter.applyTo(t.data.dataValue,!0,t.data.dontFilter,t.data.enterMode)&&i.fire("dataFiltered")},null,null,6),i.on("toHtml",function(t){t.data.dataValue.filterChildren(r.dataFilter,!0)},null,null,10),i.on("toHtml",function(t){var t=t.data,e=t.dataValue,i=new CKEDITOR.htmlParser.basicWriter;e.writeChildrenHtml(i),e=i.getHtml(!0),t.dataValue=u(e)},null,null,15),i.on("toDataFormat",function(t){var n=t.data.dataValue;t.data.enterMode!=CKEDITOR.ENTER_BR&&(n=n.replace(/^<br *\/?>/i,"")),t.data.dataValue=CKEDITOR.htmlParser.fragment.fromHtml(n,t.data.context,e(t.data.enterMode,i.config.autoParagraph))},null,null,5),i.on("toDataFormat",function(t){t.data.dataValue.filterChildren(r.htmlFilter,!0)},null,null,10),i.on("toDataFormat",function(t){t.data.filter.applyTo(t.data.dataValue,!1,!0)},null,null,11),i.on("toDataFormat",function(t){var e=t.data.dataValue,n=r.writer;n.reset(),e.writeChildrenHtml(n),e=n.getHtml(!0),e=p(e),e=f(e,i),t.data.dataValue=e},null,null,15)},CKEDITOR.htmlDataProcessor.prototype={toHtml:function(t,e,i,n){var a,r,o,s=this.editor;return e&&"object"==typeof e?(a=e.context,i=e.fixForBody,n=e.dontFilter,r=e.filter,o=e.enterMode):a=e,!a&&null!==a&&(a=s.editable().getName()),s.fire("toHtml",{dataValue:t,context:a,fixForBody:i,dontFilter:n,filter:r||s.filter,enterMode:o||s.enterMode}).dataValue},toDataFormat:function(t,e){var i,n,a;return e&&(i=e.context,n=e.filter,a=e.enterMode),!i&&null!==i&&(i=this.editor.editable().getName()),this.editor.fire("toDataFormat",{dataValue:t,filter:n||this.editor.filter,context:i,enterMode:a||this.editor.enterMode}).dataValue}};var g=/(?:&nbsp;|\xa0)$/,v="{cke_protected}",C=CKEDITOR.dtd,I=["caption","colgroup","col","thead","tfoot","tbody"],b=CKEDITOR.tools.extend({},C.$blockLimit,C.$block),E={elements:{input:s,textarea:s}},y={attributeNames:[[/^on/,"data-cke-pa-on"],[/^data-cke-expando$/,""]]},T={elements:{embed:function(t){var e=t.parent;if(e&&"object"==e.name){var i=e.attributes.width,e=e.attributes.height;i&&(t.attributes.width=i),e&&(t.attributes.height=e)}},a:function(t){return t.children.length||t.attributes.name||t.attributes["data-cke-saved-name"]?void 0:!1}}},R={elementNames:[[/^cke:/,""],[/^\?xml:namespace$/,""]],attributeNames:[[/^data-cke-(saved|pa)-/,""],[/^data-cke-.*/,""],["hidefocus",""]],elements:{$:function(t){var e=t.attributes;if(e){if(e["data-cke-temp"])return!1;for(var i,n=["name","href","src"],a=0;a<n.length;a++)i="data-cke-saved-"+n[a],i in e&&delete e[n[a]]}return t},table:function(t){t.children.slice(0).sort(function(t,e){var i,n;return t.type==CKEDITOR.NODE_ELEMENT&&e.type==t.type&&(i=CKEDITOR.tools.indexOf(I,t.name),n=CKEDITOR.tools.indexOf(I,e.name)),i>-1&&n>-1&&i!=n||(i=t.parent?t.getIndex():-1,n=e.parent?e.getIndex():-1),i>n?1:-1})},param:function(t){return t.children=[],t.isEmpty=!0,t},span:function(t){"Apple-style-span"==t.attributes["class"]&&delete t.name},html:function(t){delete t.attributes.contenteditable,delete t.attributes["class"]},body:function(t){delete t.attributes.spellcheck,delete t.attributes.contenteditable},style:function(t){var e=t.children[0];e&&e.value&&(e.value=CKEDITOR.tools.trim(e.value)),t.attributes.type||(t.attributes.type="text/css")},title:function(t){var e=t.children[0];!e&&o(t,e=new CKEDITOR.htmlParser.text),e.value=t.attributes["data-cke-title"]||""},input:l,textarea:l},attributes:{"class":function(t){return CKEDITOR.tools.ltrim(t.replace(/(?:^|\s+)cke_[^\s]*/g,""))||!1}}};CKEDITOR.env.ie&&(R.attributes.style=function(t){return t.replace(/(^|;)([^\:]+)/g,function(t){return t.toLowerCase()})});var w=/<(a|area|img|input|source)\b([^>]*)>/gi,O=/([\w-]+)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,_=/^(href|src|name)$/i,D=/(?:<style(?=[ >])[^>]*>[\s\S]*?<\/style>)|(?:<(:?link|meta|base)[^>]*>)/gi,x=/(<textarea(?=[ >])[^>]*>)([\s\S]*?)(?:<\/textarea>)/gi,k=/<cke:encoded>([^<]*)<\/cke:encoded>/gi,K=/(<\/?)((?:object|embed|param|html|body|head|title)[^>]*>)/gi,q=/(<\/?)cke:((?:html|body|head|title)[^>]*>)/gi,S=/<cke:(param|embed)([^>]*?)\/?>(?!\s*<\/cke:\1)/gi}(),CKEDITOR.htmlParser.element=function(t,e){this.name=t,this.attributes=e||{},this.children=[];var i=t||"",n=i.match(/^cke:(.*)/);n&&(i=n[1]),i=!!(CKEDITOR.dtd.$nonBodyContent[i]||CKEDITOR.dtd.$block[i]||CKEDITOR.dtd.$listItem[i]||CKEDITOR.dtd.$tableContent[i]||CKEDITOR.dtd.$nonEditable[i]||"br"==i),this.isEmpty=!!CKEDITOR.dtd.$empty[t],this.isUnknown=!CKEDITOR.dtd[t],this._={isBlockLike:i,hasInlineStarted:this.isEmpty||!i}},CKEDITOR.htmlParser.cssStyle=function(t){var e={};return((t instanceof CKEDITOR.htmlParser.element?t.attributes.style:t)||"").replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(t,i,n){"font-family"==i&&(n=n.replace(/["']/g,"")),e[i.toLowerCase()]=n}),{rules:e,populate:function(t){var e=this.toString();e&&(t instanceof CKEDITOR.dom.element?t.setAttribute("style",e):t instanceof CKEDITOR.htmlParser.element?t.attributes.style=e:t.style=e)},toString:function(){var t,i=[];for(t in e)e[t]&&i.push(t,":",e[t],";");return i.join("")}}},function(){function t(t){return function(e){return e.type==CKEDITOR.NODE_ELEMENT&&("string"==typeof t?e.name==t:e.name in t)}}var e=function(t,e){return t=t[0],e=e[0],e>t?-1:t>e?1:0},i=CKEDITOR.htmlParser.fragment.prototype;CKEDITOR.htmlParser.element.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_ELEMENT,add:i.add,clone:function(){return new CKEDITOR.htmlParser.element(this.name,this.attributes)},filter:function(t,e){var i,n,a=this,e=a.getFilterContext(e);if(e.off)return!0;for(a.parent||t.onRoot(e,a);;){if(i=a.name,!(n=t.onElementName(e,i)))return this.remove(),!1;if(a.name=n,!(a=t.onElement(e,a)))return this.remove(),!1;if(a!==this)return this.replaceWith(a),!1;if(a.name==i)break;if(a.type!=CKEDITOR.NODE_ELEMENT)return this.replaceWith(a),!1;if(!a.name)return this.replaceWithChildren(),!1}i=a.attributes;var r,o;for(r in i){for(o=r,n=i[r];;){if(!(o=t.onAttributeName(e,r))){delete i[r];break}if(o==r)break;delete i[r],r=o}o&&((n=t.onAttribute(e,a,o,n))===!1?delete i[o]:i[o]=n)}return a.isEmpty||this.filterChildren(t,!1,e),!0},filterChildren:i.filterChildren,writeHtml:function(t,i){i&&this.filter(i);var n,a,r=this.name,o=[],s=this.attributes;t.openTag(r,s);for(n in s)o.push([n,s[n]]);for(t.sortAttributes&&o.sort(e),n=0,a=o.length;a>n;n++)s=o[n],t.attribute(s[0],s[1]);t.openTagClose(r,this.isEmpty),this.writeChildrenHtml(t),this.isEmpty||t.closeTag(r)},writeChildrenHtml:i.writeChildrenHtml,replaceWithChildren:function(){for(var t=this.children,e=t.length;e;)t[--e].insertAfter(this);this.remove()},forEach:i.forEach,getFirst:function(e){if(!e)return this.children.length?this.children[0]:null;"function"!=typeof e&&(e=t(e));for(var i=0,n=this.children.length;n>i;++i)if(e(this.children[i]))return this.children[i];return null},getHtml:function(){var t=new CKEDITOR.htmlParser.basicWriter;return this.writeChildrenHtml(t),t.getHtml()},setHtml:function(t){for(var t=this.children=CKEDITOR.htmlParser.fragment.fromHtml(t).children,e=0,i=t.length;i>e;++e)t[e].parent=this},getOuterHtml:function(){var t=new CKEDITOR.htmlParser.basicWriter;return this.writeHtml(t),t.getHtml()},split:function(t){for(var e=this.children.splice(t,this.children.length-t),i=this.clone(),n=0;n<e.length;++n)e[n].parent=i;return i.children=e,e[0]&&(e[0].previous=null),t>0&&(this.children[t-1].next=null),this.parent.add(i,this.getIndex()+1),i},removeClass:function(t){var e=this.attributes["class"];e&&((e=CKEDITOR.tools.trim(e.replace(RegExp("(?:\\s+|^)"+t+"(?:\\s+|$)")," ")))?this.attributes["class"]=e:delete this.attributes["class"])},hasClass:function(t){var e=this.attributes["class"];return e?RegExp("(?:^|\\s)"+t+"(?=\\s|$)").test(e):!1},getFilterContext:function(t){var e=[];if(t||(t={off:!1,nonEditable:!1,nestedEditable:!1}),!t.off&&"off"==this.attributes["data-cke-processor"]&&e.push("off",!0),t.nonEditable||"false"!=this.attributes.contenteditable?"body"!=this.name&&!t.nestedEditable&&"true"==this.attributes.contenteditable&&e.push("nestedEditable",!0):e.push("nonEditable",!0),e.length)for(var t=CKEDITOR.tools.copy(t),i=0;i<e.length;i+=2)t[e[i]]=e[i+1];return t}},!0)}(),function(){var t={},e=/{([^}]+)}/g,i=/([\\'])/g,n=/\n/g,a=/\r/g;CKEDITOR.template=function(r){if(t[r])this.output=t[r];else{var o=r.replace(i,"\\$1").replace(n,"\\n").replace(a,"\\r").replace(e,function(t,e){return"',data['"+e+"']==undefined?'{"+e+"}':data['"+e+"'],'"});this.output=t[r]=Function("data","buffer","return buffer?buffer.push('"+o+"'):['"+o+"'].join('');")}}}(),delete CKEDITOR.loadFullCore,CKEDITOR.instances={},CKEDITOR.document=new CKEDITOR.dom.document(document),CKEDITOR.add=function(t){CKEDITOR.instances[t.name]=t,t.on("focus",function(){CKEDITOR.currentInstance!=t&&(CKEDITOR.currentInstance=t,CKEDITOR.fire("currentInstance"))}),t.on("blur",function(){CKEDITOR.currentInstance==t&&(CKEDITOR.currentInstance=null,CKEDITOR.fire("currentInstance"))}),CKEDITOR.fire("instance",null,t)},CKEDITOR.remove=function(t){delete CKEDITOR.instances[t.name]},function(){var t={};CKEDITOR.addTemplate=function(e,i){var n=t[e];return n?n:(n={name:e,source:i},CKEDITOR.fire("template",n),t[e]=new CKEDITOR.template(n.source))},CKEDITOR.getTemplate=function(e){return t[e]}}(),function(){var t=[];CKEDITOR.addCss=function(e){t.push(e)},CKEDITOR.getCss=function(){return t.join("\n")}}(),CKEDITOR.on("instanceDestroyed",function(){CKEDITOR.tools.isEmpty(this.instances)&&CKEDITOR.fire("reset")}),CKEDITOR.TRISTATE_ON=1,CKEDITOR.TRISTATE_OFF=2,CKEDITOR.TRISTATE_DISABLED=0,function(){CKEDITOR.inline=function(t,e){if(!CKEDITOR.env.isCompatible)return null;if(t=CKEDITOR.dom.element.get(t),t.getEditor())throw'The editor instance "'+t.getEditor().name+'" is already attached to the provided element.';var i=new CKEDITOR.editor(e,t,CKEDITOR.ELEMENT_MODE_INLINE),n=t.is("textarea")?t:null;return n?(i.setData(n.getValue(),null,!0),t=CKEDITOR.dom.element.createFromHtml('<div contenteditable="'+!!i.readOnly+'" class="cke_textarea_inline">'+n.getValue()+"</div>",CKEDITOR.document),t.insertAfter(n),n.hide(),n.$.form&&i._attachToForm()):i.setData(t.getHtml(),null,!0),i.on("loaded",function(){i.fire("uiReady"),i.editable(t),i.container=t,i.setData(i.getData(1)),i.resetDirty(),i.fire("contentDom"),i.mode="wysiwyg",i.fire("mode"),i.status="ready",i.fireOnce("instanceReady"),CKEDITOR.fire("instanceReady",null,i)},null,null,1e4),i.on("destroy",function(){n&&(i.container.clearCustomData(),i.container.remove(),n.show()),i.element.clearCustomData(),delete i.element}),i},CKEDITOR.inlineAll=function(){var t,e,i;for(i in CKEDITOR.dtd.$editable)for(var n=CKEDITOR.document.getElementsByTag(i),a=0,r=n.count();r>a;a++)t=n.getItem(a),"true"==t.getAttribute("contenteditable")&&(e={element:t,config:{}},CKEDITOR.fire("inline",e)!==!1&&CKEDITOR.inline(t,e.config))},CKEDITOR.domReady(function(){!CKEDITOR.disableAutoInline&&CKEDITOR.inlineAll()})}(),CKEDITOR.replaceClass="ckeditor",function(){function t(t,n,a,r){if(!CKEDITOR.env.isCompatible)return null;if(t=CKEDITOR.dom.element.get(t),t.getEditor())throw'The editor instance "'+t.getEditor().name+'" is already attached to the provided element.';var o=new CKEDITOR.editor(n,t,r);return r==CKEDITOR.ELEMENT_MODE_REPLACE&&(t.setStyle("visibility","hidden"),o._.required=t.hasAttribute("required"),t.removeAttribute("required")),a&&o.setData(a,null,!0),o.on("loaded",function(){i(o),r==CKEDITOR.ELEMENT_MODE_REPLACE&&o.config.autoUpdateElement&&t.$.form&&o._attachToForm(),o.setMode(o.config.startupMode,function(){o.resetDirty(),o.status="ready",o.fireOnce("instanceReady"),CKEDITOR.fire("instanceReady",null,o)})}),o.on("destroy",e),o}function e(){var t=this.container,e=this.element;t&&(t.clearCustomData(),t.remove()),e&&(e.clearCustomData(),this.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE&&(e.show(),this._.required&&e.setAttribute("required","required")),delete this.element)}function i(t){var e=t.name,i=t.element,a=t.elementMode,r=t.fire("uiSpace",{space:"top",html:""}).html,o=t.fire("uiSpace",{space:"bottom",html:""}).html;n||(n=CKEDITOR.addTemplate("maincontainer",'<{outerEl} id="cke_{name}" class="{id} cke cke_reset cke_chrome cke_editor_{name} cke_{langDir} '+CKEDITOR.env.cssClass+'"  dir="{langDir}" lang="{langCode}" role="application" aria-labelledby="cke_{name}_arialbl"><span id="cke_{name}_arialbl" class="cke_voice_label">{voiceLabel}</span><{outerEl} class="cke_inner cke_reset" role="presentation">{topHtml}<{outerEl} id="{contentId}" class="cke_contents cke_reset" role="presentation"></{outerEl}>{bottomHtml}</{outerEl}></{outerEl}>')),e=CKEDITOR.dom.element.createFromHtml(n.output({id:t.id,name:e,langDir:t.lang.dir,langCode:t.langCode,voiceLabel:[t.lang.editor,t.name].join(", "),topHtml:r?'<span id="'+t.ui.spaceId("top")+'" class="cke_top cke_reset_all" role="presentation" style="height:auto">'+r+"</span>":"",contentId:t.ui.spaceId("contents"),bottomHtml:o?'<span id="'+t.ui.spaceId("bottom")+'" class="cke_bottom cke_reset_all" role="presentation">'+o+"</span>":"",outerEl:CKEDITOR.env.ie?"span":"div"})),a==CKEDITOR.ELEMENT_MODE_REPLACE?(i.hide(),e.insertAfter(i)):i.append(e),t.container=e,r&&t.ui.space("top").unselectable(),o&&t.ui.space("bottom").unselectable(),i=t.config.width,a=t.config.height,i&&e.setStyle("width",CKEDITOR.tools.cssLength(i)),a&&t.ui.space("contents").setStyle("height",CKEDITOR.tools.cssLength(a)),e.disableContextMenu(),CKEDITOR.env.webkit&&e.on("focus",function(){t.focus()}),t.fireOnce("uiReady")}CKEDITOR.replace=function(e,i){return t(e,i,null,CKEDITOR.ELEMENT_MODE_REPLACE)},CKEDITOR.appendTo=function(e,i,n){return t(e,i,n,CKEDITOR.ELEMENT_MODE_APPENDTO)},CKEDITOR.replaceAll=function(){for(var t=document.getElementsByTagName("textarea"),e=0;e<t.length;e++){var i=null,n=t[e];if(n.name||n.id){if("string"==typeof arguments[0]){if(!RegExp("(?:^|\\s)"+arguments[0]+"(?:$|\\s)").test(n.className))continue}else if("function"==typeof arguments[0]&&(i={},arguments[0](n,i)===!1))continue;this.replace(n,i)}}},CKEDITOR.editor.prototype.addMode=function(t,e){(this._.modes||(this._.modes={}))[t]=e},CKEDITOR.editor.prototype.setMode=function(t,e){var i=this,n=this._.modes;if(t!=i.mode&&n&&n[t]){if(i.fire("beforeSetMode",t),i.mode){var a=i.checkDirty();i._.previousMode=i.mode,i.fire("beforeModeUnload"),i.editable(0),i.ui.space("contents").setHtml(""),i.mode=""}this._.modes[t](function(){i.mode=t,void 0!==a&&!a&&i.resetDirty(),setTimeout(function(){i.fire("mode"),e&&e.call(i)},0)})}},CKEDITOR.editor.prototype.resize=function(t,e,i,n){var a=this.container,r=this.ui.space("contents"),o=CKEDITOR.env.webkit&&this.document&&this.document.getWindow().$.frameElement,n=n?a.getChild(1):a;
n.setSize("width",t,!0),o&&(o.style.width="1%"),r.setStyle("height",Math.max(e-(i?0:(n.$.offsetHeight||0)-(r.$.clientHeight||0)),0)+"px"),o&&(o.style.width="100%"),this.fire("resize")},CKEDITOR.editor.prototype.getResizable=function(t){return t?this.ui.space("contents"):this.container};var n;CKEDITOR.domReady(function(){CKEDITOR.replaceClass&&CKEDITOR.replaceAll(CKEDITOR.replaceClass)})}(),CKEDITOR.config.startupMode="wysiwyg",function(){function t(t){var i,a=t.editor,r=t.data.path,o=r.blockLimit,s=t.data.selection,l=s.getRanges()[0];(CKEDITOR.env.gecko||CKEDITOR.env.ie&&CKEDITOR.env.needsBrFiller)&&(s=e(s,r))&&(s.appendBogus(),i=CKEDITOR.env.ie),a.config.autoParagraph!==!1&&a.activeEnterMode!=CKEDITOR.ENTER_BR&&a.editable().equals(o)&&!r.block&&l.collapsed&&!l.getCommonAncestor().isReadOnly()&&(r=l.clone(),r.enlarge(CKEDITOR.ENLARGE_BLOCK_CONTENTS),o=new CKEDITOR.dom.walker(r),o.guard=function(t){return!n(t)||t.type==CKEDITOR.NODE_COMMENT||t.isReadOnly()},(!o.checkForward()||r.checkStartOfBlock()&&r.checkEndOfBlock())&&(a=l.fixBlock(!0,a.activeEnterMode==CKEDITOR.ENTER_DIV?"div":"p"),CKEDITOR.env.needsBrFiller||(a=a.getFirst(n))&&a.type==CKEDITOR.NODE_TEXT&&CKEDITOR.tools.trim(a.getText()).match(/^(?:&nbsp;|\xa0)$/)&&a.remove(),i=1,t.cancel())),i&&l.select()}function e(t,e){if(t.isFake)return 0;var i=e.block||e.blockLimit,a=i&&i.getLast(n);return!i||!i.isBlockBoundary()||a&&a.type==CKEDITOR.NODE_ELEMENT&&a.isBlockBoundary()||i.is("pre")||i.getBogus()?void 0:i}function i(t){var e=t.data.getTarget();e.is("input")&&(e=e.getAttribute("type"),("submit"==e||"reset"==e)&&t.data.preventDefault())}function n(t){return d(t)&&h(t)}function a(t,e){return function(i){var n=CKEDITOR.dom.element.get(i.data.$.toElement||i.data.$.fromElement||i.data.$.relatedTarget);(!n||!e.equals(n)&&!e.contains(n))&&t.call(this,i)}}function r(t){var e,i=t.getRanges()[0],a=t.root,r={table:1,ul:1,ol:1,dl:1};if(i.startPath().contains(r)){var t=function(t){return function(i,a){return a&&i.type==CKEDITOR.NODE_ELEMENT&&i.is(r)&&(e=i),a||!n(i)||t&&l(i)?void 0:!1}},o=i.clone();if(o.collapse(1),o.setStartAt(a,CKEDITOR.POSITION_AFTER_START),a=new CKEDITOR.dom.walker(o),a.guard=t(),a.checkBackward(),e)return o=i.clone(),o.collapse(),o.setEndAt(e,CKEDITOR.POSITION_AFTER_END),a=new CKEDITOR.dom.walker(o),a.guard=t(!0),e=!1,a.checkForward(),e}return null}function o(t){t.editor.focus(),t.editor.fire("saveSnapshot")}function s(t,e){var i=t.editor;!e&&i.getSelection().scrollIntoView(),setTimeout(function(){i.fire("saveSnapshot")},0)}CKEDITOR.editable=CKEDITOR.tools.createClass({base:CKEDITOR.dom.element,$:function(t,e){this.base(e.$||e),this.editor=t,this.hasFocus=!1,this.setup()},proto:{focus:function(){var t;if(CKEDITOR.env.webkit&&!this.hasFocus&&(t=this.editor._.previousActive||this.getDocument().getActive(),this.contains(t)))return void t.focus();try{this.$[CKEDITOR.env.ie&&this.getDocument().equals(CKEDITOR.document)?"setActive":"focus"]()}catch(e){if(!CKEDITOR.env.ie)throw e}CKEDITOR.env.safari&&!this.isInline()&&(t=CKEDITOR.document.getActive(),t.equals(this.getWindow().getFrame())||this.getWindow().focus())},on:function(t,e){var i=Array.prototype.slice.call(arguments,0);return CKEDITOR.env.ie&&/^focus|blur$/.exec(t)&&(t="focus"==t?"focusin":"focusout",e=a(e,this),i[0]=t,i[1]=e),CKEDITOR.dom.element.prototype.on.apply(this,i)},attachListener:function(t){!this._.listeners&&(this._.listeners=[]);var e=Array.prototype.slice.call(arguments,1),e=t.on.apply(t,e);return this._.listeners.push(e),e},clearListeners:function(){var t=this._.listeners;try{for(;t.length;)t.pop().removeListener()}catch(e){}},restoreAttrs:function(){var t,e,i=this._.attrChanges;for(e in i)i.hasOwnProperty(e)&&(t=i[e],null!==t?this.setAttribute(e,t):this.removeAttribute(e))},attachClass:function(t){var e=this.getCustomData("classes");this.hasClass(t)||(!e&&(e=[]),e.push(t),this.setCustomData("classes",e),this.addClass(t))},changeAttr:function(t,e){var i=this.getAttribute(t);e!==i&&(!this._.attrChanges&&(this._.attrChanges={}),t in this._.attrChanges||(this._.attrChanges[t]=i),this.setAttribute(t,e))},insertHtml:function(t,e){o(this),u(this,e||"html",t)},insertText:function(t){o(this);var e=this.editor,i=e.getSelection().getStartElement().hasAscendant("pre",!0)?CKEDITOR.ENTER_BR:e.activeEnterMode,e=i==CKEDITOR.ENTER_BR,n=CKEDITOR.tools,t=n.htmlEncode(t.replace(/\r\n/g,"\n")),t=t.replace(/\t/g,"&nbsp;&nbsp; &nbsp;"),i=i==CKEDITOR.ENTER_P?"p":"div";if(!e){var a=/\n{2}/g;if(a.test(t))var r="<"+i+">",s="</"+i+">",t=r+t.replace(a,function(){return s+r})+s}t=t.replace(/\n/g,"<br>"),e||(t=t.replace(RegExp("<br>(?=</"+i+">)"),function(t){return n.repeat(t,2)})),t=t.replace(/^ | $/g,"&nbsp;"),t=t.replace(/(>|\s) /g,function(t,e){return e+"&nbsp;"}).replace(/ (?=<)/g,"&nbsp;"),u(this,"text",t)},insertElement:function(t,e){e?this.insertElementIntoRange(t,e):this.insertElementIntoSelection(t)},insertElementIntoRange:function(t,e){var i=this.editor,n=i.config.enterMode,a=t.getName(),r=CKEDITOR.dtd.$block[a];if(e.checkReadOnly())return!1;e.deleteContents(1),e.startContainer.type==CKEDITOR.NODE_ELEMENT&&e.startContainer.is({tr:1,table:1,tbody:1,thead:1,tfoot:1})&&p(e);var o,s;if(r)for(;(o=e.getCommonAncestor(0,1))&&(s=CKEDITOR.dtd[o.getName()])&&(!s||!s[a]);)o.getName()in CKEDITOR.dtd.span?e.splitElement(o):e.checkStartOfBlock()&&e.checkEndOfBlock()?(e.setStartBefore(o),e.collapse(!0),o.remove()):e.splitBlock(n==CKEDITOR.ENTER_DIV?"div":"p",i.editable());return e.insertNode(t),!0},insertElementIntoSelection:function(t){var e=this.editor,i=e.activeEnterMode,e=e.getSelection(),a=e.getRanges()[0],r=t.getName(),r=CKEDITOR.dtd.$block[r];o(this),this.insertElementIntoRange(t,a)&&(a.moveToPosition(t,CKEDITOR.POSITION_AFTER_END),r&&((r=t.getNext(function(t){return n(t)&&!l(t)}))&&r.type==CKEDITOR.NODE_ELEMENT&&r.is(CKEDITOR.dtd.$block)?r.getDtd()["#"]?a.moveToElementEditStart(r):a.moveToElementEditEnd(t):r||i==CKEDITOR.ENTER_BR||(r=a.fixBlock(!0,i==CKEDITOR.ENTER_DIV?"div":"p"),a.moveToElementEditStart(r)))),e.selectRanges([a]),s(this,CKEDITOR.env.opera)},setData:function(t,e){e||(t=this.editor.dataProcessor.toHtml(t)),this.setHtml(t),this.editor.fire("dataReady")},getData:function(t){var e=this.getHtml();return t||(e=this.editor.dataProcessor.toDataFormat(e)),e},setReadOnly:function(t){this.setAttribute("contenteditable",!t)},detach:function(){this.removeClass("cke_editable");var t=this.editor;this._.detach(),delete t.document,delete t.window},isInline:function(){return this.getDocument().equals(CKEDITOR.document)},setup:function(){var t=this.editor;if(this.attachListener(t,"beforeGetData",function(){var e=this.getData();this.is("textarea")||t.config.ignoreEmptyParagraph!==!1&&(e=e.replace(c,function(t,e){return e})),t.setData(e,null,1)},this),this.attachListener(t,"getSnapshot",function(t){t.data=this.getData(1)},this),this.attachListener(t,"afterSetData",function(){this.setData(t.getData(1))},this),this.attachListener(t,"loadSnapshot",function(t){this.setData(t.data,1)},this),this.attachListener(t,"beforeFocus",function(){var e=t.getSelection();(e=e&&e.getNative())&&"Control"==e.type||this.focus()},this),this.attachListener(t,"insertHtml",function(t){this.insertHtml(t.data.dataValue,t.data.mode)},this),this.attachListener(t,"insertElement",function(t){this.insertElement(t.data)},this),this.attachListener(t,"insertText",function(t){this.insertText(t.data)},this),this.setReadOnly(t.readOnly),this.attachClass("cke_editable"),this.attachClass(t.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?"cke_editable_inline":t.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE||t.elementMode==CKEDITOR.ELEMENT_MODE_APPENDTO?"cke_editable_themed":""),this.attachClass("cke_contents_"+t.config.contentsLangDirection),t.keystrokeHandler.blockedKeystrokes[8]=+t.readOnly,t.keystrokeHandler.attach(this),this.on("blur",function(t){CKEDITOR.env.opera&&CKEDITOR.document.getActive().equals(this.isInline()?this:this.getWindow().getFrame())?t.cancel():this.hasFocus=!1},null,null,-1),this.on("focus",function(){this.hasFocus=!0},null,null,-1),t.focusManager.add(this),this.equals(CKEDITOR.document.getActive())&&(this.hasFocus=!0,t.once("contentDom",function(){t.focusManager.focus()})),this.isInline()&&this.changeAttr("tabindex",t.tabIndex),!this.is("textarea")){t.document=this.getDocument(),t.window=this.getWindow();var e=t.document;this.changeAttr("spellcheck",!t.config.disableNativeSpellChecker);var a=t.config.contentsLangDirection;this.getDirection(1)!=a&&this.changeAttr("dir",a);var o=CKEDITOR.getCss();o&&(a=e.getHead(),a.getCustomData("stylesheet")||(o=e.appendStyleText(o),o=new CKEDITOR.dom.element(o.ownerNode||o.owningElement),a.setCustomData("stylesheet",o),o.data("cke-temp",1))),a=e.getCustomData("stylesheet_ref")||0,e.setCustomData("stylesheet_ref",a+1),this.setCustomData("cke_includeReadonly",!t.config.disableReadonlyStyling),this.attachListener(this,"click",function(t){var t=t.data,e=new CKEDITOR.dom.elementPath(t.getTarget(),this).contains("a");e&&2!=t.$.button&&e.isReadOnly()&&t.preventDefault()});var s={8:1,46:1};this.attachListener(t,"key",function(e){if(t.readOnly)return!0;var i,n=e.data.keyCode;if(n in s){var a,o,l,c,e=t.getSelection(),h=e.getRanges()[0],u=h.startPath(),n=8==n;CKEDITOR.env.ie&&CKEDITOR.env.version<11&&(a=e.getSelectedElement())||(a=r(e))?(t.fire("saveSnapshot"),h.moveToPosition(a,CKEDITOR.POSITION_BEFORE_START),a.remove(),h.select(),t.fire("saveSnapshot"),i=1):h.collapsed&&((o=u.block)&&(c=o[n?"getPrevious":"getNext"](d))&&c.type==CKEDITOR.NODE_ELEMENT&&c.is("table")&&h[n?"checkStartOfBlock":"checkEndOfBlock"]()?(t.fire("saveSnapshot"),h[n?"checkEndOfBlock":"checkStartOfBlock"]()&&o.remove(),h["moveToElementEdit"+(n?"End":"Start")](c),h.select(),t.fire("saveSnapshot"),i=1):u.blockLimit&&u.blockLimit.is("td")&&(l=u.blockLimit.getAscendant("table"))&&h.checkBoundaryOfElement(l,n?CKEDITOR.START:CKEDITOR.END)&&(c=l[n?"getPrevious":"getNext"](d))?(t.fire("saveSnapshot"),h["moveToElementEdit"+(n?"End":"Start")](c),h.checkStartOfBlock()&&h.checkEndOfBlock()?c.remove():h.select(),t.fire("saveSnapshot"),i=1):(l=u.contains(["td","th","caption"]))&&h.checkBoundaryOfElement(l,n?CKEDITOR.START:CKEDITOR.END)&&(i=1))}return!i}),t.blockless&&CKEDITOR.env.ie&&CKEDITOR.env.needsBrFiller&&this.attachListener(this,"keyup",function(e){e.data.getKeystroke()in s&&!this.getFirst(n)&&(this.appendBogus(),e=t.createRange(),e.moveToPosition(this,CKEDITOR.POSITION_AFTER_START),e.select())}),this.attachListener(this,"dblclick",function(e){return t.readOnly?!1:(e={element:e.data.getTarget()},void t.fire("doubleclick",e))}),CKEDITOR.env.ie&&this.attachListener(this,"click",i),!CKEDITOR.env.ie&&!CKEDITOR.env.opera&&this.attachListener(this,"mousedown",function(e){var i=e.data.getTarget();i.is("img","hr","input","textarea","select")&&(t.getSelection().selectElement(i),i.is("input","textarea","select")&&e.data.preventDefault())}),CKEDITOR.env.gecko&&this.attachListener(this,"mouseup",function(e){if(2==e.data.$.button&&(e=e.data.getTarget(),!e.getOuterHtml().replace(c,""))){var i=t.createRange();i.moveToElementEditStart(e),i.select(!0)}}),CKEDITOR.env.webkit&&(this.attachListener(this,"click",function(t){t.data.getTarget().is("input","select")&&t.data.preventDefault()}),this.attachListener(this,"mouseup",function(t){t.data.getTarget().is("input","textarea")&&t.data.preventDefault()}))}}},_:{detach:function(){this.editor.setData(this.editor.getData(),0,1),this.clearListeners(),this.restoreAttrs();var t;if(t=this.removeCustomData("classes"))for(;t.length;)this.removeClass(t.pop());if(!this.is("textarea")){t=this.getDocument();var e=t.getHead();if(e.getCustomData("stylesheet")){var i=t.getCustomData("stylesheet_ref");--i?t.setCustomData("stylesheet_ref",i):(t.removeCustomData("stylesheet_ref"),e.removeCustomData("stylesheet").remove())}}this.editor.fire("contentDomUnload"),delete this.editor}}}),CKEDITOR.editor.prototype.editable=function(t){var e=this._.editable;return e&&t?0:(arguments.length&&(e=this._.editable=t?t instanceof CKEDITOR.editable?t:new CKEDITOR.editable(this,t):(e&&e.detach(),null)),e)};var l=CKEDITOR.dom.walker.bogus(),c=/(^|<body\b[^>]*>)\s*<(p|div|address|h\d|center|pre)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\2>)?\s*(?=$|<\/body>)/gi,d=CKEDITOR.dom.walker.whitespaces(!0),h=CKEDITOR.dom.walker.bookmark(!1,!0);CKEDITOR.on("instanceLoaded",function(e){var i=e.editor;i.on("insertElement",function(t){t=t.data,t.type==CKEDITOR.NODE_ELEMENT&&(t.is("input")||t.is("textarea"))&&("false"!=t.getAttribute("contentEditable")&&t.data("cke-editable",t.hasAttribute("contenteditable")?"true":"1"),t.setAttribute("contentEditable",!1))}),i.on("selectionChange",function(e){if(!i.readOnly){var n=i.getSelection();n&&!n.isLocked&&(n=i.checkDirty(),i.fire("lockSnapshot"),t(e),i.fire("unlockSnapshot"),!n&&i.resetDirty())}})}),CKEDITOR.on("instanceCreated",function(t){var e=t.editor;e.on("mode",function(){var t=e.editable();if(t&&t.isInline()){var i=e.title;if(t.changeAttr("role","textbox"),t.changeAttr("aria-label",i),i&&t.changeAttr("title",i),i=this.ui.space(this.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?"top":"contents")){var n=CKEDITOR.tools.getNextId(),a=CKEDITOR.dom.element.createFromHtml('<span id="'+n+'" class="cke_voice_label">'+this.lang.common.editorHelp+"</span>");i.append(a),t.changeAttr("aria-describedby",n)}}})}),CKEDITOR.addCss(".cke_editable{cursor:text}.cke_editable img,.cke_editable input,.cke_editable textarea{cursor:default}");var u=function(){function t(t){return t.type==CKEDITOR.NODE_ELEMENT}function e(i,n){var a,r,o,s,c=[],d=n.range.startContainer;a=n.range.startPath();for(var d=l[d.getName()],h=0,u=i.getChildren(),p=u.count(),f=-1,m=-1,g=0,v=a.contains(l.$list);p>h;++h)a=u.getItem(h),t(a)?(o=a.getName(),v&&o in CKEDITOR.dtd.$list?c=c.concat(e(a,n)):(s=!!d[o],"br"!=o||!a.data("cke-eol")||h&&h!=p-1||(g=(r=h?c[h-1].node:u.getItem(h+1))&&(!t(r)||!r.is("br")),r=r&&t(r)&&l.$block[r.getName()]),-1==f&&!s&&(f=h),s||(m=h),c.push({isElement:1,isLineBreak:g,isBlock:a.isBlockBoundary(),hasBlockSibling:r,node:a,name:o,allowed:s}),r=g=0)):c.push({isElement:0,node:a,allowed:1});return f>-1&&(c[f].firstNotAllowed=1),m>-1&&(c[m].lastNotAllowed=1),c}function i(e,n){var a,r=[],o=e.getChildren(),s=o.count(),c=0,d=l[n],h=!e.is(l.$inline)||e.is("br");for(h&&r.push(" ");s>c;c++)a=o.getItem(c),t(a)&&!a.is(d)?r=r.concat(i(a,n)):r.push(a);return h&&r.push(" "),r}function a(e){return e&&t(e)&&(e.is(l.$removeEmpty)||e.is("a")&&!e.isBlockBoundary())}function r(e,i,n,a){var o,s,l=e.clone();l.setEndAt(i,CKEDITOR.POSITION_BEFORE_END),(o=new CKEDITOR.dom.walker(l).next())&&t(o)&&c[o.getName()]&&(s=o.getPrevious())&&t(s)&&!s.getParent().equals(e.startContainer)&&n.contains(s)&&a.contains(o)&&o.isIdentical(s)&&(o.moveChildren(s),o.remove(),r(e,i,n,a))}function o(e,i){function n(e,i){return i.isBlock&&i.isElement&&!i.node.is("br")&&t(e)&&e.is("br")?(e.remove(),1):void 0}var a=i.endContainer.getChild(i.endOffset),r=i.endContainer.getChild(i.endOffset-1);a&&n(a,e[e.length-1]),r&&n(r,e[0])&&(i.setEnd(i.endContainer,i.endOffset-1),i.collapse())}var l=CKEDITOR.dtd,c={p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,ul:1,ol:1,li:1,pre:1,dl:1,blockquote:1},d={p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1},h=CKEDITOR.tools.extend({},l.$inline);return delete h.br,function(c,u,p){var f=c.editor;c.getDocument();var m=f.getSelection().getRanges()[0],g=!1;if("unfiltered_html"==u&&(u="html",g=!0),!m.checkReadOnly()){var v,C,I,b,E=new CKEDITOR.dom.elementPath(m.startContainer,m.root).blockLimit||m.root,u={type:u,dontFilter:g,editable:c,editor:f,range:m,blockLimit:E,mergeCandidates:[],zombies:[]},f=u.range,g=u.mergeCandidates;if("text"==u.type&&f.shrink(CKEDITOR.SHRINK_ELEMENT,!0,!1)&&(v=CKEDITOR.dom.element.createFromHtml("<span>&nbsp;</span>",f.document),f.insertNode(v),f.setStartAfter(v)),C=new CKEDITOR.dom.elementPath(f.startContainer),u.endPath=I=new CKEDITOR.dom.elementPath(f.endContainer),!f.collapsed){var E=I.block||I.blockLimit,y=f.getCommonAncestor();E&&!E.equals(y)&&!E.contains(y)&&f.checkEndOfBlock()&&u.zombies.push(E),f.deleteContents()}for(;(b=t(f.startContainer)&&f.startContainer.getChild(f.startOffset-1))&&t(b)&&b.isBlockBoundary()&&C.contains(b);)f.moveToPosition(b,CKEDITOR.POSITION_BEFORE_END);for(r(f,u.blockLimit,C,I),v&&(f.setEndBefore(v),f.collapse(),v.remove()),v=f.startPath(),(E=v.contains(a,!1,1))&&(f.splitElement(E),u.inlineStylesRoot=E,u.inlineStylesPeak=v.lastElement),v=f.createBookmark(),(E=v.startNode.getPrevious(n))&&t(E)&&a(E)&&g.push(E),(E=v.startNode.getNext(n))&&t(E)&&a(E)&&g.push(E),E=v.startNode;(E=E.getParent())&&a(E);)g.push(E);if(f.moveToBookmark(v),v=p){if(v=u.range,"text"==u.type&&u.inlineStylesRoot){for(b=u.inlineStylesPeak,f=b.getDocument().createText("{cke-peak}"),g=u.inlineStylesRoot.getParent();!b.equals(g);)f=f.appendTo(b.clone()),b=b.getParent();p=f.getOuterHtml().split("{cke-peak}").join(p)}if(b=u.blockLimit.getName(),/^\s+|\s+$/.test(p)&&"span"in CKEDITOR.dtd[b])var T='<span data-cke-marker="1">&nbsp;</span>',p=T+p+T;if(p=u.editor.dataProcessor.toHtml(p,{context:null,fixForBody:!1,dontFilter:u.dontFilter,filter:u.editor.activeFilter,enterMode:u.editor.activeEnterMode}),b=v.document.createElement("body"),b.setHtml(p),T&&(b.getFirst().remove(),b.getLast().remove()),(T=v.startPath().block)&&(1!=T.getChildCount()||!T.getBogus()))t:{var R;if(1==b.getChildCount()&&t(R=b.getFirst())&&R.is(d)){for(T=R.getElementsByTag("*"),v=0,g=T.count();g>v;v++)if(f=T.getItem(v),!f.is(h))break t;R.moveChildren(R.getParent(1)),R.remove()}}u.dataWrapper=b,v=p}if(v){R=u.range;var w,T=R.document,p=u.blockLimit;v=0;var O;b=[];var _,D,x,k,g=f=0;C=R.startContainer;var K,E=u.endPath.elements[0];for(I=E.getPosition(C),y=!(!E.getCommonAncestor(C)||I==CKEDITOR.POSITION_IDENTICAL||I&CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_IS_CONTAINED),C=e(u.dataWrapper,u),o(C,R);v<C.length;v++){if(I=C[v],w=I.isLineBreak){w=R,x=p;var q=void 0,S=void 0;I.hasBlockSibling?w=1:(q=w.startContainer.getAscendant(l.$block,1),q&&q.is({div:1,p:1})?(S=q.getPosition(x),S==CKEDITOR.POSITION_IDENTICAL||S==CKEDITOR.POSITION_CONTAINS?w=0:(x=w.splitElement(q),w.moveToPosition(x,CKEDITOR.POSITION_AFTER_START),w=1)):w=0)}if(w)g=v>0;else{if(w=R.startPath(),!I.isBlock&&u.editor.config.autoParagraph!==!1&&u.editor.activeEnterMode!=CKEDITOR.ENTER_BR&&u.editor.editable().equals(w.blockLimit)&&!w.block&&(D=u.editor.activeEnterMode!=CKEDITOR.ENTER_BR&&u.editor.config.autoParagraph!==!1?u.editor.activeEnterMode==CKEDITOR.ENTER_DIV?"div":"p":!1)&&(D=T.createElement(D),D.appendBogus(),R.insertNode(D),CKEDITOR.env.needsBrFiller&&(O=D.getBogus())&&O.remove(),R.moveToPosition(D,CKEDITOR.POSITION_BEFORE_END)),(w=R.startPath().block)&&!w.equals(_)&&((O=w.getBogus())&&(O.remove(),b.push(w)),_=w),I.firstNotAllowed&&(f=1),f&&I.isElement){for(w=R.startContainer,x=null;w&&!l[w.getName()][I.name];){if(w.equals(p)){w=null;break}x=w,w=w.getParent()}if(w)x&&(k=R.splitElement(x),u.zombies.push(k),u.zombies.push(x));else{x=p.getName(),K=!v,w=v==C.length-1,x=i(I.node,x);for(var q=[],S=x.length,N=0,A=void 0,Q=0,M=-1;S>N;N++)A=x[N]," "==A?(Q||K&&!N||(q.push(new CKEDITOR.dom.text(" ")),M=q.length),Q=1):(q.push(A),Q=0);w&&M==q.length&&q.pop(),K=q}}if(K){for(;w=K.pop();)R.insertNode(w);K=0}else R.insertNode(I.node);I.lastNotAllowed&&v<C.length-1&&((k=y?E:k)&&R.setEndAt(k,CKEDITOR.POSITION_AFTER_START),f=0),R.collapse()}}u.dontMoveCaret=g,u.bogusNeededBlocks=b}O=u.range;var P;for(k=u.bogusNeededBlocks,K=O.createBookmark();_=u.zombies.pop();)_.getParent()&&(D=O.clone(),D.moveToElementEditStart(_),D.removeEmptyBlocksAtEnd());if(k)for(;_=k.pop();)CKEDITOR.env.needsBrFiller?_.appendBogus():_.append(O.document.createText(" "));for(;_=u.mergeCandidates.pop();)_.mergeSiblings();if(O.moveToBookmark(K),!u.dontMoveCaret){for(_=t(O.startContainer)&&O.startContainer.getChild(O.startOffset-1);_&&t(_)&&!_.is(l.$empty);){if(_.isBlockBoundary())O.moveToPosition(_,CKEDITOR.POSITION_BEFORE_END);else{if(a(_)&&_.getHtml().match(/(\s|&nbsp;)$/g)){P=null;break}P=O.clone(),P.moveToPosition(_,CKEDITOR.POSITION_BEFORE_END)}_=_.getLast(n)}P&&O.moveToRange(P)}m.select(),s(c)}}}(),p=function(){function t(t){return t=new CKEDITOR.dom.walker(t),t.guard=function(t,e){return e?!1:t.type==CKEDITOR.NODE_ELEMENT?t.is(CKEDITOR.dtd.$tableContent):void 0},t.evaluator=function(t){return t.type==CKEDITOR.NODE_ELEMENT},t}function e(t,e,i){return e=t.getDocument().createElement(e),t.append(e,i),e}function i(t){var e,i=t.count();for(i;i-->0;)e=t.getItem(i),CKEDITOR.tools.trim(e.getHtml())||(e.appendBogus(),CKEDITOR.env.ie&&CKEDITOR.env.version<9&&e.getChildCount()&&e.getFirst().remove())}return function(n){var a=n.startContainer,r=a.getAscendant("table",1),o=!1;i(r.getElementsByTag("td")),i(r.getElementsByTag("th")),r=n.clone(),r.setStart(a,0),r=t(r).lastBackward(),r||(r=n.clone(),r.setEndAt(a,CKEDITOR.POSITION_BEFORE_END),r=t(r).lastForward(),o=!0),r||(r=a),r.is("table")?(n.setStartAt(r,CKEDITOR.POSITION_BEFORE_START),n.collapse(!0),r.remove()):(r.is({tbody:1,thead:1,tfoot:1})&&(r=e(r,"tr",o)),r.is("tr")&&(r=e(r,r.getParent().is("thead")?"th":"td",o)),(a=r.getBogus())&&a.remove(),n.moveToPosition(r,o?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END))}}()}(),function(){function t(){var t,e=this._.fakeSelection;e&&(t=this.getSelection(1),t&&t.isHidden()||(e.reset(),e=0)),(e||(e=t||this.getSelection(1),e&&e.getType()!=CKEDITOR.SELECTION_NONE))&&(this.fire("selectionCheck",e),t=this.elementPath(),t.compare(this._.selectionPreviousPath)||(CKEDITOR.env.webkit&&(this._.previousActive=this.document.getActive()),this._.selectionPreviousPath=t,this.fire("selectionChange",{selection:e,path:t})))}function e(){u=!0,h||(i.call(this),h=CKEDITOR.tools.setTimeout(i,200,this))}function i(){h=null,u&&(CKEDITOR.tools.setTimeout(t,0,this),u=!1)}function n(t){function e(e,i){return e&&e.type!=CKEDITOR.NODE_TEXT?t.clone()["moveToElementEdit"+(i?"End":"Start")](e):!1}if(!(t.root instanceof CKEDITOR.editable))return!1;var i=t.startContainer,n=t.getPreviousNode(p,null,i),a=t.getNextNode(p,null,i);return!e(n)&&!e(a,1)&&(n||a||i.type==CKEDITOR.NODE_ELEMENT&&i.isBlockBoundary()&&i.getBogus())?!1:!0}function a(t){return t.getCustomData("cke-fillingChar")}function r(t,e){var i=t&&t.removeCustomData("cke-fillingChar");if(i){if(e!==!1){var n,a=t.getDocument().getSelection().getNative(),r=a&&"None"!=a.type&&a.getRangeAt(0);if(i.getLength()>1&&r&&r.intersectsNode(i.$)){n=[a.anchorOffset,a.focusOffset],r=a.focusNode==i.$&&a.focusOffset>0,a.anchorNode==i.$&&a.anchorOffset>0&&n[0]--,r&&n[1]--;var s;r=a,r.isCollapsed||(s=r.getRangeAt(0),s.setStart(r.anchorNode,r.anchorOffset),s.setEnd(r.focusNode,r.focusOffset),s=s.collapsed),s&&n.unshift(n.pop())}}i.setText(o(i.getText())),n&&(i=a.getRangeAt(0),i.setStart(i.startContainer,n[0]),i.setEnd(i.startContainer,n[1]),a.removeAllRanges(),a.addRange(i))}}function o(t){return t.replace(/\u200B( )?/g,function(t){return t[1]?" ":""})}function s(t,e,i){var n=t.on("focus",function(t){t.cancel()},null,null,-100);if(CKEDITOR.env.ie)var a=t.getDocument().on("selectionchange",function(t){t.cancel()},null,null,-100);else{var r=new CKEDITOR.dom.range(t);r.moveToElementEditStart(t);var o=t.getDocument().$.createRange();o.setStart(r.startContainer.$,r.startOffset),o.collapse(1),e.removeAllRanges(),e.addRange(o)}i&&t.focus(),n.removeListener(),a&&a.removeListener()}function l(t){var e=CKEDITOR.dom.element.createFromHtml('<div data-cke-hidden-sel="1" data-cke-temp="1" style="'+(CKEDITOR.env.ie?"display:none":"position:fixed;top:0;left:-1000px")+'">&nbsp;</div>',t.document);t.fire("lockSnapshot"),t.editable().append(e);var i=t.getSelection(1),n=t.createRange(),a=i.root.on("selectionchange",function(t){t.cancel()},null,null,0);n.setStartAt(e,CKEDITOR.POSITION_AFTER_START),n.setEndAt(e,CKEDITOR.POSITION_BEFORE_END),i.selectRanges([n]),a.removeListener(),t.fire("unlockSnapshot"),t._.hiddenSelectionContainer=e}function c(t){var e={37:1,39:1,8:1,46:1};return function(i){var n=i.data.getKeystroke();if(e[n]){var a=t.getSelection().getRanges(),r=a[0];1==a.length&&r.collapsed&&(n=r[38>n?"getPreviousEditableNode":"getNextEditableNode"]())&&n.type==CKEDITOR.NODE_ELEMENT&&"false"==n.getAttribute("contenteditable")&&(t.getSelection().fake(n),i.data.preventDefault(),i.cancel())}}}function d(t){for(var e=0;e<t.length;e++){var i=t[e];if(i.getCommonAncestor().isReadOnly()&&t.splice(e,1),!i.collapsed){if(i.startContainer.isReadOnly())for(var n,a=i.startContainer;a&&!((n=a.type==CKEDITOR.NODE_ELEMENT)&&a.is("body")||!a.isReadOnly());)n&&"false"==a.getAttribute("contentEditable")&&i.setStartAfter(a),a=a.getParent();a=i.startContainer,n=i.endContainer;var r=i.startOffset,o=i.endOffset,s=i.clone();a&&a.type==CKEDITOR.NODE_TEXT&&(r>=a.getLength()?s.setStartAfter(a):s.setStartBefore(a)),n&&n.type==CKEDITOR.NODE_TEXT&&(o?s.setEndAfter(n):s.setEndBefore(n)),a=new CKEDITOR.dom.walker(s),a.evaluator=function(n){if(n.type==CKEDITOR.NODE_ELEMENT&&n.isReadOnly()){var a=i.clone();return i.setEndBefore(n),i.collapsed&&t.splice(e--,1),n.getPosition(s.endContainer)&CKEDITOR.POSITION_CONTAINS||(a.setStartAfter(n),a.collapsed||t.splice(e+1,0,a)),!0}return!1},a.next()}}return t}var h,u,p=CKEDITOR.dom.walker.invisible(1),f=function(){function t(t){return function(e){var i=e.editor.createRange();return i.moveToClosestEditablePosition(e.selected,t)&&e.editor.getSelection().selectRanges([i]),!1}}function e(t){return function(e){var i,n=e.editor,a=n.createRange();return(i=a.moveToClosestEditablePosition(e.selected,t))||(i=a.moveToClosestEditablePosition(e.selected,!t)),i&&n.getSelection().selectRanges([a]),n.fire("saveSnapshot"),e.selected.remove(),i||(a.moveToElementEditablePosition(n.editable()),n.getSelection().selectRanges([a])),n.fire("saveSnapshot"),!1}}var i=t(),n=t(1);return{37:i,38:i,39:n,40:n,8:e(),46:e(1)}}();CKEDITOR.on("instanceCreated",function(i){function n(){var t=a.getSelection();t&&t.removeAllRanges()}var a=i.editor;a.on("contentDom",function(){var i,n,o=a.document,s=CKEDITOR.document,l=a.editable(),d=o.getBody(),h=o.getDocumentElement(),u=l.isInline();if(CKEDITOR.env.gecko&&l.attachListener(l,"focus",function(t){t.removeListener(),0!==i&&(t=a.getSelection().getNative())&&t.isCollapsed&&t.anchorNode==l.$&&(t=a.createRange(),t.moveToElementEditStart(l),t.select())},null,null,-2),l.attachListener(l,CKEDITOR.env.webkit?"DOMFocusIn":"focus",function(){i&&CKEDITOR.env.webkit&&(i=a._.previousActive&&a._.previousActive.equals(o.getActive())),a.unlockSelection(i),i=0},null,null,-1),l.attachListener(l,"mousedown",function(){i=0}),CKEDITOR.env.ie||CKEDITOR.env.opera||u){var p=function(){n=new CKEDITOR.dom.selection(a.getSelection()),n.lock()};m?l.attachListener(l,"beforedeactivate",p,null,null,-1):l.attachListener(a,"selectionCheck",p,null,null,-1),l.attachListener(l,CKEDITOR.env.webkit?"DOMFocusOut":"blur",function(){a.lockSelection(n),i=1},null,null,-1),l.attachListener(l,"mousedown",function(){i=0})}if(CKEDITOR.env.ie&&!u){var f;if(l.attachListener(l,"mousedown",function(t){2==t.data.$.button&&(t=a.document.getSelection(),t&&t.getType()!=CKEDITOR.SELECTION_NONE||(f=a.window.getScrollPosition()))}),l.attachListener(l,"mouseup",function(t){2==t.data.$.button&&f&&(a.document.$.documentElement.scrollLeft=f.x,a.document.$.documentElement.scrollTop=f.y),f=null}),"BackCompat"!=o.$.compatMode&&((CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)&&h.on("mousedown",function(t){function e(t){if(t=t.data.$,n){var e=d.$.createTextRange();try{e.moveToPoint(t.x,t.y)}catch(i){}n.setEndPoint(r.compareEndPoints("StartToStart",e)<0?"EndToEnd":"StartToStart",e),n.select()}}function i(){h.removeListener("mousemove",e),s.removeListener("mouseup",i),h.removeListener("mouseup",i),n.select()}if(t=t.data,t.getTarget().is("html")&&t.$.y<h.$.clientHeight&&t.$.x<h.$.clientWidth){var n=d.$.createTextRange();try{n.moveToPoint(t.$.x,t.$.y)}catch(a){}var r=n.duplicate();h.on("mousemove",e),s.on("mouseup",i),h.on("mouseup",i)}}),CKEDITOR.env.version>7&&CKEDITOR.env.version<11)){h.on("mousedown",function(t){t.data.getTarget().is("html")&&(s.on("mouseup",g),h.on("mouseup",g))});var g=function(){s.removeListener("mouseup",g),h.removeListener("mouseup",g);var t=CKEDITOR.document.$.selection,e=t.createRange();"None"!=t.type&&e.parentElement().ownerDocument==o.$&&e.select()}}}if(l.attachListener(l,"selectionchange",t,a),l.attachListener(l,"keyup",e,a),l.attachListener(l,CKEDITOR.env.webkit?"DOMFocusIn":"focus",function(){a.forceNextSelectionCheck(),a.selectionChange(1)}),u?CKEDITOR.env.webkit||CKEDITOR.env.gecko:CKEDITOR.env.opera){var v;l.attachListener(l,"mousedown",function(){v=1}),l.attachListener(o.getDocumentElement(),"mouseup",function(){v&&e.call(a),v=0})}else l.attachListener(CKEDITOR.env.ie?l:o.getDocumentElement(),"mouseup",e,a);CKEDITOR.env.webkit&&l.attachListener(o,"keydown",function(t){switch(t.data.getKey()){case 13:case 33:case 34:case 35:case 36:case 37:case 39:case 8:case 45:case 46:r(l)}},null,null,-1),l.attachListener(l,"keydown",c(a),null,null,-1)}),a.on("contentDomUnload",a.forceNextSelectionCheck,a),a.on("dataReady",function(){delete a._.fakeSelection,delete a._.hiddenSelectionContainer,a.selectionChange(1)}),a.on("loadSnapshot",function(){var t=a.editable().getLast(function(t){return t.type==CKEDITOR.NODE_ELEMENT});t&&t.hasAttribute("data-cke-hidden-sel")&&t.remove()},null,null,100),CKEDITOR.env.ie9Compat&&a.on("beforeDestroy",n,null,null,9),CKEDITOR.env.webkit&&a.on("setData",n),a.on("contentDomUnload",function(){a.unlockSelection()}),a.on("key",function(t){if("wysiwyg"==a.mode){var e=a.getSelection();if(e.isFake){var i=f[t.data.keyCode];if(i)return i({editor:a,selected:e.getSelectedElement(),selection:e,keyEvent:t})}}})}),CKEDITOR.on("instanceReady",function(t){var e=t.editor;if(CKEDITOR.env.webkit){e.on("selectionChange",function(){var t=e.editable(),i=a(t);i&&(i.getCustomData("ready")?r(t):i.setCustomData("ready",1))},null,null,-1),e.on("beforeSetMode",function(){r(e.editable())},null,null,-1);var i,n,t=function(){var t=e.editable();if(t&&(t=a(t))){var r=e.document.$.defaultView.getSelection();"Caret"==r.type&&r.anchorNode==t.$&&(n=1),i=t.getText(),t.setText(o(i))}},s=function(){var t=e.editable();t&&(t=a(t))&&(t.setText(i),n&&(e.document.$.defaultView.getSelection().setPosition(t.$,t.getLength()),n=0))};e.on("beforeUndoImage",t),e.on("afterUndoImage",s),e.on("beforeGetData",t,null,null,0),e.on("getData",s)}}),CKEDITOR.editor.prototype.selectionChange=function(i){(i?t:e).call(this)},CKEDITOR.editor.prototype.getSelection=function(t){return!this._.savedSelection&&!this._.fakeSelection||t?(t=this.editable())&&"wysiwyg"==this.mode?new CKEDITOR.dom.selection(t):null:this._.savedSelection||this._.fakeSelection},CKEDITOR.editor.prototype.lockSelection=function(t){return t=t||this.getSelection(1),t.getType()!=CKEDITOR.SELECTION_NONE?(!t.isLocked&&t.lock(),this._.savedSelection=t,!0):!1},CKEDITOR.editor.prototype.unlockSelection=function(t){var e=this._.savedSelection;return e?(e.unlock(t),delete this._.savedSelection,!0):!1},CKEDITOR.editor.prototype.forceNextSelectionCheck=function(){delete this._.selectionPreviousPath},CKEDITOR.dom.document.prototype.getSelection=function(){return new CKEDITOR.dom.selection(this)},CKEDITOR.dom.range.prototype.select=function(){var t=this.root instanceof CKEDITOR.editable?this.root.editor.getSelection():new CKEDITOR.dom.selection(this.root);return t.selectRanges([this]),t},CKEDITOR.SELECTION_NONE=1,CKEDITOR.SELECTION_TEXT=2,CKEDITOR.SELECTION_ELEMENT=3;var m="function"!=typeof window.getSelection,g=1;CKEDITOR.dom.selection=function(t){if(t instanceof CKEDITOR.dom.selection)var e=t,t=t.root;var i=t instanceof CKEDITOR.dom.element;if(this.rev=e?e.rev:g++,this.document=t instanceof CKEDITOR.dom.document?t:t.getDocument(),this.root=t=i?t:this.document.getBody(),this.isLocked=0,this._={cache:{}},e)return CKEDITOR.tools.extend(this._.cache,e._.cache),this.isFake=e.isFake,this.isLocked=e.isLocked,this;if(e=m?this.document.$.selection:this.document.getWindow().$.getSelection(),CKEDITOR.env.webkit)("None"==e.type&&this.document.getActive().equals(t)||"Caret"==e.type&&e.anchorNode.nodeType==CKEDITOR.NODE_DOCUMENT)&&s(t,e);
else if(CKEDITOR.env.gecko)e&&this.document.getActive().equals(t)&&e.anchorNode&&e.anchorNode.nodeType==CKEDITOR.NODE_DOCUMENT&&s(t,e,!0);else if(CKEDITOR.env.ie){var n;try{n=this.document.getActive()}catch(a){}m?"None"==e.type&&n&&n.equals(this.document.getDocumentElement())&&s(t,null,!0):((e=e&&e.anchorNode)&&(e=new CKEDITOR.dom.node(e)),n&&n.equals(this.document.getDocumentElement())&&e&&(t.equals(e)||t.contains(e))&&s(t,null,!0))}n=this.getNative();var r,o;if(n)if(n.getRangeAt)r=(o=n.rangeCount&&n.getRangeAt(0))&&new CKEDITOR.dom.node(o.commonAncestorContainer);else{try{o=n.createRange()}catch(l){}r=o&&CKEDITOR.dom.element.get(o.item&&o.item(0)||o.parentElement())}return(!r||r.type!=CKEDITOR.NODE_ELEMENT&&r.type!=CKEDITOR.NODE_TEXT||!this.root.equals(r)&&!this.root.contains(r))&&(this._.cache.type=CKEDITOR.SELECTION_NONE,this._.cache.startElement=null,this._.cache.selectedElement=null,this._.cache.selectedText="",this._.cache.ranges=new CKEDITOR.dom.rangeList),this};var v={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};CKEDITOR.dom.selection.prototype={getNative:function(){return void 0!==this._.cache.nativeSel?this._.cache.nativeSel:this._.cache.nativeSel=m?this.document.$.selection:this.document.getWindow().$.getSelection()},getType:m?function(){var t=this._.cache;if(t.type)return t.type;var e=CKEDITOR.SELECTION_NONE;try{var i=this.getNative(),n=i.type;"Text"==n&&(e=CKEDITOR.SELECTION_TEXT),"Control"==n&&(e=CKEDITOR.SELECTION_ELEMENT),i.createRange().parentElement()&&(e=CKEDITOR.SELECTION_TEXT)}catch(a){}return t.type=e}:function(){var t=this._.cache;if(t.type)return t.type;var e=CKEDITOR.SELECTION_TEXT,i=this.getNative();if(i&&i.rangeCount){if(1==i.rangeCount){var i=i.getRangeAt(0),n=i.startContainer;n==i.endContainer&&1==n.nodeType&&i.endOffset-i.startOffset==1&&v[n.childNodes[i.startOffset].nodeName.toLowerCase()]&&(e=CKEDITOR.SELECTION_ELEMENT)}}else e=CKEDITOR.SELECTION_NONE;return t.type=e},getRanges:function(){var t=m?function(){function t(t){return new CKEDITOR.dom.node(t).getIndex()}var e=function(e,i){e=e.duplicate(),e.collapse(i);var n=e.parentElement();if(!n.hasChildNodes())return{container:n,offset:0};for(var a,r,o,s,l=n.children,c=e.duplicate(),d=0,h=l.length-1,u=-1;h>=d;)if(u=Math.floor((d+h)/2),a=l[u],c.moveToElementText(a),o=c.compareEndPoints("StartToStart",e),o>0)h=u-1;else{if(!(0>o))return{container:n,offset:t(a)};d=u+1}if(-1==u||u==l.length-1&&0>o){if(c.moveToElementText(n),c.setEndPoint("StartToStart",e),c=c.text.replace(/(\r\n|\r)/g,"\n").length,l=n.childNodes,!c)return a=l[l.length-1],a.nodeType!=CKEDITOR.NODE_TEXT?{container:n,offset:l.length}:{container:a,offset:a.nodeValue.length};for(n=l.length;c>0&&n>0;)r=l[--n],r.nodeType==CKEDITOR.NODE_TEXT&&(s=r,c-=r.nodeValue.length);return{container:s,offset:-c}}if(c.collapse(o>0?!0:!1),c.setEndPoint(o>0?"StartToStart":"EndToStart",e),c=c.text.replace(/(\r\n|\r)/g,"\n").length,!c)return{container:n,offset:t(a)+(o>0?0:1)};for(;c>0;)try{r=a[o>0?"previousSibling":"nextSibling"],r.nodeType==CKEDITOR.NODE_TEXT&&(c-=r.nodeValue.length,s=r),a=r}catch(p){return{container:n,offset:t(a)}}return{container:s,offset:o>0?-c:s.nodeValue.length+c}};return function(){var t=this.getNative(),i=t&&t.createRange(),n=this.getType();if(!t)return[];if(n==CKEDITOR.SELECTION_TEXT)return t=new CKEDITOR.dom.range(this.root),n=e(i,!0),t.setStart(new CKEDITOR.dom.node(n.container),n.offset),n=e(i),t.setEnd(new CKEDITOR.dom.node(n.container),n.offset),t.endContainer.getPosition(t.startContainer)&CKEDITOR.POSITION_PRECEDING&&t.endOffset<=t.startContainer.getIndex()&&t.collapse(),[t];if(n==CKEDITOR.SELECTION_ELEMENT){for(var n=[],a=0;a<i.length;a++){for(var r=i.item(a),o=r.parentNode,s=0,t=new CKEDITOR.dom.range(this.root);s<o.childNodes.length&&o.childNodes[s]!=r;s++);t.setStart(new CKEDITOR.dom.node(o),s),t.setEnd(new CKEDITOR.dom.node(o),s+1),n.push(t)}return n}return[]}}():function(){var t,e=[],i=this.getNative();if(!i)return e;for(var n=0;n<i.rangeCount;n++){var a=i.getRangeAt(n);t=new CKEDITOR.dom.range(this.root),t.setStart(new CKEDITOR.dom.node(a.startContainer),a.startOffset),t.setEnd(new CKEDITOR.dom.node(a.endContainer),a.endOffset),e.push(t)}return e};return function(e){var i=this._.cache,n=i.ranges;return n||(i.ranges=n=new CKEDITOR.dom.rangeList(t.call(this))),e?d(new CKEDITOR.dom.rangeList(n.slice())):n}}(),getStartElement:function(){var t=this._.cache;if(void 0!==t.startElement)return t.startElement;var e;switch(this.getType()){case CKEDITOR.SELECTION_ELEMENT:return this.getSelectedElement();case CKEDITOR.SELECTION_TEXT:var i=this.getRanges()[0];if(i){if(i.collapsed)e=i.startContainer,e.type!=CKEDITOR.NODE_ELEMENT&&(e=e.getParent());else{for(i.optimize();e=i.startContainer,i.startOffset==(e.getChildCount?e.getChildCount():e.getLength())&&!e.isBlockBoundary();)i.setStartAfter(e);if(e=i.startContainer,e.type!=CKEDITOR.NODE_ELEMENT)return e.getParent();if(e=e.getChild(i.startOffset),e&&e.type==CKEDITOR.NODE_ELEMENT)for(i=e.getFirst();i&&i.type==CKEDITOR.NODE_ELEMENT;)e=i,i=i.getFirst();else e=i.startContainer}e=e.$}}return t.startElement=e?new CKEDITOR.dom.element(e):null},getSelectedElement:function(){var t=this._.cache;if(void 0!==t.selectedElement)return t.selectedElement;var e=this,i=CKEDITOR.tools.tryThese(function(){return e.getNative().createRange().item(0)},function(){for(var t,i,n=e.getRanges()[0].clone(),a=2;!(!a||(t=n.getEnclosedNode())&&t.type==CKEDITOR.NODE_ELEMENT&&v[t.getName()]&&(i=t));a--)n.shrink(CKEDITOR.SHRINK_ELEMENT);return i&&i.$});return t.selectedElement=i?new CKEDITOR.dom.element(i):null},getSelectedText:function(){var t=this._.cache;if(void 0!==t.selectedText)return t.selectedText;var e=this.getNative(),e=m?"Control"==e.type?"":e.createRange().text:e.toString();return t.selectedText=e},lock:function(){this.getRanges(),this.getStartElement(),this.getSelectedElement(),this.getSelectedText(),this._.cache.nativeSel=null,this.isLocked=1},unlock:function(t){if(this.isLocked){if(t)var e=this.getSelectedElement(),i=!e&&this.getRanges(),n=this.isFake;this.isLocked=0,this.reset(),t&&(t=e||i[0]&&i[0].getCommonAncestor())&&t.getAscendant("body",1)&&(n?this.fake(e):e?this.selectElement(e):this.selectRanges(i))}},reset:function(){this._.cache={},this.isFake=0;var t=this.root.editor;if(t&&t._.fakeSelection&&this.rev==t._.fakeSelection.rev){delete t._.fakeSelection;var e=t._.hiddenSelectionContainer;e&&(t.fire("lockSnapshot"),e.remove(),t.fire("unlockSnapshot")),delete t._.hiddenSelectionContainer}this.rev=g++},selectElement:function(t){var e=new CKEDITOR.dom.range(this.root);e.setStartBefore(t),e.setEndAfter(t),this.selectRanges([e])},selectRanges:function(t){var e=this.root.editor,e=e&&e._.hiddenSelectionContainer;if(this.reset(),e)for(var i,e=this.root,a=0;a<t.length;++a)i=t[a],i.endContainer.equals(e)&&(i.endOffset=Math.min(i.endOffset,e.getChildCount()));if(t.length)if(this.isLocked){var o=CKEDITOR.document.getActive();this.unlock(),this.selectRanges(t),this.lock(),!o.equals(this.root)&&o.focus()}else{var s,l,c;if((1!=t.length||(c=t[0]).collapsed||!(s=c.getEnclosedNode())||s.type!=CKEDITOR.NODE_ELEMENT||(c=c.clone(),c.shrink(CKEDITOR.SHRINK_ELEMENT,!0),(l=c.getEnclosedNode())&&l.type==CKEDITOR.NODE_ELEMENT&&(s=l),"false"!=s.getAttribute("contenteditable")))&&(s=void 0),s)this.fake(s);else{if(m){c=CKEDITOR.dom.walker.whitespaces(!0),l=/\ufeff|\u00a0/,e={table:1,tbody:1,tr:1},t.length>1&&(s=t[t.length-1],t[0].setEnd(s.endContainer,s.endOffset)),s=t[0];var d,h,u,t=s.collapsed;if((i=s.getEnclosedNode())&&i.type==CKEDITOR.NODE_ELEMENT&&i.getName()in v&&(!i.is("a")||!i.getText()))try{return u=i.$.createControlRange(),u.addElement(i.$),void u.select()}catch(p){}(s.startContainer.type==CKEDITOR.NODE_ELEMENT&&s.startContainer.getName()in e||s.endContainer.type==CKEDITOR.NODE_ELEMENT&&s.endContainer.getName()in e)&&s.shrink(CKEDITOR.NODE_ELEMENT,!0),u=s.createBookmark(),e=u.startNode,t||(o=u.endNode),u=s.document.$.body.createTextRange(),u.moveToElementText(e.$),u.moveStart("character",1),o?(l=s.document.$.body.createTextRange(),l.moveToElementText(o.$),u.setEndPoint("EndToEnd",l),u.moveEnd("character",-1)):(d=e.getNext(c),h=e.hasAscendant("pre"),d=!(d&&d.getText&&d.getText().match(l))&&(h||!e.hasPrevious()||e.getPrevious().is&&e.getPrevious().is("br")),h=s.document.createElement("span"),h.setHtml("&#65279;"),h.insertBefore(e),d&&s.document.createText("").insertBefore(e)),s.setStartBefore(e),e.remove(),t?(d?(u.moveStart("character",-1),u.select(),s.document.$.selection.clear()):u.select(),s.moveToPosition(h,CKEDITOR.POSITION_BEFORE_START),h.remove()):(s.setEndBefore(o),o.remove(),u.select())}else{if(o=this.getNative(),!o)return;for(CKEDITOR.env.opera&&(u=this.document.$.createRange(),u.selectNodeContents(this.root.$),o.addRange(u)),this.removeAllRanges(),u=0;u<t.length;u++)if(u<t.length-1&&(s=t[u],d=t[u+1],l=s.clone(),l.setStart(s.endContainer,s.endOffset),l.setEnd(d.startContainer,d.startOffset),!l.collapsed&&(l.shrink(CKEDITOR.NODE_ELEMENT,!0),h=l.getCommonAncestor(),l=l.getEnclosedNode(),h.isReadOnly()||l&&l.isReadOnly())))d.setStart(s.startContainer,s.startOffset),t.splice(u--,1);else{s=t[u],h=this.document.$.createRange(),d=s.startContainer,CKEDITOR.env.opera&&s.collapsed&&d.type==CKEDITOR.NODE_ELEMENT&&(l=d.getChild(s.startOffset-1),c=d.getChild(s.startOffset),(!l&&!c&&d.is(CKEDITOR.dtd.$removeEmpty)||l&&l.type==CKEDITOR.NODE_ELEMENT||c&&c.type==CKEDITOR.NODE_ELEMENT)&&(s.insertNode(this.document.createText("")),s.collapse(1))),s.collapsed&&CKEDITOR.env.webkit&&n(s)&&(d=this.root,r(d,!1),l=d.getDocument().createText("​"),d.setCustomData("cke-fillingChar",l),s.insertNode(l),(d=l.getNext())&&!l.getPrevious()&&d.type==CKEDITOR.NODE_ELEMENT&&"br"==d.getName()?(r(this.root),s.moveToPosition(d,CKEDITOR.POSITION_BEFORE_START)):s.moveToPosition(l,CKEDITOR.POSITION_AFTER_END)),h.setStart(s.startContainer.$,s.startOffset);try{h.setEnd(s.endContainer.$,s.endOffset)}catch(f){if(!(f.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0))throw f;s.collapse(1),h.setEnd(s.endContainer.$,s.endOffset)}o.addRange(h)}}this.reset(),this.root.fire("selectionchange")}}},fake:function(t){var e=this.root.editor;this.reset(),l(e);var i=this._.cache,n=new CKEDITOR.dom.range(this.root);n.setStartBefore(t),n.setEndAfter(t),i.ranges=new CKEDITOR.dom.rangeList(n),i.selectedElement=i.startElement=t,i.type=CKEDITOR.SELECTION_ELEMENT,i.selectedText=i.nativeSel=null,this.isFake=1,this.rev=g++,e._.fakeSelection=this,this.root.fire("selectionchange")},isHidden:function(){var t=this.getCommonAncestor();return t&&t.type==CKEDITOR.NODE_TEXT&&(t=t.getParent()),!(!t||!t.data("cke-hidden-sel"))},createBookmarks:function(t){return t=this.getRanges().createBookmarks(t),this.isFake&&(t.isFake=1),t},createBookmarks2:function(t){return t=this.getRanges().createBookmarks2(t),this.isFake&&(t.isFake=1),t},selectBookmarks:function(t){for(var e=[],i=0;i<t.length;i++){var n=new CKEDITOR.dom.range(this.root);n.moveToBookmark(t[i]),e.push(n)}return t.isFake?this.fake(e[0].getEnclosedNode()):this.selectRanges(e),this},getCommonAncestor:function(){var t=this.getRanges();return t.length?t[0].startContainer.getCommonAncestor(t[t.length-1].endContainer):null},scrollIntoView:function(){this.type!=CKEDITOR.SELECTION_NONE&&this.getRanges()[0].scrollIntoView()},removeAllRanges:function(){if(this.getType()!=CKEDITOR.SELECTION_NONE){var t=this.getNative();try{t&&t[m?"empty":"removeAllRanges"]()}catch(e){}this.reset()}}}}(),CKEDITOR.editor.prototype.attachStyleStateChange=function(t,e){var i=this._.styleStateChangeCallbacks;i||(i=this._.styleStateChangeCallbacks=[],this.on("selectionChange",function(t){for(var e=0;e<i.length;e++){var n=i[e],a=n.style.checkActive(t.data.path)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF;n.fn.call(this,a)}})),i.push({style:t,fn:e})},CKEDITOR.STYLE_BLOCK=1,CKEDITOR.STYLE_INLINE=2,CKEDITOR.STYLE_OBJECT=3,function(){function t(t,e){for(var i,n;(t=t.getParent())&&!t.equals(e);)if(t.getAttribute("data-nostyle"))i=t;else if(!n){var a=t.getAttribute("contentEditable");"false"==a?i=t:"true"==a&&(n=1)}return i}function e(i){var a=i.document;if(i.collapsed)a=g(this,a),i.insertNode(a),i.moveToPosition(a,CKEDITOR.POSITION_BEFORE_END);else{var r,o=this.element,s=this._.definition,l=s.ignoreReadonly,c=l||s.includeReadonly;void 0==c&&(c=i.root.getCustomData("cke_includeReadonly"));var d=CKEDITOR.dtd[o];d||(r=!0,d=CKEDITOR.dtd.span),i.enlarge(CKEDITOR.ENLARGE_INLINE,1),i.trim();var h,u=i.createBookmark(),f=u.startNode,m=u.endNode,v=f;if(!l){var C=i.getCommonAncestor(),l=t(f,C),C=t(m,C);l&&(v=l.getNextSourceNode(!0)),C&&(m=C)}for(v.getPosition(m)==CKEDITOR.POSITION_FOLLOWING&&(v=0);v;){if(l=!1,v.equals(m))v=null,l=!0;else{var I=v.type==CKEDITOR.NODE_ELEMENT?v.getName():null,C=I&&"false"==v.getAttribute("contentEditable"),b=I&&v.getAttribute("data-nostyle");if(I&&v.data("cke-bookmark")){v=v.getNextSourceNode(!0);continue}if(C&&c&&CKEDITOR.dtd.$block[I])for(var E=v,y=n(E),T=void 0,R=y.length,w=0,E=R&&new CKEDITOR.dom.range(E.getDocument());R>w;++w){var T=y[w],_=CKEDITOR.filter.instances[T.data("cke-filter")];(_?_.check(this):1)&&(E.selectNodeContents(T),e.call(this,E))}if(y=I?!d[I]||b?0:C&&!c?0:(v.getPosition(m)|D)==D&&(!s.childRule||s.childRule(v)):1){if(!(y=v.getParent())||!(y.getDtd()||CKEDITOR.dtd.span)[o]&&!r||s.parentRule&&!s.parentRule(y))l=!0;else if(h||I&&CKEDITOR.dtd.$removeEmpty[I]&&(v.getPosition(m)|D)!=D||(h=i.clone(),h.setStartBefore(v)),I=v.type,I==CKEDITOR.NODE_TEXT||C||I==CKEDITOR.NODE_ELEMENT&&!v.getChildCount()){for(var k,I=v;(l=!I.getNext(O))&&(k=I.getParent(),d[k.getName()])&&(k.getPosition(f)|x)==x&&(!s.childRule||s.childRule(k));)I=k;h.setEndAfter(I)}}else l=!0;v=v.getNextSourceNode(b||C)}if(l&&h&&!h.collapsed){for(var K,q,S,l=g(this,a),C=l.hasAttributes(),b=h.getCommonAncestor(),I={},y={},T={},R={};l&&b;){if(b.getName()==o){for(K in s.attributes)!R[K]&&(S=b.getAttribute(q))&&(l.getAttribute(K)==S?y[K]=1:R[K]=1);for(q in s.styles)!T[q]&&(S=b.getStyle(q))&&(l.getStyle(q)==S?I[q]=1:T[q]=1)}b=b.getParent()}for(K in y)l.removeAttribute(K);for(q in I)l.removeStyle(q);C&&!l.hasAttributes()&&(l=null),l?(h.extractContents().appendTo(l),h.insertNode(l),p.call(this,l),l.mergeSiblings(),CKEDITOR.env.ie||l.$.normalize()):(l=new CKEDITOR.dom.element("span"),h.extractContents().appendTo(l),h.insertNode(l),p.call(this,l),l.remove(!0)),h=null}}i.moveToBookmark(u),i.shrink(CKEDITOR.SHRINK_TEXT),i.shrink(CKEDITOR.NODE_ELEMENT,!0)}}function i(t){function e(){for(var t=new CKEDITOR.dom.elementPath(n.getParent()),e=new CKEDITOR.dom.elementPath(c.getParent()),i=null,a=null,r=0;r<t.elements.length;r++){var o=t.elements[r];if(o==t.block||o==t.blockLimit)break;d.checkElementRemovable(o)&&(i=o)}for(r=0;r<e.elements.length&&(o=e.elements[r],o!=e.block&&o!=e.blockLimit);r++)d.checkElementRemovable(o)&&(a=o);a&&c.breakParent(a),i&&n.breakParent(i)}t.enlarge(CKEDITOR.ENLARGE_INLINE,1);var i=t.createBookmark(),n=i.startNode;if(t.collapsed){for(var a,r,o=new CKEDITOR.dom.elementPath(n.getParent(),t.root),s=0;s<o.elements.length&&(r=o.elements[s])&&(r!=o.block&&r!=o.blockLimit);s++)if(this.checkElementRemovable(r)){var l;t.collapsed&&(t.checkBoundaryOfElement(r,CKEDITOR.END)||(l=t.checkBoundaryOfElement(r,CKEDITOR.START)))?(a=r,a.match=l?"start":"end"):(r.mergeSiblings(),r.is(this.element)?u.call(this,r):f(r,I(this)[r.getName()]))}if(a){for(r=n,s=0;l=o.elements[s],!l.equals(a);s++)l.match||(l=l.clone(),l.append(r),r=l);r["start"==a.match?"insertBefore":"insertAfter"](a)}}else{var c=i.endNode,d=this;for(e(),o=n;!o.equals(c);)a=o.getNextSourceNode(),o.type==CKEDITOR.NODE_ELEMENT&&this.checkElementRemovable(o)&&(o.getName()==this.element?u.call(this,o):f(o,I(this)[o.getName()]),a.type==CKEDITOR.NODE_ELEMENT&&a.contains(n)&&(e(),a=n.getNext())),o=a}t.moveToBookmark(i),t.shrink(CKEDITOR.NODE_ELEMENT,!0)}function n(t){var e=[];return t.forEach(function(t){return"true"==t.getAttribute("contenteditable")?(e.push(t),!1):void 0},CKEDITOR.NODE_ELEMENT,!0),e}function a(t){var e=t.getEnclosedNode()||t.getCommonAncestor(!1,!0);(t=new CKEDITOR.dom.elementPath(e,t.root).contains(this.element,1))&&!t.isReadOnly()&&v(t,this)}function r(t){var e=t.getCommonAncestor(!0,!0);if(t=new CKEDITOR.dom.elementPath(e,t.root).contains(this.element,1)){var e=this._.definition,i=e.attributes;if(i)for(var n in i)t.removeAttribute(n,i[n]);if(e.styles)for(var a in e.styles)e.styles.hasOwnProperty(a)&&t.removeStyle(a)}}function o(t){var e=t.createBookmark(!0),i=t.createIterator();i.enforceRealBlocks=!0,this._.enterMode&&(i.enlargeBr=this._.enterMode!=CKEDITOR.ENTER_BR);for(var n,a,r=t.document;n=i.getNextParagraph();)!n.isReadOnly()&&(i.activeFilter?i.activeFilter.check(this):1)&&(a=g(this,r,n),l(n,a));t.moveToBookmark(e)}function s(t){var e=t.createBookmark(1),i=t.createIterator();i.enforceRealBlocks=!0,i.enlargeBr=this._.enterMode!=CKEDITOR.ENTER_BR;for(var n,a;n=i.getNextParagraph();)this.checkElementRemovable(n)&&(n.is("pre")?((a=this._.enterMode==CKEDITOR.ENTER_BR?null:t.document.createElement(this._.enterMode==CKEDITOR.ENTER_P?"p":"div"))&&n.copyAttributes(a),l(n,a)):u.call(this,n));t.moveToBookmark(e)}function l(t,e){var i=!e;i&&(e=t.getDocument().createElement("div"),t.copyAttributes(e));var n=e&&e.is("pre"),a=t.is("pre"),r=!n&&a;if(n&&!a){if(a=e,(r=t.getBogus())&&r.remove(),r=t.getHtml(),r=d(r,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,""),r=r.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1"),r=r.replace(/([ \t\n\r]+|&nbsp;)/g," "),r=r.replace(/<br\b[^>]*>/gi,"\n"),CKEDITOR.env.ie){var o=t.getDocument().createElement("div");o.append(a),a.$.outerHTML="<pre>"+r+"</pre>",a.copyAttributes(o.getFirst()),a=o.getFirst().remove()}else a.setHtml(r);e=a}else r?e=h(i?[t.getHtml()]:c(t),e):t.moveChildren(e);if(e.replace(t),n){var s,i=e;(s=i.getPrevious(_))&&s.type==CKEDITOR.NODE_ELEMENT&&s.is("pre")&&(n=d(s.getHtml(),/\n$/,"")+"\n\n"+d(i.getHtml(),/^\n/,""),CKEDITOR.env.ie?i.$.outerHTML="<pre>"+n+"</pre>":i.setHtml(n),s.remove())}else i&&m(e)}function c(t){t.getName();var e=[];return d(t.getOuterHtml(),/(\S\s*)\n(?:\s|(<span[^>]+data-cke-bookmark.*?\/span>))*\n(?!$)/gi,function(t,e,i){return e+"</pre>"+i+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(t,i){e.push(i)}),e}function d(t,e,i){var n="",a="",t=t.replace(/(^<span[^>]+data-cke-bookmark.*?\/span>)|(<span[^>]+data-cke-bookmark.*?\/span>$)/gi,function(t,e,i){return e&&(n=e),i&&(a=i),""});return n+t.replace(e,i)+a}function h(t,e){var i;t.length>1&&(i=new CKEDITOR.dom.documentFragment(e.getDocument()));for(var n=0;n<t.length;n++){var a=t[n],a=a.replace(/(\r\n|\r)/g,"\n"),a=d(a,/^[ \t]*\n/,""),a=d(a,/\n$/,""),a=d(a,/^[ \t]+|[ \t]+$/g,function(t,e){return 1==t.length?"&nbsp;":e?" "+CKEDITOR.tools.repeat("&nbsp;",t.length-1):CKEDITOR.tools.repeat("&nbsp;",t.length-1)+" "}),a=a.replace(/\n/g,"<br>"),a=a.replace(/[ \t]{2,}/g,function(t){return CKEDITOR.tools.repeat("&nbsp;",t.length-1)+" "});if(i){var r=e.clone();r.setHtml(a),i.append(r)}else e.setHtml(a)}return i||e}function u(t,e){var i,n=this._.definition,a=n.attributes,n=n.styles,r=I(this)[t.getName()],o=CKEDITOR.tools.isEmpty(a)&&CKEDITOR.tools.isEmpty(n);for(i in a)("class"==i||this._.definition.fullMatch)&&t.getAttribute(i)!=b(i,a[i])||e&&"data-"==i.slice(0,5)||(o=t.hasAttribute(i),t.removeAttribute(i));for(var s in n)this._.definition.fullMatch&&t.getStyle(s)!=b(s,n[s],!0)||(o=o||!!t.getStyle(s),t.removeStyle(s));f(t,r,y[t.getName()]),o&&(this._.definition.alwaysRemoveElement?m(t,1):!CKEDITOR.dtd.$block[t.getName()]||this._.enterMode==CKEDITOR.ENTER_BR&&!t.hasAttributes()?m(t):t.renameNode(this._.enterMode==CKEDITOR.ENTER_P?"p":"div"))}function p(t){for(var e,i=I(this),n=t.getElementsByTag(this.element),a=n.count();--a>=0;)e=n.getItem(a),e.isReadOnly()||u.call(this,e,!0);for(var r in i)if(r!=this.element)for(n=t.getElementsByTag(r),a=n.count()-1;a>=0;a--)e=n.getItem(a),e.isReadOnly()||f(e,i[r])}function f(t,e,i){if(e=e&&e.attributes)for(var n=0;n<e.length;n++){var a,r=e[n][0];if(a=t.getAttribute(r)){var o=e[n][1];(null===o||o.test&&o.test(a)||"string"==typeof o&&a==o)&&t.removeAttribute(r)}}i||m(t)}function m(t,e){if(!t.hasAttributes()||e)if(CKEDITOR.dtd.$block[t.getName()]){var i=t.getPrevious(_),n=t.getNext(_);i&&(i.type==CKEDITOR.NODE_TEXT||!i.isBlockBoundary({br:1}))&&t.append("br",1),n&&(n.type==CKEDITOR.NODE_TEXT||!n.isBlockBoundary({br:1}))&&t.append("br"),t.remove(!0)}else i=t.getFirst(),n=t.getLast(),t.remove(!0),i&&(i.type==CKEDITOR.NODE_ELEMENT&&i.mergeSiblings(),n&&!i.equals(n)&&n.type==CKEDITOR.NODE_ELEMENT&&n.mergeSiblings())}function g(t,e,i){var n;return n=t.element,"*"==n&&(n="span"),n=new CKEDITOR.dom.element(n,e),i&&i.copyAttributes(n),n=v(n,t),e.getCustomData("doc_processing_style")&&n.hasAttribute("id")?n.removeAttribute("id"):e.setCustomData("doc_processing_style",1),n}function v(t,e){var i=e._.definition,n=i.attributes,i=CKEDITOR.style.getStyleText(i);if(n)for(var a in n)t.setAttribute(a,n[a]);return i&&t.setAttribute("style",i),t}function C(t,e){for(var i in t)t[i]=t[i].replace(w,function(t,i){return e[i]})}function I(t){if(t._.overrides)return t._.overrides;var e=t._.overrides={},i=t._.definition.overrides;if(i){CKEDITOR.tools.isArray(i)||(i=[i]);for(var n=0;n<i.length;n++){var a,r,o=i[n];if("string"==typeof o?a=o.toLowerCase():(a=o.element?o.element.toLowerCase():t.element,r=o.attributes),o=e[a]||(e[a]={}),r){var s,o=o.attributes=o.attributes||[];for(s in r)o.push([s.toLowerCase(),r[s]])}}}return e}function b(t,e,i){var n=new CKEDITOR.dom.element("span");return n[i?"setStyle":"setAttribute"](t,e),n[i?"getStyle":"getAttribute"](t)}function E(t,e){for(var i,n=t.document,a=t.getRanges(),r=e?this.removeFromRange:this.applyToRange,o=a.createIterator();i=o.getNextRange();)r.call(this,i);t.selectRanges(a),n.removeCustomData("doc_processing_style")}var y={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,section:1,header:1,footer:1,nav:1,article:1,aside:1,figure:1,dialog:1,hgroup:1,time:1,meter:1,menu:1,command:1,keygen:1,output:1,progress:1,details:1,datagrid:1,datalist:1},T={a:1,embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1,audio:1,video:1},R=/\s*(?:;\s*|$)/,w=/#\((.+?)\)/g,O=CKEDITOR.dom.walker.bookmark(0,1),_=CKEDITOR.dom.walker.whitespaces(1);CKEDITOR.style=function(t,e){var i=t.attributes;i&&i.style&&(t.styles=CKEDITOR.tools.extend({},t.styles,CKEDITOR.tools.parseCssText(i.style)),delete i.style),e&&(t=CKEDITOR.tools.clone(t),C(t.attributes,e),C(t.styles,e)),i=this.element=t.element?"string"==typeof t.element?t.element.toLowerCase():t.element:"*",this.type=t.type||(y[i]?CKEDITOR.STYLE_BLOCK:T[i]?CKEDITOR.STYLE_OBJECT:CKEDITOR.STYLE_INLINE),"object"==typeof this.element&&(this.type=CKEDITOR.STYLE_OBJECT),this._={definition:t}},CKEDITOR.editor.prototype.applyStyle=function(t){t.checkApplicable(this.elementPath())&&E.call(t,this.getSelection())},CKEDITOR.editor.prototype.removeStyle=function(t){t.checkApplicable(this.elementPath())&&E.call(t,this.getSelection(),1)},CKEDITOR.style.prototype={apply:function(t){E.call(this,t.getSelection())},remove:function(t){E.call(this,t.getSelection(),1)},applyToRange:function(t){return(this.applyToRange=this.type==CKEDITOR.STYLE_INLINE?e:this.type==CKEDITOR.STYLE_BLOCK?o:this.type==CKEDITOR.STYLE_OBJECT?a:null).call(this,t)},removeFromRange:function(t){return(this.removeFromRange=this.type==CKEDITOR.STYLE_INLINE?i:this.type==CKEDITOR.STYLE_BLOCK?s:this.type==CKEDITOR.STYLE_OBJECT?r:null).call(this,t)},applyToObject:function(t){v(t,this)},checkActive:function(t){switch(this.type){case CKEDITOR.STYLE_BLOCK:return this.checkElementRemovable(t.block||t.blockLimit,!0);case CKEDITOR.STYLE_OBJECT:case CKEDITOR.STYLE_INLINE:for(var e,i=t.elements,n=0;n<i.length;n++)if(e=i[n],this.type!=CKEDITOR.STYLE_INLINE||e!=t.block&&e!=t.blockLimit){if(this.type==CKEDITOR.STYLE_OBJECT){var a=e.getName();if(!("string"==typeof this.element?a==this.element:a in this.element))continue}if(this.checkElementRemovable(e,!0))return!0}}return!1},checkApplicable:function(t,e){if(e&&!e.check(this))return!1;switch(this.type){case CKEDITOR.STYLE_OBJECT:return!!t.contains(this.element);case CKEDITOR.STYLE_BLOCK:return!!t.blockLimit.getDtd()[this.element]}return!0},checkElementMatch:function(t,e){var i=this._.definition;if(!t||!i.ignoreReadonly&&t.isReadOnly())return!1;var n=t.getName();if("string"==typeof this.element?n==this.element:n in this.element){if(!e&&!t.hasAttributes())return!0;if(n=i._AC)i=n;else{var n={},a=0,r=i.attributes;if(r)for(var o in r)a++,n[o]=r[o];(o=CKEDITOR.style.getStyleText(i))&&(n.style||a++,n.style=o),n._length=a,i=i._AC=n}if(!i._length)return!0;for(var s in i)if("_length"!=s){if(a=t.getAttribute(s)||"","style"==s)t:{n=i[s],"string"==typeof n&&(n=CKEDITOR.tools.parseCssText(n)),"string"==typeof a&&(a=CKEDITOR.tools.parseCssText(a,!0)),o=void 0;for(o in n)if(!(o in a)||a[o]!=n[o]&&"inherit"!=n[o]&&"inherit"!=a[o]){n=!1;break t}n=!0}else n=i[s]==a;if(n){if(!e)return!0}else if(e)return!1}if(e)return!0}return!1},checkElementRemovable:function(t,e){if(this.checkElementMatch(t,e))return!0;var i=I(this)[t.getName()];if(i){var n;if(!(i=i.attributes))return!0;for(var a=0;a<i.length;a++)if(n=i[a][0],n=t.getAttribute(n)){var r=i[a][1];if(null===r||"string"==typeof r&&n==r||r.test(n))return!0}}return!1},buildPreview:function(t){var e=this._.definition,i=[],n=e.element;"bdo"==n&&(n="span");var i=["<",n],a=e.attributes;if(a)for(var r in a)i.push(" ",r,'="',a[r],'"');return(a=CKEDITOR.style.getStyleText(e))&&i.push(' style="',a,'"'),i.push(">",t||e.name,"</",n,">"),i.join("")},getDefinition:function(){return this._.definition}},CKEDITOR.style.getStyleText=function(t){var e=t._ST;if(e)return e;var e=t.styles,i=t.attributes&&t.attributes.style||"",n="";i.length&&(i=i.replace(R,";"));for(var a in e){var r=e[a],o=(a+":"+r).replace(R,";");"inherit"==r?n+=o:i+=o}return i.length&&(i=CKEDITOR.tools.normalizeCssText(i,!0)),t._ST=i+n};var D=CKEDITOR.POSITION_PRECEDING|CKEDITOR.POSITION_IDENTICAL|CKEDITOR.POSITION_IS_CONTAINED,x=CKEDITOR.POSITION_FOLLOWING|CKEDITOR.POSITION_IDENTICAL|CKEDITOR.POSITION_IS_CONTAINED}(),CKEDITOR.styleCommand=function(t,e){this.requiredContent=this.allowedContent=this.style=t,CKEDITOR.tools.extend(this,e,!0)},CKEDITOR.styleCommand.prototype.exec=function(t){t.focus(),this.state==CKEDITOR.TRISTATE_OFF?t.applyStyle(this.style):this.state==CKEDITOR.TRISTATE_ON&&t.removeStyle(this.style)},CKEDITOR.stylesSet=new CKEDITOR.resourceManager("","stylesSet"),CKEDITOR.addStylesSet=CKEDITOR.tools.bind(CKEDITOR.stylesSet.add,CKEDITOR.stylesSet),CKEDITOR.loadStylesSet=function(t,e,i){CKEDITOR.stylesSet.addExternal(t,e,""),CKEDITOR.stylesSet.load(t,i)},CKEDITOR.editor.prototype.getStylesSet=function(t){if(this._.stylesDefinitions)t(this._.stylesDefinitions);else{var e=this,i=e.config.stylesCombo_stylesSet||e.config.stylesSet;if(i===!1)t(null);else if(i instanceof Array)e._.stylesDefinitions=i,t(i);else{i||(i="default");var i=i.split(":"),n=i[0];CKEDITOR.stylesSet.addExternal(n,i[1]?i.slice(1).join(":"):CKEDITOR.getUrl("styles.js"),""),CKEDITOR.stylesSet.load(n,function(i){e._.stylesDefinitions=i[n],t(e._.stylesDefinitions)})}}},CKEDITOR.dom.comment=function(t,e){"string"==typeof t&&(t=(e?e.$:document).createComment(t)),CKEDITOR.dom.domObject.call(this,t)},CKEDITOR.dom.comment.prototype=new CKEDITOR.dom.node,CKEDITOR.tools.extend(CKEDITOR.dom.comment.prototype,{type:CKEDITOR.NODE_COMMENT,getOuterHtml:function(){return"<!--"+this.$.nodeValue+"-->"}}),function(){var t,e={},i={};for(t in CKEDITOR.dtd.$blockLimit)t in CKEDITOR.dtd.$list||(e[t]=1);for(t in CKEDITOR.dtd.$block)t in CKEDITOR.dtd.$blockLimit||t in CKEDITOR.dtd.$empty||(i[t]=1);CKEDITOR.dom.elementPath=function(t,n){var a,r=null,o=null,s=[],l=t,n=n||t.getDocument().getBody();do if(l.type==CKEDITOR.NODE_ELEMENT){if(s.push(l),!this.lastElement&&(this.lastElement=l,l.is(CKEDITOR.dtd.$object)||"false"==l.getAttribute("contenteditable")))continue;if(l.equals(n))break;if(!o&&(a=l.getName(),"true"==l.getAttribute("contenteditable")?o=l:!r&&i[a]&&(r=l),e[a])){var c;if(c=!r){if(a="div"==a){t:{a=l.getChildren(),c=0;for(var d=a.count();d>c;c++){var h=a.getItem(c);if(h.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$block[h.getName()]){a=!0;break t}}a=!1}a=!a}c=a}c?r=l:o=l}}while(l=l.getParent());o||(o=n),this.block=r,this.blockLimit=o,this.root=n,this.elements=s}}(),CKEDITOR.dom.elementPath.prototype={compare:function(t){var e=this.elements,t=t&&t.elements;if(!t||e.length!=t.length)return!1;for(var i=0;i<e.length;i++)if(!e[i].equals(t[i]))return!1;return!0},contains:function(t,e,i){var n;"string"==typeof t&&(n=function(e){return e.getName()==t}),t instanceof CKEDITOR.dom.element?n=function(e){return e.equals(t)}:CKEDITOR.tools.isArray(t)?n=function(e){return CKEDITOR.tools.indexOf(t,e.getName())>-1}:"function"==typeof t?n=t:"object"==typeof t&&(n=function(e){return e.getName()in t});var a=this.elements,r=a.length;for(e&&r--,i&&(a=Array.prototype.slice.call(a,0),a.reverse()),e=0;r>e;e++)if(n(a[e]))return a[e];return null},isContextFor:function(t){var e;return t in CKEDITOR.dtd.$block?(e=this.contains(CKEDITOR.dtd.$intermediate)||this.root.equals(this.block)&&this.block||this.blockLimit,!!e.getDtd()[t]):!0},direction:function(){return(this.block||this.blockLimit||this.root).getDirection(1)}},CKEDITOR.dom.text=function(t,e){"string"==typeof t&&(t=(e?e.$:document).createTextNode(t)),this.$=t},CKEDITOR.dom.text.prototype=new CKEDITOR.dom.node,CKEDITOR.tools.extend(CKEDITOR.dom.text.prototype,{type:CKEDITOR.NODE_TEXT,getLength:function(){return this.$.nodeValue.length},getText:function(){return this.$.nodeValue},setText:function(t){this.$.nodeValue=t},split:function(t){var e=this.$.parentNode,i=e.childNodes.length,n=this.getLength(),a=this.getDocument(),r=new CKEDITOR.dom.text(this.$.splitText(t),a);return e.childNodes.length==i&&(t>=n?(r=a.createText(""),r.insertAfter(this)):(t=a.createText(""),t.insertAfter(r),t.remove())),r},substring:function(t,e){return"number"!=typeof e?this.$.nodeValue.substr(t):this.$.nodeValue.substring(t,e)}}),function(){function t(t,e,i){var n=t.serializable,a=e[i?"endContainer":"startContainer"],r=i?"endOffset":"startOffset",o=n?e.document.getById(t.startNode):t.startNode,t=n?e.document.getById(t.endNode):t.endNode;return a.equals(o.getPrevious())?(e.startOffset=e.startOffset-a.getLength()-t.getPrevious().getLength(),a=t.getNext()):a.equals(t.getPrevious())&&(e.startOffset=e.startOffset-a.getLength(),a=t.getNext()),a.equals(o.getParent())&&e[r]++,a.equals(t.getParent())&&e[r]++,e[i?"endContainer":"startContainer"]=a,e}CKEDITOR.dom.rangeList=function(t){return t instanceof CKEDITOR.dom.rangeList?t:(t?t instanceof CKEDITOR.dom.range&&(t=[t]):t=[],CKEDITOR.tools.extend(t,e))};var e={createIterator:function(){var t,e=this,i=CKEDITOR.dom.walker.bookmark(),n=[];return{getNextRange:function(a){t=void 0==t?0:t+1;var r=e[t];if(r&&e.length>1){if(!t)for(var o=e.length-1;o>=0;o--)n.unshift(e[o].createBookmark(!0));if(a)for(var s=0;e[t+s+1];){for(var l=r.document,a=0,o=l.getById(n[s].endNode),l=l.getById(n[s+1].startNode);;){if(o=o.getNextSourceNode(!1),l.equals(o))a=1;else if(i(o)||o.type==CKEDITOR.NODE_ELEMENT&&o.isBlockBoundary())continue;break}if(!a)break;s++}for(r.moveToBookmark(n.shift());s--;)o=e[++t],o.moveToBookmark(n.shift()),r.setEnd(o.endContainer,o.endOffset)}return r}}},createBookmarks:function(e){for(var i,n=[],a=0;a<this.length;a++){n.push(i=this[a].createBookmark(e,!0));for(var r=a+1;r<this.length;r++)this[r]=t(i,this[r]),this[r]=t(i,this[r],!0)}return n},createBookmarks2:function(t){for(var e=[],i=0;i<this.length;i++)e.push(this[i].createBookmark2(t));return e},moveToBookmarks:function(t){for(var e=0;e<this.length;e++)this[e].moveToBookmark(t[e])}}}(),function(){function t(){return CKEDITOR.getUrl(CKEDITOR.skinName.split(",")[1]||"skins/"+CKEDITOR.skinName.split(",")[0]+"/")}function e(e){var i=CKEDITOR.skin["ua_"+e],n=CKEDITOR.env;if(i)for(var a,i=i.split(",").sort(function(t,e){return t>e?-1:1
}),r=0;r<i.length;r++)if(a=i[r],n.ie&&(a.replace(/^ie/,"")==n.version||n.quirks&&"iequirks"==a)&&(a="ie"),n[a]){e+="_"+i[r];break}return CKEDITOR.getUrl(t()+e+".css")}function i(t,i){r[t]||(CKEDITOR.document.appendStyleSheet(e(t)),r[t]=1),i&&i()}function n(t){var e=t.getById(o);return e||(e=t.getHead().append("style"),e.setAttribute("id",o),e.setAttribute("type","text/css")),e}function a(t,e,i){var n,a,r;if(CKEDITOR.env.webkit)for(e=e.split("}").slice(0,-1),a=0;a<e.length;a++)e[a]=e[a].split("{");for(var o=0;o<t.length;o++)if(CKEDITOR.env.webkit)for(a=0;a<e.length;a++){for(r=e[a][1],n=0;n<i.length;n++)r=r.replace(i[n][0],i[n][1]);t[o].$.sheet.addRule(e[a][0],r)}else{for(r=e,n=0;n<i.length;n++)r=r.replace(i[n][0],i[n][1]);CKEDITOR.env.ie&&CKEDITOR.env.version<11?t[o].$.styleSheet.cssText=t[o].$.styleSheet.cssText+r:t[o].$.innerHTML=t[o].$.innerHTML+r}}var r={};CKEDITOR.skin={path:t,loadPart:function(e,n){CKEDITOR.skin.name!=CKEDITOR.skinName.split(",")[0]?CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(t()+"skin.js"),function(){i(e,n)}):i(e,n)},getPath:function(t){return CKEDITOR.getUrl(e(t))},icons:{},addIcon:function(t,e,i,n){t=t.toLowerCase(),this.icons[t]||(this.icons[t]={path:e,offset:i||0,bgsize:n||"16px"})},getIconStyle:function(t,e,i,n,a){var r;return t&&(t=t.toLowerCase(),e&&(r=this.icons[t+"-rtl"]),r||(r=this.icons[t])),t=i||r&&r.path||"",n=n||r&&r.offset,a=a||r&&r.bgsize||"16px",t&&"background-image:url("+CKEDITOR.getUrl(t)+");background-position:0 "+n+"px;background-size:"+a+";"}},CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{getUiColor:function(){return this.uiColor},setUiColor:function(t){var e=n(CKEDITOR.document);return(this.setUiColor=function(t){var i=CKEDITOR.skin.chameleon,n=[[l,t]];this.uiColor=t,a([e],i(this,"editor"),n),a(s,i(this,"panel"),n)}).call(this,t)}});var o="cke_ui_color",s=[],l=/\$color/g;CKEDITOR.on("instanceLoaded",function(t){if(!CKEDITOR.env.ie||!CKEDITOR.env.quirks){var e=t.editor,t=function(t){if(t=(t.data[0]||t.data).element.getElementsByTag("iframe").getItem(0).getFrameDocument(),!t.getById("cke_ui_color")){t=n(t),s.push(t);var i=e.getUiColor();i&&a([t],CKEDITOR.skin.chameleon(e,"panel"),[[l,i]])}};e.on("panelShow",t),e.on("menuShow",t),e.config.uiColor&&e.setUiColor(e.config.uiColor)}})}(),function(){if(CKEDITOR.env.webkit)CKEDITOR.env.hc=!1;else{var t=CKEDITOR.dom.element.createFromHtml('<div style="width:0;height:0;position:absolute;left:-10000px;border:1px solid;border-color:red blue"></div>',CKEDITOR.document);t.appendTo(CKEDITOR.document.getHead());try{var e=t.getComputedStyle("border-top-color"),i=t.getComputedStyle("border-right-color");CKEDITOR.env.hc=!(!e||e!=i)}catch(n){CKEDITOR.env.hc=!1}t.remove()}if(CKEDITOR.env.hc&&(CKEDITOR.env.cssClass=CKEDITOR.env.cssClass+" cke_hc"),CKEDITOR.document.appendStyleText(".cke{visibility:hidden;}"),CKEDITOR.status="loaded",CKEDITOR.fireOnce("loaded"),t=CKEDITOR._.pending)for(delete CKEDITOR._.pending,e=0;e<t.length;e++)CKEDITOR.editor.prototype.constructor.apply(t[e][0],t[e][1]),CKEDITOR.add(t[e][0])}(),CKEDITOR.skin.name="moono",CKEDITOR.skin.ua_editor="ie,iequirks,ie7,ie8,gecko",CKEDITOR.skin.ua_dialog="ie,iequirks,ie7,ie8,opera",CKEDITOR.skin.chameleon=function(){var t=function(){return function(t,e){for(var i=t.match(/[^#]./g),n=0;3>n;n++){var a,r=i,o=n;a=parseInt(i[n],16),a=("0"+(0>e?0|a*(1+e):0|a+(255-a)*e).toString(16)).slice(-2),r[o]=a}return"#"+i.join("")}}(),e=function(){var t=new CKEDITOR.template("background:#{to};background-image:-webkit-gradient(linear,lefttop,leftbottom,from({from}),to({to}));background-image:-moz-linear-gradient(top,{from},{to});background-image:-webkit-linear-gradient(top,{from},{to});background-image:-o-linear-gradient(top,{from},{to});background-image:-ms-linear-gradient(top,{from},{to});background-image:linear-gradient(top,{from},{to});filter:progid:DXImageTransform.Microsoft.gradient(gradientType=0,startColorstr='{from}',endColorstr='{to}');");return function(e,i){return t.output({from:e,to:i})}}(),i={editor:new CKEDITOR.template("{id}.cke_chrome [border-color:{defaultBorder};] {id} .cke_top [ {defaultGradient}border-bottom-color:{defaultBorder};] {id} .cke_bottom [{defaultGradient}border-top-color:{defaultBorder};] {id} .cke_resizer [border-right-color:{ckeResizer}] {id} .cke_dialog_title [{defaultGradient}border-bottom-color:{defaultBorder};] {id} .cke_dialog_footer [{defaultGradient}outline-color:{defaultBorder};border-top-color:{defaultBorder};] {id} .cke_dialog_tab [{lightGradient}border-color:{defaultBorder};] {id} .cke_dialog_tab:hover [{mediumGradient}] {id} .cke_dialog_contents [border-top-color:{defaultBorder};] {id} .cke_dialog_tab_selected, {id} .cke_dialog_tab_selected:hover [background:{dialogTabSelected};border-bottom-color:{dialogTabSelectedBorder};] {id} .cke_dialog_body [background:{dialogBody};border-color:{defaultBorder};] {id} .cke_toolgroup [{lightGradient}border-color:{defaultBorder};] {id} a.cke_button_off:hover, {id} a.cke_button_off:focus, {id} a.cke_button_off:active [{mediumGradient}] {id} .cke_button_on [{ckeButtonOn}] {id} .cke_toolbar_separator [background-color: {ckeToolbarSeparator};] {id} .cke_combo_button [border-color:{defaultBorder};{lightGradient}] {id} a.cke_combo_button:hover, {id} a.cke_combo_button:focus, {id} .cke_combo_on a.cke_combo_button [border-color:{defaultBorder};{mediumGradient}] {id} .cke_path_item [color:{elementsPathColor};] {id} a.cke_path_item:hover, {id} a.cke_path_item:focus, {id} a.cke_path_item:active [background-color:{elementsPathBg};] {id}.cke_panel [border-color:{defaultBorder};] "),panel:new CKEDITOR.template(".cke_panel_grouptitle [{lightGradient}border-color:{defaultBorder};] .cke_menubutton_icon [background-color:{menubuttonIcon};] .cke_menubutton:hover .cke_menubutton_icon, .cke_menubutton:focus .cke_menubutton_icon, .cke_menubutton:active .cke_menubutton_icon [background-color:{menubuttonIconHover};] .cke_menuseparator [background-color:{menubuttonIcon};] a:hover.cke_colorbox, a:focus.cke_colorbox, a:active.cke_colorbox [border-color:{defaultBorder};] a:hover.cke_colorauto, a:hover.cke_colormore, a:focus.cke_colorauto, a:focus.cke_colormore, a:active.cke_colorauto, a:active.cke_colormore [background-color:{ckeColorauto};border-color:{defaultBorder};] ")};return function(n,a){var r=n.uiColor,r={id:"."+n.id,defaultBorder:t(r,-.1),defaultGradient:e(t(r,.9),r),lightGradient:e(t(r,1),t(r,.7)),mediumGradient:e(t(r,.8),t(r,.5)),ckeButtonOn:e(t(r,.6),t(r,.7)),ckeResizer:t(r,-.4),ckeToolbarSeparator:t(r,.5),ckeColorauto:t(r,.8),dialogBody:t(r,.7),dialogTabSelected:e("#FFFFFF","#FFFFFF"),dialogTabSelectedBorder:"#FFF",elementsPathColor:t(r,-.6),elementsPathBg:r,menubuttonIcon:t(r,.5),menubuttonIconHover:t(r,.3)};return i[a].output(r).replace(/\[/g,"{").replace(/\]/g,"}")}}(),CKEDITOR.plugins.add("basicstyles",{init:function(t){var e=0,i=function(i,a,r,o){if(o){var o=new CKEDITOR.style(o),s=n[r];s.unshift(o),t.attachStyleStateChange(o,function(e){!t.readOnly&&t.getCommand(r).setState(e)}),t.addCommand(r,new CKEDITOR.styleCommand(o,{contentForms:s})),t.ui.addButton&&t.ui.addButton(i,{label:a,command:r,toolbar:"basicstyles,"+(e+=10)})}},n={bold:["strong","b",["span",function(t){return t=t.styles["font-weight"],"bold"==t||+t>=700}]],italic:["em","i",["span",function(t){return"italic"==t.styles["font-style"]}]],underline:["u",["span",function(t){return"underline"==t.styles["text-decoration"]}]],strike:["s","strike",["span",function(t){return"line-through"==t.styles["text-decoration"]}]],subscript:["sub"],superscript:["sup"]},a=t.config,r=t.lang.basicstyles;i("Bold",r.bold,"bold",a.coreStyles_bold),i("Italic",r.italic,"italic",a.coreStyles_italic),i("Underline",r.underline,"underline",a.coreStyles_underline),i("Strike",r.strike,"strike",a.coreStyles_strike),i("Subscript",r.subscript,"subscript",a.coreStyles_subscript),i("Superscript",r.superscript,"superscript",a.coreStyles_superscript),t.setKeystroke([[CKEDITOR.CTRL+66,"bold"],[CKEDITOR.CTRL+73,"italic"],[CKEDITOR.CTRL+85,"underline"]])}}),CKEDITOR.config.coreStyles_bold={element:"strong",overrides:"b"},CKEDITOR.config.coreStyles_italic={element:"em",overrides:"i"},CKEDITOR.config.coreStyles_underline={element:"u"},CKEDITOR.config.coreStyles_strike={element:"s",overrides:"strike"},CKEDITOR.config.coreStyles_subscript={element:"sub"},CKEDITOR.config.coreStyles_superscript={element:"sup"},function(){var t={exec:function(t){var e=t.getCommand("blockquote").state,i=t.getSelection(),n=i&&i.getRanges()[0];if(n){var a=i.createBookmarks();if(CKEDITOR.env.ie){var r,o=a[0].startNode,s=a[0].endNode;if(o&&"blockquote"==o.getParent().getName())for(r=o;r=r.getNext();)if(r.type==CKEDITOR.NODE_ELEMENT&&r.isBlockBoundary()){o.move(r,!0);break}if(s&&"blockquote"==s.getParent().getName())for(r=s;r=r.getPrevious();)if(r.type==CKEDITOR.NODE_ELEMENT&&r.isBlockBoundary()){s.move(r);break}}var l=n.createIterator();if(l.enlargeBr=t.config.enterMode!=CKEDITOR.ENTER_BR,e==CKEDITOR.TRISTATE_OFF){for(o=[];e=l.getNextParagraph();)o.push(e);for(o.length<1&&(e=t.document.createElement(t.config.enterMode==CKEDITOR.ENTER_P?"p":"div"),s=a.shift(),n.insertNode(e),e.append(new CKEDITOR.dom.text("",t.document)),n.moveToBookmark(s),n.selectNodeContents(e),n.collapse(!0),s=n.createBookmark(),o.push(e),a.unshift(s)),r=o[0].getParent(),n=[],s=0;s<o.length;s++)e=o[s],r=r.getCommonAncestor(e.getParent());for(e={table:1,tbody:1,tr:1,ol:1,ul:1};e[r.getName()];)r=r.getParent();for(s=null;o.length>0;){for(e=o.shift();!e.getParent().equals(r);)e=e.getParent();e.equals(s)||n.push(e),s=e}for(;n.length>0;)if(e=n.shift(),"blockquote"==e.getName()){for(s=new CKEDITOR.dom.documentFragment(t.document);e.getFirst();)s.append(e.getFirst().remove()),o.push(s.getLast());s.replace(e)}else o.push(e);for(n=t.document.createElement("blockquote"),n.insertBefore(o[0]);o.length>0;)e=o.shift(),n.append(e)}else if(e==CKEDITOR.TRISTATE_ON){for(s=[],r={};e=l.getNextParagraph();){for(o=n=null;e.getParent();){if("blockquote"==e.getParent().getName()){n=e.getParent(),o=e;break}e=e.getParent()}n&&o&&!o.getCustomData("blockquote_moveout")&&(s.push(o),CKEDITOR.dom.element.setMarker(r,o,"blockquote_moveout",!0))}for(CKEDITOR.dom.element.clearAllMarkers(r),e=[],o=[],r={};s.length>0;)l=s.shift(),n=l.getParent(),l.getPrevious()?l.getNext()?(l.breakParent(l.getParent()),o.push(l.getNext())):l.remove().insertAfter(n):l.remove().insertBefore(n),n.getCustomData("blockquote_processed")||(o.push(n),CKEDITOR.dom.element.setMarker(r,n,"blockquote_processed",!0)),e.push(l);for(CKEDITOR.dom.element.clearAllMarkers(r),s=o.length-1;s>=0;s--){n=o[s];t:{r=n;for(var l=0,c=r.getChildCount(),d=void 0;c>l&&(d=r.getChild(l));l++)if(d.type==CKEDITOR.NODE_ELEMENT&&d.isBlockBoundary()){r=!1;break t}r=!0}r&&n.remove()}if(t.config.enterMode==CKEDITOR.ENTER_BR)for(n=!0;e.length;)if(l=e.shift(),"div"==l.getName()){for(s=new CKEDITOR.dom.documentFragment(t.document),n&&l.getPrevious()&&!(l.getPrevious().type==CKEDITOR.NODE_ELEMENT&&l.getPrevious().isBlockBoundary())&&s.append(t.document.createElement("br")),n=l.getNext()&&!(l.getNext().type==CKEDITOR.NODE_ELEMENT&&l.getNext().isBlockBoundary());l.getFirst();)l.getFirst().remove().appendTo(s);n&&s.append(t.document.createElement("br")),s.replace(l),n=!1}}i.selectBookmarks(a),t.focus()}},refresh:function(t,e){this.setState(t.elementPath(e.block||e.blockLimit).contains("blockquote",1)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)},context:"blockquote",allowedContent:"blockquote",requiredContent:"blockquote"};CKEDITOR.plugins.add("blockquote",{init:function(e){e.blockless||(e.addCommand("blockquote",t),e.ui.addButton&&e.ui.addButton("Blockquote",{label:e.lang.blockquote.toolbar,command:"blockquote",toolbar:"blocks,10"}))}})}(),CKEDITOR.plugins.add("dialogui",{onLoad:function(){var t=function(t){this._||(this._={}),this._["default"]=this._.initValue=t["default"]||"",this._.required=t.required||!1;for(var e=[this._],i=1;i<arguments.length;i++)e.push(arguments[i]);return e.push(!0),CKEDITOR.tools.extend.apply(CKEDITOR.tools,e),this._},e={build:function(t,e,i){return new CKEDITOR.ui.dialog.textInput(t,e,i)}},i={build:function(t,e,i){return new CKEDITOR.ui.dialog[e.type](t,e,i)}},n={isChanged:function(){return this.getValue()!=this.getInitValue()},reset:function(t){this.setValue(this.getInitValue(),t)},setInitValue:function(){this._.initValue=this.getValue()},resetInitValue:function(){this._.initValue=this._["default"]},getInitValue:function(){return this._.initValue}},a=CKEDITOR.tools.extend({},CKEDITOR.ui.dialog.uiElement.prototype.eventProcessors,{onChange:function(t,e){this._.domOnChangeRegistered||(t.on("load",function(){this.getInputElement().on("change",function(){t.parts.dialog.isVisible()&&this.fire("change",{value:this.getValue()})},this)},this),this._.domOnChangeRegistered=!0),this.on("change",e)}},!0),r=/^on([A-Z]\w+)/,o=function(t){for(var e in t)(r.test(e)||"title"==e||"type"==e)&&delete t[e];return t};CKEDITOR.tools.extend(CKEDITOR.ui.dialog,{labeledElement:function(e,i,n,a){if(!(arguments.length<4)){var r=t.call(this,i);r.labelId=CKEDITOR.tools.getNextId()+"_label",this._.children=[],CKEDITOR.ui.dialog.uiElement.call(this,e,i,n,"div",null,{role:"presentation"},function(){var t=[],n=i.required?" cke_required":"";return"horizontal"!=i.labelLayout?t.push('<label class="cke_dialog_ui_labeled_label'+n+'" ',' id="'+r.labelId+'"',r.inputId?' for="'+r.inputId+'"':"",(i.labelStyle?' style="'+i.labelStyle+'"':"")+">",i.label,"</label>",'<div class="cke_dialog_ui_labeled_content"',i.controlStyle?' style="'+i.controlStyle+'"':"",' role="radiogroup" aria-labelledby="'+r.labelId+'">',a.call(this,e,i),"</div>"):(n={type:"hbox",widths:i.widths,padding:0,children:[{type:"html",html:'<label class="cke_dialog_ui_labeled_label'+n+'" id="'+r.labelId+'" for="'+r.inputId+'"'+(i.labelStyle?' style="'+i.labelStyle+'"':"")+">"+CKEDITOR.tools.htmlEncode(i.label)+"</span>"},{type:"html",html:'<span class="cke_dialog_ui_labeled_content"'+(i.controlStyle?' style="'+i.controlStyle+'"':"")+">"+a.call(this,e,i)+"</span>"}]},CKEDITOR.dialog._.uiElementBuilders.hbox.build(e,n,t)),t.join("")})}},textInput:function(e,i,n){if(!(arguments.length<3)){t.call(this,i);var a=this._.inputId=CKEDITOR.tools.getNextId()+"_textInput",r={"class":"cke_dialog_ui_input_"+i.type,id:a,type:i.type};i.validate&&(this.validate=i.validate),i.maxLength&&(r.maxlength=i.maxLength),i.size&&(r.size=i.size),i.inputStyle&&(r.style=i.inputStyle);var o=this,s=!1;e.on("load",function(){o.getInputElement().on("keydown",function(t){13==t.data.getKeystroke()&&(s=!0)}),o.getInputElement().on("keyup",function(t){13==t.data.getKeystroke()&&s&&(e.getButton("ok")&&setTimeout(function(){e.getButton("ok").click()},0),s=!1)},null,null,1e3)}),CKEDITOR.ui.dialog.labeledElement.call(this,e,i,n,function(){var t=['<div class="cke_dialog_ui_input_',i.type,'" role="presentation"'];i.width&&t.push('style="width:'+i.width+'" '),t.push("><input "),r["aria-labelledby"]=this._.labelId,this._.required&&(r["aria-required"]=this._.required);for(var e in r)t.push(e+'="'+r[e]+'" ');return t.push(" /></div>"),t.join("")})}},textarea:function(e,i,n){if(!(arguments.length<3)){t.call(this,i);var a=this,r=this._.inputId=CKEDITOR.tools.getNextId()+"_textarea",o={};i.validate&&(this.validate=i.validate),o.rows=i.rows||5,o.cols=i.cols||20,o["class"]="cke_dialog_ui_input_textarea "+(i["class"]||""),"undefined"!=typeof i.inputStyle&&(o.style=i.inputStyle),i.dir&&(o.dir=i.dir),CKEDITOR.ui.dialog.labeledElement.call(this,e,i,n,function(){o["aria-labelledby"]=this._.labelId,this._.required&&(o["aria-required"]=this._.required);var t,e=['<div class="cke_dialog_ui_input_textarea" role="presentation"><textarea id="',r,'" '];for(t in o)e.push(t+'="'+CKEDITOR.tools.htmlEncode(o[t])+'" ');return e.push(">",CKEDITOR.tools.htmlEncode(a._["default"]),"</textarea></div>"),e.join("")})}},checkbox:function(e,i,n){if(!(arguments.length<3)){var a=t.call(this,i,{"default":!!i["default"]});i.validate&&(this.validate=i.validate),CKEDITOR.ui.dialog.uiElement.call(this,e,i,n,"span",null,null,function(){var t=CKEDITOR.tools.extend({},i,{id:i.id?i.id+"_checkbox":CKEDITOR.tools.getNextId()+"_checkbox"},!0),n=[],r=CKEDITOR.tools.getNextId()+"_label",s={"class":"cke_dialog_ui_checkbox_input",type:"checkbox","aria-labelledby":r};return o(t),i["default"]&&(s.checked="checked"),"undefined"!=typeof t.inputStyle&&(t.style=t.inputStyle),a.checkbox=new CKEDITOR.ui.dialog.uiElement(e,t,n,"input",null,s),n.push(' <label id="',r,'" for="',s.id,'"'+(i.labelStyle?' style="'+i.labelStyle+'"':"")+">",CKEDITOR.tools.htmlEncode(i.label),"</label>"),n.join("")})}},radio:function(e,i,n){if(!(arguments.length<3)){t.call(this,i),this._["default"]||(this._["default"]=this._.initValue=i.items[0][1]),i.validate&&(this.validate=i.valdiate);var a=[],r=this;CKEDITOR.ui.dialog.labeledElement.call(this,e,i,n,function(){for(var t=[],n=[],s=(i.id?i.id:CKEDITOR.tools.getNextId())+"_radio",l=0;l<i.items.length;l++){var c=i.items[l],d=void 0!==c[2]?c[2]:c[0],h=void 0!==c[1]?c[1]:c[0],u=CKEDITOR.tools.getNextId()+"_radio_input",p=u+"_label",u=CKEDITOR.tools.extend({},i,{id:u,title:null,type:null},!0),d=CKEDITOR.tools.extend({},u,{title:d},!0),f={type:"radio","class":"cke_dialog_ui_radio_input",name:s,value:h,"aria-labelledby":p},m=[];r._["default"]==h&&(f.checked="checked"),o(u),o(d),"undefined"!=typeof u.inputStyle&&(u.style=u.inputStyle),u.keyboardFocusable=!0,a.push(new CKEDITOR.ui.dialog.uiElement(e,u,m,"input",null,f)),m.push(" "),new CKEDITOR.ui.dialog.uiElement(e,d,m,"label",null,{id:p,"for":f.id},c[0]),t.push(m.join(""))}return new CKEDITOR.ui.dialog.hbox(e,a,t,n),n.join("")}),this._.children=a}},button:function(e,i,n){if(arguments.length){"function"==typeof i&&(i=i(e.getParentEditor())),t.call(this,i,{disabled:i.disabled||!1}),CKEDITOR.event.implementOn(this);var a=this;e.on("load",function(){var t=this.getElement();!function(){t.on("click",function(t){a.click(),t.data.preventDefault()}),t.on("keydown",function(t){t.data.getKeystroke()in{32:1}&&(a.click(),t.data.preventDefault())})}(),t.unselectable()},this);var r=CKEDITOR.tools.extend({},i);delete r.style;var o=CKEDITOR.tools.getNextId()+"_label";CKEDITOR.ui.dialog.uiElement.call(this,e,r,n,"a",null,{style:i.style,href:"javascript:void(0)",title:i.label,hidefocus:"true","class":i["class"],role:"button","aria-labelledby":o},'<span id="'+o+'" class="cke_dialog_ui_button">'+CKEDITOR.tools.htmlEncode(i.label)+"</span>")}},select:function(e,i,n){if(!(arguments.length<3)){var a=t.call(this,i);i.validate&&(this.validate=i.validate),a.inputId=CKEDITOR.tools.getNextId()+"_select",CKEDITOR.ui.dialog.labeledElement.call(this,e,i,n,function(){var t=CKEDITOR.tools.extend({},i,{id:i.id?i.id+"_select":CKEDITOR.tools.getNextId()+"_select"},!0),n=[],r=[],s={id:a.inputId,"class":"cke_dialog_ui_input_select","aria-labelledby":this._.labelId};n.push('<div class="cke_dialog_ui_input_',i.type,'" role="presentation"'),i.width&&n.push('style="width:'+i.width+'" '),n.push(">"),void 0!=i.size&&(s.size=i.size),void 0!=i.multiple&&(s.multiple=i.multiple),o(t);for(var l,c=0;c<i.items.length&&(l=i.items[c]);c++)r.push('<option value="',CKEDITOR.tools.htmlEncode(void 0!==l[1]?l[1]:l[0]).replace(/"/g,"&quot;"),'" /> ',CKEDITOR.tools.htmlEncode(l[0]));return"undefined"!=typeof t.inputStyle&&(t.style=t.inputStyle),a.select=new CKEDITOR.ui.dialog.uiElement(e,t,n,"select",null,s,r.join("")),n.push("</div>"),n.join("")})}},file:function(e,i,n){if(!(arguments.length<3)){void 0===i["default"]&&(i["default"]="");var a=CKEDITOR.tools.extend(t.call(this,i),{definition:i,buttons:[]});i.validate&&(this.validate=i.validate),e.on("load",function(){CKEDITOR.document.getById(a.frameId).getParent().addClass("cke_dialog_ui_input_file")}),CKEDITOR.ui.dialog.labeledElement.call(this,e,i,n,function(){a.frameId=CKEDITOR.tools.getNextId()+"_fileInput";var t=['<iframe frameborder="0" allowtransparency="0" class="cke_dialog_ui_input_file" role="presentation" id="',a.frameId,'" title="',i.label,'" src="javascript:void('];return t.push(CKEDITOR.env.ie?"(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"})()":"0"),t.push(')"></iframe>'),t.join("")})}},fileButton:function(e,i,n){if(!(arguments.length<3)){t.call(this,i);var a=this;i.validate&&(this.validate=i.validate);var r=CKEDITOR.tools.extend({},i),o=r.onClick;r.className=(r.className?r.className+" ":"")+"cke_dialog_ui_button",r.onClick=function(t){var n=i["for"];o&&o.call(this,t)===!1||(e.getContentElement(n[0],n[1]).submit(),this.disable())},e.on("load",function(){e.getContentElement(i["for"][0],i["for"][1])._.buttons.push(a)}),CKEDITOR.ui.dialog.button.call(this,e,r,n)}},html:function(){var t=/^\s*<[\w:]+\s+([^>]*)?>/,e=/^(\s*<[\w:]+(?:\s+[^>]*)?)((?:.|\r|\n)+)$/,i=/\/$/;return function(n,a,r){if(!(arguments.length<3)){var o=[],s=a.html;"<"!=s.charAt(0)&&(s="<span>"+s+"</span>");var l=a.focus;if(l){var c=this.focus;this.focus=function(){("function"==typeof l?l:c).call(this),this.fire("focus")},a.isFocusable&&(this.isFocusable=this.isFocusable),this.keyboardFocusable=!0}CKEDITOR.ui.dialog.uiElement.call(this,n,a,o,"span",null,null,""),o=o.join("").match(t),s=s.match(e)||["","",""],i.test(s[1])&&(s[1]=s[1].slice(0,-1),s[2]="/"+s[2]),r.push([s[1]," ",o[1]||"",s[2]].join(""))}}}(),fieldset:function(t,e,i,n,a){var r=a.label;this._={children:e},CKEDITOR.ui.dialog.uiElement.call(this,t,a,n,"fieldset",null,null,function(){var t=[];r&&t.push("<legend"+(a.labelStyle?' style="'+a.labelStyle+'"':"")+">"+r+"</legend>");for(var e=0;e<i.length;e++)t.push(i[e]);return t.join("")})}},!0),CKEDITOR.ui.dialog.html.prototype=new CKEDITOR.ui.dialog.uiElement,CKEDITOR.ui.dialog.labeledElement.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{setLabel:function(t){var e=CKEDITOR.document.getById(this._.labelId);return e.getChildCount()<1?new CKEDITOR.dom.text(t,CKEDITOR.document).appendTo(e):e.getChild(0).$.nodeValue=t,this},getLabel:function(){var t=CKEDITOR.document.getById(this._.labelId);return!t||t.getChildCount()<1?"":t.getChild(0).getText()},eventProcessors:a},!0),CKEDITOR.ui.dialog.button.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{click:function(){return this._.disabled?!1:this.fire("click",{dialog:this._.dialog})},enable:function(){this._.disabled=!1;var t=this.getElement();t&&t.removeClass("cke_disabled")},disable:function(){this._.disabled=!0,this.getElement().addClass("cke_disabled")},isVisible:function(){return this.getElement().getFirst().isVisible()},isEnabled:function(){return!this._.disabled},eventProcessors:CKEDITOR.tools.extend({},CKEDITOR.ui.dialog.uiElement.prototype.eventProcessors,{onClick:function(t,e){this.on("click",function(){e.apply(this,arguments)})}},!0),accessKeyUp:function(){this.click()},accessKeyDown:function(){this.focus()},keyboardFocusable:!0},!0),CKEDITOR.ui.dialog.textInput.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,{getInputElement:function(){return CKEDITOR.document.getById(this._.inputId)},focus:function(){var t=this.selectParentTab();setTimeout(function(){var e=t.getInputElement();e&&e.$.focus()},0)},select:function(){var t=this.selectParentTab();setTimeout(function(){var e=t.getInputElement();e&&(e.$.focus(),e.$.select())},0)},accessKeyUp:function(){this.select()},setValue:function(t){return!t&&(t=""),CKEDITOR.ui.dialog.uiElement.prototype.setValue.apply(this,arguments)},keyboardFocusable:!0},n,!0),CKEDITOR.ui.dialog.textarea.prototype=new CKEDITOR.ui.dialog.textInput,CKEDITOR.ui.dialog.select.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,{getInputElement:function(){return this._.select.getElement()},add:function(t,e,i){var n=new CKEDITOR.dom.element("option",this.getDialog().getParentEditor().document),a=this.getInputElement().$;return n.$.text=t,n.$.value=void 0===e||null===e?t:e,void 0===i||null===i?CKEDITOR.env.ie?a.add(n.$):a.add(n.$,null):a.add(n.$,i),this},remove:function(t){return this.getInputElement().$.remove(t),this},clear:function(){for(var t=this.getInputElement().$;t.length>0;)t.remove(0);return this},keyboardFocusable:!0},n,!0),CKEDITOR.ui.dialog.checkbox.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{getInputElement:function(){return this._.checkbox.getElement()},setValue:function(t,e){this.getInputElement().$.checked=t,!e&&this.fire("change",{value:t})},getValue:function(){return this.getInputElement().$.checked},accessKeyUp:function(){this.setValue(!this.getValue())},eventProcessors:{onChange:function(t,e){return!CKEDITOR.env.ie||CKEDITOR.env.version>8?a.onChange.apply(this,arguments):(t.on("load",function(){var t=this._.checkbox.getElement();t.on("propertychange",function(e){e=e.data.$,"checked"==e.propertyName&&this.fire("change",{value:t.$.checked})},this)},this),this.on("change",e),null)}},keyboardFocusable:!0},n,!0),CKEDITOR.ui.dialog.radio.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{setValue:function(t,e){for(var i,n=this._.children,a=0;a<n.length&&(i=n[a]);a++)i.getElement().$.checked=i.getValue()==t;!e&&this.fire("change",{value:t})},getValue:function(){for(var t=this._.children,e=0;e<t.length;e++)if(t[e].getElement().$.checked)return t[e].getValue();return null},accessKeyUp:function(){var t,e=this._.children;for(t=0;t<e.length;t++)if(e[t].getElement().$.checked)return void e[t].getElement().focus();e[0].getElement().focus()},eventProcessors:{onChange:function(t,e){return CKEDITOR.env.ie?(t.on("load",function(){for(var t=this._.children,e=this,i=0;i<t.length;i++)t[i].getElement().on("propertychange",function(t){t=t.data.$,"checked"==t.propertyName&&this.$.checked&&e.fire("change",{value:this.getAttribute("value")})})},this),this.on("change",e),null):a.onChange.apply(this,arguments)}}},n,!0),CKEDITOR.ui.dialog.file.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,n,{getInputElement:function(){var t=CKEDITOR.document.getById(this._.frameId).getFrameDocument();return t.$.forms.length>0?new CKEDITOR.dom.element(t.$.forms[0].elements[0]):this.getElement()},submit:function(){return this.getInputElement().getParent().$.submit(),this},getAction:function(){return this.getInputElement().getParent().$.action},registerEvents:function(t){var e,i,n=/^on([A-Z]\w+)/,a=function(t,e,i,n){t.on("formLoaded",function(){t.getInputElement().on(i,n,t)})};for(i in t)(e=i.match(n))&&(this.eventProcessors[i]?this.eventProcessors[i].call(this,this._.dialog,t[i]):a(this,this._.dialog,e[1].toLowerCase(),t[i]));return this},reset:function(){function t(){i.$.open();var t="";n.size&&(t=n.size-(CKEDITOR.env.ie?7:0));var c=e.frameId+"_input";for(i.$.write(['<html dir="'+s+'" lang="'+l+'"><head><title></title></head><body style="margin: 0; overflow: hidden; background: transparent;">','<form enctype="multipart/form-data" method="POST" dir="'+s+'" lang="'+l+'" action="',CKEDITOR.tools.htmlEncode(n.action),'"><label id="',e.labelId,'" for="',c,'" style="display:none">',CKEDITOR.tools.htmlEncode(n.label),'</label><input style="width:100%" id="',c,'" aria-labelledby="',e.labelId,'" type="file" name="',CKEDITOR.tools.htmlEncode(n.id||"cke_upload"),'" size="',CKEDITOR.tools.htmlEncode(t>0?t:""),'" /></form></body></html><script>',CKEDITOR.env.ie?"("+CKEDITOR.tools.fixDomain+")();":"","window.parent.CKEDITOR.tools.callFunction("+r+");","window.onbeforeunload = function() {window.parent.CKEDITOR.tools.callFunction("+o+")}","</script>"].join("")),i.$.close(),t=0;t<a.length;t++)a[t].enable()}var e=this._,i=CKEDITOR.document.getById(e.frameId).getFrameDocument(),n=e.definition,a=e.buttons,r=this.formLoadedNumber,o=this.formUnloadNumber,s=e.dialog._.editor.lang.dir,l=e.dialog._.editor.langCode;r||(r=this.formLoadedNumber=CKEDITOR.tools.addFunction(function(){this.fire("formLoaded")},this),o=this.formUnloadNumber=CKEDITOR.tools.addFunction(function(){this.getInputElement().clearCustomData()},this),this.getDialog()._.editor.on("destroy",function(){CKEDITOR.tools.removeFunction(r),CKEDITOR.tools.removeFunction(o)})),CKEDITOR.env.gecko?setTimeout(t,500):t()},getValue:function(){return this.getInputElement().$.value||""},setInitValue:function(){this._.initValue=""},eventProcessors:{onChange:function(t,e){this._.domOnChangeRegistered||(this.on("formLoaded",function(){this.getInputElement().on("change",function(){this.fire("change",{value:this.getValue()})},this)},this),this._.domOnChangeRegistered=!0),this.on("change",e)}},keyboardFocusable:!0},!0),CKEDITOR.ui.dialog.fileButton.prototype=new CKEDITOR.ui.dialog.button,CKEDITOR.ui.dialog.fieldset.prototype=CKEDITOR.tools.clone(CKEDITOR.ui.dialog.hbox.prototype),CKEDITOR.dialog.addUIElement("text",e),CKEDITOR.dialog.addUIElement("password",e),CKEDITOR.dialog.addUIElement("textarea",i),CKEDITOR.dialog.addUIElement("checkbox",i),CKEDITOR.dialog.addUIElement("radio",i),CKEDITOR.dialog.addUIElement("button",i),CKEDITOR.dialog.addUIElement("select",i),CKEDITOR.dialog.addUIElement("file",i),CKEDITOR.dialog.addUIElement("fileButton",i),CKEDITOR.dialog.addUIElement("html",i),CKEDITOR.dialog.addUIElement("fieldset",{build:function(t,e,i){for(var n,a=e.children,r=[],o=[],s=0;s<a.length&&(n=a[s]);s++){var l=[];r.push(l),o.push(CKEDITOR.dialog._.uiElementBuilders[n.type].build(t,n,l))}return new CKEDITOR.ui.dialog[e.type](t,o,r,i,e)}})}}),CKEDITOR.DIALOG_RESIZE_NONE=0,CKEDITOR.DIALOG_RESIZE_WIDTH=1,CKEDITOR.DIALOG_RESIZE_HEIGHT=2,CKEDITOR.DIALOG_RESIZE_BOTH=3,function(){function t(){for(var t=this._.tabIdList.length,e=CKEDITOR.tools.indexOf(this._.tabIdList,this._.currentTabId)+t,i=e-1;i>e-t;i--)if(this._.tabs[this._.tabIdList[i%t]][0].$.offsetHeight)return this._.tabIdList[i%t];return null}function e(){for(var t=this._.tabIdList.length,e=CKEDITOR.tools.indexOf(this._.tabIdList,this._.currentTabId),i=e+1;e+t>i;i++)if(this._.tabs[this._.tabIdList[i%t]][0].$.offsetHeight)return this._.tabIdList[i%t];return null}function i(t,e){for(var i=t.$.getElementsByTagName("input"),n=0,a=i.length;a>n;n++){var r=new CKEDITOR.dom.element(i[n]);"text"==r.getAttribute("type").toLowerCase()&&(e?(r.setAttribute("value",r.getCustomData("fake_value")||""),r.removeCustomData("fake_value")):(r.setCustomData("fake_value",r.getAttribute("value")),r.setAttribute("value","")))}}function n(t,e){var i=this.getInputElement();i&&(t?i.removeAttribute("aria-invalid"):i.setAttribute("aria-invalid",!0)),t||(this.select?this.select():this.focus()),e&&alert(e),this.fire("validated",{valid:t,msg:e})}function a(){var t=this.getInputElement();t&&t.removeAttribute("aria-invalid")}function r(t){var t=CKEDITOR.dom.element.createFromHtml(CKEDITOR.addTemplate("dialog",m).output({id:CKEDITOR.tools.getNextNumber(),editorId:t.id,langDir:t.lang.dir,langCode:t.langCode,editorDialogClass:"cke_editor_"+t.name.replace(/\./g,"\\.")+"_dialog",closeTitle:t.lang.common.close,hidpi:CKEDITOR.env.hidpi?"cke_hidpi":""})),e=t.getChild([0,0,0,0,0]),i=e.getChild(0),n=e.getChild(1);if(CKEDITOR.env.ie&&!CKEDITOR.env.ie6Compat){var a="javascript:void(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"}())";CKEDITOR.dom.element.createFromHtml('<iframe frameBorder="0" class="cke_iframe_shim" src="'+a+'" tabIndex="-1"></iframe>').appendTo(e.getParent())}return i.unselectable(),n.unselectable(),{element:t,parts:{dialog:t.getChild(0),title:i,close:n,tabs:e.getChild(2),contents:e.getChild([3,0,0,0]),footer:e.getChild([3,0,1,0])}}}function o(t,e,i){this.element=e,this.focusIndex=i,this.tabIndex=0,this.isFocusable=function(){return!e.getAttribute("disabled")&&e.isVisible()},this.focus=function(){t._.currentFocusIndex=this.focusIndex,this.element.focus()},e.on("keydown",function(t){t.data.getKeystroke()in{32:1,13:1}&&this.fire("click")}),e.on("focus",function(){this.fire("mouseover")}),e.on("blur",function(){this.fire("mouseout")})}function s(t){function e(){t.layout()}var i=CKEDITOR.document.getWindow();i.on("resize",e),t.on("hide",function(){i.removeListener("resize",e)})}function l(t,e){this._={dialog:t},CKEDITOR.tools.extend(this,e)
}function c(t){function e(e){var i=t.getSize(),l=CKEDITOR.document.getWindow().getViewPaneSize(),c=e.data.$.screenX,d=e.data.$.screenY,h=c-n.x,u=d-n.y;n={x:c,y:d},a.x=a.x+h,a.y=a.y+u,t.move(a.x+s[3]<o?-s[3]:a.x-s[1]>l.width-i.width-o?l.width-i.width+("rtl"==r.lang.dir?0:s[1]):a.x,a.y+s[0]<o?-s[0]:a.y-s[2]>l.height-i.height-o?l.height-i.height+s[2]:a.y,1),e.data.preventDefault()}function i(){if(CKEDITOR.document.removeListener("mousemove",e),CKEDITOR.document.removeListener("mouseup",i),CKEDITOR.env.ie6Compat){var t=y.getChild(0).getFrameDocument();t.removeListener("mousemove",e),t.removeListener("mouseup",i)}}var n=null,a=null;t.getElement().getFirst();var r=t.getParentEditor(),o=r.config.dialog_magnetDistance,s=CKEDITOR.skin.margins||[0,0,0,0];"undefined"==typeof o&&(o=20),t.parts.title.on("mousedown",function(r){if(n={x:r.data.$.screenX,y:r.data.$.screenY},CKEDITOR.document.on("mousemove",e),CKEDITOR.document.on("mouseup",i),a=t.getPosition(),CKEDITOR.env.ie6Compat){var o=y.getChild(0).getFrameDocument();o.on("mousemove",e),o.on("mouseup",i)}r.data.preventDefault()},t)}function d(t){function e(e){var i="rtl"==u.lang.dir,h=d.width,p=d.height,f=h+(e.data.$.screenX-n)*(i?-1:1)*(t._.moved?1:2),m=p+(e.data.$.screenY-a)*(t._.moved?1:2),g=t._.element.getFirst(),g=i&&g.getComputedStyle("right"),v=t.getPosition();v.y+m>c.height&&(m=c.height-v.y),(i?g:v.x)+f>c.width&&(f=c.width-(i?g:v.x)),(o==CKEDITOR.DIALOG_RESIZE_WIDTH||o==CKEDITOR.DIALOG_RESIZE_BOTH)&&(h=Math.max(r.minWidth||0,f-s)),(o==CKEDITOR.DIALOG_RESIZE_HEIGHT||o==CKEDITOR.DIALOG_RESIZE_BOTH)&&(p=Math.max(r.minHeight||0,m-l)),t.resize(h,p),t._.moved||t.layout(),e.data.preventDefault()}function i(){if(CKEDITOR.document.removeListener("mouseup",i),CKEDITOR.document.removeListener("mousemove",e),h&&(h.remove(),h=null),CKEDITOR.env.ie6Compat){var t=y.getChild(0).getFrameDocument();t.removeListener("mouseup",i),t.removeListener("mousemove",e)}}var n,a,r=t.definition,o=r.resizable;if(o!=CKEDITOR.DIALOG_RESIZE_NONE){var s,l,c,d,h,u=t.getParentEditor(),p=CKEDITOR.tools.addFunction(function(r){d=t.getSize();var o=t.parts.contents;o.$.getElementsByTagName("iframe").length&&(h=CKEDITOR.dom.element.createFromHtml('<div class="cke_dialog_resize_cover" style="height: 100%; position: absolute; width: 100%;"></div>'),o.append(h)),l=d.height-t.parts.contents.getSize("height",!(CKEDITOR.env.gecko||CKEDITOR.env.opera||CKEDITOR.env.ie&&CKEDITOR.env.quirks)),s=d.width-t.parts.contents.getSize("width",1),n=r.screenX,a=r.screenY,c=CKEDITOR.document.getWindow().getViewPaneSize(),CKEDITOR.document.on("mousemove",e),CKEDITOR.document.on("mouseup",i),CKEDITOR.env.ie6Compat&&(o=y.getChild(0).getFrameDocument(),o.on("mousemove",e),o.on("mouseup",i)),r.preventDefault&&r.preventDefault()});t.on("load",function(){var e="";o==CKEDITOR.DIALOG_RESIZE_WIDTH?e=" cke_resizer_horizontal":o==CKEDITOR.DIALOG_RESIZE_HEIGHT&&(e=" cke_resizer_vertical"),e=CKEDITOR.dom.element.createFromHtml('<div class="cke_resizer'+e+" cke_resizer_"+u.lang.dir+'" title="'+CKEDITOR.tools.htmlEncode(u.lang.common.resize)+'" onmousedown="CKEDITOR.tools.callFunction('+p+', event )">'+("ltr"==u.lang.dir?"◢":"◣")+"</div>"),t.parts.footer.append(e,1)}),u.on("destroy",function(){CKEDITOR.tools.removeFunction(p)})}}function h(t){t.data.preventDefault(1)}function u(t){var e=CKEDITOR.document.getWindow(),i=t.config,n=i.dialog_backgroundCoverColor||"white",a=i.dialog_backgroundCoverOpacity,r=i.baseFloatZIndex,i=CKEDITOR.tools.genKey(n,a,r),o=T[i];o?o.show():(r=['<div tabIndex="-1" style="position: ',CKEDITOR.env.ie6Compat?"absolute":"fixed","; z-index: ",r,"; top: 0px; left: 0px; ",CKEDITOR.env.ie6Compat?"":"background-color: "+n,'" class="cke_dialog_background_cover">'],CKEDITOR.env.ie6Compat&&(n="<html><body style=\\'background-color:"+n+";\\'></body></html>",r.push('<iframe hidefocus="true" frameborder="0" id="cke_dialog_background_iframe" src="javascript:'),r.push("void((function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.write( '"+n+"' );document.close();")+"})())"),r.push('" style="position:absolute;left:0;top:0;width:100%;height: 100%;filter: progid:DXImageTransform.Microsoft.Alpha(opacity=0)"></iframe>')),r.push("</div>"),o=CKEDITOR.dom.element.createFromHtml(r.join("")),o.setOpacity(void 0!=a?a:.5),o.on("keydown",h),o.on("keypress",h),o.on("keyup",h),o.appendTo(CKEDITOR.document.getBody()),T[i]=o),t.focusManager.add(o),y=o;var t=function(){var t=e.getViewPaneSize();o.setStyles({width:t.width+"px",height:t.height+"px"})},s=function(){var t=e.getScrollPosition(),i=CKEDITOR.dialog._.currentTop;if(o.setStyles({left:t.x+"px",top:t.y+"px"}),i)do t=i.getPosition(),i.move(t.x,t.y);while(i=i._.parentDialog)};if(E=t,e.on("resize",t),t(),(!CKEDITOR.env.mac||!CKEDITOR.env.webkit)&&o.focus(),CKEDITOR.env.ie6Compat){var l=function(){s(),arguments.callee.prevScrollHandler.apply(this,arguments)};e.$.setTimeout(function(){l.prevScrollHandler=window.onscroll||function(){},window.onscroll=l},0),s()}}function p(t){y&&(t.focusManager.remove(y),t=CKEDITOR.document.getWindow(),y.hide(),t.removeListener("resize",E),CKEDITOR.env.ie6Compat&&t.$.setTimeout(function(){window.onscroll=window.onscroll&&window.onscroll.prevScrollHandler||null},0),E=null)}var f=CKEDITOR.tools.cssLength,m='<div class="cke_reset_all {editorId} {editorDialogClass} {hidpi}" dir="{langDir}" lang="{langCode}" role="dialog" aria-labelledby="cke_dialog_title_{id}"><table class="cke_dialog '+CKEDITOR.env.cssClass+' cke_{langDir}" style="position:absolute" role="presentation"><tr><td role="presentation"><div class="cke_dialog_body" role="presentation"><div id="cke_dialog_title_{id}" class="cke_dialog_title" role="presentation"></div><a id="cke_dialog_close_button_{id}" class="cke_dialog_close_button" href="javascript:void(0)" title="{closeTitle}" role="button"><span class="cke_label">X</span></a><div id="cke_dialog_tabs_{id}" class="cke_dialog_tabs" role="tablist"></div><table class="cke_dialog_contents" role="presentation"><tr><td id="cke_dialog_contents_{id}" class="cke_dialog_contents_body" role="presentation"></td></tr><tr><td id="cke_dialog_footer_{id}" class="cke_dialog_footer" role="presentation"></td></tr></table></div></td></tr></table></div>';CKEDITOR.dialog=function(i,o){function s(){var t=T._.focusList;t.sort(function(t,e){return t.tabIndex!=e.tabIndex?e.tabIndex-t.tabIndex:t.focusIndex-e.focusIndex});for(var e=t.length,i=0;e>i;i++)t[i].focusIndex=i}function l(t){var e=T._.focusList,t=t||0;if(!(e.length<1)){var i=T._.currentFocusIndex;try{e[i].getInputElement().$.blur()}catch(n){}for(var a=i=(i+t+e.length)%e.length;t&&!e[a].isFocusable()&&(a=(a+t+e.length)%e.length,a!=i););e[a].focus(),"text"==e[a].type&&e[a].select()}}function h(n){if(T==CKEDITOR.dialog._.currentTop){var a=n.data.getKeystroke(),r="rtl"==i.lang.dir;if(p=f=0,9==a||a==CKEDITOR.SHIFT+9)a=a==CKEDITOR.SHIFT+9,T._.tabBarMode?(a=a?t.call(T):e.call(T),T.selectPage(a),T._.tabs[a][0].focus()):l(a?-1:1),p=1;else if(a==CKEDITOR.ALT+121&&!T._.tabBarMode&&T.getPageCount()>1)T._.tabBarMode=!0,T._.tabs[T._.currentTabId][0].focus(),p=1;else if(37!=a&&39!=a||!T._.tabBarMode)if(13!=a&&32!=a||!T._.tabBarMode)if(13==a)a=n.data.getTarget(),a.is("a","button","select","textarea")||a.is("input")&&"button"==a.$.type||((a=this.getButton("ok"))&&CKEDITOR.tools.setTimeout(a.click,0,a),p=1),f=1;else{if(27!=a)return;(a=this.getButton("cancel"))?CKEDITOR.tools.setTimeout(a.click,0,a):this.fire("cancel",{hide:!0}).hide!==!1&&this.hide(),f=1}else this.selectPage(this._.currentTabId),this._.tabBarMode=!1,this._.currentFocusIndex=-1,l(1),p=1;else a=a==(r?39:37)?t.call(T):e.call(T),T.selectPage(a),T._.tabs[a][0].focus(),p=1;u(n)}}function u(t){p?t.data.preventDefault(1):f&&t.data.stopPropagation()}var p,f,m=CKEDITOR.dialog._.dialogDefinitions[o],v=CKEDITOR.tools.clone(g),C=i.config.dialog_buttonsOrder||"OS",I=i.lang.dir,E={};if(("OS"==C&&CKEDITOR.env.mac||"rtl"==C&&"ltr"==I||"ltr"==C&&"rtl"==I)&&v.buttons.reverse(),m=CKEDITOR.tools.extend(m(i),v),m=CKEDITOR.tools.clone(m),m=new b(this,m),v=r(i),this._={editor:i,element:v.element,name:o,contentSize:{width:0,height:0},size:{width:0,height:0},contents:{},buttons:{},accessKeyMap:{},tabs:{},tabIdList:[],currentTabId:null,currentTabIndex:null,pageCount:0,lastTab:null,tabBarMode:!1,focusList:[],currentFocusIndex:0,hasFocus:!1},this.parts=v.parts,CKEDITOR.tools.setTimeout(function(){i.fire("ariaWidget",this.parts.contents)},0,this),v={position:CKEDITOR.env.ie6Compat?"absolute":"fixed",top:0,visibility:"hidden"},v["rtl"==I?"right":"left"]=0,this.parts.dialog.setStyles(v),CKEDITOR.event.call(this),this.definition=m=CKEDITOR.fire("dialogDefinition",{name:o,definition:m},i).definition,!("removeDialogTabs"in i._)&&i.config.removeDialogTabs){for(v=i.config.removeDialogTabs.split(";"),I=0;I<v.length;I++)if(C=v[I].split(":"),2==C.length){var y=C[0];E[y]||(E[y]=[]),E[y].push(C[1])}i._.removeDialogTabs=E}if(i._.removeDialogTabs&&(E=i._.removeDialogTabs[o]))for(I=0;I<E.length;I++)m.removeContents(E[I]);m.onLoad&&this.on("load",m.onLoad),m.onShow&&this.on("show",m.onShow),m.onHide&&this.on("hide",m.onHide),m.onOk&&this.on("ok",function(t){i.fire("saveSnapshot"),setTimeout(function(){i.fire("saveSnapshot")},0),m.onOk.call(this,t)===!1&&(t.data.hide=!1)}),m.onCancel&&this.on("cancel",function(t){m.onCancel.call(this,t)===!1&&(t.data.hide=!1)});var T=this,R=function(t){var e,i=T._.contents,n=!1;for(e in i)for(var a in i[e])if(n=t.call(this,i[e][a]))return};this.on("ok",function(t){R(function(e){if(e.validate){var i=e.validate(this),a="string"==typeof i||i===!1;return a&&(t.data.hide=!1,t.stop()),n.call(e,!a,"string"==typeof i?i:void 0),a}})},this,null,0),this.on("cancel",function(t){R(function(e){return e.isChanged()?(i.config.dialog_noConfirmCancel||confirm(i.lang.common.confirmCancel)||(t.data.hide=!1),!0):void 0})},this,null,0),this.parts.close.on("click",function(t){this.fire("cancel",{hide:!0}).hide!==!1&&this.hide(),t.data.preventDefault()},this),this.changeFocus=l;var w=this._.element;for(i.focusManager.add(w,1),this.on("show",function(){w.on("keydown",h,this),(CKEDITOR.env.opera||CKEDITOR.env.gecko)&&w.on("keypress",u,this)}),this.on("hide",function(){w.removeListener("keydown",h),(CKEDITOR.env.opera||CKEDITOR.env.gecko)&&w.removeListener("keypress",u),R(function(t){a.apply(t)})}),this.on("iframeAdded",function(t){new CKEDITOR.dom.document(t.data.iframe.$.contentWindow.document).on("keydown",h,this,null,0)}),this.on("show",function(){if(s(),i.config.dialog_startupFocusTab&&T._.pageCount>1)T._.tabBarMode=!0,T._.tabs[T._.currentTabId][0].focus();else if(!this._.hasFocus)if(this._.currentFocusIndex=-1,m.onFocus){var t=m.onFocus.call(this);t&&t.focus()}else l(1)},this,null,4294967295),CKEDITOR.env.ie6Compat&&this.on("load",function(){var t=this.getElement(),e=t.getFirst();e.remove(),e.appendTo(t)},this),c(this),d(this),new CKEDITOR.dom.text(m.title,CKEDITOR.document).appendTo(this.parts.title),I=0;I<m.contents.length;I++)(E=m.contents[I])&&this.addPage(E);for(this.parts.tabs.on("click",function(t){var e=t.data.getTarget();e.hasClass("cke_dialog_tab")&&(e=e.$.id,this.selectPage(e.substring(4,e.lastIndexOf("_"))),this._.tabBarMode&&(this._.tabBarMode=!1,this._.currentFocusIndex=-1,l(1)),t.data.preventDefault())},this),I=[],E=CKEDITOR.dialog._.uiElementBuilders.hbox.build(this,{type:"hbox",className:"cke_dialog_footer_buttons",widths:[],children:m.buttons},I).getChild(),this.parts.footer.setHtml(I.join("")),I=0;I<E.length;I++)this._.buttons[E[I].id]=E[I]},CKEDITOR.dialog.prototype={destroy:function(){this.hide(),this._.element.remove()},resize:function(){return function(t,e){this._.contentSize&&this._.contentSize.width==t&&this._.contentSize.height==e||(CKEDITOR.dialog.fire("resize",{dialog:this,width:t,height:e},this._.editor),this.fire("resize",{width:t,height:e},this._.editor),this.parts.contents.setStyles({width:t+"px",height:e+"px"}),"rtl"==this._.editor.lang.dir&&this._.position&&(this._.position.x=CKEDITOR.document.getWindow().getViewPaneSize().width-this._.contentSize.width-parseInt(this._.element.getFirst().getStyle("right"),10)),this._.contentSize={width:t,height:e})}}(),getSize:function(){var t=this._.element.getFirst();return{width:t.$.offsetWidth||0,height:t.$.offsetHeight||0}},move:function(t,e,i){var n=this._.element.getFirst(),a="rtl"==this._.editor.lang.dir,r="fixed"==n.getComputedStyle("position");CKEDITOR.env.ie&&n.setStyle("zoom","100%"),r&&this._.position&&this._.position.x==t&&this._.position.y==e||(this._.position={x:t,y:e},r||(r=CKEDITOR.document.getWindow().getScrollPosition(),t+=r.x,e+=r.y),a&&(r=this.getSize(),t=CKEDITOR.document.getWindow().getViewPaneSize().width-r.width-t),e={top:(e>0?e:0)+"px"},e[a?"right":"left"]=(t>0?t:0)+"px",n.setStyles(e),i&&(this._.moved=1))},getPosition:function(){return CKEDITOR.tools.extend({},this._.position)},show:function(){var t=this._.element,e=this.definition;if(t.getParent()&&t.getParent().equals(CKEDITOR.document.getBody())?t.setStyle("display","block"):t.appendTo(CKEDITOR.document.getBody()),CKEDITOR.env.gecko&&CKEDITOR.env.version<10900){var i=this.parts.dialog;i.setStyle("position","absolute"),setTimeout(function(){i.setStyle("position","fixed")},0)}this.resize(this._.contentSize&&this._.contentSize.width||e.width||e.minWidth,this._.contentSize&&this._.contentSize.height||e.height||e.minHeight),this.reset(),this.selectPage(this.definition.contents[0].id),null===CKEDITOR.dialog._.currentZIndex&&(CKEDITOR.dialog._.currentZIndex=this._.editor.config.baseFloatZIndex),this._.element.getFirst().setStyle("z-index",CKEDITOR.dialog._.currentZIndex=CKEDITOR.dialog._.currentZIndex+10),null===CKEDITOR.dialog._.currentTop?(CKEDITOR.dialog._.currentTop=this,this._.parentDialog=null,u(this._.editor)):(this._.parentDialog=CKEDITOR.dialog._.currentTop,this._.parentDialog.getElement().getFirst().$.style.zIndex-=Math.floor(this._.editor.config.baseFloatZIndex/2),CKEDITOR.dialog._.currentTop=this),t.on("keydown",w),t.on(CKEDITOR.env.opera?"keypress":"keyup",O),this._.hasFocus=!1;for(var n in e.contents)if(e.contents[n]){var t=e.contents[n],a=this._.tabs[t.id],r=t.requiredContent,o=0;if(a){for(var l in this._.contents[t.id]){var c=this._.contents[t.id][l];"hbox"!=c.type&&"vbox"!=c.type&&c.getInputElement()&&(c.requiredContent&&!this._.editor.activeFilter.check(c.requiredContent)?c.disable():(c.enable(),o++))}!o||r&&!this._.editor.activeFilter.check(r)?a[0].addClass("cke_dialog_tab_disabled"):a[0].removeClass("cke_dialog_tab_disabled")}}CKEDITOR.tools.setTimeout(function(){this.layout(),s(this),this.parts.dialog.setStyle("visibility",""),this.fireOnce("load",{}),CKEDITOR.ui.fire("ready",this),this.fire("show",{}),this._.editor.fire("dialogShow",this),this._.parentDialog||this._.editor.focusManager.lock(),this.foreach(function(t){t.setInitValue&&t.setInitValue()})},100,this)},layout:function(){var t=this.parts.dialog,e=this.getSize(),i=CKEDITOR.document.getWindow().getViewPaneSize(),n=(i.width-e.width)/2,a=(i.height-e.height)/2;CKEDITOR.env.ie6Compat||(e.height+(a>0?a:0)>i.height||e.width+(n>0?n:0)>i.width?t.setStyle("position","absolute"):t.setStyle("position","fixed")),this.move(this._.moved?this._.position.x:n,this._.moved?this._.position.y:a)},foreach:function(t){for(var e in this._.contents)for(var i in this._.contents[e])t.call(this,this._.contents[e][i]);return this},reset:function(){var t=function(t){t.reset&&t.reset(1)};return function(){return this.foreach(t),this}}(),setupContent:function(){var t=arguments;this.foreach(function(e){e.setup&&e.setup.apply(e,t)})},commitContent:function(){var t=arguments;this.foreach(function(e){CKEDITOR.env.ie&&this._.currentFocusIndex==e.focusIndex&&e.getInputElement().$.blur(),e.commit&&e.commit.apply(e,t)})},hide:function(){if(this.parts.dialog.isVisible()){this.fire("hide",{}),this._.editor.fire("dialogHide",this),this.selectPage(this._.tabIdList[0]);var t=this._.element;for(t.setStyle("display","none"),this.parts.dialog.setStyle("visibility","hidden"),D(this);CKEDITOR.dialog._.currentTop!=this;)CKEDITOR.dialog._.currentTop.hide();if(this._.parentDialog){var e=this._.parentDialog.getElement().getFirst();e.setStyle("z-index",parseInt(e.$.style.zIndex,10)+Math.floor(this._.editor.config.baseFloatZIndex/2))}else p(this._.editor);if(CKEDITOR.dialog._.currentTop=this._.parentDialog)CKEDITOR.dialog._.currentZIndex=CKEDITOR.dialog._.currentZIndex-10;else{CKEDITOR.dialog._.currentZIndex=null,t.removeListener("keydown",w),t.removeListener(CKEDITOR.env.opera?"keypress":"keyup",O);var i=this._.editor;i.focus(),setTimeout(function(){i.focusManager.unlock()},0)}delete this._.parentDialog,this.foreach(function(t){t.resetInitValue&&t.resetInitValue()})}},addPage:function(t){if(!t.requiredContent||this._.editor.filter.check(t.requiredContent)){for(var e=[],i=t.label?' title="'+CKEDITOR.tools.htmlEncode(t.label)+'"':"",n=CKEDITOR.dialog._.uiElementBuilders.vbox.build(this,{type:"vbox",className:"cke_dialog_page_contents",children:t.elements,expand:!!t.expand,padding:t.padding,style:t.style||"width: 100%;"},e),a=this._.contents[t.id]={},r=n.getChild(),o=0;n=r.shift();)!n.notAllowed&&"hbox"!=n.type&&"vbox"!=n.type&&o++,a[n.id]=n,"function"==typeof n.getChild&&r.push.apply(r,n.getChild());o||(t.hidden=!0),e=CKEDITOR.dom.element.createFromHtml(e.join("")),e.setAttribute("role","tabpanel"),n=CKEDITOR.env,a="cke_"+t.id+"_"+CKEDITOR.tools.getNextNumber(),i=CKEDITOR.dom.element.createFromHtml(['<a class="cke_dialog_tab"',this._.pageCount>0?" cke_last":"cke_first",i,t.hidden?' style="display:none"':"",' id="',a,'"',n.gecko&&n.version>=10900&&!n.hc?"":' href="javascript:void(0)"',' tabIndex="-1" hidefocus="true" role="tab">',t.label,"</a>"].join("")),e.setAttribute("aria-labelledby",a),this._.tabs[t.id]=[i,e],this._.tabIdList.push(t.id),!t.hidden&&this._.pageCount++,this._.lastTab=i,this.updateStyle(),e.setAttribute("name",t.id),e.appendTo(this.parts.contents),i.unselectable(),this.parts.tabs.append(i),t.accessKey&&(_(this,this,"CTRL+"+t.accessKey,k,x),this._.accessKeyMap["CTRL+"+t.accessKey]=t.id)}},selectPage:function(t){if(this._.currentTabId!=t&&!this._.tabs[t][0].hasClass("cke_dialog_tab_disabled")&&this.fire("selectPage",{page:t,currentPage:this._.currentTabId})!==!1){for(var e in this._.tabs){var n=this._.tabs[e][0],a=this._.tabs[e][1];e!=t&&(n.removeClass("cke_dialog_tab_selected"),a.hide()),a.setAttribute("aria-hidden",e!=t)}var r=this._.tabs[t];r[0].addClass("cke_dialog_tab_selected"),CKEDITOR.env.ie6Compat||CKEDITOR.env.ie7Compat?(i(r[1]),r[1].show(),setTimeout(function(){i(r[1],1)},0)):r[1].show(),this._.currentTabId=t,this._.currentTabIndex=CKEDITOR.tools.indexOf(this._.tabIdList,t)}},updateStyle:function(){this.parts.dialog[(1===this._.pageCount?"add":"remove")+"Class"]("cke_single_page")},hidePage:function(e){var i=this._.tabs[e]&&this._.tabs[e][0];i&&1!=this._.pageCount&&i.isVisible()&&(e==this._.currentTabId&&this.selectPage(t.call(this)),i.hide(),this._.pageCount--,this.updateStyle())},showPage:function(t){(t=this._.tabs[t]&&this._.tabs[t][0])&&(t.show(),this._.pageCount++,this.updateStyle())},getElement:function(){return this._.element},getName:function(){return this._.name},getContentElement:function(t,e){var i=this._.contents[t];return i&&i[e]},getValueOf:function(t,e){return this.getContentElement(t,e).getValue()},setValueOf:function(t,e,i){return this.getContentElement(t,e).setValue(i)},getButton:function(t){return this._.buttons[t]},click:function(t){return this._.buttons[t].click()},disableButton:function(t){return this._.buttons[t].disable()},enableButton:function(t){return this._.buttons[t].enable()},getPageCount:function(){return this._.pageCount},getParentEditor:function(){return this._.editor},getSelectedElement:function(){return this.getParentEditor().getSelection().getSelectedElement()},addFocusable:function(t,e){if("undefined"==typeof e)e=this._.focusList.length,this._.focusList.push(new o(this,t,e));else{this._.focusList.splice(e,0,new o(this,t,e));for(var i=e+1;i<this._.focusList.length;i++)this._.focusList[i].focusIndex++}}},CKEDITOR.tools.extend(CKEDITOR.dialog,{add:function(t,e){this._.dialogDefinitions[t]&&"function"!=typeof e||(this._.dialogDefinitions[t]=e)},exists:function(t){return!!this._.dialogDefinitions[t]},getCurrent:function(){return CKEDITOR.dialog._.currentTop},isTabEnabled:function(t,e,i){return t=t.config.removeDialogTabs,!(t&&t.match(RegExp("(?:^|;)"+e+":"+i+"(?:$|;)","i")))},okButton:function(){var t=function(t,e){return e=e||{},CKEDITOR.tools.extend({id:"ok",type:"button",label:t.lang.common.ok,"class":"cke_dialog_ui_button_ok",onClick:function(t){t=t.data.dialog,t.fire("ok",{hide:!0}).hide!==!1&&t.hide()}},e,!0)};return t.type="button",t.override=function(e){return CKEDITOR.tools.extend(function(i){return t(i,e)},{type:"button"},!0)},t}(),cancelButton:function(){var t=function(t,e){return e=e||{},CKEDITOR.tools.extend({id:"cancel",type:"button",label:t.lang.common.cancel,"class":"cke_dialog_ui_button_cancel",onClick:function(t){t=t.data.dialog,t.fire("cancel",{hide:!0}).hide!==!1&&t.hide()}},e,!0)};return t.type="button",t.override=function(e){return CKEDITOR.tools.extend(function(i){return t(i,e)},{type:"button"},!0)},t}(),addUIElement:function(t,e){this._.uiElementBuilders[t]=e}}),CKEDITOR.dialog._={uiElementBuilders:{},dialogDefinitions:{},currentTop:null,currentZIndex:null},CKEDITOR.event.implementOn(CKEDITOR.dialog),CKEDITOR.event.implementOn(CKEDITOR.dialog.prototype);var g={resizable:CKEDITOR.DIALOG_RESIZE_BOTH,minWidth:600,minHeight:400,buttons:[CKEDITOR.dialog.okButton,CKEDITOR.dialog.cancelButton]},v=function(t,e,i){for(var n,a=0;n=t[a];a++){if(n.id==e)return n;if(i&&n[i]&&(n=v(n[i],e,i)))return n}return null},C=function(t,e,i,n,a){if(i){for(var r,o=0;r=t[o];o++){if(r.id==i)return t.splice(o,0,e),e;if(n&&r[n]&&(r=C(r[n],e,i,n,!0)))return r}if(a)return null}return t.push(e),e},I=function(t,e,i){for(var n,a=0;n=t[a];a++){if(n.id==e)return t.splice(a,1);if(i&&n[i]&&(n=I(n[i],e,i)))return n}return null},b=function(t,e){this.dialog=t;for(var i,n=e.contents,a=0;i=n[a];a++)n[a]=i&&new l(t,i);CKEDITOR.tools.extend(this,e)};b.prototype={getContents:function(t){return v(this.contents,t)},getButton:function(t){return v(this.buttons,t)},addContents:function(t,e){return C(this.contents,t,e)},addButton:function(t,e){return C(this.buttons,t,e)},removeContents:function(t){I(this.contents,t)},removeButton:function(t){I(this.buttons,t)}},l.prototype={get:function(t){return v(this.elements,t,"children")},add:function(t,e){return C(this.elements,t,e,"children")},remove:function(t){I(this.elements,t,"children")}};var E,y,T={},R={},w=function(t){var e=t.data.$.ctrlKey||t.data.$.metaKey,i=t.data.$.altKey,n=t.data.$.shiftKey,a=String.fromCharCode(t.data.$.keyCode);(e=R[(e?"CTRL+":"")+(i?"ALT+":"")+(n?"SHIFT+":"")+a])&&e.length&&(e=e[e.length-1],e.keydown&&e.keydown.call(e.uiElement,e.dialog,e.key),t.data.preventDefault())},O=function(t){var e=t.data.$.ctrlKey||t.data.$.metaKey,i=t.data.$.altKey,n=t.data.$.shiftKey,a=String.fromCharCode(t.data.$.keyCode);(e=R[(e?"CTRL+":"")+(i?"ALT+":"")+(n?"SHIFT+":"")+a])&&e.length&&(e=e[e.length-1],e.keyup&&(e.keyup.call(e.uiElement,e.dialog,e.key),t.data.preventDefault()))},_=function(t,e,i,n,a){(R[i]||(R[i]=[])).push({uiElement:t,dialog:e,key:i,keyup:a||t.accessKeyUp,keydown:n||t.accessKeyDown})},D=function(t){for(var e in R){for(var i=R[e],n=i.length-1;n>=0;n--)(i[n].dialog==t||i[n].uiElement==t)&&i.splice(n,1);0===i.length&&delete R[e]}},x=function(t,e){t._.accessKeyMap[e]&&t.selectPage(t._.accessKeyMap[e])},k=function(){};!function(){CKEDITOR.ui.dialog={uiElement:function(t,e,i,n,a,r,o){if(!(arguments.length<4)){var s=(n.call?n(e):n)||"div",l=["<",s," "],c=(a&&a.call?a(e):a)||{},d=(r&&r.call?r(e):r)||{},h=(o&&o.call?o.call(this,t,e):o)||"",u=this.domId=d.id||CKEDITOR.tools.getNextId()+"_uiElement";this.id=e.id,e.requiredContent&&!t.getParentEditor().filter.check(e.requiredContent)&&(c.display="none",this.notAllowed=!0),d.id=u;var p={};e.type&&(p["cke_dialog_ui_"+e.type]=1),e.className&&(p[e.className]=1),e.disabled&&(p.cke_disabled=1);for(var f=d["class"]&&d["class"].split?d["class"].split(" "):[],u=0;u<f.length;u++)f[u]&&(p[f[u]]=1);f=[];for(u in p)f.push(u);d["class"]=f.join(" "),e.title&&(d.title=e.title),p=(e.style||"").split(";"),e.align&&(f=e.align,c["margin-left"]="left"==f?0:"auto",c["margin-right"]="right"==f?0:"auto");for(u in c)p.push(u+":"+c[u]);for(e.hidden&&p.push("display:none"),u=p.length-1;u>=0;u--)""===p[u]&&p.splice(u,1);p.length>0&&(d.style=(d.style?d.style+"; ":"")+p.join("; "));for(u in d)l.push(u+'="'+CKEDITOR.tools.htmlEncode(d[u])+'" ');l.push(">",h,"</",s,">"),i.push(l.join("")),(this._||(this._={})).dialog=t,"boolean"==typeof e.isChanged&&(this.isChanged=function(){return e.isChanged}),"function"==typeof e.isChanged&&(this.isChanged=e.isChanged),"function"==typeof e.setValue&&(this.setValue=CKEDITOR.tools.override(this.setValue,function(t){return function(i){t.call(this,e.setValue.call(this,i))}})),"function"==typeof e.getValue&&(this.getValue=CKEDITOR.tools.override(this.getValue,function(t){return function(){return e.getValue.call(this,t.call(this))}})),CKEDITOR.event.implementOn(this),this.registerEvents(e),this.accessKeyUp&&this.accessKeyDown&&e.accessKey&&_(this,t,"CTRL+"+e.accessKey);var m=this;t.on("load",function(){var e=m.getInputElement();if(e){var i=m.type in{checkbox:1,ratio:1}&&CKEDITOR.env.ie&&CKEDITOR.env.version<8?"cke_dialog_ui_focused":"";e.on("focus",function(){t._.tabBarMode=!1,t._.hasFocus=!0,m.fire("focus"),i&&this.addClass(i)}),e.on("blur",function(){m.fire("blur"),i&&this.removeClass(i)})}}),CKEDITOR.tools.extend(this,e),this.keyboardFocusable&&(this.tabIndex=e.tabIndex||0,this.focusIndex=t._.focusList.push(this)-1,this.on("focus",function(){t._.currentFocusIndex=m.focusIndex}))}},hbox:function(t,e,i,n,a){if(!(arguments.length<4)){this._||(this._={});var r,o=this._.children=e,s=a&&a.widths||null,l=a&&a.height||null,c={role:"presentation"};a&&a.align&&(c.align=a.align),CKEDITOR.ui.dialog.uiElement.call(this,t,a||{type:"hbox"},n,"table",{},c,function(){var t=['<tbody><tr class="cke_dialog_ui_hbox">'];for(r=0;r<i.length;r++){var e="cke_dialog_ui_hbox_child",n=[];0===r&&(e="cke_dialog_ui_hbox_first"),r==i.length-1&&(e="cke_dialog_ui_hbox_last"),t.push('<td class="',e,'" role="presentation" '),s?s[r]&&n.push("width:"+f(s[r])):n.push("width:"+Math.floor(100/i.length)+"%"),l&&n.push("height:"+f(l)),a&&void 0!=a.padding&&n.push("padding:"+f(a.padding)),CKEDITOR.env.ie&&CKEDITOR.env.quirks&&o[r].align&&n.push("text-align:"+o[r].align),n.length>0&&t.push('style="'+n.join("; ")+'" '),t.push(">",i[r],"</td>")}return t.push("</tr></tbody>"),t.join("")})}},vbox:function(t,e,i,n,a){if(!(arguments.length<3)){this._||(this._={});var r=this._.children=e,o=a&&a.width||null,s=a&&a.heights||null;CKEDITOR.ui.dialog.uiElement.call(this,t,a||{type:"vbox"},n,"div",null,{role:"presentation"},function(){var e=['<table role="presentation" cellspacing="0" border="0" '];e.push('style="'),a&&a.expand&&e.push("height:100%;"),e.push("width:"+f(o||"100%"),";"),CKEDITOR.env.webkit&&e.push("float:none;"),e.push('"'),e.push('align="',CKEDITOR.tools.htmlEncode(a&&a.align||("ltr"==t.getParentEditor().lang.dir?"left":"right")),'" '),e.push("><tbody>");for(var n=0;n<i.length;n++){var l=[];e.push('<tr><td role="presentation" '),o&&l.push("width:"+f(o||"100%")),s?l.push("height:"+f(s[n])):a&&a.expand&&l.push("height:"+Math.floor(100/i.length)+"%"),a&&void 0!=a.padding&&l.push("padding:"+f(a.padding)),CKEDITOR.env.ie&&CKEDITOR.env.quirks&&r[n].align&&l.push("text-align:"+r[n].align),l.length>0&&e.push('style="',l.join("; "),'" '),e.push(' class="cke_dialog_ui_vbox_child">',i[n],"</td></tr>")}return e.push("</tbody></table>"),e.join("")})}}}}(),CKEDITOR.ui.dialog.uiElement.prototype={getElement:function(){return CKEDITOR.document.getById(this.domId)},getInputElement:function(){return this.getElement()},getDialog:function(){return this._.dialog},setValue:function(t,e){return this.getInputElement().setValue(t),!e&&this.fire("change",{value:t}),this},getValue:function(){return this.getInputElement().getValue()},isChanged:function(){return!1},selectParentTab:function(){for(var t=this.getInputElement();(t=t.getParent())&&-1==t.$.className.search("cke_dialog_page_contents"););return t?(t=t.getAttribute("name"),this._.dialog._.currentTabId!=t&&this._.dialog.selectPage(t),this):this},focus:function(){return this.selectParentTab().getInputElement().focus(),this},registerEvents:function(t){var e,i,n=/^on([A-Z]\w+)/,a=function(t,e,i,n){e.on("load",function(){t.getInputElement().on(i,n,t)})};for(i in t)(e=i.match(n))&&(this.eventProcessors[i]?this.eventProcessors[i].call(this,this._.dialog,t[i]):a(this,this._.dialog,e[1].toLowerCase(),t[i]));return this},eventProcessors:{onLoad:function(t,e){t.on("load",e,this)},onShow:function(t,e){t.on("show",e,this)},onHide:function(t,e){t.on("hide",e,this)}},accessKeyDown:function(){this.focus()},accessKeyUp:function(){},disable:function(){var t=this.getElement();this.getInputElement().setAttribute("disabled","true"),t.addClass("cke_disabled")},enable:function(){var t=this.getElement();this.getInputElement().removeAttribute("disabled"),t.removeClass("cke_disabled")},isEnabled:function(){return!this.getElement().hasClass("cke_disabled")},isVisible:function(){return this.getInputElement().isVisible()},isFocusable:function(){return this.isEnabled()&&this.isVisible()?!0:!1}},CKEDITOR.ui.dialog.hbox.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{getChild:function(t){return arguments.length<1?this._.children.concat():(t.splice||(t=[t]),t.length<2?this._.children[t[0]]:this._.children[t[0]]&&this._.children[t[0]].getChild?this._.children[t[0]].getChild(t.slice(1,t.length)):null)}},!0),CKEDITOR.ui.dialog.vbox.prototype=new CKEDITOR.ui.dialog.hbox,function(){var t={build:function(t,e,i){for(var n,a=e.children,r=[],o=[],s=0;s<a.length&&(n=a[s]);s++){var l=[];r.push(l),o.push(CKEDITOR.dialog._.uiElementBuilders[n.type].build(t,n,l))}return new CKEDITOR.ui.dialog[e.type](t,o,r,i,e)}};CKEDITOR.dialog.addUIElement("hbox",t),CKEDITOR.dialog.addUIElement("vbox",t)}(),CKEDITOR.dialogCommand=function(t,e){this.dialogName=t,CKEDITOR.tools.extend(this,e,!0)},CKEDITOR.dialogCommand.prototype={exec:function(t){CKEDITOR.env.opera?CKEDITOR.tools.setTimeout(function(){t.openDialog(this.dialogName)},0,this):t.openDialog(this.dialogName)},canUndo:!1,editorFocus:1},function(){var t=/^([a]|[^a])+$/,e=/^\d*$/,i=/^\d*(?:\.\d+)?$/,n=/^(((\d*(\.\d+))|(\d*))(px|\%)?)?$/,a=/^(((\d*(\.\d+))|(\d*))(px|em|ex|in|cm|mm|pt|pc|\%)?)?$/i,r=/^(\s*[\w-]+\s*:\s*[^:;]+(?:;|$))*$/;CKEDITOR.VALIDATE_OR=1,CKEDITOR.VALIDATE_AND=2,CKEDITOR.dialog.validate={functions:function(){var t=arguments;return function(){var e,i=this&&this.getValue?this.getValue():t[0],n=void 0,a=CKEDITOR.VALIDATE_AND,r=[];for(e=0;e<t.length&&"function"==typeof t[e];e++)r.push(t[e]);e<t.length&&"string"==typeof t[e]&&(n=t[e],e++),e<t.length&&"number"==typeof t[e]&&(a=t[e]);var o=a==CKEDITOR.VALIDATE_AND?!0:!1;for(e=0;e<r.length;e++)o=a==CKEDITOR.VALIDATE_AND?o&&r[e](i):o||r[e](i);return o?!0:n}},regex:function(t,e){return function(i){return i=this&&this.getValue?this.getValue():i,t.test(i)?!0:e}},notEmpty:function(e){return this.regex(t,e)},integer:function(t){return this.regex(e,t)},number:function(t){return this.regex(i,t)},cssLength:function(t){return this.functions(function(t){return a.test(CKEDITOR.tools.trim(t))},t)},htmlLength:function(t){return this.functions(function(t){return n.test(CKEDITOR.tools.trim(t))},t)},inlineStyle:function(t){return this.functions(function(t){return r.test(CKEDITOR.tools.trim(t))},t)},equals:function(t,e){return this.functions(function(e){return e==t},e)},notEqual:function(t,e){return this.functions(function(e){return e!=t},e)}},CKEDITOR.on("instanceDestroyed",function(t){if(CKEDITOR.tools.isEmpty(CKEDITOR.instances)){for(var e;e=CKEDITOR.dialog._.currentTop;)e.hide();for(var i in T)T[i].remove();
T={}}var n,t=t.editor._.storedDialogs;for(n in t)t[n].destroy()})}(),CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{openDialog:function(t,e){var i=null,n=CKEDITOR.dialog._.dialogDefinitions[t];if(null===CKEDITOR.dialog._.currentTop&&u(this),"function"==typeof n)i=this._.storedDialogs||(this._.storedDialogs={}),i=i[t]||(i[t]=new CKEDITOR.dialog(this,t)),e&&e.call(i,i),i.show();else{if("failed"==n)throw p(this),Error('[CKEDITOR.dialog.openDialog] Dialog "'+t+'" failed when loading definition.');"string"==typeof n&&CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(n),function(){"function"!=typeof CKEDITOR.dialog._.dialogDefinitions[t]&&(CKEDITOR.dialog._.dialogDefinitions[t]="failed"),this.openDialog(t,e)},this,0,1)}return CKEDITOR.skin.loadPart("dialog"),i}})}(),CKEDITOR.plugins.add("dialog",{requires:"dialogui",init:function(t){t.on("doubleclick",function(e){e.data.dialog&&t.openDialog(e.data.dialog)},null,null,999)}}),function(){function t(t){function e(){var e=t.editable();e.on(C,function(t){(!CKEDITOR.env.ie||!m)&&u(t)}),CKEDITOR.env.ie&&e.on("paste",function(e){g||(a(),e.data.preventDefault(),u(e),o("paste")||t.openDialog("paste"))}),CKEDITOR.env.ie&&(e.on("contextmenu",r,null,null,0),e.on("beforepaste",function(t){t.data&&!t.data.$.ctrlKey&&r()},null,null,0)),e.on("beforecut",function(){!m&&l(t)});var i;e.attachListener(CKEDITOR.env.ie?e:t.document.getDocumentElement(),"mouseup",function(){i=setTimeout(function(){p()},0)}),t.on("destroy",function(){clearTimeout(i)}),e.on("keyup",p)}function i(e){return{type:e,canUndo:"cut"==e,startDisabled:!0,exec:function(){"cut"==this.type&&l();var e,i=this.type;if(CKEDITOR.env.ie)e=o(i);else try{e=t.document.$.execCommand(i,!1,null)}catch(n){e=!1}return e||alert(t.lang.clipboard[this.type+"Error"]),e}}}function n(){return{canUndo:!1,async:!0,exec:function(t,e){var i=function(e,i){e&&s(e.type,e.dataValue,!!i),t.fire("afterCommandExec",{name:"paste",command:n,returnValue:!!e})},n=this;"string"==typeof e?i({type:"auto",dataValue:e},1):t.getClipboardData(i)}}}function a(){g=1,setTimeout(function(){g=0},100)}function r(){m=1,setTimeout(function(){m=0},10)}function o(e){var i=t.document,n=i.getBody(),a=!1,r=function(){a=!0};return n.on(e,r),(CKEDITOR.env.version>7?i.$:i.$.selection.createRange()).execCommand(e),n.removeListener(e,r),a}function s(e,i,n){return e={type:e},n&&t.fire("beforePaste",e)===!1||!i?!1:(e.dataValue=i,t.fire("paste",e))}function l(){if(CKEDITOR.env.ie&&!CKEDITOR.env.quirks){var e,i,n,a=t.getSelection();a.getType()==CKEDITOR.SELECTION_ELEMENT&&(e=a.getSelectedElement())&&(i=a.getRanges()[0],n=t.document.createText(""),n.insertBefore(e),i.setStartBefore(n),i.setEndAfter(e),a.selectRanges([i]),setTimeout(function(){e.getParent()&&(n.remove(),a.selectElement(e))},0))}}function c(e,i){var n,a=t.document,r=t.editable(),o=function(t){t.cancel()},s=CKEDITOR.env.gecko&&CKEDITOR.env.version<=10902;if(!a.getById("cke_pastebin")){var l=t.getSelection(),c=l.createBookmarks(),d=new CKEDITOR.dom.element(!CKEDITOR.env.webkit&&!r.is("body")||CKEDITOR.env.ie||CKEDITOR.env.opera?"div":"body",a);d.setAttributes({id:"cke_pastebin","data-cke-temp":"1"}),CKEDITOR.env.opera&&d.appendBogus();var h=0,a=a.getWindow();s?(d.insertAfter(c[0].startNode),d.setStyle("display","inline")):(CKEDITOR.env.webkit?(r.append(d),d.addClass("cke_editable"),r.is("body")||(s="static"!=r.getComputedStyle("position")?r:CKEDITOR.dom.element.get(r.$.offsetParent),h=s.getDocumentPosition().y)):r.getAscendant(CKEDITOR.env.ie||CKEDITOR.env.opera?"body":"html",1).append(d),d.setStyles({position:"absolute",top:a.getScrollPosition().y-h+10+"px",width:"1px",height:Math.max(1,a.getViewPaneSize().height-20)+"px",overflow:"hidden",margin:0,padding:0})),(s=d.getParent().isReadOnly())?(d.setOpacity(0),d.setAttribute("contenteditable",!0)):d.setStyle("ltr"==t.config.contentsLangDirection?"left":"right","-1000px"),t.on("selectionChange",o,null,null,0),(CKEDITOR.env.webkit||CKEDITOR.env.gecko)&&(n=r.once("blur",o,null,null,-100)),s&&d.focus(),s=new CKEDITOR.dom.range(d),s.selectNodeContents(d);var u=s.select();CKEDITOR.env.ie&&(n=r.once("blur",function(){t.lockSelection(u)}));var p=CKEDITOR.document.getWindow().getScrollPosition().y;setTimeout(function(){(CKEDITOR.env.webkit||CKEDITOR.env.opera)&&(CKEDITOR.document[CKEDITOR.env.webkit?"getBody":"getDocumentElement"]().$.scrollTop=p),n&&n.removeListener(),CKEDITOR.env.ie&&r.focus(),l.selectBookmarks(c),d.remove();var e;CKEDITOR.env.webkit&&(e=d.getFirst())&&e.is&&e.hasClass("Apple-style-span")&&(d=e),t.removeListener("selectionChange",o),i(d.getHtml())},0)}}function d(){if(CKEDITOR.env.ie){t.focus(),a();var e=t.focusManager;if(e.lock(),t.editable().fire(C)&&!o("paste"))return e.unlock(),!1;e.unlock()}else try{if(t.editable().fire(C)&&!t.document.$.execCommand("Paste",!1,null))throw 0}catch(i){return!1}return!0}function h(e){if("wysiwyg"==t.mode)switch(e.data.keyCode){case CKEDITOR.CTRL+86:case CKEDITOR.SHIFT+45:e=t.editable(),a(),!CKEDITOR.env.ie&&e.fire("beforepaste"),(CKEDITOR.env.opera||CKEDITOR.env.gecko&&CKEDITOR.env.version<10900)&&e.fire("paste");break;case CKEDITOR.CTRL+88:case CKEDITOR.SHIFT+46:t.fire("saveSnapshot"),setTimeout(function(){t.fire("saveSnapshot")},50)}}function u(e){var i={type:"auto"},n=t.fire("beforePaste",i);c(e,function(t){t=t.replace(/<span[^>]+data-cke-bookmark[^<]*?<\/span>/gi,""),n&&s(i.type,t,0,1)})}function p(){if("wysiwyg"==t.mode){var e=f("paste");t.getCommand("cut").setState(f("cut")),t.getCommand("copy").setState(f("copy")),t.getCommand("paste").setState(e),t.fire("pasteState",e)}}function f(e){if(v&&e in{paste:1,cut:1})return CKEDITOR.TRISTATE_DISABLED;if("paste"==e)return CKEDITOR.TRISTATE_OFF;var e=t.getSelection(),i=e.getRanges();return e.getType()==CKEDITOR.SELECTION_NONE||1==i.length&&i[0].collapsed?CKEDITOR.TRISTATE_DISABLED:CKEDITOR.TRISTATE_OFF}var m=0,g=0,v=0,C=CKEDITOR.env.ie?"beforepaste":"paste";!function(){t.on("key",h),t.on("contentDom",e),t.on("selectionChange",function(t){v=t.data.selection.getRanges()[0].checkReadOnly(),p()}),t.contextMenu&&t.contextMenu.addListener(function(t,e){return v=e.getRanges()[0].checkReadOnly(),{cut:f("cut"),copy:f("copy"),paste:f("paste")}})}(),function(){function e(e,i,n,a,r){var o=t.lang.clipboard[i];t.addCommand(i,n),t.ui.addButton&&t.ui.addButton(e,{label:o,command:i,toolbar:"clipboard,"+a}),t.addMenuItems&&t.addMenuItem(i,{label:o,command:i,group:"clipboard",order:r})}e("Cut","cut",i("cut"),10,1),e("Copy","copy",i("copy"),20,4),e("Paste","paste",n(),30,8)}(),t.getClipboardData=function(e,i){function n(t){t.removeListener(),t.cancel(),i(t.data)}function a(t){t.removeListener(),t.cancel(),l=!0,i({type:s,dataValue:t.data})}function r(){this.customTitle=e&&e.title}var o=!1,s="auto",l=!1;i||(i=e,e=null),t.on("paste",n,null,null,0),t.on("beforePaste",function(t){t.removeListener(),o=!0,s=t.data.type},null,null,1e3),d()===!1&&(t.removeListener("paste",n),o&&t.fire("pasteDialog",r)?(t.on("pasteDialogCommit",a),t.on("dialogHide",function(t){t.removeListener(),t.data.removeListener("pasteDialogCommit",a),setTimeout(function(){l||i(null)},10)})):i(null))}}function e(t){if(CKEDITOR.env.webkit){if(!t.match(/^[^<]*$/g)&&!t.match(/^(<div><br( ?\/)?><\/div>|<div>[^<]*<\/div>)*$/gi))return"html"}else if(CKEDITOR.env.ie){if(!t.match(/^([^<]|<br( ?\/)?>)*$/gi)&&!t.match(/^(<p>([^<]|<br( ?\/)?>)*<\/p>|(\r\n))*$/gi))return"html"}else{if(!CKEDITOR.env.gecko&&!CKEDITOR.env.opera)return"html";if(!t.match(/^([^<]|<br( ?\/)?>)*$/gi))return"html"}return"htmlifiedtext"}function i(t,e){function i(t){return CKEDITOR.tools.repeat("</p><p>",~~(t/2))+(t%2==1?"<br>":"")}return e=e.replace(/\s+/g," ").replace(/> +</g,"><").replace(/<br ?\/>/gi,"<br>"),e=e.replace(/<\/?[A-Z]+>/g,function(t){return t.toLowerCase()}),e.match(/^[^<]$/)?e:(CKEDITOR.env.webkit&&e.indexOf("<div>")>-1&&(e=e.replace(/^(<div>(<br>|)<\/div>)(?!$|(<div>(<br>|)<\/div>))/g,"<br>").replace(/^(<div>(<br>|)<\/div>){2}(?!$)/g,"<div></div>"),e.match(/<div>(<br>|)<\/div>/)&&(e="<p>"+e.replace(/(<div>(<br>|)<\/div>)+/g,function(t){return i(t.split("</div><div>").length+1)})+"</p>"),e=e.replace(/<\/div><div>/g,"<br>"),e=e.replace(/<\/?div>/g,"")),(CKEDITOR.env.gecko||CKEDITOR.env.opera)&&t.enterMode!=CKEDITOR.ENTER_BR&&(CKEDITOR.env.gecko&&(e=e.replace(/^<br><br>$/,"<br>")),e.indexOf("<br><br>")>-1&&(e="<p>"+e.replace(/(<br>){2,}/g,function(t){return i(t.length/4)})+"</p>")),r(t,e))}function n(){var t=new CKEDITOR.htmlParser.filter,e={blockquote:1,dl:1,fieldset:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,ol:1,p:1,table:1,ul:1},i=CKEDITOR.tools.extend({br:0},CKEDITOR.dtd.$inline),n={p:1,br:1,"cke:br":1},a=CKEDITOR.dtd,r=CKEDITOR.tools.extend({area:1,basefont:1,embed:1,iframe:1,map:1,object:1,param:1},CKEDITOR.dtd.$nonBodyContent,CKEDITOR.dtd.$cdata),o=function(t){delete t.name,t.add(new CKEDITOR.htmlParser.text(" "))},s=function(t){for(var e,i=t;(i=i.next)&&i.name&&i.name.match(/^h\d$/);)for(e=new CKEDITOR.htmlParser.element("cke:br"),e.isEmpty=!0,t.add(e);e=i.children.shift();)t.add(e)};return t.addRules({elements:{h1:s,h2:s,h3:s,h4:s,h5:s,h6:s,img:function(t){var t=CKEDITOR.tools.trim(t.attributes.alt||""),e=" ";return t&&!t.match(/(^http|\.(jpe?g|gif|png))/i)&&(e=" ["+t+"] "),new CKEDITOR.htmlParser.text(e)},td:o,th:o,$:function(t){var o,s=t.name;if(r[s])return!1;if(t.attributes={},"br"==s)return t;if(e[s])t.name="p";else if(i[s])delete t.name;else if(a[s]){if(o=new CKEDITOR.htmlParser.element("cke:br"),o.isEmpty=!0,CKEDITOR.dtd.$empty[s])return o;t.add(o,0),o=o.clone(),o.isEmpty=!0,t.add(o),delete t.name}return n[t.name]||delete t.name,t}}},{applyToAll:!0}),t}function a(t,e,i){var e=new CKEDITOR.htmlParser.fragment.fromHtml(e),n=new CKEDITOR.htmlParser.basicWriter;e.writeHtml(n,i);var e=n.getHtml(),e=e.replace(/\s*(<\/?[a-z:]+ ?\/?>)\s*/g,"$1").replace(/(<cke:br \/>){2,}/g,"<cke:br />").replace(/(<cke:br \/>)(<\/?p>|<br \/>)/g,"$2").replace(/(<\/?p>|<br \/>)(<cke:br \/>)/g,"$1").replace(/<(cke:)?br( \/)?>/g,"<br>").replace(/<p><\/p>/g,""),a=0,e=e.replace(/<\/?p>/g,function(t){if("<p>"==t){if(++a>1)return"</p><p>"}else if(--a>0)return"</p><p>";return t}).replace(/<p><\/p>/g,"");return r(t,e)}function r(t,e){return t.enterMode==CKEDITOR.ENTER_BR?e=e.replace(/(<\/p><p>)+/g,function(t){return CKEDITOR.tools.repeat("<br>",t.length/7*2)}).replace(/<\/?p>/g,""):t.enterMode==CKEDITOR.ENTER_DIV&&(e=e.replace(/<(\/)?p>/g,"<$1div>")),e}CKEDITOR.plugins.add("clipboard",{requires:"dialog",init:function(r){var o;t(r),CKEDITOR.dialog.add("paste",CKEDITOR.getUrl(this.path+"dialogs/paste.js")),r.on("paste",function(t){var e=t.data.dataValue,i=CKEDITOR.dtd.$block;if(e.indexOf("Apple-")>-1&&(e=e.replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi," "),"html"!=t.data.type&&(e=e.replace(/<span class="Apple-tab-span"[^>]*>([^<]*)<\/span>/gi,function(t,e){return e.replace(/\t/g,"&nbsp;&nbsp; &nbsp;")})),e.indexOf('<br class="Apple-interchange-newline">')>-1&&(t.data.startsWithEOL=1,t.data.preSniffing="html",e=e.replace(/<br class="Apple-interchange-newline">/,"")),e=e.replace(/(<[^>]+) class="Apple-[^"]*"/gi,"$1")),e.match(/^<[^<]+cke_(editable|contents)/i)){var n,a,r=new CKEDITOR.dom.element("div");for(r.setHtml(e);1==r.getChildCount()&&(n=r.getFirst())&&n.type==CKEDITOR.NODE_ELEMENT&&(n.hasClass("cke_editable")||n.hasClass("cke_contents"));)r=a=n;a&&(e=a.getHtml().replace(/<br>$/i,""))}CKEDITOR.env.ie?e=e.replace(/^&nbsp;(?: |\r\n)?<(\w+)/g,function(e,n){return n.toLowerCase()in i?(t.data.preSniffing="html","<"+n):e}):CKEDITOR.env.webkit?e=e.replace(/<\/(\w+)><div><br><\/div>$/,function(e,n){return n in i?(t.data.endsWithEOL=1,"</"+n+">"):e}):CKEDITOR.env.gecko&&(e=e.replace(/(\s)<br>$/,"$1")),t.data.dataValue=e},null,null,3),r.on("paste",function(t){var s,t=t.data,l=t.type,c=t.dataValue,d=r.config.clipboard_defaultContentType||"html";s="html"==l||"html"==t.preSniffing?"html":e(c),"htmlifiedtext"==s?c=i(r.config,c):"text"==l&&"html"==s&&(c=a(r.config,c,o||(o=n(r)))),t.startsWithEOL&&(c='<br data-cke-eol="1">'+c),t.endsWithEOL&&(c+='<br data-cke-eol="1">'),"auto"==l&&(l="html"==s||"html"==d?"html":"text"),t.type=l,t.dataValue=c,delete t.preSniffing,delete t.startsWithEOL,delete t.endsWithEOL},null,null,6),r.on("paste",function(t){t=t.data,r.insertHtml(t.dataValue,t.type),setTimeout(function(){r.fire("afterPaste")},0)},null,null,1e3),r.on("pasteDialog",function(t){setTimeout(function(){r.openDialog("paste",t.data)},0)})}})}(),function(){CKEDITOR.plugins.add("panel",{beforeInit:function(t){t.ui.addHandler(CKEDITOR.UI_PANEL,CKEDITOR.ui.panel.handler)}}),CKEDITOR.UI_PANEL="panel",CKEDITOR.ui.panel=function(t,e){e&&CKEDITOR.tools.extend(this,e),CKEDITOR.tools.extend(this,{className:"",css:[]}),this.id=CKEDITOR.tools.getNextId(),this.document=t,this.isFramed=this.forceIFrame||this.css.length,this._={blocks:{}}},CKEDITOR.ui.panel.handler={create:function(t){return new CKEDITOR.ui.panel(t)}};var t=CKEDITOR.addTemplate("panel",'<div lang="{langCode}" id="{id}" dir={dir} class="cke cke_reset_all {editorId} cke_panel cke_panel {cls} cke_{dir}" style="z-index:{z-index}" role="presentation">{frame}</div>'),e=CKEDITOR.addTemplate("panel-frame",'<iframe id="{id}" class="cke_panel_frame" role="presentation" frameborder="0" src="{src}"></iframe>'),i=CKEDITOR.addTemplate("panel-frame-inner",'<!DOCTYPE html><html class="cke_panel_container {env}" dir="{dir}" lang="{langCode}"><head>{css}</head><body class="cke_{dir}" style="margin:0;padding:0" onload="{onload}"></body></html>');CKEDITOR.ui.panel.prototype={render:function(n,a){this.getHolderElement=function(){var t=this._.holder;if(!t){if(this.isFramed){var t=this.document.getById(this.id+"_frame"),e=t.getParent(),t=t.getFrameDocument();CKEDITOR.env.iOS&&e.setStyles({overflow:"scroll","-webkit-overflow-scrolling":"touch"}),e=CKEDITOR.tools.addFunction(CKEDITOR.tools.bind(function(){this.isLoaded=!0,this.onLoad&&this.onLoad()},this)),t.write(i.output(CKEDITOR.tools.extend({css:CKEDITOR.tools.buildStyleHtml(this.css),onload:"window.parent.CKEDITOR.tools.callFunction("+e+");"},r))),t.getWindow().$.CKEDITOR=CKEDITOR,t.on("key"+(CKEDITOR.env.opera?"press":"down"),function(t){var e=t.data.getKeystroke(),i=this.document.getById(this.id).getAttribute("dir");this._.onKeyDown&&this._.onKeyDown(e)===!1?t.data.preventDefault():(27==e||e==("rtl"==i?39:37))&&this.onEscape&&this.onEscape(e)===!1&&t.data.preventDefault()},this),t=t.getBody(),t.unselectable(),CKEDITOR.env.air&&CKEDITOR.tools.callFunction(e)}else t=this.document.getById(this.id);this._.holder=t}return t};var r={editorId:n.id,id:this.id,langCode:n.langCode,dir:n.lang.dir,cls:this.className,frame:"",env:CKEDITOR.env.cssClass,"z-index":n.config.baseFloatZIndex+1};if(this.isFramed){var o=CKEDITOR.env.air?"javascript:void(0)":CKEDITOR.env.ie?"javascript:void(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"}())":"";r.frame=e.output({id:this.id+"_frame",src:o})}return o=t.output(r),a&&a.push(o),o},addBlock:function(t,e){return e=this._.blocks[t]=e instanceof CKEDITOR.ui.panel.block?e:new CKEDITOR.ui.panel.block(this.getHolderElement(),e),this._.currentBlock||this.showBlock(t),e},getBlock:function(t){return this._.blocks[t]},showBlock:function(t){var t=this._.blocks[t],e=this._.currentBlock,i=!this.forceIFrame||CKEDITOR.env.ie?this._.holder:this.document.getById(this.id+"_frame");return e&&e.hide(),this._.currentBlock=t,CKEDITOR.fire("ariaWidget",i),t._.focusIndex=-1,this._.onKeyDown=t.onKeyDown&&CKEDITOR.tools.bind(t.onKeyDown,t),t.show(),t},destroy:function(){this.element&&this.element.remove()}},CKEDITOR.ui.panel.block=CKEDITOR.tools.createClass({$:function(t,e){this.element=t.append(t.getDocument().createElement("div",{attributes:{tabindex:-1,"class":"cke_panel_block"},styles:{display:"none"}})),e&&CKEDITOR.tools.extend(this,e),this.element.setAttributes({role:this.attributes.role||"presentation","aria-label":this.attributes["aria-label"],title:this.attributes.title||this.attributes["aria-label"]}),this.keys={},this._.focusIndex=-1,this.element.disableContextMenu()},_:{markItem:function(t){-1!=t&&(t=this.element.getElementsByTag("a").getItem(this._.focusIndex=t),(CKEDITOR.env.webkit||CKEDITOR.env.opera)&&t.getDocument().getWindow().focus(),t.focus(),this.onMark&&this.onMark(t))}},proto:{show:function(){this.element.setStyle("display","")},hide:function(){(!this.onHide||this.onHide.call(this)!==!0)&&this.element.setStyle("display","none")},onKeyDown:function(t,e){var i=this.keys[t];switch(i){case"next":for(var n,a=this._.focusIndex,i=this.element.getElementsByTag("a");n=i.getItem(++a);)if(n.getAttribute("_cke_focus")&&n.$.offsetWidth){this._.focusIndex=a,n.focus();break}return n||e?!1:(this._.focusIndex=-1,this.onKeyDown(t,1));case"prev":for(a=this._.focusIndex,i=this.element.getElementsByTag("a");a>0&&(n=i.getItem(--a));){if(n.getAttribute("_cke_focus")&&n.$.offsetWidth){this._.focusIndex=a,n.focus();break}n=null}return n||e?!1:(this._.focusIndex=i.count(),this.onKeyDown(t,1));case"click":case"mouseup":return a=this._.focusIndex,(n=a>=0&&this.element.getElementsByTag("a").getItem(a))&&(n.$[i]?n.$[i]():n.$["on"+i]()),!1}return!0}}})}(),CKEDITOR.plugins.add("floatpanel",{requires:"panel"}),function(){function t(t,i,n,a,r){var r=CKEDITOR.tools.genKey(i.getUniqueId(),n.getUniqueId(),t.lang.dir,t.uiColor||"",a.css||"",r||""),o=e[r];return o||(o=e[r]=new CKEDITOR.ui.panel(i,a),o.element=n.append(CKEDITOR.dom.element.createFromHtml(o.render(t),i)),o.element.setStyles({display:"none",position:"absolute"})),o}var e={};CKEDITOR.ui.floatPanel=CKEDITOR.tools.createClass({$:function(e,i,n,a){function r(){c.hide()}n.forceIFrame=1,n.toolbarRelated&&e.elementMode==CKEDITOR.ELEMENT_MODE_INLINE&&(i=CKEDITOR.document.getById("cke_"+e.name));var o=i.getDocument(),a=t(e,o,i,n,a||0),s=a.element,l=s.getFirst(),c=this;s.disableContextMenu(),this.element=s,this._={editor:e,panel:a,parentElement:i,definition:n,document:o,iframe:l,children:[],dir:e.lang.dir},e.on("mode",r),e.on("resize",r),o.getWindow().on("resize",r)},proto:{addBlock:function(t,e){return this._.panel.addBlock(t,e)},addListBlock:function(t,e){return this._.panel.addListBlock(t,e)},getBlock:function(t){return this._.panel.getBlock(t)},showBlock:function(t,e,i,n,a,r){var o=this._.panel,s=o.showBlock(t);this.allowBlur(!1),t=this._.editor.editable(),this._.returnFocus=t.hasFocus?t:new CKEDITOR.dom.element(CKEDITOR.document.$.activeElement);var l=this.element,t=this._.iframe,t=CKEDITOR.env.ie?t:new CKEDITOR.dom.window(t.$.contentWindow),c=l.getDocument(),d=this._.parentElement.getPositionedAncestor(),h=e.getDocumentPosition(c),c=d?d.getDocumentPosition(c):{x:0,y:0},u="rtl"==this._.dir,p=h.x+(n||0)-c.x,f=h.y+(a||0)-c.y;!u||1!=i&&4!=i?u||2!=i&&3!=i||(p+=e.$.offsetWidth-1):p+=e.$.offsetWidth,(3==i||4==i)&&(f+=e.$.offsetHeight-1),this._.panel._.offsetParentId=e.getId(),l.setStyles({top:f+"px",left:0,display:""}),l.setOpacity(0),l.getFirst().removeStyle("width"),this._.editor.focusManager.add(t),this._.blurSet||(CKEDITOR.event.useCapture=!0,t.on("blur",function(t){this.allowBlur()&&t.data.getPhase()==CKEDITOR.EVENT_PHASE_AT_TARGET&&this.visible&&!this._.activeChild&&(delete this._.returnFocus,this.hide())},this),t.on("focus",function(){this._.focused=!0,this.hideChild(),this.allowBlur(!0)},this),CKEDITOR.event.useCapture=!1,this._.blurSet=1),o.onEscape=CKEDITOR.tools.bind(function(t){return this.onEscape&&this.onEscape(t)===!1?!1:void 0},this),CKEDITOR.tools.setTimeout(function(){var t=CKEDITOR.tools.bind(function(){if(l.removeStyle("width"),s.autoSize){var t=s.element.getDocument(),t=(CKEDITOR.env.webkit?s.element:t.getBody()).$.scrollWidth;CKEDITOR.env.ie&&CKEDITOR.env.quirks&&t>0&&(t+=(l.$.offsetWidth||0)-(l.$.clientWidth||0)+3),l.setStyle("width",t+10+"px"),t=s.element.$.scrollHeight,CKEDITOR.env.ie&&CKEDITOR.env.quirks&&t>0&&(t+=(l.$.offsetHeight||0)-(l.$.clientHeight||0)+3),l.setStyle("height",t+"px"),o._.currentBlock.element.setStyle("display","none").removeStyle("display")}else l.removeStyle("height");u&&(p-=l.$.offsetWidth),l.setStyle("left",p+"px");var e=o.element.getWindow(),t=l.$.getBoundingClientRect(),e=e.getViewPaneSize(),i=t.width||t.right-t.left,n=t.height||t.bottom-t.top,a=u?t.right:e.width-t.left,c=u?e.width-t.right:t.left;u?i>a&&(p=c>i?p+i:e.width>i?p-t.left:p-t.right+e.width):i>a&&(p=c>i?p-i:e.width>i?p-t.right+e.width:p-t.left),i=t.top,e.height-t.top<n&&(f=i>n?f-n:e.height>n?f-t.bottom+e.height:f-t.top),CKEDITOR.env.ie&&(e=t=new CKEDITOR.dom.element(l.$.offsetParent),"html"==e.getName()&&(e=e.getDocument().getBody()),"rtl"==e.getComputedStyle("direction")&&(p=CKEDITOR.env.ie8Compat?p-2*l.getDocument().getDocumentElement().$.scrollLeft:p-(t.$.scrollWidth-t.$.clientWidth)));var d,t=l.getFirst();(d=t.getCustomData("activePanel"))&&d.onHide&&d.onHide.call(this,1),t.setCustomData("activePanel",this),l.setStyles({top:f+"px",left:p+"px"}),l.setOpacity(1),r&&r()},this);o.isLoaded?t():o.onLoad=t,CKEDITOR.tools.setTimeout(function(){var t=CKEDITOR.env.webkit&&CKEDITOR.document.getWindow().getScrollPosition().y;this.focus(),s.element.focus(),CKEDITOR.env.webkit&&(CKEDITOR.document.getBody().$.scrollTop=t),this.allowBlur(!0),this._.editor.fire("panelShow",this)},0,this)},CKEDITOR.env.air?200:0,this),this.visible=1,this.onShow&&this.onShow.call(this)},focus:function(){if(CKEDITOR.env.webkit){var t=CKEDITOR.document.getActive();!t.equals(this._.iframe)&&t.$.blur()}(this._.lastFocused||this._.iframe.getFrameDocument().getWindow()).focus()},blur:function(){var t=this._.iframe.getFrameDocument().getActive();t.is("a")&&(this._.lastFocused=t)},hide:function(t){!this.visible||this.onHide&&this.onHide.call(this)===!0||(this.hideChild(),CKEDITOR.env.gecko&&this._.iframe.getFrameDocument().$.activeElement.blur(),this.element.setStyle("display","none"),this.visible=0,this.element.getFirst().removeCustomData("activePanel"),(t=t&&this._.returnFocus)&&(CKEDITOR.env.webkit&&t.type&&t.getWindow().$.focus(),t.focus()),delete this._.lastFocused,this._.editor.fire("panelHide",this))},allowBlur:function(t){var e=this._.panel;return void 0!=t&&(e.allowBlur=t),e.allowBlur},showAsChild:function(t,e,i,n,a,r){(this._.activeChild!=t||t._.panel._.offsetParentId!=i.getId())&&(this.hideChild(),t.onHide=CKEDITOR.tools.bind(function(){CKEDITOR.tools.setTimeout(function(){this._.focused||this.hide()},0,this)},this),this._.activeChild=t,this._.focused=!1,t.showBlock(e,i,n,a,r),this.blur(),(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)&&setTimeout(function(){t.element.getChild(0).$.style.cssText+=""},100))},hideChild:function(t){var e=this._.activeChild;e&&(delete e.onHide,delete this._.activeChild,e.hide(),t&&this.focus())}}}),CKEDITOR.on("instanceDestroyed",function(){var t,i=CKEDITOR.tools.isEmpty(CKEDITOR.instances);for(t in e){var n=e[t];i?n.destroy():n.element.hide()}i&&(e={})})}(),CKEDITOR.plugins.add("menu",{requires:"floatpanel",beforeInit:function(t){for(var e=t.config.menu_groups.split(","),i=t._.menuGroups={},n=t._.menuItems={},a=0;a<e.length;a++)i[e[a]]=a+1;t.addMenuGroup=function(t,e){i[t]=e||100},t.addMenuItem=function(t,e){i[e.group]&&(n[t]=new CKEDITOR.menuItem(this,t,e))},t.addMenuItems=function(t){for(var e in t)this.addMenuItem(e,t[e])},t.getMenuItem=function(t){return n[t]},t.removeMenuItem=function(t){delete n[t]}}}),function(){function t(t){t.sort(function(t,e){return t.group<e.group?-1:t.group>e.group?1:t.order<e.order?-1:t.order>e.order?1:0})}var e='<span class="cke_menuitem"><a id="{id}" class="cke_menubutton cke_menubutton__{name} cke_menubutton_{state} {cls}" href="{href}" title="{title}" tabindex="-1"_cke_focus=1 hidefocus="true" role="{role}" aria-haspopup="{hasPopup}" aria-disabled="{disabled}" {ariaChecked}';(CKEDITOR.env.opera||CKEDITOR.env.gecko&&CKEDITOR.env.mac)&&(e+=' onkeypress="return false;"'),CKEDITOR.env.gecko&&(e+=' onblur="this.style.cssText = this.style.cssText;"');var e=e+(' onmouseover="CKEDITOR.tools.callFunction({hoverFn},{index});" onmouseout="CKEDITOR.tools.callFunction({moveOutFn},{index});" '+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction({clickFn},{index}); return false;">'),i=CKEDITOR.addTemplate("menuItem",e+'<span class="cke_menubutton_inner"><span class="cke_menubutton_icon"><span class="cke_button_icon cke_button__{iconName}_icon" style="{iconStyle}"></span></span><span class="cke_menubutton_label">{label}</span>{arrowHtml}</span></a></span>'),n=CKEDITOR.addTemplate("menuArrow",'<span class="cke_menuarrow"><span>{label}</span></span>');CKEDITOR.menu=CKEDITOR.tools.createClass({$:function(t,e){e=this._.definition=e||{},this.id=CKEDITOR.tools.getNextId(),this.editor=t,this.items=[],this._.listeners=[],this._.level=e.level||1;var i=CKEDITOR.tools.extend({},e.panel,{css:[CKEDITOR.skin.getPath("editor")],level:this._.level-1,block:{}}),n=i.block.attributes=i.attributes||{};!n.role&&(n.role="menu"),this._.panelDefinition=i},_:{onShow:function(){var t=this.editor.getSelection(),e=t&&t.getStartElement(),i=this.editor.elementPath(),n=this._.listeners;this.removeAll();for(var a=0;a<n.length;a++){var r=n[a](e,t,i);if(r)for(var o in r){var s=this.editor.getMenuItem(o);!s||s.command&&!this.editor.getCommand(s.command).state||(s.state=r[o],this.add(s))}}},onClick:function(t){this.hide(),t.onClick?t.onClick():t.command&&this.editor.execCommand(t.command)},onEscape:function(t){var e=this.parent;return e?e._.panel.hideChild(1):27==t&&this.hide(1),!1},onHide:function(){this.onHide&&this.onHide()},showSubMenu:function(t){var e=this._.subMenu,i=this.items[t];if(i=i.getItems&&i.getItems()){e?e.removeAll():(e=this._.subMenu=new CKEDITOR.menu(this.editor,CKEDITOR.tools.extend({},this._.definition,{level:this._.level+1},!0)),e.parent=this,e._.onClick=CKEDITOR.tools.bind(this._.onClick,this));for(var n in i){var a=this.editor.getMenuItem(n);a&&(a.state=i[n],e.add(a))}var r=this._.panel.getBlock(this.id).element.getDocument().getById(this.id+(""+t));setTimeout(function(){e.show(r,2)},0)}else this._.panel.hideChild(1)}},proto:{add:function(t){t.order||(t.order=this.items.length),this.items.push(t)},removeAll:function(){this.items=[]},show:function(e,i,n,a){if(this.parent||(this._.onShow(),this.items.length)){var i=i||("rtl"==this.editor.lang.dir?2:1),r=this.items,o=this.editor,s=this._.panel,l=this._.element;if(!s){s=this._.panel=new CKEDITOR.ui.floatPanel(this.editor,CKEDITOR.document.getBody(),this._.panelDefinition,this._.level),s.onEscape=CKEDITOR.tools.bind(function(t){return this._.onEscape(t)===!1?!1:void 0},this),s.onShow=function(){s._.panel.getHolderElement().getParent().addClass("cke cke_reset_all")},s.onHide=CKEDITOR.tools.bind(function(){this._.onHide&&this._.onHide()},this),l=s.addBlock(this.id,this._.panelDefinition.block),l.autoSize=!0;var c=l.keys;c[40]="next",c[9]="next",c[38]="prev",c[CKEDITOR.SHIFT+9]="prev",c["rtl"==o.lang.dir?37:39]=CKEDITOR.env.ie?"mouseup":"click",c[32]=CKEDITOR.env.ie?"mouseup":"click",CKEDITOR.env.ie&&(c[13]="mouseup"),l=this._.element=l.element,c=l.getDocument(),c.getBody().setStyle("overflow","hidden"),c.getElementsByTag("html").getItem(0).setStyle("overflow","hidden"),this._.itemOverFn=CKEDITOR.tools.addFunction(function(t){clearTimeout(this._.showSubTimeout),this._.showSubTimeout=CKEDITOR.tools.setTimeout(this._.showSubMenu,o.config.menu_subMenuDelay||400,this,[t])},this),this._.itemOutFn=CKEDITOR.tools.addFunction(function(){clearTimeout(this._.showSubTimeout)},this),this._.itemClickFn=CKEDITOR.tools.addFunction(function(t){var e=this.items[t];e.state==CKEDITOR.TRISTATE_DISABLED?this.hide(1):e.getItems?this._.showSubMenu(t):this._.onClick(e)},this)}t(r);for(var c=o.elementPath(),c=['<div class="cke_menu'+(c&&c.direction()!=o.lang.dir?" cke_mixed_dir_content":"")+'" role="presentation">'],d=r.length,h=d&&r[0].group,u=0;d>u;u++){var p=r[u];h!=p.group&&(c.push('<div class="cke_menuseparator" role="separator"></div>'),h=p.group),p.render(this,u,c)}c.push("</div>"),l.setHtml(c.join("")),CKEDITOR.ui.fire("ready",this),this.parent?this.parent._.panel.showAsChild(s,this.id,e,i,n,a):s.showBlock(this.id,e,i,n,a),o.fire("menuShow",[s])}},addListener:function(t){this._.listeners.push(t)},hide:function(t){this._.onHide&&this._.onHide(),this._.panel&&this._.panel.hide(t)}}}),CKEDITOR.menuItem=CKEDITOR.tools.createClass({$:function(t,e,i){CKEDITOR.tools.extend(this,i,{order:0,className:"cke_menubutton__"+e}),this.group=t._.menuGroups[this.group],this.editor=t,this.name=e},proto:{render:function(t,e,a){var r=t.id+(""+e),o="undefined"==typeof this.state?CKEDITOR.TRISTATE_OFF:this.state,s="",l=o==CKEDITOR.TRISTATE_ON?"on":o==CKEDITOR.TRISTATE_DISABLED?"disabled":"off";this.role in{menuitemcheckbox:1,menuitemradio:1}&&(s=' aria-checked="'+(o==CKEDITOR.TRISTATE_ON?"true":"false")+'"');var c=this.getItems,d="&#"+("rtl"==this.editor.lang.dir?"9668":"9658")+";",h=this.name;this.icon&&!/\./.test(this.icon)&&(h=this.icon),t={id:r,name:this.name,iconName:h,label:this.label,cls:this.className||"",state:l,hasPopup:c?"true":"false",disabled:o==CKEDITOR.TRISTATE_DISABLED,title:this.label,href:"javascript:void('"+(this.label||"").replace("'")+"')",hoverFn:t._.itemOverFn,moveOutFn:t._.itemOutFn,clickFn:t._.itemClickFn,index:e,iconStyle:CKEDITOR.skin.getIconStyle(h,"rtl"==this.editor.lang.dir,h==this.icon?null:this.icon,this.iconOffset),arrowHtml:c?n.output({label:d}):"",role:this.role?this.role:"menuitem",ariaChecked:s},i.output(t,a)}}})}(),CKEDITOR.config.menu_groups="clipboard,form,tablecell,tablecellproperties,tablerow,tablecolumn,table,anchor,link,image,flash,checkbox,radio,textfield,hiddenfield,imagebutton,button,select,textarea,div",CKEDITOR.plugins.add("contextmenu",{requires:"menu",onLoad:function(){CKEDITOR.plugins.contextMenu=CKEDITOR.tools.createClass({base:CKEDITOR.menu,$:function(t){this.base.call(this,t,{panel:{className:"cke_menu_panel",attributes:{"aria-label":t.lang.contextmenu.options}}})},proto:{addTarget:function(t,e){if(t.on("contextmenu",function(t){var t=t.data,n=CKEDITOR.env.webkit?i:CKEDITOR.env.mac?t.$.metaKey:t.$.ctrlKey;if(!e||!n){t.preventDefault();var a=t.getTarget().getDocument(),r=t.getTarget().getDocument().getDocumentElement(),n=!a.equals(CKEDITOR.document),a=a.getWindow().getScrollPosition(),o=n?t.$.clientX:t.$.pageX||a.x+t.$.clientX,s=n?t.$.clientY:t.$.pageY||a.y+t.$.clientY;CKEDITOR.tools.setTimeout(function(){this.open(r,null,o,s)},CKEDITOR.env.ie?200:0,this)}},this),CKEDITOR.env.webkit){var i,n=function(){i=0};t.on("keydown",function(t){i=CKEDITOR.env.mac?t.data.$.metaKey:t.data.$.ctrlKey}),t.on("keyup",n),t.on("contextmenu",n)}},open:function(t,e,i,n){this.editor.focus(),t=t||CKEDITOR.document.getDocumentElement(),this.editor.selectionChange(1),this.show(t,e,i,n)}}})},beforeInit:function(t){var e=t.contextMenu=new CKEDITOR.plugins.contextMenu(t);t.on("contentDom",function(){e.addTarget(t.editable(),t.config.browserContextMenuOnCtrl!==!1)}),t.addCommand("contextMenu",{exec:function(){t.contextMenu.open(t.document.getBody())}}),t.setKeystroke(CKEDITOR.SHIFT+121,"contextMenu"),t.setKeystroke(CKEDITOR.CTRL+CKEDITOR.SHIFT+121,"contextMenu")}}),CKEDITOR.plugins.add("resize",{init:function(t){var e,i,n,a,r=t.config,o=t.ui.spaceId("resizer"),s=t.element?t.element.getDirection(1):"ltr";if(!r.resize_dir&&(r.resize_dir="vertical"),void 0==r.resize_maxWidth&&(r.resize_maxWidth=3e3),void 0==r.resize_maxHeight&&(r.resize_maxHeight=3e3),void 0==r.resize_minWidth&&(r.resize_minWidth=750),void 0==r.resize_minHeight&&(r.resize_minHeight=250),r.resize_enabled!==!1){var l=null,c=("both"==r.resize_dir||"horizontal"==r.resize_dir)&&r.resize_minWidth!=r.resize_maxWidth,d=("both"==r.resize_dir||"vertical"==r.resize_dir)&&r.resize_minHeight!=r.resize_maxHeight,h=function(o){var l=e,h=i,u=l+(o.data.$.screenX-n)*("rtl"==s?-1:1),o=h+(o.data.$.screenY-a);c&&(l=Math.max(r.resize_minWidth,Math.min(u,r.resize_maxWidth))),d&&(h=Math.max(r.resize_minHeight,Math.min(o,r.resize_maxHeight))),t.resize(c?l:null,h)},u=function(){CKEDITOR.document.removeListener("mousemove",h),CKEDITOR.document.removeListener("mouseup",u),t.document&&(t.document.removeListener("mousemove",h),t.document.removeListener("mouseup",u))
},p=CKEDITOR.tools.addFunction(function(o){l||(l=t.getResizable()),e=l.$.offsetWidth||0,i=l.$.offsetHeight||0,n=o.screenX,a=o.screenY,r.resize_minWidth>e&&(r.resize_minWidth=e),r.resize_minHeight>i&&(r.resize_minHeight=i),CKEDITOR.document.on("mousemove",h),CKEDITOR.document.on("mouseup",u),t.document&&(t.document.on("mousemove",h),t.document.on("mouseup",u)),o.preventDefault&&o.preventDefault()});t.on("destroy",function(){CKEDITOR.tools.removeFunction(p)}),t.on("uiSpace",function(e){if("bottom"==e.data.space){var i="";c&&!d&&(i=" cke_resizer_horizontal"),!c&&d&&(i=" cke_resizer_vertical");var n='<span id="'+o+'" class="cke_resizer'+i+" cke_resizer_"+s+'" title="'+CKEDITOR.tools.htmlEncode(t.lang.common.resize)+'" onmousedown="CKEDITOR.tools.callFunction('+p+', event)">'+("ltr"==s?"◢":"◣")+"</span>";e.data.html="ltr"==s&&"ltr"==i?e.data.html+n:n+e.data.html}},t,null,100),t.on("maximize",function(e){t.ui.space("resizer")[e.data==CKEDITOR.TRISTATE_ON?"hide":"show"]()})}}}),function(){var t='<a id="{id}" class="cke_button cke_button__{name} cke_button_{state} {cls}"'+(CKEDITOR.env.gecko&&CKEDITOR.env.version>=10900&&!CKEDITOR.env.hc?"":" href=\"javascript:void('{titleJs}')\"")+' title="{title}" tabindex="-1" hidefocus="true" role="button" aria-labelledby="{id}_label" aria-haspopup="{hasArrow}" aria-disabled="{ariaDisabled}"';(CKEDITOR.env.opera||CKEDITOR.env.gecko&&CKEDITOR.env.mac)&&(t+=' onkeypress="return false;"'),CKEDITOR.env.gecko&&(t+=' onblur="this.style.cssText = this.style.cssText;"');var t=t+(' onkeydown="return CKEDITOR.tools.callFunction({keydownFn},event);" onfocus="return CKEDITOR.tools.callFunction({focusFn},event);"  onmousedown="return CKEDITOR.tools.callFunction({mousedownFn},event);" '+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction({clickFn},this);return false;"><span class="cke_button_icon cke_button__{iconName}_icon" style="{style}"'),t=t+'>&nbsp;</span><span id="{id}_label" class="cke_button_label cke_button__{name}_label" aria-hidden="false">{label}</span>{arrowHtml}</a>',e=CKEDITOR.addTemplate("buttonArrow",'<span class="cke_button_arrow">'+(CKEDITOR.env.hc?"&#9660;":"")+"</span>"),i=CKEDITOR.addTemplate("button",t);CKEDITOR.plugins.add("button",{beforeInit:function(t){t.ui.addHandler(CKEDITOR.UI_BUTTON,CKEDITOR.ui.button.handler)}}),CKEDITOR.UI_BUTTON="button",CKEDITOR.ui.button=function(t){CKEDITOR.tools.extend(this,t,{title:t.label,click:t.click||function(e){e.execCommand(t.command)}}),this._={}},CKEDITOR.ui.button.handler={create:function(t){return new CKEDITOR.ui.button(t)}},CKEDITOR.ui.button.prototype={render:function(t,n){var a,r=CKEDITOR.env,o=this._.id=CKEDITOR.tools.getNextId(),s="",l=this.command;this._.editor=t;var c={id:o,button:this,editor:t,focus:function(){CKEDITOR.document.getById(o).focus()},execute:function(){this.button.click(t)},attach:function(t){this.button.attach(t)}},d=CKEDITOR.tools.addFunction(function(t){return c.onkey?(t=new CKEDITOR.dom.event(t),c.onkey(c,t.getKeystroke())!==!1):void 0}),h=CKEDITOR.tools.addFunction(function(t){var e;return c.onfocus&&(e=c.onfocus(c,new CKEDITOR.dom.event(t))!==!1),CKEDITOR.env.gecko&&CKEDITOR.env.version<10900&&t.preventBubble(),e}),u=0,p=CKEDITOR.tools.addFunction(function(){if(CKEDITOR.env.opera){var e=t.editable();e.isInline()&&e.hasFocus&&(t.lockSelection(),u=1)}});if(c.clickFn=a=CKEDITOR.tools.addFunction(function(){u&&(t.unlockSelection(1),u=0),c.execute()}),this.modes){var f={},m=function(){var e=t.mode;e&&(e=this.modes[e]?void 0!=f[e]?f[e]:CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,e=t.readOnly&&!this.readOnly?CKEDITOR.TRISTATE_DISABLED:e,this.setState(e),this.refresh&&this.refresh())};t.on("beforeModeUnload",function(){t.mode&&this._.state!=CKEDITOR.TRISTATE_DISABLED&&(f[t.mode]=this._.state)},this),t.on("activeFilterChange",m,this),t.on("mode",m,this),!this.readOnly&&t.on("readOnly",m,this)}else l&&(l=t.getCommand(l))&&(l.on("state",function(){this.setState(l.state)},this),s+=l.state==CKEDITOR.TRISTATE_ON?"on":l.state==CKEDITOR.TRISTATE_DISABLED?"disabled":"off");this.directional&&t.on("contentDirChanged",function(e){var i=CKEDITOR.document.getById(this._.id),n=i.getFirst(),e=e.data;e!=t.lang.dir?i.addClass("cke_"+e):i.removeClass("cke_ltr").removeClass("cke_rtl"),n.setAttribute("style",CKEDITOR.skin.getIconStyle(g,"rtl"==e,this.icon,this.iconOffset))},this),l||(s+="off");var g=m=this.name||this.command;return this.icon&&!/\./.test(this.icon)&&(g=this.icon,this.icon=null),r={id:o,name:m,iconName:g,label:this.label,cls:this.className||"",state:s,ariaDisabled:"disabled"==s?"true":"false",title:this.title,titleJs:r.gecko&&r.version>=10900&&!r.hc?"":(this.title||"").replace("'",""),hasArrow:this.hasArrow?"true":"false",keydownFn:d,mousedownFn:p,focusFn:h,clickFn:a,style:CKEDITOR.skin.getIconStyle(g,"rtl"==t.lang.dir,this.icon,this.iconOffset),arrowHtml:this.hasArrow?e.output():""},i.output(r,n),this.onRender&&this.onRender(),c},setState:function(t){if(this._.state==t)return!1;this._.state=t;var e=CKEDITOR.document.getById(this._.id);return e?(e.setState(t,"cke_button"),t==CKEDITOR.TRISTATE_DISABLED?e.setAttribute("aria-disabled",!0):e.removeAttribute("aria-disabled"),this.hasArrow?(t=t==CKEDITOR.TRISTATE_ON?this._.editor.lang.button.selectedLabel.replace(/%1/g,this.label):this.label,CKEDITOR.document.getById(this._.id+"_label").setText(t)):t==CKEDITOR.TRISTATE_ON?e.setAttribute("aria-pressed",!0):e.removeAttribute("aria-pressed"),!0):!1},getState:function(){return this._.state},toFeature:function(t){if(this._.feature)return this._.feature;var e=this;return!this.allowedContent&&!this.requiredContent&&this.command&&(e=t.getCommand(this.command)||e),this._.feature=e}},CKEDITOR.ui.prototype.addButton=function(t,e){this.add(t,CKEDITOR.UI_BUTTON,e)}}(),function(){function t(t){function i(){for(var i=n(),r=CKEDITOR.tools.clone(t.config.toolbarGroups)||e(t),o=0;o<r.length;o++){var s=r[o];if("/"!=s){"string"==typeof s&&(s=r[o]={name:s});var l,c=s.groups;if(c)for(var d=0;d<c.length;d++)l=c[d],(l=i[l])&&a(s,l);(l=i[s.name])&&a(s,l)}}return r}function n(){var e,i,n,a={};for(e in t.ui.items)i=t.ui.items[e],n=i.toolbar||"others",n=n.split(","),i=n[0],n=parseInt(n[1]||-1,10),a[i]||(a[i]=[]),a[i].push({name:e,order:n});for(i in a)a[i]=a[i].sort(function(t,e){return t.order==e.order?0:e.order<0?-1:t.order<0?1:t.order<e.order?-1:1});return a}function a(e,i){if(i.length){e.items?e.items.push(t.ui.create("-")):e.items=[];for(var n;n=i.shift();)n="string"==typeof n?n:n.name,o&&-1!=CKEDITOR.tools.indexOf(o,n)||(n=t.ui.create(n))&&t.addFeature(n)&&e.items.push(n)}}function r(t){var e,i,n,r=[];for(e=0;e<t.length;++e)i=t[e],n={},"/"==i?r.push(i):CKEDITOR.tools.isArray(i)?(a(n,CKEDITOR.tools.clone(i)),r.push(n)):i.items&&(a(n,CKEDITOR.tools.clone(i.items)),n.name=i.name,r.push(n));return r}var o=t.config.removeButtons,o=o&&o.split(","),s=t.config.toolbar;return"string"==typeof s&&(s=t.config["toolbar_"+s]),t.toolbar=s?r(s):i()}function e(t){return t._.toolbarGroups||(t._.toolbarGroups=[{name:"document",groups:["mode","document","doctools"]},{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker"]},{name:"forms"},"/",{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi"]},{name:"links"},{name:"insert"},"/",{name:"styles"},{name:"colors"},{name:"tools"},{name:"others"},{name:"about"}])}var i=function(){this.toolbars=[],this.focusCommandExecuted=!1};i.prototype.focus=function(){for(var t,e=0;t=this.toolbars[e++];)for(var i,n=0;i=t.items[n++];)if(i.focus)return void i.focus()};var n={modes:{wysiwyg:1,source:1},readOnly:1,exec:function(t){t.toolbox&&(t.toolbox.focusCommandExecuted=!0,CKEDITOR.env.ie||CKEDITOR.env.air?setTimeout(function(){t.toolbox.focus()},100):t.toolbox.focus())}};CKEDITOR.plugins.add("toolbar",{requires:"button",init:function(e){var a,r=function(t,i){var n,o="rtl"==e.lang.dir,s=e.config.toolbarGroupCycling,l=o?37:39,o=o?39:37,s=void 0===s||s;switch(i){case 9:case CKEDITOR.SHIFT+9:for(;!n||!n.items.length;)if(n=9==i?(n?n.next:t.toolbar.next)||e.toolbox.toolbars[0]:(n?n.previous:t.toolbar.previous)||e.toolbox.toolbars[e.toolbox.toolbars.length-1],n.items.length)for(t=n.items[a?n.items.length-1:0];t&&!t.focus;)(t=a?t.previous:t.next)||(n=0);return t&&t.focus(),!1;case l:n=t;do n=n.next,!n&&s&&(n=t.toolbar.items[0]);while(n&&!n.focus);return n?n.focus():r(t,9),!1;case 40:return t.button&&t.button.hasArrow?(e.once("panelShow",function(t){t.data._.panel._.currentBlock.onKeyDown(40)}),t.execute()):r(t,40==i?l:o),!1;case o:case 38:n=t;do n=n.previous,!n&&s&&(n=t.toolbar.items[t.toolbar.items.length-1]);while(n&&!n.focus);return n?n.focus():(a=1,r(t,CKEDITOR.SHIFT+9),a=0),!1;case 27:return e.focus(),!1;case 13:case 32:return t.execute(),!1}return!0};e.on("uiSpace",function(n){if(n.data.space==e.config.toolbarLocation){n.removeListener(),e.toolbox=new i;var a,o,s=CKEDITOR.tools.getNextId(),l=['<span id="',s,'" class="cke_voice_label">',e.lang.toolbar.toolbars,"</span>",'<span id="'+e.ui.spaceId("toolbox")+'" class="cke_toolbox" role="group" aria-labelledby="',s,'" onmousedown="return false;">'],s=e.config.toolbarStartupExpanded!==!1;e.config.toolbarCanCollapse&&e.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE&&l.push('<span class="cke_toolbox_main"'+(s?">":' style="display:none">'));for(var c=e.toolbox.toolbars,d=t(e),h=0;h<d.length;h++){var u,p,f,m=0,g=d[h];if(g)if(a&&(l.push("</span>"),o=a=0),"/"===g)l.push('<span class="cke_toolbar_break"></span>');else{f=g.items||g;for(var v=0;v<f.length;v++){var C,I=f[v];if(I)if(I.type==CKEDITOR.UI_SEPARATOR)o=a&&I;else{if(C=I.canGroup!==!1,!m){u=CKEDITOR.tools.getNextId(),m={id:u,items:[]},p=g.name&&(e.lang.toolbar.toolbarGroups[g.name]||g.name),l.push('<span id="',u,'" class="cke_toolbar"',p?' aria-labelledby="'+u+'_label"':"",' role="toolbar">'),p&&l.push('<span id="',u,'_label" class="cke_voice_label">',p,"</span>"),l.push('<span class="cke_toolbar_start"></span>');var b=c.push(m)-1;b>0&&(m.previous=c[b-1],m.previous.next=m)}C?a||(l.push('<span class="cke_toolgroup" role="presentation">'),a=1):a&&(l.push("</span>"),a=0),u=function(t){t=t.render(e,l),b=m.items.push(t)-1,b>0&&(t.previous=m.items[b-1],t.previous.next=t),t.toolbar=m,t.onkey=r,t.onfocus=function(){e.toolbox.focusCommandExecuted||e.focus()}},o&&(u(o),o=0),u(I)}}a&&(l.push("</span>"),o=a=0),m&&l.push('<span class="cke_toolbar_end"></span></span>')}}if(e.config.toolbarCanCollapse&&l.push("</span>"),e.config.toolbarCanCollapse&&e.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE){var E=CKEDITOR.tools.addFunction(function(){e.execCommand("toolbarCollapse")});e.on("destroy",function(){CKEDITOR.tools.removeFunction(E)}),e.addCommand("toolbarCollapse",{readOnly:1,exec:function(t){var e=t.ui.space("toolbar_collapser"),i=e.getPrevious(),n=t.ui.space("contents"),a=i.getParent(),r=parseInt(n.$.style.height,10),o=a.$.offsetHeight,s=e.hasClass("cke_toolbox_collapser_min");s?(i.show(),e.removeClass("cke_toolbox_collapser_min"),e.setAttribute("title",t.lang.toolbar.toolbarCollapse)):(i.hide(),e.addClass("cke_toolbox_collapser_min"),e.setAttribute("title",t.lang.toolbar.toolbarExpand)),e.getFirst().setText(s?"▲":"◀"),n.setStyle("height",r-(a.$.offsetHeight-o)+"px"),t.fire("resize")},modes:{wysiwyg:1,source:1}}),e.setKeystroke(CKEDITOR.ALT+(CKEDITOR.env.ie||CKEDITOR.env.webkit?189:109),"toolbarCollapse"),l.push('<a title="'+(s?e.lang.toolbar.toolbarCollapse:e.lang.toolbar.toolbarExpand)+'" id="'+e.ui.spaceId("toolbar_collapser")+'" tabIndex="-1" class="cke_toolbox_collapser'),s||l.push(" cke_toolbox_collapser_min"),l.push('" onclick="CKEDITOR.tools.callFunction('+E+')">','<span class="cke_arrow">&#9650;</span>',"</a>")}l.push("</span>"),n.data.html=n.data.html+l.join("")}}),e.on("destroy",function(){if(this.toolbox){var t,e,i,n,a=0;for(t=this.toolbox.toolbars;a<t.length;a++)for(i=t[a].items,e=0;e<i.length;e++)n=i[e],n.clickFn&&CKEDITOR.tools.removeFunction(n.clickFn),n.keyDownFn&&CKEDITOR.tools.removeFunction(n.keyDownFn)}}),e.on("uiReady",function(){var t=e.ui.space("toolbox");t&&e.focusManager.add(t,1)}),e.addCommand("toolbarFocus",n),e.setKeystroke(CKEDITOR.ALT+121,"toolbarFocus"),e.ui.add("-",CKEDITOR.UI_SEPARATOR,{}),e.ui.addHandler(CKEDITOR.UI_SEPARATOR,{create:function(){return{render:function(t,e){return e.push('<span class="cke_toolbar_separator" role="separator"></span>'),{}}}}})}}),CKEDITOR.ui.prototype.addToolbarGroup=function(t,i,n){var a=e(this.editor),r=0===i,o={name:t};if(n){if(n=CKEDITOR.tools.search(a,function(t){return t.name==n}))return!n.groups&&(n.groups=[]),i&&(i=CKEDITOR.tools.indexOf(n.groups,i),i>=0)?void n.groups.splice(i+1,0,t):void(r?n.groups.splice(0,0,t):n.groups.push(t));i=null}i&&(i=CKEDITOR.tools.indexOf(a,function(t){return t.name==i})),r?a.splice(0,0,t):"number"==typeof i?a.splice(i+1,0,o):a.push(t)}}(),CKEDITOR.UI_SEPARATOR="separator",CKEDITOR.config.toolbarLocation="top",function(){function t(t,e,i){i=t.config.forceEnterMode||i,"wysiwyg"==t.mode&&(e||(e=t.activeEnterMode),t.elementPath().isContextFor("p")||(e=CKEDITOR.ENTER_BR,i=1),t.fire("saveSnapshot"),e==CKEDITOR.ENTER_BR?r(t,e,null,i):o(t,e,null,i),t.fire("saveSnapshot"))}function e(t){for(var t=t.getSelection().getRanges(!0),e=t.length-1;e>0;e--)t[e].deleteContents();return t[0]}CKEDITOR.plugins.add("enterkey",{init:function(e){e.addCommand("enter",{modes:{wysiwyg:1},editorFocus:!1,exec:function(e){t(e)}}),e.addCommand("shiftEnter",{modes:{wysiwyg:1},editorFocus:!1,exec:function(e){t(e,e.activeShiftEnterMode,1)}}),e.setKeystroke([[13,"enter"],[CKEDITOR.SHIFT+13,"shiftEnter"]])}});var i=CKEDITOR.dom.walker.whitespaces(),n=CKEDITOR.dom.walker.bookmark();CKEDITOR.plugins.enterkey={enterBlock:function(t,a,o,l){if(o=o||e(t)){var c,d=o.document,h=o.checkStartOfBlock(),u=o.checkEndOfBlock(),p=t.elementPath(o.startContainer).block,f=a==CKEDITOR.ENTER_DIV?"div":"p";if(h&&u){if(p&&(p.is("li")||p.getParent().is("li"))){o=p.getParent(),c=o.getParent();var l=!p.hasPrevious(),m=!p.hasNext(),f=t.getSelection(),g=f.createBookmarks(),h=p.getDirection(1),u=p.getAttribute("class"),v=p.getAttribute("style"),C=c.getDirection(1)!=h,t=t.enterMode!=CKEDITOR.ENTER_BR||C||v||u;if(c.is("li"))l||m?p[l?"insertBefore":"insertAfter"](c):p.breakParent(c);else{if(t)c=d.createElement(a==CKEDITOR.ENTER_P?"p":"div"),C&&c.setAttribute("dir",h),v&&c.setAttribute("style",v),u&&c.setAttribute("class",u),p.moveChildren(c),l||m?c[l?"insertBefore":"insertAfter"](o):(p.breakParent(o),c.insertAfter(o));else if(p.appendBogus(!0),l||m)for(;d=p[l?"getFirst":"getLast"]();)d[l?"insertBefore":"insertAfter"](o);else for(p.breakParent(o);d=p.getLast();)d.insertAfter(o);p.remove()}return void f.selectBookmarks(g)}if(p&&p.getParent().is("blockquote"))return p.breakParent(p.getParent()),p.getPrevious().getFirst(CKEDITOR.dom.walker.invisible(1))||p.getPrevious().remove(),p.getNext().getFirst(CKEDITOR.dom.walker.invisible(1))||p.getNext().remove(),o.moveToElementEditStart(p),void o.select()}else if(p&&p.is("pre")&&!u)return void r(t,a,o,l);if(u=o.splitBlock(f)){if(a=u.previousBlock,p=u.nextBlock,t=u.wasStartOfBlock,h=u.wasEndOfBlock,p?(g=p.getParent(),g.is("li")&&(p.breakParent(g),p.move(p.getNext(),1))):a&&(g=a.getParent())&&g.is("li")&&(a.breakParent(g),g=a.getNext(),o.moveToElementEditStart(g),a.move(a.getPrevious())),t||h){if(a?(a.is("li")||!s.test(a.getName())&&!a.is("pre"))&&(c=a.clone()):p&&(c=p.clone()),c?l&&!c.is("li")&&c.renameNode(f):g&&g.is("li")?c=g:(c=d.createElement(f),a&&(m=a.getDirection())&&c.setAttribute("dir",m)),d=u.elementPath)for(l=0,f=d.elements.length;f>l&&(g=d.elements[l],!g.equals(d.block)&&!g.equals(d.blockLimit));l++)CKEDITOR.dtd.$removeEmpty[g.getName()]&&(g=g.clone(),c.moveChildren(g),c.append(g));c.appendBogus(),c.getParent()||o.insertNode(c),c.is("li")&&c.removeAttribute("value"),!CKEDITOR.env.ie||!t||h&&a.getChildCount()||(o.moveToElementEditStart(h?a:c),o.select()),o.moveToElementEditStart(t&&!h?p:c)}else p.is("li")&&(c=o.clone(),c.selectNodeContents(p),c=new CKEDITOR.dom.walker(c),c.evaluator=function(t){return!(n(t)||i(t)||t.type==CKEDITOR.NODE_ELEMENT&&t.getName()in CKEDITOR.dtd.$inline&&!(t.getName()in CKEDITOR.dtd.$empty))},(g=c.next())&&g.type==CKEDITOR.NODE_ELEMENT&&g.is("ul","ol")&&(CKEDITOR.env.needsBrFiller?d.createElement("br"):d.createText(" ")).insertBefore(g)),p&&o.moveToElementEditStart(p);o.select(),o.scrollIntoView()}}},enterBr:function(t,i,n,a){if(n=n||e(t)){var r=n.document,l=n.checkEndOfBlock(),c=new CKEDITOR.dom.elementPath(t.getSelection().getStartElement()),d=c.block,c=d&&c.block.getName();a||"li"!=c?(!a&&l&&s.test(c)?(l=d.getDirection())?(r=r.createElement("div"),r.setAttribute("dir",l),r.insertAfter(d),n.setStart(r,0)):(r.createElement("br").insertAfter(d),CKEDITOR.env.gecko&&r.createText("").insertAfter(d),n.setStartAt(d.getNext(),CKEDITOR.env.ie?CKEDITOR.POSITION_BEFORE_START:CKEDITOR.POSITION_AFTER_START)):(d="pre"==c&&CKEDITOR.env.ie&&CKEDITOR.env.version<8?r.createText("\r"):r.createElement("br"),n.deleteContents(),n.insertNode(d),CKEDITOR.env.needsBrFiller?(r.createText("").insertAfter(d),l&&d.getParent().appendBogus(),d.getNext().$.nodeValue="",n.setStartAt(d.getNext(),CKEDITOR.POSITION_AFTER_START)):n.setStartAt(d,CKEDITOR.POSITION_AFTER_END)),n.collapse(!0),n.select(),n.scrollIntoView()):o(t,i,n,a)}}};var a=CKEDITOR.plugins.enterkey,r=a.enterBr,o=a.enterBlock,s=/^h[1-6]$/}(),function(){function t(t,e){var i={},n=[],a={nbsp:" ",shy:"­",gt:">",lt:"<",amp:"&",apos:"'",quot:'"'},t=t.replace(/\b(nbsp|shy|gt|lt|amp|apos|quot)(?:,|$)/g,function(t,r){var o=e?"&"+r+";":a[r];return i[o]=e?a[r]:"&"+r+";",n.push(o),""});if(!e&&t){var r,t=t.split(","),o=document.createElement("div");for(o.innerHTML="&"+t.join(";&")+";",r=o.innerHTML,o=null,o=0;o<r.length;o++){var s=r.charAt(o);i[s]="&"+t[o]+";",n.push(s)}}return i.regex=n.join(e?"|":""),i}CKEDITOR.plugins.add("entities",{afterInit:function(e){var i=e.config;if(e=(e=e.dataProcessor)&&e.htmlFilter){var n=[];i.basicEntities!==!1&&n.push("nbsp,gt,lt,amp"),i.entities&&(n.length&&n.push("quot,iexcl,cent,pound,curren,yen,brvbar,sect,uml,copy,ordf,laquo,not,shy,reg,macr,deg,plusmn,sup2,sup3,acute,micro,para,middot,cedil,sup1,ordm,raquo,frac14,frac12,frac34,iquest,times,divide,fnof,bull,hellip,prime,Prime,oline,frasl,weierp,image,real,trade,alefsym,larr,uarr,rarr,darr,harr,crarr,lArr,uArr,rArr,dArr,hArr,forall,part,exist,empty,nabla,isin,notin,ni,prod,sum,minus,lowast,radic,prop,infin,ang,and,or,cap,cup,int,there4,sim,cong,asymp,ne,equiv,le,ge,sub,sup,nsub,sube,supe,oplus,otimes,perp,sdot,lceil,rceil,lfloor,rfloor,lang,rang,loz,spades,clubs,hearts,diams,circ,tilde,ensp,emsp,thinsp,zwnj,zwj,lrm,rlm,ndash,mdash,lsquo,rsquo,sbquo,ldquo,rdquo,bdquo,dagger,Dagger,permil,lsaquo,rsaquo,euro"),i.entities_latin&&n.push("Agrave,Aacute,Acirc,Atilde,Auml,Aring,AElig,Ccedil,Egrave,Eacute,Ecirc,Euml,Igrave,Iacute,Icirc,Iuml,ETH,Ntilde,Ograve,Oacute,Ocirc,Otilde,Ouml,Oslash,Ugrave,Uacute,Ucirc,Uuml,Yacute,THORN,szlig,agrave,aacute,acirc,atilde,auml,aring,aelig,ccedil,egrave,eacute,ecirc,euml,igrave,iacute,icirc,iuml,eth,ntilde,ograve,oacute,ocirc,otilde,ouml,oslash,ugrave,uacute,ucirc,uuml,yacute,thorn,yuml,OElig,oelig,Scaron,scaron,Yuml"),i.entities_greek&&n.push("Alpha,Beta,Gamma,Delta,Epsilon,Zeta,Eta,Theta,Iota,Kappa,Lambda,Mu,Nu,Xi,Omicron,Pi,Rho,Sigma,Tau,Upsilon,Phi,Chi,Psi,Omega,alpha,beta,gamma,delta,epsilon,zeta,eta,theta,iota,kappa,lambda,mu,nu,xi,omicron,pi,rho,sigmaf,sigma,tau,upsilon,phi,chi,psi,omega,thetasym,upsih,piv"),i.entities_additional&&n.push(i.entities_additional));var a=t(n.join(",")),r=a.regex?"["+a.regex+"]":"a^";delete a.regex,i.entities&&i.entities_processNumerical&&(r="[^ -~]|"+r);var r=RegExp(r,"g"),o=function(t){return"force"!=i.entities_processNumerical&&a[t]?a[t]:"&#"+t.charCodeAt(0)+";"},s=t("nbsp,gt,lt,amp,shy",!0),l=RegExp(s.regex,"g"),c=function(t){return s[t]};e.addRules({text:function(t){return t.replace(l,c).replace(r,o)}},{applyToAll:!0,excludeNestedEditable:!0})}}})}(),CKEDITOR.config.basicEntities=!0,CKEDITOR.config.entities=!0,CKEDITOR.config.entities_latin=!0,CKEDITOR.config.entities_greek=!0,CKEDITOR.config.entities_additional="#39",CKEDITOR.plugins.add("listblock",{requires:"panel",onLoad:function(){var t=CKEDITOR.addTemplate("panel-list",'<ul role="presentation" class="cke_panel_list">{items}</ul>'),e=CKEDITOR.addTemplate("panel-list-item",'<li id="{id}" class="cke_panel_listItem" role=presentation><a id="{id}_option" _cke_focus=1 hidefocus=true title="{title}" href="javascript:void(\'{val}\')"  {onclick}="CKEDITOR.tools.callFunction({clickFn},\'{val}\'); return false;" role="option">{text}</a></li>'),i=CKEDITOR.addTemplate("panel-list-group",'<h1 id="{id}" class="cke_panel_grouptitle" role="presentation" >{label}</h1>'),n=/\'/g;CKEDITOR.ui.panel.prototype.addListBlock=function(t,e){return this.addBlock(t,new CKEDITOR.ui.listBlock(this.getHolderElement(),e))},CKEDITOR.ui.listBlock=CKEDITOR.tools.createClass({base:CKEDITOR.ui.panel.block,$:function(t,e){var e=e||{},i=e.attributes||(e.attributes={});(this.multiSelect=!!e.multiSelect)&&(i["aria-multiselectable"]=!0),!i.role&&(i.role="listbox"),this.base.apply(this,arguments),this.element.setAttribute("role",i.role),i=this.keys,i[40]="next",i[9]="next",i[38]="prev",i[CKEDITOR.SHIFT+9]="prev",i[32]=CKEDITOR.env.ie?"mouseup":"click",CKEDITOR.env.ie&&(i[13]="mouseup"),this._.pendingHtml=[],this._.pendingList=[],this._.items={},this._.groups={}},_:{close:function(){if(this._.started){var e=t.output({items:this._.pendingList.join("")});this._.pendingList=[],this._.pendingHtml.push(e),delete this._.started}},getClick:function(){return this._.click||(this._.click=CKEDITOR.tools.addFunction(function(t){var e=this.toggle(t);this.onClick&&this.onClick(t,e)},this)),this._.click}},proto:{add:function(t,i,a){var r=CKEDITOR.tools.getNextId();this._.started||(this._.started=1,this._.size=this._.size||0),this._.items[t]=r;var o;o=CKEDITOR.tools.htmlEncodeAttr(t).replace(n,"\\'"),t={id:r,val:o,onclick:CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick",clickFn:this._.getClick(),title:CKEDITOR.tools.htmlEncodeAttr(a||t),text:i||t},this._.pendingList.push(e.output(t))},startGroup:function(t){this._.close();var e=CKEDITOR.tools.getNextId();this._.groups[t]=e,this._.pendingHtml.push(i.output({id:e,label:t}))},commit:function(){this._.close(),this.element.appendHtml(this._.pendingHtml.join("")),delete this._.size,this._.pendingHtml=[]},toggle:function(t){var e=this.isMarked(t);return e?this.unmark(t):this.mark(t),!e},hideGroup:function(t){var e=(t=this.element.getDocument().getById(this._.groups[t]))&&t.getNext();t&&(t.setStyle("display","none"),e&&"ul"==e.getName()&&e.setStyle("display","none"))},hideItem:function(t){this.element.getDocument().getById(this._.items[t]).setStyle("display","none")},showAll:function(){var t,e=this._.items,i=this._.groups,n=this.element.getDocument();for(t in e)n.getById(e[t]).setStyle("display","");for(var a in i)e=n.getById(i[a]),t=e.getNext(),e.setStyle("display",""),t&&"ul"==t.getName()&&t.setStyle("display","")},mark:function(t){this.multiSelect||this.unmarkAll();var t=this._.items[t],e=this.element.getDocument().getById(t);e.addClass("cke_selected"),this.element.getDocument().getById(t+"_option").setAttribute("aria-selected",!0),this.onMark&&this.onMark(e)},unmark:function(t){var e=this.element.getDocument(),t=this._.items[t],i=e.getById(t);i.removeClass("cke_selected"),e.getById(t+"_option").removeAttribute("aria-selected"),this.onUnmark&&this.onUnmark(i)},unmarkAll:function(){var t,e=this._.items,i=this.element.getDocument();for(t in e){var n=e[t];i.getById(n).removeClass("cke_selected"),i.getById(n+"_option").removeAttribute("aria-selected")}this.onUnmark&&this.onUnmark()},isMarked:function(t){return this.element.getDocument().getById(this._.items[t]).hasClass("cke_selected")},focus:function(t){this._.focusIndex=-1;var e,i=this.element.getElementsByTag("a"),n=-1;if(t){for(e=this.element.getDocument().getById(this._.items[t]).getFirst();t=i.getItem(++n);)if(t.equals(e)){this._.focusIndex=n;break}}else this.element.focus();e&&setTimeout(function(){e.focus()},0)}}})}}),CKEDITOR.plugins.add("richcombo",{requires:"floatpanel,listblock,button",beforeInit:function(t){t.ui.addHandler(CKEDITOR.UI_RICHCOMBO,CKEDITOR.ui.richCombo.handler)}}),function(){var t='<span id="{id}" class="cke_combo cke_combo__{name} {cls}" role="presentation"><span id="{id}_label" class="cke_combo_label">{label}</span><a class="cke_combo_button" hidefocus=true title="{title}" tabindex="-1"'+(CKEDITOR.env.gecko&&CKEDITOR.env.version>=10900&&!CKEDITOR.env.hc?"":'" href="javascript:void(\'{titleJs}\')"')+' hidefocus="true" role="button" aria-labelledby="{id}_label" aria-haspopup="true"';(CKEDITOR.env.opera||CKEDITOR.env.gecko&&CKEDITOR.env.mac)&&(t+=' onkeypress="return false;"'),CKEDITOR.env.gecko&&(t+=' onblur="this.style.cssText = this.style.cssText;"');var t=t+(' onkeydown="return CKEDITOR.tools.callFunction({keydownFn},event,this);" onmousedown="return CKEDITOR.tools.callFunction({mousedownFn},event);"  onfocus="return CKEDITOR.tools.callFunction({focusFn},event);" '+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction({clickFn},this);return false;"><span id="{id}_text" class="cke_combo_text cke_combo_inlinelabel">{label}</span><span class="cke_combo_open"><span class="cke_combo_arrow">'+(CKEDITOR.env.hc?"&#9660;":CKEDITOR.env.air?"&nbsp;":"")+"</span></span></a></span>"),e=CKEDITOR.addTemplate("combo",t);CKEDITOR.UI_RICHCOMBO="richcombo",CKEDITOR.ui.richCombo=CKEDITOR.tools.createClass({$:function(t){CKEDITOR.tools.extend(this,t,{canGroup:!1,title:t.label,modes:{wysiwyg:1},editorFocus:1}),t=this.panel||{},delete this.panel,this.id=CKEDITOR.tools.getNextNumber(),this.document=t.parent&&t.parent.getDocument()||CKEDITOR.document,t.className="cke_combopanel",t.block={multiSelect:t.multiSelect,attributes:t.attributes},t.toolbarRelated=!0,this._={panelDefinition:t,items:{}}},proto:{renderHtml:function(t){var e=[];return this.render(t,e),e.join("")},render:function(t,i){function n(){var e=this.modes[t.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED;t.readOnly&&!this.readOnly&&(e=CKEDITOR.TRISTATE_DISABLED),this.setState(e),this.setValue(""),e!=CKEDITOR.TRISTATE_DISABLED&&this.refresh&&this.refresh()}var a=CKEDITOR.env,r="cke_"+this.id,o=CKEDITOR.tools.addFunction(function(e){h&&(t.unlockSelection(1),h=0),l.execute(e)},this),s=this,l={id:r,combo:this,focus:function(){CKEDITOR.document.getById(r).getChild(1).focus()},execute:function(e){var i=s._;if(i.state!=CKEDITOR.TRISTATE_DISABLED)if(s.createPanel(t),i.on)i.panel.hide();else{s.commit();var n=s.getValue();n?i.list.mark(n):i.list.unmarkAll(),i.panel.showBlock(s.id,new CKEDITOR.dom.element(e),4)}},clickFn:o};t.on("activeFilterChange",n,this),t.on("mode",n,this),t.on("selectionChange",n,this),!this.readOnly&&t.on("readOnly",n,this);var c=CKEDITOR.tools.addFunction(function(e,i){var e=new CKEDITOR.dom.event(e),n=e.getKeystroke();switch(40==n&&t.once("panelShow",function(t){t.data._.panel._.currentBlock.onKeyDown(40)}),n){case 13:case 32:case 40:CKEDITOR.tools.callFunction(o,i);break;default:l.onkey(l,n)}e.preventDefault()}),d=CKEDITOR.tools.addFunction(function(){l.onfocus&&l.onfocus()}),h=0,u=CKEDITOR.tools.addFunction(function(){if(CKEDITOR.env.opera){var e=t.editable();e.isInline()&&e.hasFocus&&(t.lockSelection(),h=1)}});return l.keyDownFn=c,a={id:r,name:this.name||this.command,label:this.label,title:this.title,cls:this.className||"",titleJs:a.gecko&&a.version>=10900&&!a.hc?"":(this.title||"").replace("'",""),keydownFn:c,mousedownFn:u,focusFn:d,clickFn:o},e.output(a,i),this.onRender&&this.onRender(),l},createPanel:function(t){if(!this._.panel){var e=this._.panelDefinition,i=this._.panelDefinition.block,n=e.parent||CKEDITOR.document.getBody(),a="cke_combopanel__"+this.name,r=new CKEDITOR.ui.floatPanel(t,n,e),o=r.addListBlock(this.id,i),s=this;r.onShow=function(){this.element.addClass(a),s.setState(CKEDITOR.TRISTATE_ON),s._.on=1,s.editorFocus&&!t.focusManager.hasFocus&&t.focus(),s.onOpen&&s.onOpen(),t.once("panelShow",function(){o.focus(!o.multiSelect&&s.getValue())})},r.onHide=function(e){this.element.removeClass(a),s.setState(s.modes&&s.modes[t.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),s._.on=0,!e&&s.onClose&&s.onClose()},r.onEscape=function(){r.hide(1)},o.onClick=function(t,e){s.onClick&&s.onClick.call(s,t,e),r.hide()},this._.panel=r,this._.list=o,r.getBlock(this.id).onHide=function(){s._.on=0,s.setState(CKEDITOR.TRISTATE_OFF)},this.init&&this.init()}},setValue:function(t,e){this._.value=t;var i=this.document.getById("cke_"+this.id+"_text");i&&(t||e?i.removeClass("cke_combo_inlinelabel"):(e=this.label,i.addClass("cke_combo_inlinelabel")),i.setText("undefined"!=typeof e?e:t))},getValue:function(){return this._.value||""},unmarkAll:function(){this._.list.unmarkAll()},mark:function(t){this._.list.mark(t)},hideItem:function(t){this._.list.hideItem(t)},hideGroup:function(t){this._.list.hideGroup(t)},showAll:function(){this._.list.showAll()},add:function(t,e,i){this._.items[t]=i||t,this._.list.add(t,e,i)},startGroup:function(t){this._.list.startGroup(t)},commit:function(){this._.committed||(this._.list.commit(),this._.committed=1,CKEDITOR.ui.fire("ready",this)),this._.committed=1},setState:function(t){if(this._.state!=t){var e=this.document.getById("cke_"+this.id);e.setState(t,"cke_combo"),t==CKEDITOR.TRISTATE_DISABLED?e.setAttribute("aria-disabled",!0):e.removeAttribute("aria-disabled"),this._.state=t}},getState:function(){return this._.state},enable:function(){this._.state==CKEDITOR.TRISTATE_DISABLED&&this.setState(this._.lastState)},disable:function(){this._.state!=CKEDITOR.TRISTATE_DISABLED&&(this._.lastState=this._.state,this.setState(CKEDITOR.TRISTATE_DISABLED))}},statics:{handler:{create:function(t){return new CKEDITOR.ui.richCombo(t)}}}}),CKEDITOR.ui.prototype.addRichCombo=function(t,e){this.add(t,CKEDITOR.UI_RICHCOMBO,e)}}(),CKEDITOR.plugins.add("format",{requires:"richcombo",init:function(t){if(!t.blockless){for(var e=t.config,i=t.lang.format,n=e.format_tags.split(";"),a={},r=0,o=[],s=0;s<n.length;s++){var l=n[s],c=new CKEDITOR.style(e["format_"+l]);(!t.filter.customConfig||t.filter.check(c))&&(r++,a[l]=c,a[l]._.enterMode=t.config.enterMode,o.push(c))}0!==r&&t.ui.addRichCombo("Format",{label:i.label,title:i.panelTitle,toolbar:"styles,20",allowedContent:o,panel:{css:[CKEDITOR.skin.getPath("editor")].concat(e.contentsCss),multiSelect:!1,attributes:{"aria-label":i.panelTitle}},init:function(){this.startGroup(i.panelTitle);for(var t in a){var e=i["tag_"+t];this.add(t,a[t].buildPreview(e),e)}},onClick:function(e){t.focus(),t.fire("saveSnapshot");var e=a[e],i=t.elementPath();t[e.checkActive(i)?"removeStyle":"applyStyle"](e),setTimeout(function(){t.fire("saveSnapshot")},0)},onRender:function(){t.on("selectionChange",function(e){var i=this.getValue(),e=e.data.path;this.refresh();for(var n in a)if(a[n].checkActive(e))return void(n!=i&&this.setValue(n,t.lang.format["tag_"+n]));this.setValue("")},this)},onOpen:function(){this.showAll();for(var e in a)t.activeFilter.check(a[e])||this.hideItem(e)},refresh:function(){var e=t.elementPath();if(e){if(e.isContextFor("p"))for(var i in a)if(t.activeFilter.check(a[i]))return;this.setState(CKEDITOR.TRISTATE_DISABLED)}}})}}}),CKEDITOR.config.format_tags="p;h1;h2;h3;h4;h5;h6;pre;address;div",CKEDITOR.config.format_p={element:"p"},CKEDITOR.config.format_div={element:"div"},CKEDITOR.config.format_pre={element:"pre"},CKEDITOR.config.format_address={element:"address"},CKEDITOR.config.format_h1={element:"h1"},CKEDITOR.config.format_h2={element:"h2"},CKEDITOR.config.format_h3={element:"h3"},CKEDITOR.config.format_h4={element:"h4"},CKEDITOR.config.format_h5={element:"h5"},CKEDITOR.config.format_h6={element:"h6"},function(){var t={canUndo:!1,exec:function(t){var e=t.document.createElement("hr");t.insertElement(e)},allowedContent:"hr",requiredContent:"hr"};
CKEDITOR.plugins.add("horizontalrule",{init:function(e){e.blockless||(e.addCommand("horizontalrule",t),e.ui.addButton&&e.ui.addButton("HorizontalRule",{label:e.lang.horizontalrule.toolbar,command:"horizontalrule",toolbar:"insert,40"}))}})}(),CKEDITOR.plugins.add("htmlwriter",{init:function(t){var e=new CKEDITOR.htmlWriter;e.forceSimpleAmpersand=t.config.forceSimpleAmpersand,e.indentationChars=t.config.dataIndentationChars||"	",t.dataProcessor.writer=e}}),CKEDITOR.htmlWriter=CKEDITOR.tools.createClass({base:CKEDITOR.htmlParser.basicWriter,$:function(){this.base(),this.indentationChars="	",this.selfClosingEnd=" />",this.lineBreakChars="\n",this.sortAttributes=1,this._.indent=0,this._.indentation="",this._.inPre=0,this._.rules={};var t,e=CKEDITOR.dtd;for(t in CKEDITOR.tools.extend({},e.$nonBodyContent,e.$block,e.$listItem,e.$tableContent))this.setRules(t,{indent:!e[t]["#"],breakBeforeOpen:1,breakBeforeClose:!e[t]["#"],breakAfterClose:1,needsSpace:t in e.$block&&!(t in{li:1,dt:1,dd:1})});this.setRules("br",{breakAfterOpen:1}),this.setRules("title",{indent:0,breakAfterOpen:0}),this.setRules("style",{indent:0,breakBeforeClose:1}),this.setRules("pre",{breakAfterOpen:1,indent:0})},proto:{openTag:function(t){var e=this._.rules[t];this._.afterCloser&&e&&e.needsSpace&&this._.needsSpace&&this._.output.push("\n"),this._.indent?this.indentation():e&&e.breakBeforeOpen&&(this.lineBreak(),this.indentation()),this._.output.push("<",t),this._.afterCloser=0},openTagClose:function(t,e){var i=this._.rules[t];e?(this._.output.push(this.selfClosingEnd),i&&i.breakAfterClose&&(this._.needsSpace=i.needsSpace)):(this._.output.push(">"),i&&i.indent&&(this._.indentation=this._.indentation+this.indentationChars)),i&&i.breakAfterOpen&&this.lineBreak(),"pre"==t&&(this._.inPre=1)},attribute:function(t,e){"string"==typeof e&&(this.forceSimpleAmpersand&&(e=e.replace(/&amp;/g,"&")),e=CKEDITOR.tools.htmlEncodeAttr(e)),this._.output.push(" ",t,'="',e,'"')},closeTag:function(t){var e=this._.rules[t];e&&e.indent&&(this._.indentation=this._.indentation.substr(this.indentationChars.length)),this._.indent?this.indentation():e&&e.breakBeforeClose&&(this.lineBreak(),this.indentation()),this._.output.push("</",t,">"),"pre"==t&&(this._.inPre=0),e&&e.breakAfterClose&&(this.lineBreak(),this._.needsSpace=e.needsSpace),this._.afterCloser=1},text:function(t){this._.indent&&(this.indentation(),!this._.inPre&&(t=CKEDITOR.tools.ltrim(t))),this._.output.push(t)},comment:function(t){this._.indent&&this.indentation(),this._.output.push("<!--",t,"-->")},lineBreak:function(){!this._.inPre&&this._.output.length>0&&this._.output.push(this.lineBreakChars),this._.indent=1},indentation:function(){!this._.inPre&&this._.indentation&&this._.output.push(this._.indentation),this._.indent=0},reset:function(){this._.output=[],this._.indent=0,this._.indentation="",this._.afterCloser=0,this._.inPre=0},setRules:function(t,e){var i=this._.rules[t];i?CKEDITOR.tools.extend(i,e,!0):this._.rules[t]=e}}}),function(){function t(t){var e=this.editor,i=t.document,n=i.body;(t=i.getElementById("cke_actscrpt"))&&t.parentNode.removeChild(t),(t=i.getElementById("cke_shimscrpt"))&&t.parentNode.removeChild(t),CKEDITOR.env.gecko&&(n.contentEditable=!1,CKEDITOR.env.version<2e4&&(n.innerHTML=n.innerHTML.replace(/^.*<\!-- cke-content-start --\>/,""),setTimeout(function(){var t=new CKEDITOR.dom.range(new CKEDITOR.dom.document(i));t.setStart(new CKEDITOR.dom.node(n),0),e.getSelection().selectRanges([t])},0))),n.contentEditable=!0,CKEDITOR.env.ie&&(n.hideFocus=!0,n.disabled=!0,n.removeAttribute("disabled")),delete this._.isLoadingData,this.$=n,i=new CKEDITOR.dom.document(i),this.setup(),CKEDITOR.env.ie&&(i.getDocumentElement().addClass(i.$.compatMode),e.config.enterMode!=CKEDITOR.ENTER_P&&this.attachListener(i,"selectionchange",function(){var t=i.getBody(),n=e.getSelection(),a=n&&n.getRanges()[0];a&&t.getHtml().match(/^<p>(?:&nbsp;|<br>)<\/p>$/i)&&a.startContainer.equals(t)&&setTimeout(function(){a=e.getSelection().getRanges()[0],a.startContainer.equals("body")||(t.getFirst().remove(1),a.moveToElementEditEnd(t),a.select())},0)})),(CKEDITOR.env.webkit||CKEDITOR.env.ie&&CKEDITOR.env.version>10)&&i.getDocumentElement().on("mousedown",function(t){t.data.getTarget().is("html")&&setTimeout(function(){e.editable().focus()})});try{e.document.$.execCommand("2D-position",!1,!0)}catch(a){}try{e.document.$.execCommand("enableInlineTableEditing",!1,!e.config.disableNativeTableHandles)}catch(r){}if(e.config.disableObjectResizing)try{this.getDocument().$.execCommand("enableObjectResizing",!1,!1)}catch(o){this.attachListener(this,CKEDITOR.env.ie?"resizestart":"resize",function(t){t.data.preventDefault()})}(CKEDITOR.env.gecko||CKEDITOR.env.ie&&"CSS1Compat"==e.document.$.compatMode)&&this.attachListener(this,"keydown",function(t){var i=t.data.getKeystroke();if(33==i||34==i)if(CKEDITOR.env.ie)setTimeout(function(){e.getSelection().scrollIntoView()},0);else if(e.window.$.innerHeight>this.$.offsetHeight){var n=e.createRange();n[33==i?"moveToElementEditStart":"moveToElementEditEnd"](this),n.select(),t.data.preventDefault()}}),CKEDITOR.env.ie&&this.attachListener(i,"blur",function(){try{i.$.selection.empty()}catch(t){}}),e.document.getElementsByTag("title").getItem(0).data("cke-title",e.document.$.title),CKEDITOR.env.ie&&(e.document.$.title=this._.docTitle),CKEDITOR.tools.setTimeout(function(){e.fire("contentDom"),this._.isPendingFocus&&(e.focus(),this._.isPendingFocus=!1),setTimeout(function(){e.fire("dataReady")},0),CKEDITOR.env.ie&&setTimeout(function(){if(e.document){var t=e.document.$.body;t.runtimeStyle.marginBottom="0px",t.runtimeStyle.marginBottom=""}},1e3)},0,this)}function e(){var t=[];if(CKEDITOR.document.$.documentMode>=8){t.push("html.CSS1Compat [contenteditable=false]{min-height:0 !important}");var e,i=[];for(e in CKEDITOR.dtd.$removeEmpty)i.push("html.CSS1Compat "+e+"[contenteditable=false]");t.push(i.join(",")+"{display:inline-block}")}else CKEDITOR.env.gecko&&(t.push("html{height:100% !important}"),t.push("img:-moz-broken{-moz-force-broken-image-icon:1;min-width:24px;min-height:24px}"));return t.push("html{cursor:text;*cursor:auto}"),t.push("img,input,textarea{cursor:default}"),t.join("\n")}CKEDITOR.plugins.add("wysiwygarea",{init:function(t){t.config.fullPage&&t.addFeature({allowedContent:"html head title; style [media,type]; body (*)[id]; meta link [*]",requiredContent:"body"}),t.addMode("wysiwyg",function(e){function n(n){n&&n.removeListener(),t.editable(new i(t,r.$.contentWindow.document.body)),t.setData(t.getData(1),e)}var a="document.open();"+(CKEDITOR.env.ie?"("+CKEDITOR.tools.fixDomain+")();":"")+"document.close();",a=CKEDITOR.env.air?"javascript:void(0)":CKEDITOR.env.ie?"javascript:void(function(){"+encodeURIComponent(a)+"}())":"",r=CKEDITOR.dom.element.createFromHtml('<iframe src="'+a+'" frameBorder="0"></iframe>');r.setStyles({width:"100%",height:"100%"}),r.addClass("cke_wysiwyg_frame cke_reset");var o=t.ui.space("contents");o.append(r),(a=CKEDITOR.env.ie||CKEDITOR.env.gecko)&&r.on("load",n);var s=t.title,l=t.lang.common.editorHelp;s&&(CKEDITOR.env.ie&&(s+=", "+l),r.setAttribute("title",s));var s=CKEDITOR.tools.getNextId(),c=CKEDITOR.dom.element.createFromHtml('<span id="'+s+'" class="cke_voice_label">'+l+"</span>");o.append(c,1),t.on("beforeModeUnload",function(t){t.removeListener(),c.remove()}),r.setAttributes({"aria-describedby":s,tabIndex:t.tabIndex,allowTransparency:"true"}),!a&&n(),CKEDITOR.env.webkit&&(a=function(){o.setStyle("width","100%"),r.hide(),r.setSize("width",o.getSize("width")),o.removeStyle("width"),r.show()},r.setCustomData("onResize",a),CKEDITOR.document.getWindow().on("resize",a)),t.fire("ariaWidget",r)})}});var i=CKEDITOR.tools.createClass({$:function(){this.base.apply(this,arguments),this._.frameLoadedHandler=CKEDITOR.tools.addFunction(function(e){CKEDITOR.tools.setTimeout(t,0,this,e)},this),this._.docTitle=this.getWindow().getFrame().getAttribute("title")},base:CKEDITOR.editable,proto:{setData:function(t,i){var n=this.editor;if(i)this.setHtml(t),n.fire("dataReady");else{this._.isLoadingData=!0,n._.dataStore={id:1};var a=n.config,r=a.fullPage,o=a.docType,s=CKEDITOR.tools.buildStyleHtml(e()).replace(/<style>/,'<style data-cke-temp="1">');r||(s+=CKEDITOR.tools.buildStyleHtml(n.config.contentsCss));var l=a.baseHref?'<base href="'+a.baseHref+'" data-cke-temp="1" />':"";r&&(t=t.replace(/<!DOCTYPE[^>]*>/i,function(t){return n.docType=o=t,""}).replace(/<\?xml\s[^\?]*\?>/i,function(t){return n.xmlDeclaration=t,""})),t=n.dataProcessor.toHtml(t),r?(/<body[\s|>]/.test(t)||(t="<body>"+t),/<html[\s|>]/.test(t)||(t="<html>"+t+"</html>"),/<head[\s|>]/.test(t)?/<title[\s|>]/.test(t)||(t=t.replace(/<head[^>]*>/,"$&<title></title>")):t=t.replace(/<html[^>]*>/,"$&<head><title></title></head>"),l&&(t=t.replace(/<head>/,"$&"+l)),t=t.replace(/<\/head\s*>/,s+"$&"),t=o+t):t=a.docType+'<html dir="'+a.contentsLangDirection+'" lang="'+(a.contentsLanguage||n.langCode)+'"><head><title>'+this._.docTitle+"</title>"+l+s+"</head><body"+(a.bodyId?' id="'+a.bodyId+'"':"")+(a.bodyClass?' class="'+a.bodyClass+'"':"")+">"+t+"</body></html>",CKEDITOR.env.gecko&&(t=t.replace(/<body/,'<body contenteditable="true" '),CKEDITOR.env.version<2e4&&(t=t.replace(/<body[^>]*>/,"$&<!-- cke-content-start -->"))),a='<script id="cke_actscrpt" type="text/javascript"'+(CKEDITOR.env.ie?' defer="defer" ':"")+">var wasLoaded=0;function onload(){if(!wasLoaded)window.parent.CKEDITOR.tools.callFunction("+this._.frameLoadedHandler+",window);wasLoaded=1;}"+(CKEDITOR.env.ie?"onload();":'document.addEventListener("DOMContentLoaded", onload, false );')+"</script>",CKEDITOR.env.ie&&CKEDITOR.env.version<9&&(a+='<script id="cke_shimscrpt">window.parent.CKEDITOR.tools.enableHtml5Elements(document)</script>'),t=t.replace(/(?=\s*<\/(:?head)>)/,a),this.clearCustomData(),this.clearListeners(),n.fire("contentDomUnload");var c=this.getDocument();try{c.write(t)}catch(d){setTimeout(function(){c.write(t)},0)}}},getData:function(t){if(t)return this.getHtml();var t=this.editor,e=t.config,i=e.fullPage,n=i&&t.docType,a=i&&t.xmlDeclaration,r=this.getDocument(),i=i?r.getDocumentElement().getOuterHtml():r.getBody().getHtml();return CKEDITOR.env.gecko&&e.enterMode!=CKEDITOR.ENTER_BR&&(i=i.replace(/<br>(?=\s*(:?$|<\/body>))/,"")),i=t.dataProcessor.toDataFormat(i),a&&(i=a+"\n"+i),n&&(i=n+"\n"+i),i},focus:function(){this._.isLoadingData?this._.isPendingFocus=!0:i.baseProto.focus.call(this)},detach:function(){var t=this.editor,e=t.document,t=t.window.getFrame();i.baseProto.detach.call(this),this.clearCustomData(),e.getDocumentElement().clearCustomData(),t.clearCustomData(),CKEDITOR.tools.removeFunction(this._.frameLoadedHandler),(e=t.removeCustomData("onResize"))&&e.removeListener(),t.remove()}}})}(),CKEDITOR.config.disableObjectResizing=!1,CKEDITOR.config.disableNativeTableHandles=!0,CKEDITOR.config.disableNativeSpellChecker=!0,CKEDITOR.config.contentsCss=CKEDITOR.getUrl("contents.css"),function(){function t(t,n){var a,r;n.on("refresh",function(t){var n,a=[e];for(n in t.data.states)a.push(t.data.states[n]);this.setState(CKEDITOR.tools.search(a,i)?i:e)},n,null,100),n.on("exec",function(e){a=t.getSelection(),r=a.createBookmarks(1),e.data||(e.data={}),e.data.done=!1},n,null,0),n.on("exec",function(){t.forceNextSelectionCheck(),a.selectBookmarks(r)},n,null,100)}var e=CKEDITOR.TRISTATE_DISABLED,i=CKEDITOR.TRISTATE_OFF;CKEDITOR.plugins.add("indent",{init:function(e){var i=CKEDITOR.plugins.indent.genericDefinition;t(e,e.addCommand("indent",new i(!0))),t(e,e.addCommand("outdent",new i)),e.ui.addButton&&(e.ui.addButton("Indent",{label:e.lang.indent.indent,command:"indent",directional:!0,toolbar:"indent,20"}),e.ui.addButton("Outdent",{label:e.lang.indent.outdent,command:"outdent",directional:!0,toolbar:"indent,10"})),e.on("dirChanged",function(t){var i=e.createRange(),n=t.data.node;i.setStartBefore(n),i.setEndAfter(n);for(var a,r=new CKEDITOR.dom.walker(i);a=r.next();)if(a.type==CKEDITOR.NODE_ELEMENT)if(!a.equals(n)&&a.getDirection())i.setStartAfter(a),r=new CKEDITOR.dom.walker(i);else{var o=e.config.indentClasses;if(o)for(var s="ltr"==t.data.dir?["_rtl",""]:["","_rtl"],l=0;l<o.length;l++)a.hasClass(o[l]+s[0])&&(a.removeClass(o[l]+s[0]),a.addClass(o[l]+s[1]));o=a.getStyle("margin-right"),s=a.getStyle("margin-left"),o?a.setStyle("margin-left",o):a.removeStyle("margin-left"),s?a.setStyle("margin-right",s):a.removeStyle("margin-right")}})}}),CKEDITOR.plugins.indent={genericDefinition:function(t){this.isIndent=!!t,this.startDisabled=!this.isIndent},specificDefinition:function(t,e,i){this.name=e,this.editor=t,this.jobs={},this.enterBr=t.config.enterMode==CKEDITOR.ENTER_BR,this.isIndent=!!i,this.relatedGlobal=i?"indent":"outdent",this.indentKey=i?9:CKEDITOR.SHIFT+9,this.database={}},registerCommands:function(t,e){t.on("pluginsLoaded",function(){for(var t in e)(function(t,e){var i,n=t.getCommand(e.relatedGlobal);for(i in e.jobs)n.on("exec",function(n){n.data.done||(t.fire("lockSnapshot"),e.execJob(t,i)&&(n.data.done=!0),t.fire("unlockSnapshot"),CKEDITOR.dom.element.clearAllMarkers(e.database))},this,null,i),n.on("refresh",function(n){n.data.states||(n.data.states={}),n.data.states[e.name+"@"+i]=e.refreshJob(t,i,n.data.path)},this,null,i);t.addFeature(e)})(this,e[t])})}},CKEDITOR.plugins.indent.genericDefinition.prototype={context:"p",exec:function(){}},CKEDITOR.plugins.indent.specificDefinition.prototype={execJob:function(t,i){var n=this.jobs[i];return n.state!=e?n.exec.call(this,t):void 0},refreshJob:function(t,i,n){return i=this.jobs[i],i.state=t.activeFilter.checkFeature(this)?i.refresh.call(this,t,n):e,i.state},getContext:function(t){return t.contains(this.context)}}}(),function(){function t(t){function e(e){for(var i=a.startContainer,l=a.endContainer;i&&!i.getParent().equals(e);)i=i.getParent();for(;l&&!l.getParent().equals(e);)l=l.getParent();if(!i||!l)return!1;for(var c=i,i=[],d=!1;!d;)c.equals(l)&&(d=!0),i.push(c),c=c.getNext();if(i.length<1)return!1;for(c=e.getParents(!0),l=0;l<c.length;l++)if(c[l].getName&&s[c[l].getName()]){e=c[l];break}for(var c=r.isIndent?1:-1,l=i[0],i=i[i.length-1],d=CKEDITOR.plugins.list.listToArray(e,o),h=d[i.getCustomData("listarray_index")].indent,l=l.getCustomData("listarray_index");l<=i.getCustomData("listarray_index");l++)if(d[l].indent=d[l].indent+c,c>0){var u=d[l].parent;d[l].parent=new CKEDITOR.dom.element(u.getName(),u.getDocument())}for(l=i.getCustomData("listarray_index")+1;l<d.length&&d[l].indent>h;l++)d[l].indent=d[l].indent+c;if(i=CKEDITOR.plugins.list.arrayToList(d,o,null,t.config.enterMode,e.getDirection()),!r.isIndent){var p;if((p=e.getParent())&&p.is("li"))for(var f,c=i.listNode.getChildren(),m=[],l=c.count()-1;l>=0;l--)(f=c.getItem(l))&&f.is&&f.is("li")&&m.push(f)}if(i&&i.listNode.replace(e),m&&m.length)for(l=0;l<m.length;l++){for(f=e=m[l];(f=f.getNext())&&f.is&&f.getName()in s;)CKEDITOR.env.needsNbspFiller&&!e.getFirst(n)&&e.append(a.document.createText(" ")),e.append(f);e.insertAfter(p)}return i&&t.fire("contentDomInvalidated"),!0}for(var a,r=this,o=this.database,s=this.context,l=t.getSelection(),l=(l&&l.getRanges()).createIterator();a=l.getNextRange();){for(var c=a.getCommonAncestor();c&&(c.type!=CKEDITOR.NODE_ELEMENT||!s[c.getName()]);)c=c.getParent();if(c||(c=a.startPath().contains(s))&&a.setEndAt(c,CKEDITOR.POSITION_BEFORE_END),!c){var d=a.getEnclosedNode();d&&d.type==CKEDITOR.NODE_ELEMENT&&d.getName()in s&&(a.setStartAt(d,CKEDITOR.POSITION_AFTER_START),a.setEndAt(d,CKEDITOR.POSITION_BEFORE_END),c=d)}if(c&&a.startContainer.type==CKEDITOR.NODE_ELEMENT&&a.startContainer.getName()in s&&(d=new CKEDITOR.dom.walker(a),d.evaluator=i,a.startContainer=d.next()),c&&a.endContainer.type==CKEDITOR.NODE_ELEMENT&&a.endContainer.getName()in s&&(d=new CKEDITOR.dom.walker(a),d.evaluator=i,a.endContainer=d.previous()),c)return e(c)}return 0}function e(t,e){return e||(e=t.contains(this.context)),e&&t.block&&t.block.equals(e.getFirst(i))}function i(t){return t.type==CKEDITOR.NODE_ELEMENT&&t.is("li")}function n(t){return a(t)&&r(t)}var a=CKEDITOR.dom.walker.whitespaces(!0),r=CKEDITOR.dom.walker.bookmark(!1,!0),o=CKEDITOR.TRISTATE_DISABLED,s=CKEDITOR.TRISTATE_OFF;CKEDITOR.plugins.add("indentlist",{requires:"indent",init:function(i){function n(i){a.specificDefinition.apply(this,arguments),this.requiredContent=["ul","ol"],i.on("key",function(t){if("wysiwyg"==i.mode&&t.data.keyCode==this.indentKey){var n=this.getContext(i.elementPath());!n||this.isIndent&&e.call(this,i.elementPath(),n)||(i.execCommand(this.relatedGlobal),t.cancel())}},this),this.jobs[this.isIndent?10:30]={refresh:this.isIndent?function(t,i){var n=this.getContext(i),a=e.call(this,i,n);return n&&this.isIndent&&!a?s:o}:function(t,e){return!this.getContext(e)||this.isIndent?o:s},exec:CKEDITOR.tools.bind(t,this)}}var a=CKEDITOR.plugins.indent;a.registerCommands(i,{indentlist:new n(i,"indentlist",!0),outdentlist:new n(i,"outdentlist")}),CKEDITOR.tools.extend(n.prototype,a.specificDefinition.prototype,{context:{ol:1,ul:1}})}})}(),function(){function t(t,e){var i=n.exec(t),a=n.exec(e);if(i){if(!i[2]&&"px"==a[2])return a[1];if("px"==i[2]&&!a[2])return a[1]+"px"}return e}var e=CKEDITOR.htmlParser.cssStyle,i=CKEDITOR.tools.cssLength,n=/^((?:\d*(?:\.\d+))|(?:\d+))(.*)?$/i,a={elements:{$:function(i){var n=i.attributes;if((n=(n=(n=n&&n["data-cke-realelement"])&&new CKEDITOR.htmlParser.fragment.fromHtml(decodeURIComponent(n)))&&n.children[0])&&i.attributes["data-cke-resizable"]){var a=new e(i).rules,i=n.attributes,r=a.width,a=a.height;r&&(i.width=t(i.width,r)),a&&(i.height=t(i.height,a))}return n}}},r=CKEDITOR.plugins.add("fakeobjects",{init:function(t){t.filter.allow("img[!data-cke-realelement,src,alt,title](*){*}","fakeobjects")},afterInit:function(t){(t=(t=t.dataProcessor)&&t.htmlFilter)&&t.addRules(a)}});CKEDITOR.editor.prototype.createFakeElement=function(t,n,a,o){var s=this.lang.fakeobjects,s=s[a]||s.unknown,n={"class":n,"data-cke-realelement":encodeURIComponent(t.getOuterHtml()),"data-cke-real-node-type":t.type,alt:s,title:s,align:t.getAttribute("align")||""};return CKEDITOR.env.hc||(n.src=CKEDITOR.getUrl(r.path+"images/spacer.gif")),a&&(n["data-cke-real-element-type"]=a),o&&(n["data-cke-resizable"]=o,a=new e,o=t.getAttribute("width"),t=t.getAttribute("height"),o&&(a.rules.width=i(o)),t&&(a.rules.height=i(t)),a.populate(n)),this.document.createElement("img",{attributes:n})},CKEDITOR.editor.prototype.createFakeParserElement=function(t,n,a,o){var s,l=this.lang.fakeobjects,l=l[a]||l.unknown;return s=new CKEDITOR.htmlParser.basicWriter,t.writeHtml(s),s=s.getHtml(),n={"class":n,"data-cke-realelement":encodeURIComponent(s),"data-cke-real-node-type":t.type,alt:l,title:l,align:t.attributes.align||""},CKEDITOR.env.hc||(n.src=CKEDITOR.getUrl(r.path+"images/spacer.gif")),a&&(n["data-cke-real-element-type"]=a),o&&(n["data-cke-resizable"]=o,o=t.attributes,t=new e,a=o.width,o=o.height,void 0!=a&&(t.rules.width=i(a)),void 0!=o&&(t.rules.height=i(o)),t.populate(n)),new CKEDITOR.htmlParser.element("img",n)},CKEDITOR.editor.prototype.restoreRealElement=function(e){if(e.data("cke-real-node-type")!=CKEDITOR.NODE_ELEMENT)return null;var i=CKEDITOR.dom.element.createFromHtml(decodeURIComponent(e.data("cke-realelement")),this.document);if(e.data("cke-resizable")){var n=e.getStyle("width"),e=e.getStyle("height");n&&i.setAttribute("width",t(i.getAttribute("width"),n)),e&&i.setAttribute("height",t(i.getAttribute("height"),e))}return i}}(),CKEDITOR.plugins.add("link",{requires:"dialog,fakeobjects",onLoad:function(){function t(t){return i.replace(/%1/g,"rtl"==t?"right":"left").replace(/%2/g,"cke_contents_"+t)}var e="background:url("+CKEDITOR.getUrl(this.path+"images"+(CKEDITOR.env.hidpi?"/hidpi":"")+"/anchor.png")+") no-repeat %1 center;border:1px dotted #00f;background-size:16px;",i=".%2 a.cke_anchor,.%2 a.cke_anchor_empty,.cke_editable.%2 a[name],.cke_editable.%2 a[data-cke-saved-name]{"+e+"padding-%1:18px;cursor:auto;}"+(CKEDITOR.plugins.link.synAnchorSelector?"a.cke_anchor_empty{display:inline-block;"+(CKEDITOR.env.ie&&CKEDITOR.env.version>10?"min-height:16px;vertical-align:middle":"")+"}":"")+".%2 img.cke_anchor{"+e+"width:16px;min-height:15px;height:1.15em;vertical-align:"+(CKEDITOR.env.opera?"middle":"text-bottom")+";}";CKEDITOR.addCss(t("ltr")+t("rtl"))},init:function(t){var e="a[!href]";CKEDITOR.dialog.isTabEnabled(t,"link","advanced")&&(e=e.replace("]",",accesskey,charset,dir,id,lang,name,rel,tabindex,title,type]{*}(*)")),CKEDITOR.dialog.isTabEnabled(t,"link","target")&&(e=e.replace("]",",target,onclick]")),t.addCommand("link",new CKEDITOR.dialogCommand("link",{allowedContent:e,requiredContent:"a[href]"})),t.addCommand("anchor",new CKEDITOR.dialogCommand("anchor",{allowedContent:"a[!name,id]",requiredContent:"a[name]"})),t.addCommand("unlink",new CKEDITOR.unlinkCommand),t.addCommand("removeAnchor",new CKEDITOR.removeAnchorCommand),t.setKeystroke(CKEDITOR.CTRL+76,"link"),t.ui.addButton&&(t.ui.addButton("Link",{label:t.lang.link.toolbar,command:"link",toolbar:"links,10"}),t.ui.addButton("Unlink",{label:t.lang.link.unlink,command:"unlink",toolbar:"links,20"}),t.ui.addButton("Anchor",{label:t.lang.link.anchor.toolbar,command:"anchor",toolbar:"links,30"})),CKEDITOR.dialog.add("link",this.path+"dialogs/link.js"),CKEDITOR.dialog.add("anchor",this.path+"dialogs/anchor.js"),t.on("doubleclick",function(e){var i=CKEDITOR.plugins.link.getSelectedLink(t)||e.data.element;i.isReadOnly()||(i.is("a")?(e.data.dialog=!i.getAttribute("name")||i.getAttribute("href")&&i.getChildCount()?"link":"anchor",t.getSelection().selectElement(i)):CKEDITOR.plugins.link.tryRestoreFakeAnchor(t,i)&&(e.data.dialog="anchor"))}),t.addMenuItems&&t.addMenuItems({anchor:{label:t.lang.link.anchor.menu,command:"anchor",group:"anchor",order:1},removeAnchor:{label:t.lang.link.anchor.remove,command:"removeAnchor",group:"anchor",order:5},link:{label:t.lang.link.menu,command:"link",group:"link",order:1},unlink:{label:t.lang.link.unlink,command:"unlink",group:"link",order:5}}),t.contextMenu&&t.contextMenu.addListener(function(e){if(!e||e.isReadOnly())return null;if(e=CKEDITOR.plugins.link.tryRestoreFakeAnchor(t,e),!e&&!(e=CKEDITOR.plugins.link.getSelectedLink(t)))return null;var i={};return e.getAttribute("href")&&e.getChildCount()&&(i={link:CKEDITOR.TRISTATE_OFF,unlink:CKEDITOR.TRISTATE_OFF}),e&&e.hasAttribute("name")&&(i.anchor=i.removeAnchor=CKEDITOR.TRISTATE_OFF),i})},afterInit:function(t){var e=t.dataProcessor,i=e&&e.dataFilter,e=e&&e.htmlFilter,n=t._.elementsPath&&t._.elementsPath.filters;i&&i.addRules({elements:{a:function(e){var i=e.attributes;if(!i.name)return null;var n=!e.children.length;if(CKEDITOR.plugins.link.synAnchorSelector){var e=n?"cke_anchor_empty":"cke_anchor",a=i["class"];i.name&&(!a||a.indexOf(e)<0)&&(i["class"]=(a||"")+" "+e),n&&CKEDITOR.plugins.link.emptyAnchorFix&&(i.contenteditable="false",i["data-cke-editable"]=1)}else if(CKEDITOR.plugins.link.fakeAnchor&&n)return t.createFakeParserElement(e,"cke_anchor","anchor");return null}}}),CKEDITOR.plugins.link.emptyAnchorFix&&e&&e.addRules({elements:{a:function(t){delete t.attributes.contenteditable}}}),n&&n.push(function(e,i){return"a"!=i||!CKEDITOR.plugins.link.tryRestoreFakeAnchor(t,e)&&(!e.getAttribute("name")||e.getAttribute("href")&&e.getChildCount())?void 0:"anchor"})}}),CKEDITOR.plugins.link={getSelectedLink:function(t){var e=t.getSelection(),i=e.getSelectedElement();return i&&i.is("a")?i:(e=e.getRanges()[0])?(e.shrink(CKEDITOR.SHRINK_TEXT),t.elementPath(e.getCommonAncestor()).contains("a",1)):null},getEditorAnchors:function(t){for(var e,i=t.editable(),n=i.isInline()&&!t.plugins.divarea?t.document:i,a=n.getElementsByTag("a"),i=[],r=0;e=a.getItem(r++);)(e.data("cke-saved-name")||e.hasAttribute("name"))&&i.push({name:e.data("cke-saved-name")||e.getAttribute("name"),id:e.getAttribute("id")});if(this.fakeAnchor)for(n=n.getElementsByTag("img"),r=0;e=n.getItem(r++);)(e=this.tryRestoreFakeAnchor(t,e))&&i.push({name:e.getAttribute("name"),id:e.getAttribute("id")});return i},fakeAnchor:CKEDITOR.env.opera||CKEDITOR.env.webkit,synAnchorSelector:CKEDITOR.env.ie,emptyAnchorFix:CKEDITOR.env.ie&&8>CKEDITOR.env.version,tryRestoreFakeAnchor:function(t,e){if(e&&e.data("cke-real-element-type")&&"anchor"==e.data("cke-real-element-type")){var i=t.restoreRealElement(e);if(i.data("cke-saved-name"))return i}}},CKEDITOR.unlinkCommand=function(){},CKEDITOR.unlinkCommand.prototype={exec:function(t){var e=new CKEDITOR.style({element:"a",type:CKEDITOR.STYLE_INLINE,alwaysRemoveElement:1});t.removeStyle(e)},refresh:function(t,e){var i=e.lastElement&&e.lastElement.getAscendant("a",!0);this.setState(i&&"a"==i.getName()&&i.getAttribute("href")&&i.getChildCount()?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)},contextSensitive:1,startDisabled:1,requiredContent:"a[href]"},CKEDITOR.removeAnchorCommand=function(){},CKEDITOR.removeAnchorCommand.prototype={exec:function(t){var e,i=t.getSelection(),n=i.createBookmarks();i&&(e=i.getSelectedElement())&&(CKEDITOR.plugins.link.fakeAnchor&&!e.getChildCount()?CKEDITOR.plugins.link.tryRestoreFakeAnchor(t,e):e.is("a"))?e.remove(1):(e=CKEDITOR.plugins.link.getSelectedLink(t))&&(e.hasAttribute("href")?(e.removeAttributes({name:1,"data-cke-saved-name":1}),e.removeClass("cke_anchor")):e.remove(1)),i.selectBookmarks(n)},requiredContent:"a[name]"},CKEDITOR.tools.extend(CKEDITOR.config,{linkShowAdvancedTab:!0,linkShowTargetTab:!0}),function(){function t(t,e,i){function n(i){!(l=d[i?"getFirst":"getLast"]())||l.is&&l.isBlockBoundary()||!(c=e.root[i?"getPrevious":"getNext"](CKEDITOR.dom.walker.invisible(!0)))||c.is&&c.isBlockBoundary({br:1})||t.document.createElement("br")[i?"insertBefore":"insertAfter"](l)}for(var a=CKEDITOR.plugins.list.listToArray(e.root,i),r=[],o=0;o<e.contents.length;o++){var s=e.contents[o];(s=s.getAscendant("li",!0))&&!s.getCustomData("list_item_processed")&&(r.push(s),CKEDITOR.dom.element.setMarker(i,s,"list_item_processed",!0))}for(s=null,o=0;o<r.length;o++)s=r[o].getCustomData("listarray_index"),a[s].indent=-1;for(o=s+1;o<a.length;o++)if(a[o].indent>a[o-1].indent+1){for(r=a[o-1].indent+1-a[o].indent,s=a[o].indent;a[o]&&a[o].indent>=s;)a[o].indent=a[o].indent+r,o++;o--}var l,c,d=CKEDITOR.plugins.list.arrayToList(a,i,null,t.config.enterMode,e.root.getAttribute("dir")).listNode;n(!0),n(),d.replace(e.root),t.fire("contentDomInvalidated")}function e(t,e){this.name=t,this.context=this.type=e,this.allowedContent=e+" li",this.requiredContent=e}function i(t,e,i,n){for(var a,r;a=t[n?"getLast":"getFirst"](p);)(r=a.getDirection(1))!==e.getDirection(1)&&a.setAttribute("dir",r),a.remove(),i?a[n?"insertBefore":"insertAfter"](i):e.append(a,n)}function n(t){var e;(e=function(e){var n=t[e?"getPrevious":"getNext"](d);n&&n.type==CKEDITOR.NODE_ELEMENT&&n.is(t.getName())&&(i(t,n,null,!e),t.remove(),t=n)})(),e(1)}function a(t){return t.type==CKEDITOR.NODE_ELEMENT&&(t.getName()in CKEDITOR.dtd.$block||t.getName()in CKEDITOR.dtd.$listItem)&&CKEDITOR.dtd[t.getName()]["#"]}function r(t,e,a){t.fire("saveSnapshot"),a.enlarge(CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS);var r=a.extractContents();e.trim(!1,!0);var s=e.createBookmark(),l=new CKEDITOR.dom.elementPath(e.startContainer),c=l.block,l=l.lastElement.getAscendant("li",1)||c,u=new CKEDITOR.dom.elementPath(a.startContainer),p=u.contains(CKEDITOR.dtd.$listItem),u=u.contains(CKEDITOR.dtd.$list);for(c?(c=c.getBogus())&&c.remove():u&&(c=u.getPrevious(d))&&h(c)&&c.remove(),(c=r.getLast())&&c.type==CKEDITOR.NODE_ELEMENT&&c.is("br")&&c.remove(),(c=e.startContainer.getChild(e.startOffset))?r.insertBefore(c):e.startContainer.append(r),p&&(r=o(p))&&(l.contains(p)?(i(r,p.getParent(),p),r.remove()):l.append(r));a.checkStartOfBlock()&&a.checkEndOfBlock()&&(u=a.startPath(),r=u.block,r);)r.is("li")&&(l=r.getParent(),r.equals(l.getLast(d))&&r.equals(l.getFirst(d))&&(r=l)),a.moveToPosition(r,CKEDITOR.POSITION_BEFORE_START),r.remove();a=a.clone(),r=t.editable(),a.setEndAt(r,CKEDITOR.POSITION_BEFORE_END),a=new CKEDITOR.dom.walker(a),a.evaluator=function(t){return d(t)&&!h(t)},(a=a.next())&&a.type==CKEDITOR.NODE_ELEMENT&&a.getName()in CKEDITOR.dtd.$list&&n(a),e.moveToBookmark(s),e.select(),t.fire("saveSnapshot")}function o(t){return(t=t.getLast(d))&&t.type==CKEDITOR.NODE_ELEMENT&&t.getName()in s?t:null}var s={ol:1,ul:1},l=CKEDITOR.dom.walker.whitespaces(),c=CKEDITOR.dom.walker.bookmark(),d=function(t){return!(l(t)||c(t))},h=CKEDITOR.dom.walker.bogus();CKEDITOR.plugins.list={listToArray:function(t,e,i,n,a){if(!s[t.getName()])return[];n||(n=0),i||(i=[]);for(var r=0,o=t.getChildCount();o>r;r++){var l=t.getChild(r);if(l.type==CKEDITOR.NODE_ELEMENT&&l.getName()in CKEDITOR.dtd.$list&&CKEDITOR.plugins.list.listToArray(l,e,i,n+1),"li"==l.$.nodeName.toLowerCase()){var c={parent:t,indent:n,element:l,contents:[]};a?c.grandparent=a:(c.grandparent=t.getParent(),c.grandparent&&"li"==c.grandparent.$.nodeName.toLowerCase()&&(c.grandparent=c.grandparent.getParent())),e&&CKEDITOR.dom.element.setMarker(e,l,"listarray_index",i.length),i.push(c);for(var d,h=0,u=l.getChildCount();u>h;h++)d=l.getChild(h),d.type==CKEDITOR.NODE_ELEMENT&&s[d.getName()]?CKEDITOR.plugins.list.listToArray(d,e,i,n+1,c.grandparent):c.contents.push(d)}}return i},arrayToList:function(t,e,i,n,a){if(i||(i=0),!t||t.length<i+1)return null;for(var r,o,l,h=t[i].parent.getDocument(),u=new CKEDITOR.dom.documentFragment(h),p=null,f=i,m=Math.max(t[i].indent,0),g=null,v=n==CKEDITOR.ENTER_P?"p":"div";;){var C=t[f];if(r=C.grandparent,o=C.element.getDirection(1),C.indent==m){for(p&&t[f].parent.getName()==p.getName()||(p=t[f].parent.clone(!1,1),a&&p.setAttribute("dir",a),u.append(p)),g=p.append(C.element.clone(0,1)),o!=p.getDirection(1)&&g.setAttribute("dir",o),r=0;r<C.contents.length;r++)g.append(C.contents[r].clone(1,1));f++}else if(C.indent==Math.max(m,0)+1)C=t[f-1].element.getDirection(1),f=CKEDITOR.plugins.list.arrayToList(t,null,f,n,C!=o?o:null),!g.getChildCount()&&CKEDITOR.env.needsNbspFiller&&!(h.$.documentMode>7)&&g.append(h.createText(" ")),g.append(f.listNode),f=f.nextIndex;else{if(-1!=C.indent||i||!r)return null;s[r.getName()]?(g=C.element.clone(!1,!0),o!=r.getDirection(1)&&g.setAttribute("dir",o)):g=new CKEDITOR.dom.documentFragment(h);var I,b,p=r.getDirection(1)!=o,E=C.element,y=E.getAttribute("class"),T=E.getAttribute("style"),R=g.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT&&(n!=CKEDITOR.ENTER_BR||p||T||y),w=C.contents.length;for(r=0;w>r;r++)if(I=C.contents[r],c(I)&&w>1)R?b=I.clone(1,1):g.append(I.clone(1,1));else if(I.type==CKEDITOR.NODE_ELEMENT&&I.isBlockBoundary()){p&&!I.getDirection()&&I.setAttribute("dir",o),l=I;var O=E.getAttribute("style");O&&l.setAttribute("style",O.replace(/([^;])$/,"$1;")+(l.getAttribute("style")||"")),y&&I.addClass(y),l=null,b&&(g.append(b),b=null),g.append(I.clone(1,1))}else R?(l||(l=h.createElement(v),g.append(l),p&&l.setAttribute("dir",o)),T&&l.setAttribute("style",T),y&&l.setAttribute("class",y),b&&(l.append(b),b=null),l.append(I.clone(1,1))):g.append(I.clone(1,1));b&&((l||g).append(b),b=null),g.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT&&f!=t.length-1&&(CKEDITOR.env.needsBrFiller&&(o=g.getLast())&&o.type==CKEDITOR.NODE_ELEMENT&&o.is("br")&&o.remove(),o=g.getLast(d),(!o||!(o.type==CKEDITOR.NODE_ELEMENT&&o.is(CKEDITOR.dtd.$block)))&&g.append(h.createElement("br"))),o=g.$.nodeName.toLowerCase(),("div"==o||"p"==o)&&g.appendBogus(),u.append(g),p=null,f++}if(l=null,t.length<=f||Math.max(t[f].indent,0)<m)break}if(e)for(t=u.getFirst();t;){if(t.type==CKEDITOR.NODE_ELEMENT&&(CKEDITOR.dom.element.clearMarkers(e,t),t.getName()in CKEDITOR.dtd.$listItem&&(i=t,h=a=n=void 0,n=i.getDirection()))){for(a=i.getParent();a&&!(h=a.getDirection());)a=a.getParent();n==h&&i.removeAttribute("dir")}t=t.getNextSourceNode()}return{listNode:u,nextIndex:f}}};var u=/^h[1-6]$/,p=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_ELEMENT);e.prototype={exec:function(e){this.refresh(e,e.elementPath());var i=e.config,a=e.getSelection(),r=a&&a.getRanges();if(this.state==CKEDITOR.TRISTATE_OFF){var o=e.editable();if(o.getFirst(d)){var l=1==r.length&&r[0];(i=l&&l.getEnclosedNode())&&i.is&&this.type==i.getName()&&this.setState(CKEDITOR.TRISTATE_ON)
}else i.enterMode==CKEDITOR.ENTER_BR?o.appendBogus():r[0].fixBlock(1,i.enterMode==CKEDITOR.ENTER_P?"p":"div"),a.selectRanges(r)}for(var i=a.createBookmarks(!0),o=[],c={},r=r.createIterator(),h=0;(l=r.getNextRange())&&++h;){var p=l.getBoundaryNodes(),f=p.startNode,m=p.endNode;for(f.type==CKEDITOR.NODE_ELEMENT&&"td"==f.getName()&&l.setStartAt(p.startNode,CKEDITOR.POSITION_AFTER_START),m.type==CKEDITOR.NODE_ELEMENT&&"td"==m.getName()&&l.setEndAt(p.endNode,CKEDITOR.POSITION_BEFORE_END),l=l.createIterator(),l.forceBrBreak=this.state==CKEDITOR.TRISTATE_OFF;p=l.getNextParagraph();)if(!p.getCustomData("list_block")){CKEDITOR.dom.element.setMarker(c,p,"list_block",1);for(var g,v=e.elementPath(p),f=v.elements,m=0,v=v.blockLimit,C=f.length-1;C>=0&&(g=f[C]);C--)if(s[g.getName()]&&v.contains(g)){v.removeCustomData("list_group_object_"+h),(f=g.getCustomData("list_group_object"))?f.contents.push(p):(f={root:g,contents:[p]},o.push(f),CKEDITOR.dom.element.setMarker(c,g,"list_group_object",f)),m=1;break}m||(m=v,m.getCustomData("list_group_object_"+h)?m.getCustomData("list_group_object_"+h).contents.push(p):(f={root:m,contents:[p]},CKEDITOR.dom.element.setMarker(c,m,"list_group_object_"+h,f),o.push(f)))}}for(g=[];o.length>0;)if(f=o.shift(),this.state==CKEDITOR.TRISTATE_OFF)if(s[f.root.getName()]){for(r=e,h=f,f=c,l=g,m=CKEDITOR.plugins.list.listToArray(h.root,f),v=[],p=0;p<h.contents.length;p++)C=h.contents[p],(C=C.getAscendant("li",!0))&&!C.getCustomData("list_item_processed")&&(v.push(C),CKEDITOR.dom.element.setMarker(f,C,"list_item_processed",!0));for(var C=h.root.getDocument(),I=void 0,b=void 0,p=0;p<v.length;p++){var E=v[p].getCustomData("listarray_index"),I=m[E].parent;I.is(this.type)||(b=C.createElement(this.type),I.copyAttributes(b,{start:1,type:1}),b.removeStyle("list-style-type"),m[E].parent=b)}for(f=CKEDITOR.plugins.list.arrayToList(m,f,null,r.config.enterMode),m=void 0,v=f.listNode.getChildCount(),p=0;v>p&&(m=f.listNode.getChild(p));p++)m.getName()==this.type&&l.push(m);f.listNode.replace(h.root),r.fire("contentDomInvalidated")}else{for(m=e,p=f,l=g,v=p.contents,r=p.root.getDocument(),h=[],1==v.length&&v[0].equals(p.root)&&(f=r.createElement("div"),v[0].moveChildren&&v[0].moveChildren(f),v[0].append(f),v[0]=f),p=p.contents[0].getParent(),C=0;C<v.length;C++)p=p.getCommonAncestor(v[C].getParent());for(I=m.config.useComputedState,m=f=void 0,I=void 0===I||I,C=0;C<v.length;C++)for(b=v[C];E=b.getParent();){if(E.equals(p)){h.push(b),!m&&b.getDirection()&&(m=1),b=b.getDirection(I),null!==f&&(f=f&&f!=b?null:b);break}b=E}if(!(h.length<1)){for(v=h[h.length-1].getNext(),C=r.createElement(this.type),l.push(C),I=l=void 0;h.length;)l=h.shift(),I=r.createElement("li"),l.is("pre")||u.test(l.getName())||"false"==l.getAttribute("contenteditable")?l.appendTo(I):(l.copyAttributes(I),f&&l.getDirection()&&(I.removeStyle("direction"),I.removeAttribute("dir")),l.moveChildren(I),l.remove()),I.appendTo(C);f&&m&&C.setAttribute("dir",f),v?C.insertBefore(v):C.appendTo(p)}}else this.state==CKEDITOR.TRISTATE_ON&&s[f.root.getName()]&&t.call(this,e,f,c);for(C=0;C<g.length;C++)n(g[C]);CKEDITOR.dom.element.clearAllMarkers(c),a.selectBookmarks(i),e.focus()},refresh:function(t,e){var i=e.contains(s,1),n=e.blockLimit||e.root;this.setState(i&&n.contains(i)?i.is(this.type)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_OFF)}},CKEDITOR.plugins.add("list",{requires:"indentlist",init:function(t){t.blockless||(t.addCommand("numberedlist",new e("numberedlist","ol")),t.addCommand("bulletedlist",new e("bulletedlist","ul")),t.ui.addButton&&(t.ui.addButton("NumberedList",{label:t.lang.list.numberedlist,command:"numberedlist",directional:!0,toolbar:"list,10"}),t.ui.addButton("BulletedList",{label:t.lang.list.bulletedlist,command:"bulletedlist",directional:!0,toolbar:"list,20"})),t.on("key",function(e){var i=e.data.keyCode;if("wysiwyg"==t.mode&&i in{8:1,46:1}){var n=t.getSelection().getRanges()[0],l=n&&n.startPath();if(n&&n.collapsed){var c=8==i,u=t.editable(),p=new CKEDITOR.dom.walker(n.clone());if(p.evaluator=function(t){return d(t)&&!h(t)},p.guard=function(t,e){return!(e&&t.type==CKEDITOR.NODE_ELEMENT&&t.is("table"))},i=n.clone(),c){var f,m;(f=l.contains(s))&&n.checkBoundaryOfElement(f,CKEDITOR.START)&&(f=f.getParent())&&f.is("li")&&(f=o(f))?(m=f,f=f.getPrevious(d),i.moveToPosition(f&&h(f)?f:m,CKEDITOR.POSITION_BEFORE_START)):(p.range.setStartAt(u,CKEDITOR.POSITION_AFTER_START),p.range.setEnd(n.startContainer,n.startOffset),(f=p.previous())&&f.type==CKEDITOR.NODE_ELEMENT&&(f.getName()in s||f.is("li"))&&(f.is("li")||(p.range.selectNodeContents(f),p.reset(),p.evaluator=a,f=p.previous()),m=f,i.moveToElementEditEnd(m))),m?(r(t,i,n),e.cancel()):(i=l.contains(s))&&n.checkBoundaryOfElement(i,CKEDITOR.START)&&(m=i.getFirst(d),n.checkBoundaryOfElement(m,CKEDITOR.START)&&(f=i.getPrevious(d),o(m)?f&&(n.moveToElementEditEnd(f),n.select()):t.execCommand("outdent"),e.cancel()))}else(m=l.contains("li"))?(p.range.setEndAt(u,CKEDITOR.POSITION_BEFORE_END),u=(l=m.getLast(d))&&a(l)?l:m,m=0,(f=p.next())&&f.type==CKEDITOR.NODE_ELEMENT&&f.getName()in s&&f.equals(l)?(m=1,f=p.next()):n.checkBoundaryOfElement(u,CKEDITOR.END)&&(m=1),m&&f&&(n=n.clone(),n.moveToElementEditStart(f),r(t,i,n),e.cancel())):(p.range.setEndAt(u,CKEDITOR.POSITION_BEFORE_END),(f=p.next())&&f.type==CKEDITOR.NODE_ELEMENT&&f.is(s)&&(f=f.getFirst(d),l.block&&n.checkStartOfBlock()&&n.checkEndOfBlock()?(l.block.remove(),n.moveToElementEditStart(f),n.select()):o(f)?(n.moveToElementEditStart(f),n.select()):(n=n.clone(),n.moveToElementEditStart(f),r(t,i,n)),e.cancel()));setTimeout(function(){t.selectionChange(1)})}}}))}})}(),function(){function t(t,e,i){return d(e)&&d(i)&&i.equals(e.getNext(function(t){return!(V(t)||G(t)||h(t))}))}function e(t){this.upper=t[0],this.lower=t[1],this.set.apply(this,t.slice(2))}function i(t){var e=t.element;if(e&&d(e)&&(e=e.getAscendant(t.triggers,!0))&&t.editable.contains(e)){var i=r(e,!0);if("true"==i.getAttribute("contenteditable"))return e;if(i.is(t.triggers))return i}return null}function n(t,e,i){return I(t,e),I(t,i),t=e.size.bottom,i=i.size.top,t&&i?0|(t+i)/2:t||i}function a(t,e,i){return e=e[i?"getPrevious":"getNext"](function(e){return e&&e.type==CKEDITOR.NODE_TEXT&&!V(e)||d(e)&&!h(e)&&!c(t,e)})}function r(t,e){if(t.data("cke-editable"))return null;for(e||(t=t.getParent());t&&!t.data("cke-editable");){if(t.hasAttribute("contenteditable"))return t;t=t.getParent()}return null}function o(t){var e=t.doc,i=w('<span contenteditable="false" style="'+j+"position:absolute;border-top:1px dashed "+t.boxColor+'"></span>',e),n=this.path+"images/"+(O.hidpi?"hidpi/":"")+"icon.png";for(T(i,{attach:function(){return this.wrap.getParent()||this.wrap.appendTo(t.editable,!0),this},lineChildren:[T(w('<span title="'+t.editor.lang.magicline.title+'" contenteditable="false">&#8629;</span>',e),{base:j+"height:17px;width:17px;"+(t.rtl?"left":"right")+":17px;background:url("+n+") center no-repeat "+t.boxColor+";cursor:pointer;"+(O.hc?"font-size: 15px;line-height:14px;border:1px solid #fff;text-align:center;":"")+(O.hidpi?"background-size: 9px 10px;":""),looks:["top:-8px;"+CKEDITOR.tools.cssVendorPrefix("border-radius","2px",1),"top:-17px;"+CKEDITOR.tools.cssVendorPrefix("border-radius","2px 2px 0px 0px",1),"top:-1px;"+CKEDITOR.tools.cssVendorPrefix("border-radius","0px 0px 2px 2px",1)]}),T(w(U,e),{base:z+"left:0px;border-left-color:"+t.boxColor+";",looks:["border-width:8px 0 8px 8px;top:-8px","border-width:8px 0 0 8px;top:-8px","border-width:0 0 8px 8px;top:0px"]}),T(w(U,e),{base:z+"right:0px;border-right-color:"+t.boxColor+";",looks:["border-width:8px 8px 8px 0;top:-8px","border-width:8px 8px 0 0;top:-8px","border-width:0 8px 8px 0;top:0px"]})],detach:function(){return this.wrap.getParent()&&this.wrap.remove(),this},mouseNear:function(){I(t,this);var e=t.holdDistance,i=this.size;return i&&t.mouse.y>i.top-e&&t.mouse.y<i.bottom+e&&t.mouse.x>i.left-e&&t.mouse.x<i.right+e?!0:!1},place:function(){var e=t.view,i=t.editable,n=t.trigger,a=n.upper,r=n.lower,o=a||r,s=o.getParent(),l={};this.trigger=n,a&&I(t,a,!0),r&&I(t,r,!0),I(t,s,!0),t.inInlineMode&&b(t,!0),s.equals(i)?(l.left=e.scroll.x,l.right=-e.scroll.x,l.width=""):(l.left=o.size.left-o.size.margin.left+e.scroll.x-(t.inInlineMode?e.editable.left+e.editable.border.left:0),l.width=o.size.outerWidth+o.size.margin.left+o.size.margin.right+e.scroll.x,l.right=""),a&&r?l.top=a.size.margin.bottom===r.size.margin.top?0|a.size.bottom+a.size.margin.bottom/2:a.size.margin.bottom<r.size.margin.top?a.size.bottom+a.size.margin.bottom:a.size.bottom+a.size.margin.bottom-r.size.margin.top:a?r||(l.top=a.size.bottom+a.size.margin.bottom):l.top=r.size.top-r.size.margin.top,n.is(A)||l.top>e.scroll.y-15&&l.top<e.scroll.y+5?(l.top=t.inInlineMode?0:e.scroll.y,this.look(A)):n.is(Q)||l.top>e.pane.bottom-5&&l.top<e.pane.bottom+15?(l.top=t.inInlineMode?e.editable.height+e.editable.padding.top+e.editable.padding.bottom:e.pane.bottom-1,this.look(Q)):(t.inInlineMode&&(l.top=l.top-(e.editable.top+e.editable.border.top)),this.look(M)),t.inInlineMode&&(l.top--,l.top=l.top+e.editable.scroll.top,l.left=l.left+e.editable.scroll.left);for(var c in l)l[c]=CKEDITOR.tools.cssLength(l[c]);this.setStyles(l)},look:function(t){if(this.oldLook!=t){for(var e,i=this.lineChildren.length;i--;)(e=this.lineChildren[i]).setAttribute("style",e.base+e.looks[0|t/2]);this.oldLook=t}},wrap:new R("span",t.doc)}),e=i.lineChildren.length;e--;)i.lineChildren[e].appendTo(i);i.look(M),i.appendTo(i.wrap),i.unselectable(),i.lineChildren[0].on("mouseup",function(e){i.detach(),s(t,function(e){var i=t.line.trigger;e[i.is(k)?"insertBefore":"insertAfter"](i.is(k)?i.lower:i.upper)},!0),t.editor.focus(),!O.ie&&t.enterMode!=CKEDITOR.ENTER_BR&&t.hotNode.scrollIntoView(),e.data.preventDefault(!0)}),i.on("mousedown",function(t){t.data.preventDefault(!0)}),t.line=i}function s(t,e,i){var n,a=new CKEDITOR.dom.range(t.doc),o=t.editor;O.ie&&t.enterMode==CKEDITOR.ENTER_BR?n=t.doc.createText(P):(n=(n=r(t.element,!0))&&n.data("cke-enter-mode")||t.enterMode,n=new R(x[n],t.doc),n.is("br")||t.doc.createText(P).appendTo(n)),i&&o.fire("saveSnapshot"),e(n),a.moveToPosition(n,CKEDITOR.POSITION_AFTER_START),o.getSelection().selectRanges([a]),t.hotNode=n,i&&o.fire("saveSnapshot")}function l(t,e){return{canUndo:!0,modes:{wysiwyg:1},exec:function(){function n(i){var n=O.ie&&O.version<9?" ":P,a=t.hotNode&&t.hotNode.getText()==n&&t.element.equals(t.hotNode)&&t.lastCmdDirection===!!e;s(t,function(n){a&&t.hotNode&&t.hotNode.remove(),n[e?"insertAfter":"insertBefore"](i),n.setAttributes({"data-cke-magicline-hot":1,"data-cke-magicline-dir":!!e}),t.lastCmdDirection=!!e}),!O.ie&&t.enterMode!=CKEDITOR.ENTER_BR&&t.hotNode.scrollIntoView(),t.line.detach()}return function(o){var s,o=o.getSelection().getStartElement(),o=o.getAscendant(F,1);if(!f(t,o)&&o&&!o.equals(t.editable)&&!o.contains(t.editable)){(s=r(o))&&"false"==s.getAttribute("contenteditable")&&(o=s),t.element=o,s=a(t,o,!e);var l;d(s)&&s.is(t.triggers)&&s.is($)&&(!a(t,s,!e)||(l=a(t,s,!e))&&d(l)&&l.is(t.triggers))?n(s):(l=i(t,o),d(l)&&(a(t,l,!e)?(o=a(t,l,!e))&&d(o)&&o.is(t.triggers)&&n(l):n(l)))}}}()}}function c(t,e){if(!e||e.type!=CKEDITOR.NODE_ELEMENT||!e.$)return!1;var i=t.line;return i.wrap.equals(e)||i.wrap.contains(e)}function d(t){return t&&t.type==CKEDITOR.NODE_ELEMENT&&t.$}function h(t){if(!d(t))return!1;var e;return(e=u(t))||(d(t)?(e={left:1,right:1,center:1},e=!(!e[t.getComputedStyle("float")]&&!e[t.getAttribute("align")])):e=!1),e}function u(t){return!!{absolute:1,fixed:1}[t.getComputedStyle("position")]}function p(t,e){return d(e)?e.is(t.triggers):null}function f(t,e){if(!e)return!1;for(var i=e.getParents(1),n=i.length;n--;)for(var a=t.tabuList.length;a--;)if(i[n].hasAttribute(t.tabuList[a]))return!0;return!1}function m(t,e,i){return(e=e[i?"getLast":"getFirst"](function(e){return t.isRelevant(e)&&!e.is(B)}))?(I(t,e),i?e.size.top>t.mouse.y:e.size.bottom<t.mouse.y):!1}function g(t){var i=t.editable,n=t.mouse,a=t.view,r=t.triggerOffset;b(t);var o=n.y>(t.inInlineMode?a.editable.top+a.editable.height/2:Math.min(a.editable.height,a.pane.height)/2),i=i[o?"getLast":"getFirst"](function(t){return!(V(t)||G(t))});return i?(c(t,i)&&(i=t.line.wrap[o?"getPrevious":"getNext"](function(t){return!(V(t)||G(t))})),d(i)&&!h(i)&&p(t,i)?(I(t,i),!o&&i.size.top>=0&&n.y>0&&n.y<i.size.top+r?(t=t.inInlineMode||0===a.scroll.y?A:M,new e([null,i,k,S,t])):o&&i.size.bottom<=a.pane.height&&n.y>i.size.bottom-r&&n.y<a.pane.height?(t=t.inInlineMode||i.size.bottom>a.pane.height-r&&i.size.bottom<a.pane.height?Q:M,new e([i,null,K,S,t])):null):null):null}function v(t){var n=t.mouse,r=t.view,o=t.triggerOffset,s=i(t);if(!s)return null;I(t,s);var l,c,o=Math.min(o,0|s.size.outerHeight/2),u=[];if(n.y>s.size.top-1&&n.y<s.size.top+o)c=!1;else{if(!(n.y>s.size.bottom-o&&n.y<s.size.bottom+1))return null;c=!0}if(h(s)||m(t,s,c)||s.getParent().is(L))return null;var f=a(t,s,!c);if(f){if(f&&f.type==CKEDITOR.NODE_TEXT)return null;if(d(f)){if(h(f)||!p(t,f)||f.getParent().is(L))return null;u=[f,s][c?"reverse":"concat"]().concat([q,S])}}else s.equals(t.editable[c?"getLast":"getFirst"](t.isRelevant))?(b(t),c&&n.y>s.size.bottom-o&&n.y<r.pane.height&&s.size.bottom>r.pane.height-o&&s.size.bottom<r.pane.height?l=Q:n.y>0&&n.y<s.size.top+o&&(l=A)):l=M,u=[null,s][c?"reverse":"concat"]().concat([c?K:k,S,l,s.equals(t.editable[c?"getLast":"getFirst"](t.isRelevant))?c?Q:A:M]);return 0 in u?new e(u):null}function C(t,e,i,n){for(var a=function(){var i=O.ie?e.$.currentStyle:t.win.$.getComputedStyle(e.$,"");return O.ie?function(t){return i[CKEDITOR.tools.cssStyleToDomStyle(t)]}:function(t){return i.getPropertyValue(t)}}(),r=e.getDocumentPosition(),o={},s={},l={},c={},d=Y.length;d--;)o[Y[d]]=parseInt(a("border-"+Y[d]+"-width"),10)||0,l[Y[d]]=parseInt(a("padding-"+Y[d]),10)||0,s[Y[d]]=parseInt(a("margin-"+Y[d]),10)||0;return(!i||n)&&E(t,n),c.top=r.y-(i?0:t.view.scroll.y),c.left=r.x-(i?0:t.view.scroll.x),c.outerWidth=e.$.offsetWidth,c.outerHeight=e.$.offsetHeight,c.height=c.outerHeight-(l.top+l.bottom+o.top+o.bottom),c.width=c.outerWidth-(l.left+l.right+o.left+o.right),c.bottom=c.top+c.outerHeight,c.right=c.left+c.outerWidth,t.inInlineMode&&(c.scroll={top:e.$.scrollTop,left:e.$.scrollLeft}),T({border:o,padding:l,margin:s,ignoreScroll:i},c,!0)}function I(t,e,i){if(!d(e))return e.size=null;if(e.size){if(e.size.ignoreScroll==i&&e.size.date>new Date-H)return null}else e.size={};return T(e.size,C(t,e,i),{date:+new Date},!0)}function b(t,e){t.view.editable=C(t,t.editable,e,!0)}function E(t,e){t.view||(t.view={});var i=t.view;if(e||!(i&&i.date>new Date-H)){var n=t.win,i=n.getScrollPosition(),n=n.getViewPaneSize();T(t.view,{scroll:{x:i.x,y:i.y,width:t.doc.$.documentElement.scrollWidth-n.width,height:t.doc.$.documentElement.scrollHeight-n.height},pane:{width:n.width,height:n.height,bottom:n.height+i.y},date:+new Date},!0)}}function y(t,i,n,a){for(var r=a,o=a,s=0,l=!1,c=!1,d=t.view.pane.height,h=t.mouse;h.y+s<d&&h.y-s>0&&(l||(l=i(r,a)),c||(c=i(o,a)),!l&&h.y-s>0&&(r=n(t,{x:h.x,y:h.y-s})),!c&&h.y+s<d&&(o=n(t,{x:h.x,y:h.y+s})),!l||!c);)s+=2;return new e([r,o,null,null])}CKEDITOR.plugins.add("magicline",{init:function(t){var n,r,p,m=t.config,I=m.magicline_triggerOffset||30,y={editor:t,enterMode:m.enterMode,triggerOffset:I,holdDistance:0|I*(m.magicline_holdDistance||.5),boxColor:m.magicline_color||"#ff0000",rtl:"rtl"==m.contentsLangDirection,tabuList:["data-cke-hidden-sel"].concat(m.magicline_tabuList||[]),triggers:m.magicline_everywhere?F:{table:1,hr:1,div:1,ul:1,ol:1,dl:1,form:1,blockquote:1}};y.isRelevant=function(t){return d(t)&&!c(y,t)&&!h(t)},t.on("contentDom",function(){var d=t.editable(),h=t.document,I=t.window;T(y,{editable:d,inInlineMode:d.isInline(),doc:h,win:I,hotNode:null},!0),y.boundary=y.inInlineMode?y.editable:y.doc.getDocumentElement(),d.is(D.$inline)||(y.inInlineMode&&!u(d)&&d.setStyles({position:"relative",top:null,left:null}),o.call(this,y),E(y),d.attachListener(t,"beforeUndoImage",function(){y.line.detach()}),d.attachListener(t,"beforeGetData",function(){y.line.wrap.getParent()&&(y.line.detach(),t.once("getData",function(){y.line.attach()},null,null,1e3))},null,null,0),d.attachListener(y.inInlineMode?h:h.getWindow().getFrame(),"mouseout",function(e){if("wysiwyg"==t.mode)if(y.inInlineMode){var i=e.data.$.clientX,e=e.data.$.clientY;E(y),b(y,!0);var n=y.view.editable,a=y.view.scroll;i>n.left-a.x&&i<n.right-a.x&&e>n.top-a.y&&e<n.bottom-a.y||(clearTimeout(p),p=null,y.line.detach())}else clearTimeout(p),p=null,y.line.detach()}),d.attachListener(d,"keyup",function(){y.hiddenMode=0}),d.attachListener(d,"keydown",function(e){if("wysiwyg"==t.mode)switch(e=e.data.getKeystroke(),t.getSelection().getStartElement(),e){case 2228240:case 16:y.hiddenMode=1,y.line.detach()}}),d.attachListener(y.inInlineMode?d:h,"mousemove",function(e){if(r=!0,"wysiwyg"==t.mode&&!t.readOnly&&!p){var i={x:e.data.$.clientX,y:e.data.$.clientY};p=setTimeout(function(){y.mouse=i,p=y.trigger=null,E(y),r&&!y.hiddenMode&&t.focusManager.hasFocus&&!y.line.mouseNear()&&(y.element=W(y,!0))&&((y.trigger=g(y)||v(y)||X(y))&&!f(y,y.trigger.upper||y.trigger.lower)?y.line.attach().place():(y.trigger=null,y.line.detach()),r=!1)},30)}}),d.attachListener(I,"scroll",function(){"wysiwyg"==t.mode&&(y.line.detach(),O.webkit&&(y.hiddenMode=1,clearTimeout(n),n=setTimeout(function(){y.mouseDown||(y.hiddenMode=0)},50)))}),d.attachListener(_?h:I,"mousedown",function(){"wysiwyg"==t.mode&&(y.line.detach(),y.hiddenMode=1,y.mouseDown=1)}),d.attachListener(_?h:I,"mouseup",function(){y.hiddenMode=0,y.mouseDown=0}),t.addCommand("accessPreviousSpace",l(y)),t.addCommand("accessNextSpace",l(y,!0)),t.setKeystroke([[m.magicline_keystrokePrevious,"accessPreviousSpace"],[m.magicline_keystrokeNext,"accessNextSpace"]]),t.on("loadSnapshot",function(){var e,i,n,a;for(a in{p:1,br:1,div:1})for(e=t.document.getElementsByTag(a),n=e.count();n--;)if((i=e.getItem(n)).data("cke-magicline-hot"))return y.hotNode=i,void(y.lastCmdDirection="true"===i.data("cke-magicline-dir")?!0:!1)}),this.backdoor={accessFocusSpace:s,boxTrigger:e,isLine:c,getAscendantTrigger:i,getNonEmptyNeighbour:a,getSize:C,that:y,triggerEdge:v,triggerEditable:g,triggerExpand:X})},this)}});var T=CKEDITOR.tools.extend,R=CKEDITOR.dom.element,w=R.createFromHtml,O=CKEDITOR.env,_=CKEDITOR.env.ie&&CKEDITOR.env.version<9,D=CKEDITOR.dtd,x={},k=128,K=64,q=32,S=16,N=8,A=4,Q=2,M=1,P=" ",L=D.$listItem,B=D.$tableContent,$=T({},D.$nonEditable,D.$empty),F=D.$block,H=100,j="width:0px;height:0px;padding:0px;margin:0px;display:block;z-index:9999;color:#fff;position:absolute;font-size: 0px;line-height:0px;",z=j+"border-color:transparent;display:block;border-style:solid;",U="<span>"+P+"</span>";x[CKEDITOR.ENTER_BR]="br",x[CKEDITOR.ENTER_P]="p",x[CKEDITOR.ENTER_DIV]="div",e.prototype={set:function(t,e,i){return this.properties=t+e+(i||M),this},is:function(t){return(this.properties&t)==t}};var W=function(){return function(t,e,i){if(!t.mouse)return null;var n=t.doc,a=t.line.wrap,i=i||t.mouse,r=new CKEDITOR.dom.element(n.$.elementFromPoint(i.x,i.y));return e&&c(t,r)&&(a.hide(),r=new CKEDITOR.dom.element(n.$.elementFromPoint(i.x,i.y)),a.show()),!r||r.type!=CKEDITOR.NODE_ELEMENT||!r.$||O.ie&&O.version<9&&!t.boundary.equals(r)&&!t.boundary.contains(r)?null:r}}(),V=CKEDITOR.dom.walker.whitespaces(),G=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_COMMENT),X=function(){function e(e){var a,r,o,s=e.element;if(!d(s)||s.contains(e.editable)||s.isReadOnly())return null;if(o=y(e,function(t,e){return!e.equals(t)},function(t,e){return W(t,!0,e)},s),a=o.upper,r=o.lower,t(e,a,r))return o.set(q,N);if(a&&s.contains(a))for(;!a.getParent().equals(s);)a=a.getParent();else a=s.getFirst(function(t){return i(e,t)});if(r&&s.contains(r))for(;!r.getParent().equals(s);)r=r.getParent();else r=s.getLast(function(t){return i(e,t)});if(!a||!r)return null;if(I(e,a),I(e,r),!(e.mouse.y>a.size.top&&e.mouse.y<r.size.bottom))return null;for(var l,c,h,u,s=Number.MAX_VALUE;r&&!r.equals(a)&&(c=a.getNext(e.isRelevant));)l=Math.abs(n(e,a,c)-e.mouse.y),s>l&&(s=l,h=a,u=c),a=c,I(e,a);return h&&u&&e.mouse.y>h.size.top&&e.mouse.y<u.size.bottom?(o.upper=h,o.lower=u,o.set(q,N)):null}function i(t,e){return!(e&&e.type==CKEDITOR.NODE_TEXT||G(e)||h(e)||c(t,e)||e.type==CKEDITOR.NODE_ELEMENT&&e.$&&e.is("br"))}return function(i){var n,a=e(i);if(n=a){n=a.upper;var r=a.lower;n=!n||!r||h(r)||h(n)||r.equals(n)||n.equals(r)||r.contains(n)||n.contains(r)?!1:p(i,n)&&p(i,r)&&t(i,n,r)?!0:!1}return n?a:null}}(),Y=["top","left","right","bottom"]}(),CKEDITOR.config.magicline_keystrokePrevious=CKEDITOR.CTRL+CKEDITOR.SHIFT+51,CKEDITOR.config.magicline_keystrokeNext=CKEDITOR.CTRL+CKEDITOR.SHIFT+52,function(){var t={canUndo:!1,async:!0,exec:function(e){e.getClipboardData({title:e.lang.pastetext.title},function(i){i&&e.fire("paste",{type:"text",dataValue:i.dataValue}),e.fire("afterCommandExec",{name:"pastetext",command:t,returnValue:!!i})})}};CKEDITOR.plugins.add("pastetext",{requires:"clipboard",init:function(e){e.addCommand("pastetext",t),e.ui.addButton&&e.ui.addButton("PasteText",{label:e.lang.pastetext.button,command:"pastetext",toolbar:"clipboard,40"}),e.config.forcePasteAsPlainText&&e.on("beforePaste",function(t){"html"!=t.data.type&&(t.data.type="text")}),e.on("pasteState",function(t){e.getCommand("pastetext").setState(t.data)})}})}(),function(){function t(t,e,i){var n=CKEDITOR.cleanWord;return n?i():(t=CKEDITOR.getUrl(t.config.pasteFromWordCleanupFile||e+"filter/default.js"),CKEDITOR.scriptLoader.load(t,i,null,!0)),!n}function e(t){t.data.type="html"}CKEDITOR.plugins.add("pastefromword",{requires:"clipboard",init:function(i){var n=0,a=this.path;i.addCommand("pastefromword",{canUndo:!1,async:!0,exec:function(t){var i=this;n=1,t.once("beforePaste",e),t.getClipboardData({title:t.lang.pastefromword.title},function(e){e&&t.fire("paste",{type:"html",dataValue:e.dataValue}),t.fire("afterCommandExec",{name:"pastefromword",command:i,returnValue:!!e})})}}),i.ui.addButton&&i.ui.addButton("PasteFromWord",{label:i.lang.pastefromword.toolbar,command:"pastefromword",toolbar:"clipboard,50"}),i.on("pasteState",function(t){i.getCommand("pastefromword").setState(t.data)}),i.on("paste",function(e){var r=e.data,o=r.dataValue;if(o&&(n||/(class=\"?Mso|style=\"[^\"]*\bmso\-|w:WordDocument)/.test(o))){var s=t(i,a,function(){s?i.fire("paste",r):(!i.config.pasteFromWordPromptCleanup||n||confirm(i.lang.pastefromword.confirmCleanup))&&(r.dataValue=CKEDITOR.cleanWord(o,i))});s&&e.cancel()}},null,null,3)}})}(),CKEDITOR.plugins.add("removeformat",{init:function(t){t.addCommand("removeFormat",CKEDITOR.plugins.removeformat.commands.removeformat),t.ui.addButton&&t.ui.addButton("RemoveFormat",{label:t.lang.removeformat.toolbar,command:"removeFormat",toolbar:"cleanup,10"})}}),CKEDITOR.plugins.removeformat={commands:{removeformat:{exec:function(t){for(var e,i=t._.removeFormatRegex||(t._.removeFormatRegex=RegExp("^(?:"+t.config.removeFormatTags.replace(/,/g,"|")+")$","i")),n=t._.removeAttributes||(t._.removeAttributes=t.config.removeFormatAttributes.split(",")),a=CKEDITOR.plugins.removeformat.filter,r=t.getSelection().getRanges(1),o=r.createIterator();e=o.getNextRange();){e.collapsed||e.enlarge(CKEDITOR.ENLARGE_ELEMENT);var s=e.createBookmark(),l=s.startNode,c=s.endNode,d=function(e){for(var n,r=t.elementPath(e),o=r.elements,s=1;(n=o[s])&&(!n.equals(r.block)&&!n.equals(r.blockLimit));s++)i.test(n.getName())&&a(t,n)&&e.breakParent(n)};if(d(l),c)for(d(c),l=l.getNextSourceNode(!0,CKEDITOR.NODE_ELEMENT);l&&!l.equals(c);)d=l.getNextSourceNode(!1,CKEDITOR.NODE_ELEMENT),"img"==l.getName()&&l.data("cke-realelement")||!a(t,l)||(i.test(l.getName())?l.remove(1):(l.removeAttributes(n),t.fire("removeFormatCleanup",l))),l=d;e.moveToBookmark(s)}t.forceNextSelectionCheck(),t.getSelection().selectRanges(r)}}},filter:function(t,e){for(var i=t._.removeFormatFilters||[],n=0;n<i.length;n++)if(i[n](e)===!1)return!1;return!0}},CKEDITOR.editor.prototype.addRemoveFormatFilter=function(t){this._.removeFormatFilters||(this._.removeFormatFilters=[]),this._.removeFormatFilters.push(t)},CKEDITOR.config.removeFormatTags="b,big,code,del,dfn,em,font,i,ins,kbd,q,s,samp,small,span,strike,strong,sub,sup,tt,u,var",CKEDITOR.config.removeFormatAttributes="class,style,lang,width,height,align,hspace,valign",function(){CKEDITOR.plugins.add("sourcearea",{init:function(e){function i(){this.hide(),this.setStyle("height",this.getParent().$.clientHeight+"px"),this.setStyle("width",this.getParent().$.clientWidth+"px"),this.show()}if(e.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE){var n=CKEDITOR.plugins.sourcearea;e.addMode("source",function(n){var a=e.ui.space("contents").getDocument().createElement("textarea");a.setStyles(CKEDITOR.tools.extend({width:CKEDITOR.env.ie7Compat?"99%":"100%",height:"100%",resize:"none",outline:"none","text-align":"left"},CKEDITOR.tools.cssVendorPrefix("tab-size",e.config.sourceAreaTabSize||4))),a.setAttribute("dir","ltr"),a.addClass("cke_source cke_reset cke_enable_context_menu"),e.ui.space("contents").append(a),a=e.editable(new t(e,a)),a.setData(e.getData(1)),CKEDITOR.env.ie&&(a.attachListener(e,"resize",i,a),a.attachListener(CKEDITOR.document.getWindow(),"resize",i,a),CKEDITOR.tools.setTimeout(i,0,a)),e.fire("ariaWidget",this),n()}),e.addCommand("source",n.commands.source),e.ui.addButton&&e.ui.addButton("Source",{label:e.lang.sourcearea.toolbar,command:"source",toolbar:"mode,10"}),e.on("mode",function(){e.getCommand("source").setState("source"==e.mode?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)})}}});var t=CKEDITOR.tools.createClass({base:CKEDITOR.editable,proto:{setData:function(t){this.setValue(t),this.editor.fire("dataReady")},getData:function(){return this.getValue()},insertHtml:function(){},insertElement:function(){},insertText:function(){},setReadOnly:function(t){this[(t?"set":"remove")+"Attribute"]("readOnly","readonly")},detach:function(){t.baseProto.detach.call(this),this.clearCustomData(),this.remove()}}})}(),CKEDITOR.plugins.sourcearea={commands:{source:{modes:{wysiwyg:1,source:1},editorFocus:!1,readOnly:1,exec:function(t){"wysiwyg"==t.mode&&t.fire("saveSnapshot"),t.getCommand("source").setState(CKEDITOR.TRISTATE_DISABLED),t.setMode("source"==t.mode?"wysiwyg":"source")},canUndo:!1}}},CKEDITOR.plugins.add("specialchar",{availableLangs:{ar:1,bg:1,ca:1,cs:1,cy:1,de:1,el:1,en:1,eo:1,es:1,et:1,fa:1,fi:1,fr:1,"fr-ca":1,gl:1,he:1,hr:1,hu:1,id:1,it:1,ja:1,km:1,ku:1,lv:1,nb:1,nl:1,no:1,pl:1,pt:1,"pt-br":1,ru:1,si:1,sk:1,sl:1,sq:1,sv:1,th:1,tr:1,ug:1,uk:1,vi:1,zh:1,"zh-cn":1},requires:"dialog",init:function(t){var e=this;CKEDITOR.dialog.add("specialchar",this.path+"dialogs/specialchar.js"),t.addCommand("specialchar",{exec:function(){var i=t.langCode,i=e.availableLangs[i]?i:e.availableLangs[i.replace(/-.*/,"")]?i.replace(/-.*/,""):"en";CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(e.path+"dialogs/lang/"+i+".js"),function(){CKEDITOR.tools.extend(t.lang.specialchar,e.langEntries[i]),t.openDialog("specialchar")})},modes:{wysiwyg:1},canUndo:!1}),t.ui.addButton&&t.ui.addButton("SpecialChar",{label:t.lang.specialchar.toolbar,command:"specialchar",toolbar:"insert,50"})}}),CKEDITOR.config.specialChars="! &quot; # $ % &amp; ' ( ) * + - . / 0 1 2 3 4 5 6 7 8 9 : ; &lt; = &gt; ? @ A B C D E F G H I J K L M N O P Q R S T U V W X Y Z [ ] ^ _ ` a b c d e f g h i j k l m n o p q r s t u v w x y z { | } ~ &euro; &lsquo; &rsquo; &ldquo; &rdquo; &ndash; &mdash; &iexcl; &cent; &pound; &curren; &yen; &brvbar; &sect; &uml; &copy; &ordf; &laquo; &not; &reg; &macr; &deg; &sup2; &sup3; &acute; &micro; &para; &middot; &cedil; &sup1; &ordm; &raquo; &frac14; &frac12; &frac34; &iquest; &Agrave; &Aacute; &Acirc; &Atilde; &Auml; &Aring; &AElig; &Ccedil; &Egrave; &Eacute; &Ecirc; &Euml; &Igrave; &Iacute; &Icirc; &Iuml; &ETH; &Ntilde; &Ograve; &Oacute; &Ocirc; &Otilde; &Ouml; &times; &Oslash; &Ugrave; &Uacute; &Ucirc; &Uuml; &Yacute; &THORN; &szlig; &agrave; &aacute; &acirc; &atilde; &auml; &aring; &aelig; &ccedil; &egrave; &eacute; &ecirc; &euml; &igrave; &iacute; &icirc; &iuml; &eth; &ntilde; &ograve; &oacute; &ocirc; &otilde; &ouml; &divide; &oslash; &ugrave; &uacute; &ucirc; &uuml; &yacute; &thorn; &yuml; &OElig; &oelig; &#372; &#374 &#373 &#375; &sbquo; &#8219; &bdquo; &hellip; &trade; &#9658; &bull; &rarr; &rArr; &hArr; &diams; &asymp;".split(" "),function(){CKEDITOR.plugins.add("stylescombo",{requires:"richcombo",init:function(t){var e=t.config,i=t.lang.stylescombo,n={},a=[],r=[];t.on("stylesSet",function(i){if(i=i.data.styles){for(var o,s,l=0,c=i.length;c>l;l++)o=i[l],t.blockless&&o.element in CKEDITOR.dtd.$block||(s=o.name,o=new CKEDITOR.style(o),(!t.filter.customConfig||t.filter.check(o))&&(o._name=s,o._.enterMode=e.enterMode,o._.weight=l+1e3*(o.type==CKEDITOR.STYLE_OBJECT?1:o.type==CKEDITOR.STYLE_BLOCK?2:3),n[s]=o,a.push(o),r.push(o)));a.sort(function(t,e){return t._.weight-e._.weight})}}),t.ui.addRichCombo("Styles",{label:i.label,title:i.panelTitle,toolbar:"styles,10",allowedContent:r,panel:{css:[CKEDITOR.skin.getPath("editor")].concat(e.contentsCss),multiSelect:!0,attributes:{"aria-label":i.panelTitle}},init:function(){var t,e,n,r,o,s;for(o=0,s=a.length;s>o;o++)t=a[o],e=t._name,r=t.type,r!=n&&(this.startGroup(i["panelTitle"+r]),n=r),this.add(e,t.type==CKEDITOR.STYLE_OBJECT?e:t.buildPreview(),e);this.commit()},onClick:function(e){t.focus(),t.fire("saveSnapshot");var e=n[e],i=t.elementPath();t[e.checkActive(i)?"removeStyle":"applyStyle"](e),t.fire("saveSnapshot")},onRender:function(){t.on("selectionChange",function(t){for(var e,i=this.getValue(),t=t.data.path.elements,a=0,r=t.length;r>a;a++){e=t[a];for(var o in n)if(n[o].checkElementRemovable(e,!0))return void(o!=i&&this.setValue(o))}this.setValue("")},this)},onOpen:function(){var e=t.getSelection().getSelectedElement(),e=t.elementPath(e),a=[0,0,0,0];this.showAll(),this.unmarkAll();for(var r in n){var o=n[r],s=o.type;o.checkApplicable(e,t.activeFilter)?a[s]++:this.hideItem(r),o.checkActive(e)&&this.mark(r)}a[CKEDITOR.STYLE_BLOCK]||this.hideGroup(i["panelTitle"+CKEDITOR.STYLE_BLOCK]),a[CKEDITOR.STYLE_INLINE]||this.hideGroup(i["panelTitle"+CKEDITOR.STYLE_INLINE]),a[CKEDITOR.STYLE_OBJECT]||this.hideGroup(i["panelTitle"+CKEDITOR.STYLE_OBJECT])},refresh:function(){var e=t.elementPath();if(e){for(var i in n)if(n[i].checkApplicable(e,t.activeFilter))return;this.setState(CKEDITOR.TRISTATE_DISABLED)}},reset:function(){n={},a=[]}})}})}(),function(){function t(t){return{editorFocus:!1,canUndo:!1,modes:{wysiwyg:1},exec:function(e){if(e.editable().hasFocus){var i,n=e.getSelection();if(i=new CKEDITOR.dom.elementPath(n.getCommonAncestor(),n.root).contains({td:1,th:1},1)){var n=e.createRange(),a=CKEDITOR.tools.tryThese(function(){var e=i.getParent().$.cells[i.$.cellIndex+(t?-1:1)];return e.parentNode.parentNode,e},function(){var e=i.getParent(),e=e.getAscendant("table").$.rows[e.$.rowIndex+(t?-1:1)];return e.cells[t?e.cells.length-1:0]});if(a||t){if(!a)return!0;a=new CKEDITOR.dom.element(a),n.moveToElementEditStart(a),(!n.checkStartOfBlock()||!n.checkEndOfBlock())&&n.selectNodeContents(a)}else{for(var r=i.getAscendant("table").$,a=i.getParent().$.cells,r=new CKEDITOR.dom.element(r.insertRow(-1),e.document),o=0,s=a.length;s>o;o++)r.append(new CKEDITOR.dom.element(a[o],e.document).clone(!1,!1)).appendBogus();n.moveToElementEditStart(r)}return n.select(!0),!0}}return!1}}}var e={editorFocus:!1,modes:{wysiwyg:1,source:1}},i={exec:function(t){t.container.focusNext(!0,t.tabIndex)}},n={exec:function(t){t.container.focusPrevious(!0,t.tabIndex)}};CKEDITOR.plugins.add("tab",{init:function(a){for(var r=a.config.enableTabKeyTools!==!1,o=a.config.tabSpaces||0,s="";o--;)s+=" ";s&&a.on("key",function(t){9==t.data.keyCode&&(a.insertHtml(s),t.cancel())}),r&&a.on("key",function(t){(9==t.data.keyCode&&a.execCommand("selectNextCell")||t.data.keyCode==CKEDITOR.SHIFT+9&&a.execCommand("selectPreviousCell"))&&t.cancel()}),a.addCommand("blur",CKEDITOR.tools.extend(i,e)),a.addCommand("blurBack",CKEDITOR.tools.extend(n,e)),a.addCommand("selectNextCell",t()),a.addCommand("selectPreviousCell",t(!0))}})}(),CKEDITOR.dom.element.prototype.focusNext=function(t,e){var i,n,a,r,o,s,l=void 0===e?this.getTabIndex():e;
if(0>=l)for(o=this.getNextSourceNode(t,CKEDITOR.NODE_ELEMENT);o;){if(o.isVisible()&&0===o.getTabIndex()){a=o;break}o=o.getNextSourceNode(!1,CKEDITOR.NODE_ELEMENT)}else for(o=this.getDocument().getBody().getFirst();o=o.getNextSourceNode(!1,CKEDITOR.NODE_ELEMENT);){if(!i)if(!n&&o.equals(this)){if(n=!0,t){if(!(o=o.getNextSourceNode(!0,CKEDITOR.NODE_ELEMENT)))break;i=1}}else n&&!this.contains(o)&&(i=1);if(o.isVisible()&&!((s=o.getTabIndex())<0)){if(i&&s==l){a=o;break}s>l&&(!a||!r||r>s)?(a=o,r=s):a||0!==s||(a=o,r=s)}}a&&a.focus()},CKEDITOR.dom.element.prototype.focusPrevious=function(t,e){for(var i,n,a,r,o=void 0===e?this.getTabIndex():e,s=0,l=this.getDocument().getBody().getLast();l=l.getPreviousSourceNode(!1,CKEDITOR.NODE_ELEMENT);){if(!i)if(!n&&l.equals(this)){if(n=!0,t){if(!(l=l.getPreviousSourceNode(!0,CKEDITOR.NODE_ELEMENT)))break;i=1}}else n&&!this.contains(l)&&(i=1);if(l.isVisible()&&!((r=l.getTabIndex())<0))if(0>=o){if(i&&0===r){a=l;break}r>s&&(a=l,s=r)}else{if(i&&r==o){a=l;break}o>r&&(!a||r>s)&&(a=l,s=r)}}a&&a.focus()},function(){function t(t){this.editor=t,this.reset()}CKEDITOR.plugins.add("undo",{init:function(e){function i(t){a.enabled&&t.data.command.canUndo!==!1&&a.save()}function n(){a.enabled=e.readOnly?!1:"wysiwyg"==e.mode,a.onChange()}var a=e.undoManager=new t(e),r=e.addCommand("undo",{exec:function(){a.undo()&&(e.selectionChange(),this.fire("afterUndo"))},startDisabled:!0,canUndo:!1}),o=e.addCommand("redo",{exec:function(){a.redo()&&(e.selectionChange(),this.fire("afterRedo"))},startDisabled:!0,canUndo:!1});e.setKeystroke([[CKEDITOR.CTRL+90,"undo"],[CKEDITOR.CTRL+89,"redo"],[CKEDITOR.CTRL+CKEDITOR.SHIFT+90,"redo"]]),a.onChange=function(){r.setState(a.undoable()?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),o.setState(a.redoable()?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)},e.on("beforeCommandExec",i),e.on("afterCommandExec",i),e.on("saveSnapshot",function(t){a.save(t.data&&t.data.contentOnly)}),e.on("contentDom",function(){e.editable().on("keydown",function(t){t=t.data.getKey(),(8==t||46==t)&&a.type(t,0)}),e.editable().on("keypress",function(t){a.type(t.data.getKey(),1)})}),e.on("beforeModeUnload",function(){"wysiwyg"==e.mode&&a.save(!0)}),e.on("mode",n),e.on("readOnly",n),e.ui.addButton&&(e.ui.addButton("Undo",{label:e.lang.undo.undo,command:"undo",toolbar:"undo,10"}),e.ui.addButton("Redo",{label:e.lang.undo.redo,command:"redo",toolbar:"undo,20"})),e.resetUndo=function(){a.reset(),e.fire("saveSnapshot")},e.on("updateSnapshot",function(){a.currentImage&&a.update()}),e.on("lockSnapshot",function(t){a.lock(t.data&&t.data.dontUpdate)}),e.on("unlockSnapshot",a.unlock,a)}}),CKEDITOR.plugins.undo={};var e=CKEDITOR.plugins.undo.Image=function(t,e){this.editor=t,t.fire("beforeUndoImage");var i=t.getSnapshot();CKEDITOR.env.ie&&i&&(i=i.replace(/\s+data-cke-expando=".*?"/g,"")),this.contents=i,e||(this.bookmarks=(i=i&&t.getSelection())&&i.createBookmarks2(!0)),t.fire("afterUndoImage")},i=/\b(?:href|src|name)="[^"]*?"/gi;e.prototype={equalsContent:function(t){var e=this.contents,t=t.contents;return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)&&(e=e.replace(i,""),t=t.replace(i,"")),e!=t?!1:!0},equalsSelection:function(t){var e=this.bookmarks,t=t.bookmarks;if(e||t){if(!e||!t||e.length!=t.length)return!1;for(var i=0;i<e.length;i++){var n=e[i],a=t[i];if(n.startOffset!=a.startOffset||n.endOffset!=a.endOffset||!CKEDITOR.tools.arrayCompare(n.start,a.start)||!CKEDITOR.tools.arrayCompare(n.end,a.end))return!1}}return!0}},t.prototype={type:function(t,i){var n=!i&&t!=this.lastKeystroke,a=this.editor;if(!this.typing||i&&!this.wasCharacter||n){var r=new e(a),o=this.snapshots.length;CKEDITOR.tools.setTimeout(function(){var t=a.getSnapshot();CKEDITOR.env.ie&&(t=t.replace(/\s+data-cke-expando=".*?"/g,"")),r.contents!=t&&o==this.snapshots.length&&(this.typing=!0,this.save(!1,r,!1)||this.snapshots.splice(this.index+1,this.snapshots.length-this.index-1),this.hasUndo=!0,this.hasRedo=!1,this.modifiersCount=this.typesCount=1,this.onChange())},0,this)}this.lastKeystroke=t,(this.wasCharacter=i)?(this.modifiersCount=0,this.typesCount++,this.typesCount>25?(this.save(!1,null,!1),this.typesCount=1):setTimeout(function(){a.fire("change")},0)):(this.typesCount=0,this.modifiersCount++,this.modifiersCount>25?(this.save(!1,null,!1),this.modifiersCount=1):setTimeout(function(){a.fire("change")},0))},reset:function(){this.lastKeystroke=0,this.snapshots=[],this.index=-1,this.limit=this.editor.config.undoStackSize||20,this.currentImage=null,this.hasRedo=this.hasUndo=!1,this.locked=null,this.resetType()},resetType:function(){this.typing=!1,delete this.lastKeystroke,this.modifiersCount=this.typesCount=0},fireChange:function(){this.hasUndo=!!this.getNextImage(!0),this.hasRedo=!!this.getNextImage(!1),this.resetType(),this.onChange()},save:function(t,i,n){if(this.locked)return!1;var a=this.snapshots;if(i||(i=new e(this.editor)),i.contents===!1)return!1;if(this.currentImage)if(i.equalsContent(this.currentImage)){if(t||i.equalsSelection(this.currentImage))return!1}else this.editor.fire("change");return a.splice(this.index+1,a.length-this.index-1),a.length==this.limit&&a.shift(),this.index=a.push(i)-1,this.currentImage=i,n!==!1&&this.fireChange(),!0},restoreImage:function(t){var e,i=this.editor;t.bookmarks&&(i.focus(),e=i.getSelection()),this.locked=1,this.editor.loadSnapshot(t.contents),t.bookmarks?e.selectBookmarks(t.bookmarks):CKEDITOR.env.ie&&(e=this.editor.document.getBody().$.createTextRange(),e.collapse(!0),e.select()),this.locked=0,this.index=t.index,this.currentImage=this.snapshots[this.index],this.update(),this.fireChange(),i.fire("change")},getNextImage:function(t){var e,i=this.snapshots,n=this.currentImage;if(n)if(t){for(e=this.index-1;e>=0;e--)if(t=i[e],!n.equalsContent(t))return t.index=e,t}else for(e=this.index+1;e<i.length;e++)if(t=i[e],!n.equalsContent(t))return t.index=e,t;return null},redoable:function(){return this.enabled&&this.hasRedo},undoable:function(){return this.enabled&&this.hasUndo},undo:function(){if(this.undoable()){this.save(!0);var t=this.getNextImage(!0);if(t)return this.restoreImage(t),!0}return!1},redo:function(){if(this.redoable()&&(this.save(!0),this.redoable())){var t=this.getNextImage(!1);if(t)return this.restoreImage(t),!0}return!1},update:function(t){if(!this.locked){t||(t=new e(this.editor));for(var i=this.index,n=this.snapshots;i>0&&this.currentImage.equalsContent(n[i-1]);)i-=1;n.splice(i,this.index-i+1,t),this.index=i,this.currentImage=t}},lock:function(t){this.locked?this.locked.level++:t?this.locked={level:1}:(t=new e(this.editor,!0),this.locked={update:this.currentImage&&this.currentImage.equalsContent(t)?t:null,level:1})},unlock:function(){if(this.locked&&!--this.locked.level){var t=this.locked.update,i=t&&new e(this.editor,!0);this.locked=null,t&&!t.equalsContent(i)&&this.update()}}}}(),function(){CKEDITOR.plugins.add("templates",{requires:"dialog",init:function(t){CKEDITOR.dialog.add("templates",CKEDITOR.getUrl(this.path+"dialogs/templates.js")),t.addCommand("templates",new CKEDITOR.dialogCommand("templates")),t.ui.addButton&&t.ui.addButton("Templates",{label:t.lang.templates.button,command:"templates",toolbar:"doctools,10"})}});var t={},e={};CKEDITOR.addTemplates=function(e,i){t[e]=i},CKEDITOR.getTemplates=function(e){return t[e]},CKEDITOR.loadTemplates=function(t,i){for(var n=[],a=0,r=t.length;r>a;a++)e[t[a]]||(n.push(t[a]),e[t[a]]=1);n.length?CKEDITOR.scriptLoader.load(n,i):setTimeout(i,0)}}(),CKEDITOR.config.templates_files=[CKEDITOR.getUrl("plugins/templates/templates/default.js")],CKEDITOR.config.templates_replaceContent=!0,CKEDITOR.plugins.add("divarea",{afterInit:function(t){t.addMode("wysiwyg",function(e){var i=CKEDITOR.dom.element.createFromHtml('<div class="cke_wysiwyg_div cke_reset" hidefocus="true"></div>');t.ui.space("contents").append(i),i=t.editable(i),i.detach=CKEDITOR.tools.override(i.detach,function(t){return function(){t.apply(this,arguments),this.remove()}}),t.setData(t.getData(1),e),t.fire("contentDom")})}}),function(){function t(t,e){var i,e=void 0===e||e;if(e)i=t.getComputedStyle("text-align");else{for(;(!t.hasAttribute||!t.hasAttribute("align")&&!t.getStyle("text-align"))&&(i=t.getParent(),i);)t=i;i=t.getStyle("text-align")||t.getAttribute("align")||""}return i&&(i=i.replace(/(?:-(?:moz|webkit)-)?(?:start|auto)/i,"")),!i&&e&&(i="rtl"==t.getComputedStyle("direction")?"right":"left"),i}function e(t,e,i){this.editor=t,this.name=e,this.value=i,this.context="p";var e=t.config.justifyClasses,n=t.config.enterMode==CKEDITOR.ENTER_P?"p":"div";if(e){switch(i){case"left":this.cssClassName=e[0];break;case"center":this.cssClassName=e[1];break;case"right":this.cssClassName=e[2];break;case"justify":this.cssClassName=e[3]}this.cssClassRegex=RegExp("(?:^|\\s+)(?:"+e.join("|")+")(?=$|\\s)"),this.requiredContent=n+"("+this.cssClassName+")"}else this.requiredContent=n+"{text-align}";this.allowedContent={"caption div h1 h2 h3 h4 h5 h6 p pre td th li":{propertiesOnly:!0,styles:this.cssClassName?null:"text-align",classes:this.cssClassName||null}},t.config.enterMode==CKEDITOR.ENTER_BR&&(this.allowedContent.div=!0)}function i(t){var e=t.editor,i=e.createRange();i.setStartBefore(t.data.node),i.setEndAfter(t.data.node);for(var n,a=new CKEDITOR.dom.walker(i);n=a.next();)if(n.type==CKEDITOR.NODE_ELEMENT)if(!n.equals(t.data.node)&&n.getDirection())i.setStartAfter(n),a=new CKEDITOR.dom.walker(i);else{var r=e.config.justifyClasses;r&&(n.hasClass(r[0])?(n.removeClass(r[0]),n.addClass(r[2])):n.hasClass(r[2])&&(n.removeClass(r[2]),n.addClass(r[0]))),r=n.getStyle("text-align"),"left"==r?n.setStyle("text-align","right"):"right"==r&&n.setStyle("text-align","left")}}e.prototype={exec:function(e){var i=e.getSelection(),n=e.config.enterMode;if(i){for(var a,r,o=i.createBookmarks(),s=i.getRanges(),l=this.cssClassName,c=e.config.useComputedState,c=void 0===c||c,d=s.length-1;d>=0;d--)for(a=s[d].createIterator(),a.enlargeBr=n!=CKEDITOR.ENTER_BR;r=a.getNextParagraph(n==CKEDITOR.ENTER_P?"p":"div");)if(!r.isReadOnly()){r.removeAttribute("align"),r.removeStyle("text-align");var h=l&&(r.$.className=CKEDITOR.tools.ltrim(r.$.className.replace(this.cssClassRegex,""))),u=this.state==CKEDITOR.TRISTATE_OFF&&(!c||t(r,!0)!=this.value);l?u?r.addClass(l):h||r.removeAttribute("class"):u&&r.setStyle("text-align",this.value)}e.focus(),e.forceNextSelectionCheck(),i.selectBookmarks(o)}},refresh:function(e,i){var n=i.block||i.blockLimit;this.setState("body"!=n.getName()&&t(n,this.editor.config.useComputedState)==this.value?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)}},CKEDITOR.plugins.add("justify",{init:function(t){if(!t.blockless){var n=new e(t,"justifyleft","left"),a=new e(t,"justifycenter","center"),r=new e(t,"justifyright","right"),o=new e(t,"justifyblock","justify");t.addCommand("justifyleft",n),t.addCommand("justifycenter",a),t.addCommand("justifyright",r),t.addCommand("justifyblock",o),t.ui.addButton&&(t.ui.addButton("JustifyLeft",{label:t.lang.justify.left,command:"justifyleft",toolbar:"align,10"}),t.ui.addButton("JustifyCenter",{label:t.lang.justify.center,command:"justifycenter",toolbar:"align,20"}),t.ui.addButton("JustifyRight",{label:t.lang.justify.right,command:"justifyright",toolbar:"align,30"}),t.ui.addButton("JustifyBlock",{label:t.lang.justify.block,command:"justifyblock",toolbar:"align,40"})),t.on("dirChanged",i)}}})}(),function(){CKEDITOR.plugins.liststyle={requires:"dialog,contextmenu",init:function(t){if(!t.blockless){var e;e=new CKEDITOR.dialogCommand("numberedListStyle",{requiredContent:"ol",allowedContent:"ol{list-style-type}[start]"}),e=t.addCommand("numberedListStyle",e),t.addFeature(e),CKEDITOR.dialog.add("numberedListStyle",this.path+"dialogs/liststyle.js"),e=new CKEDITOR.dialogCommand("bulletedListStyle",{requiredContent:"ul",allowedContent:"ul{list-style-type}"}),e=t.addCommand("bulletedListStyle",e),t.addFeature(e),CKEDITOR.dialog.add("bulletedListStyle",this.path+"dialogs/liststyle.js"),t.addMenuGroup("list",108),t.addMenuItems({numberedlist:{label:t.lang.liststyle.numberedTitle,group:"list",command:"numberedListStyle"},bulletedlist:{label:t.lang.liststyle.bulletedTitle,group:"list",command:"bulletedListStyle"}}),t.contextMenu.addListener(function(t){if(!t||t.isReadOnly())return null;for(;t;){var e=t.getName();if("ol"==e)return{numberedlist:CKEDITOR.TRISTATE_OFF};if("ul"==e)return{bulletedlist:CKEDITOR.TRISTATE_OFF};t=t.getParent()}return null})}}},CKEDITOR.plugins.add("liststyle",CKEDITOR.plugins.liststyle)}(),function(){function t(t,e){CKEDITOR.tools.extend(this,{editor:t,editable:t.editable(),doc:t.document,win:t.window},e,!0),this.frame=this.win.getFrame(),this.inline=this.editable.isInline(),this.target=this[this.inline?"editable":"doc"]}function e(t,e){CKEDITOR.tools.extend(this,e,{editor:t},!0)}function i(t,e){var i=t.editable();CKEDITOR.tools.extend(this,{editor:t,editable:i,doc:t.document,win:t.window,container:CKEDITOR.document.getBody(),winTop:CKEDITOR.document.getWindow()},e,!0),this.hidden={},this.visible={},this.inline=i.isInline(),this.inline||(this.frame=this.win.getFrame()),this.queryViewport();var n=CKEDITOR.tools.bind(this.queryViewport,this),s=CKEDITOR.tools.bind(this.hideVisible,this),l=CKEDITOR.tools.bind(this.removeAll,this);i.attachListener(this.winTop,"resize",n),i.attachListener(this.winTop,"scroll",n),i.attachListener(this.winTop,"resize",s),i.attachListener(this.win,"scroll",s),i.attachListener(this.inline?i:this.frame,"mouseout",function(t){var e=t.data.$.clientX,t=t.data.$.clientY;this.queryViewport(),(e<=this.rect.left||e>=this.rect.right||t<=this.rect.top||t>=this.rect.bottom)&&this.hideVisible(),(0>=e||e>=this.winTopPane.width||0>=t||t>=this.winTopPane.height)&&this.hideVisible()},this),i.attachListener(t,"resize",n),i.attachListener(t,"mode",l),t.on("destroy",l),this.lineTpl=new CKEDITOR.template(o).output({lineStyle:CKEDITOR.tools.writeCssText(CKEDITOR.tools.extend({},r,this.lineStyle,!0)),tipLeftStyle:CKEDITOR.tools.writeCssText(CKEDITOR.tools.extend({},a,{left:"0px","border-left-color":"red","border-width":"6px 0 6px 6px"},this.tipCss,this.tipLeftStyle,!0)),tipRightStyle:CKEDITOR.tools.writeCssText(CKEDITOR.tools.extend({},a,{right:"0px","border-right-color":"red","border-width":"6px 6px 6px 0"},this.tipCss,this.tipRightStyle,!0))})}function n(t){return t&&t.type==CKEDITOR.NODE_ELEMENT&&!(s[t.getComputedStyle("float")]||s[t.getAttribute("align")])&&!l[t.getComputedStyle("position")]}CKEDITOR.plugins.add("lineutils"),CKEDITOR.LINEUTILS_BEFORE=1,CKEDITOR.LINEUTILS_AFTER=2,CKEDITOR.LINEUTILS_INSIDE=4,t.prototype={start:function(t){var e,i,n,a=this,r=this.editor,o=this.doc,s=CKEDITOR.tools.eventsBuffer(50,function(){r.readOnly||"wysiwyg"!=r.mode||(a.relations={},e=new CKEDITOR.dom.element(o.$.elementFromPoint(i,n)),a.traverseSearch(e),isNaN(i+n)||a.pixelSearch(e,i,n),t&&t(a.relations,i,n))});this.listener=this.editable.attachListener(this.target,"mousemove",function(t){i=t.data.$.clientX,n=t.data.$.clientY,s.input()}),this.editable.attachListener(this.inline?this.editable:this.frame,"mouseout",function(){s.reset()})},stop:function(){this.listener&&this.listener.removeListener()},getRange:function(){var t={};return t[CKEDITOR.LINEUTILS_BEFORE]=CKEDITOR.POSITION_BEFORE_START,t[CKEDITOR.LINEUTILS_AFTER]=CKEDITOR.POSITION_AFTER_END,t[CKEDITOR.LINEUTILS_INSIDE]=CKEDITOR.POSITION_AFTER_START,function(e){var i=this.editor.createRange();return i.moveToPosition(this.relations[e.uid].element,t[e.type]),i}}(),store:function(){function t(t,e,i){var n=t.getUniqueId();n in i?i[n].type=i[n].type|e:i[n]={element:t,type:e}}return function(e,i){var a;i&CKEDITOR.LINEUTILS_AFTER&&n(a=e.getNext())&&a.isVisible()&&(t(a,CKEDITOR.LINEUTILS_BEFORE,this.relations),i^=CKEDITOR.LINEUTILS_AFTER),i&CKEDITOR.LINEUTILS_INSIDE&&n(a=e.getFirst())&&a.isVisible()&&(t(a,CKEDITOR.LINEUTILS_BEFORE,this.relations),i^=CKEDITOR.LINEUTILS_INSIDE),t(e,i,this.relations)}}(),traverseSearch:function(t){var e,i,a;do if(a=t.$["data-cke-expando"],!(a&&a in this.relations)){if(t.equals(this.editable))break;if(n(t))for(e in this.lookups)(i=this.lookups[e](t))&&this.store(t,i)}while((!t||t.type!=CKEDITOR.NODE_ELEMENT||"true"!=t.getAttribute("contenteditable"))&&(t=t.getParent()))},pixelSearch:function(){function t(t,i,a,r,o){for(var s,l=0;o(a)&&(a+=r,25!=++l);)if(s=this.doc.$.elementFromPoint(i,a))if(s==t)l=0;else if(e(t,s)&&(l=0,n(s=new CKEDITOR.dom.element(s))))return s}var e=CKEDITOR.env.ie||CKEDITOR.env.webkit?function(t,e){return t.contains(e)}:function(t,e){return!!(16&t.compareDocumentPosition(e))};return function(e,i,a){var r=this.win.getViewPaneSize().height,o=t.call(this,e.$,i,a,-1,function(t){return t>0}),i=t.call(this,e.$,i,a,1,function(t){return r>t});if(o)for(this.traverseSearch(o);!o.getParent().equals(e);)o=o.getParent();if(i)for(this.traverseSearch(i);!i.getParent().equals(e);)i=i.getParent();for(;(o||i)&&(o&&(o=o.getNext(n)),o&&!o.equals(i))&&(this.traverseSearch(o),i&&(i=i.getPrevious(n)),i&&!i.equals(o));)this.traverseSearch(i)}}(),greedySearch:function(){this.relations={};for(var t,e,i,a=this.editable.getElementsByTag("*"),r=0;t=a.getItem(r++);)if(!t.equals(this.editable)&&(t.hasAttribute("contenteditable")||!t.isReadOnly())&&n(t)&&t.isVisible())for(i in this.lookups)(e=this.lookups[i](t))&&this.store(t,e);return this.relations}},e.prototype={locate:function(){function t(t,e){var i=t.element[e===CKEDITOR.LINEUTILS_BEFORE?"getPrevious":"getNext"]();return i&&n(i)?(t.siblingRect=i.getClientRect(),e==CKEDITOR.LINEUTILS_BEFORE?(t.siblingRect.bottom+t.elementRect.top)/2:(t.elementRect.bottom+t.siblingRect.top)/2):e==CKEDITOR.LINEUTILS_BEFORE?t.elementRect.top:t.elementRect.bottom}var e,i;return function(n){this.locations={};for(i in n)e=n[i],e.elementRect=e.element.getClientRect(),e.type&CKEDITOR.LINEUTILS_BEFORE&&this.store(i,CKEDITOR.LINEUTILS_BEFORE,t(e,CKEDITOR.LINEUTILS_BEFORE)),e.type&CKEDITOR.LINEUTILS_AFTER&&this.store(i,CKEDITOR.LINEUTILS_AFTER,t(e,CKEDITOR.LINEUTILS_AFTER)),e.type&CKEDITOR.LINEUTILS_INSIDE&&this.store(i,CKEDITOR.LINEUTILS_INSIDE,(e.elementRect.top+e.elementRect.bottom)/2);return this.locations}}(),sort:function(){var t,e,i,n,a,r;return function(o,s){t=this.locations,e=[];for(n in t)for(a in t[n])if(i=Math.abs(o-t[n][a]),e.length){for(r=0;r<e.length;r++)if(i<e[r].dist){e.splice(r,0,{uid:+n,type:a,dist:i});break}r==e.length&&e.push({uid:+n,type:a,dist:i})}else e.push({uid:+n,type:a,dist:i});return"undefined"!=typeof s?e.slice(0,s):e}}(),store:function(t,e,i){this.locations[t]||(this.locations[t]={}),this.locations[t][e]=i}};var a={display:"block",width:"0px",height:"0px","border-color":"transparent","border-style":"solid",position:"absolute",top:"-6px"},r={height:"0px","border-top":"1px dashed red",position:"absolute","z-index":9999},o='<div data-cke-lineutils-line="1" class="cke_reset_all" style="{lineStyle}"><span style="{tipLeftStyle}">&nbsp;</span><span style="{tipRightStyle}">&nbsp;</span></div>';i.prototype={removeAll:function(){for(var t in this.hidden)this.hidden[t].remove(),delete this.hidden[t];for(t in this.visible)this.visible[t].remove(),delete this.visible[t]},hideLine:function(t){var e=t.getUniqueId();t.hide(),this.hidden[e]=t,delete this.visible[e]},showLine:function(t){var e=t.getUniqueId();t.show(),this.visible[e]=t,delete this.hidden[e]},hideVisible:function(){for(var t in this.visible)this.hideLine(this.visible[t])},placeLine:function(t,e){var i,n,a;if(i=this.getStyle(t.uid,t.type)){for(a in this.visible)if(this.visible[a].getCustomData("hash")!==this.hash){n=this.visible[a];break}if(!n)for(a in this.hidden)if(this.hidden[a].getCustomData("hash")!==this.hash){this.showLine(n=this.hidden[a]);break}n||this.showLine(n=this.addLine()),n.setCustomData("hash",this.hash),this.visible[n.getUniqueId()]=n,n.setStyles(i),e&&e(n)}},getStyle:function(t,e){var i=this.relations[t],n=this.locations[t][e],a={};if(a.width=i.siblingRect?Math.max(i.siblingRect.width,i.elementRect.width):i.elementRect.width,a.top=this.inline?n+this.winTopScroll.y:this.rect.top+this.winTopScroll.y+n,a.top-this.winTopScroll.y<this.rect.top||a.top-this.winTopScroll.y>this.rect.bottom)return!1;this.inline?a.left=i.elementRect.left:(i.elementRect.left>0?a.left=this.rect.left+i.elementRect.left:(a.width=a.width+i.elementRect.left,a.left=this.rect.left),(i=a.left+a.width-(this.rect.left+this.winPane.width))>0&&(a.width=a.width-i)),a.left=a.left+this.winTopScroll.x;for(var r in a)a[r]=CKEDITOR.tools.cssLength(a[r]);return a},addLine:function(){var t=CKEDITOR.dom.element.createFromHtml(this.lineTpl);return t.appendTo(this.container),t},prepare:function(t,e){this.relations=t,this.locations=e,this.hash=Math.random()},cleanup:function(){var t,e;for(e in this.visible)t=this.visible[e],t.getCustomData("hash")!==this.hash&&this.hideLine(t)},queryViewport:function(){this.winPane=this.win.getViewPaneSize(),this.winTopScroll=this.winTop.getScrollPosition(),this.winTopPane=this.winTop.getViewPaneSize(),this.rect=this.inline?this.editable.getClientRect():this.frame.getClientRect()}};var s={left:1,right:1,center:1},l={absolute:1,fixed:1};CKEDITOR.plugins.lineutils={finder:t,locator:e,liner:i}}(),function(){function t(t){this.editor=t,this.registered={},this.instances={},this.selected=[],this.widgetHoldingFocusedEditable=this.focused=null,this._={nextId:0,upcasts:[],upcastCallbacks:[],filters:{}},_(this),O(this),this.on("checkWidgets",r),this.editor.on("contentDomInvalidated",this.checkWidgets,this),w(this),y(this),T(this),E(this),R(this)}function e(t,i,n,a,r){var o=t.editor;CKEDITOR.tools.extend(this,a,{editor:o,id:i,inline:"span"==n.getParent().getName(),element:n,data:CKEDITOR.tools.extend({},"function"==typeof a.defaults?a.defaults():a.defaults),dataReady:!1,inited:!1,ready:!1,edit:e.prototype.edit,focusedEditable:null,definition:a,repository:t,draggable:a.draggable!==!1,_:{downcastFn:a.downcast&&"string"==typeof a.downcast?a.downcasts[a.downcast]:a.downcast}},!0),t.fire("instanceCreated",this),P(this,a),this.init&&this.init(),this.inited=!0,(t=this.element.data("cke-widget-data"))&&this.setData(JSON.parse(t)),r&&this.setData(r),this.dataReady=!0,B(this),this.fire("data",this.data),this.isInited()&&o.editable().contains(this.wrapper)&&(this.ready=!0,this.fire("ready"))}function i(t,e,i){CKEDITOR.dom.element.call(this,e.$),this.editor=t,e=this.filter=i.filter,CKEDITOR.dtd[this.getName()].p?(this.enterMode=e?e.getAllowedEnterMode(t.enterMode):t.enterMode,this.shiftEnterMode=e?e.getAllowedEnterMode(t.shiftEnterMode,!0):t.shiftEnterMode):this.enterMode=this.shiftEnterMode=CKEDITOR.ENTER_BR}function n(t,e){t.addCommand(e.name,{exec:function(){function i(){t.widgets.finalizeCreation(o)}var n=t.widgets.focused;if(n&&n.name==e.name)n.edit();else if(e.insert)e.insert();else if(e.template){var a,n="function"==typeof e.defaults?e.defaults():e.defaults,n=CKEDITOR.dom.element.createFromHtml(e.template.output(n)),r=t.widgets.wrapElement(n,e.name),o=new CKEDITOR.dom.documentFragment(r.getDocument());o.append(r),(a=t.widgets.initOn(n,e))?(n=a.once("edit",function(e){e.data.dialog?a.once("dialog",function(e){var n,r,e=e.data;n=e.once("ok",i,null,null,20),r=e.once("cancel",function(){t.widgets.destroy(a,!0)}),e.once("hide",function(){n.removeListener(),r.removeListener()})}):i()},null,null,999),a.edit(),n.removeListener()):i()}},refresh:function(t,e){this.setState(l(t.editable(),e.blockLimit)?CKEDITOR.TRISTATE_DISABLED:CKEDITOR.TRISTATE_OFF)},context:"div",allowedContent:e.allowedContent,requiredContent:e.requiredContent,contentForms:e.contentForms,contentTransformations:e.contentTransformations})}function a(t,e){t.focused=null,e.isInited()&&(t.fire("widgetBlurred",{widget:e}),e.setFocused(!1))}function r(t){if(t=t.data,"wysiwyg"==this.editor.mode){var e,i,n=this.editor.editable(),a=this.instances;if(n){for(e in a)n.contains(a[e].wrapper)||this.destroy(a[e],!0);if(t&&t.initOnlyNew)n=this.initOnAll();else{var r=n.find(".cke_widget_wrapper"),n=[];for(e=0,a=r.count();a>e;e++){i=r.getItem(e);var o;if(o=!this.getByElement(i,!0)){t:{o=g;for(var s=i;s=s.getParent();)if(o(s)){o=!0;break t}o=!1}o=!o}o&&(i.addClass("cke_widget_new"),n.push(this.initOn(i.getFirst(u))))}}t&&t.focusInited&&1==n.length&&n[0].focus()}}}function o(t,e,i){if(!i.allowedContent)return null;var n=this._.filters[t];return n||(this._.filters[t]=n={}),(t=n[e])||(n[e]=t=new CKEDITOR.filter(i.allowedContent)),t}function s(t){var e=[],i=t._.upcasts,n=t._.upcastCallbacks;return{toBeWrapped:e,iterator:function(t){var a,r,o,s,l;if("data-cke-widget-wrapper"in t.attributes)return(t=t.getFirst(h))&&e.push([t]),!1;if("data-widget"in t.attributes)return e.push([t]),!1;if(l=i.length){if(t.attributes["data-cke-widget-upcasted"])return!1;for(s=0,a=n.length;a>s;++s)if(n[s](t)===!1)return;for(s=0;l>s;++s)if(a=i[s],o={},r=a[0](t,o))return r instanceof CKEDITOR.htmlParser.element&&(t=r),t.attributes["data-cke-widget-data"]=JSON.stringify(o),t.attributes["data-cke-widget-upcasted"]=1,e.push([t,a[1]]),!1}}}}function l(t,e){return!e||e.equals(t)?null:m(e)?e:l(t,e.getParent())}function c(t){return{tabindex:-1,contenteditable:"false","data-cke-widget-wrapper":1,"data-cke-filter":"off","class":"cke_widget_wrapper cke_widget_new cke_widget_"+(t?"inline":"block")}}function d(t,e,i){if(t.type==CKEDITOR.NODE_ELEMENT){var n=CKEDITOR.dtd[t.name];if(n&&!n[i.name]){var n=t.split(e),a=t.parent,e=n.getIndex();return t.children.length||(e-=1,t.remove()),n.children.length||n.remove(),d(a,e,i)}}t.add(i,e)}function h(t){return t.type==CKEDITOR.NODE_ELEMENT&&!!t.attributes["data-widget"]}function u(t){return t.type==CKEDITOR.NODE_ELEMENT&&t.hasAttribute("data-widget")}function p(t,e){return"boolean"==typeof t.inline?t.inline:!!CKEDITOR.dtd.$inline[e]}function f(t){return t.type==CKEDITOR.NODE_ELEMENT&&t.hasAttribute("data-cke-widget-wrapper")}function m(t){return t.type==CKEDITOR.NODE_ELEMENT&&t.hasAttribute("data-cke-widget-editable")}function g(t){return t.hasAttribute("data-cke-temp")}function v(t,e,i){e.focus(),t.fire("saveSnapshot"),t.fire("lockSnapshot",{dontUpdate:!0}),i.select(),i=e.wrapper.getOuterHtml(),e.wrapper.remove(),t.widgets.destroy(e,!0),t.execCommand("paste",i),t.fire("unlockSnapshot")}function C(t,e,i,n){var a=t.editor;a.fire("lockSnapshot"),i?(n=i.data("cke-widget-editable"),n=e.editables[n],t.widgetHoldingFocusedEditable=e,e.focusedEditable=n,i.addClass("cke_widget_editable_focused"),n.filter&&a.setActiveFilter(n.filter),a.setActiveEnterMode(n.enterMode,n.shiftEnterMode)):(n||e.focusedEditable.removeClass("cke_widget_editable_focused"),e.focusedEditable=null,t.widgetHoldingFocusedEditable=null,a.setActiveFilter(null),a.setActiveEnterMode(null,null)),a.fire("unlockSnapshot")}function I(t){t.contextMenu&&t.contextMenu.addListener(function(e){return(e=t.widgets.getByElement(e,!0))?e.fire("contextMenu",{}):void 0})}function b(t,e){return CKEDITOR.tools.trim(e)}function E(t){var e=t.editor,i=CKEDITOR.plugins.lineutils;e.on("contentDom",function(){var n=e.editable(),a=CKEDITOR.env.ie&&CKEDITOR.env.version<9||n.isInline()?n:e.document;n.attachListener(a,"drop",function(i){var n,a,r=i.data.$.dataTransfer.getData("text");if(r){try{n=JSON.parse(r)}catch(o){return}if("cke-widget"==n.type&&(i.data.preventDefault(),n.editor==e.name&&(a=t.instances[n.id]))){t:if(n=i.data.$,r=e.createRange(),i.data.testRange)r=i.data.testRange;else if(document.caretRangeFromPoint)i=e.document.$.caretRangeFromPoint(n.clientX,n.clientY),r.setStart(CKEDITOR.dom.node(i.startContainer),i.startOffset),r.collapse(!0);else if(n.rangeParent)r.setStart(CKEDITOR.dom.node(n.rangeParent),n.rangeOffset),r.collapse(!0);else{if(!document.body.createTextRange){r=null;break t}i=e.document.getBody().$.createTextRange(),i.moveToPoint(n.clientX,n.clientY),n="cke-temp-"+(new Date).getTime(),i.pasteHTML('<span id="'+n+'">​</span>'),i=e.document.getById(n),r.moveToPosition(i,CKEDITOR.POSITION_BEFORE_START),i.remove()}r&&(CKEDITOR.env.gecko?setTimeout(v,0,e,a,r):v(e,a,r))}}}),CKEDITOR.tools.extend(t,{finder:new i.finder(e,{lookups:{"default":function(t){if(!t.is(CKEDITOR.dtd.$listItem)&&t.is(CKEDITOR.dtd.$block)){for(;t;){if(m(t))return;t=t.getParent()}return CKEDITOR.LINEUTILS_BEFORE|CKEDITOR.LINEUTILS_AFTER}}}}),locator:new i.locator(e),liner:new i.liner(e,{lineStyle:{cursor:"move !important","border-top-color":"#666"},tipLeftStyle:{"border-left-color":"#666"},tipRightStyle:{"border-right-color":"#666"}})},!0)})}function y(t){var e=t.editor;e.on("contentDom",function(){var i,n,a=e.editable(),r=a.isInline()?a:e.document;a.attachListener(r,"mousedown",function(e){var a=e.data.getTarget();return a.type?(i=t.getByElement(a),n=0,void(i&&(i.inline&&a.type==CKEDITOR.NODE_ELEMENT&&a.hasAttribute("data-cke-widget-drag-handler")?n=1:l(i.wrapper,a)?i=null:(e.data.preventDefault(),CKEDITOR.env.ie||i.focus())))):!1}),a.attachListener(r,"mouseup",function(){i&&n&&(n=0,i.focus())}),CKEDITOR.env.ie&&a.attachListener(r,"mouseup",function(){i&&setTimeout(function(){i.focus(),i=null})})}),e.on("doubleclick",function(e){var i=t.getByElement(e.data.element);return i&&!l(i.wrapper,e.data.element)?i.fire("doubleclick",{element:e.data.element}):void 0},null,null,1)}function T(t){t.editor.on("key",function(e){var i,n=t.focused,a=t.widgetHoldingFocusedEditable;return n?i=n.fire("key",{keyCode:e.data.keyCode}):a&&(n=e.data.keyCode,e=a.focusedEditable,n==CKEDITOR.CTRL+65?(n=e.getBogus(),a=a.editor.createRange(),a.selectNodeContents(e),n&&a.setEndAt(n,CKEDITOR.POSITION_BEFORE_START),a.select(),i=!1):8==n||46==n?(i=a.editor.getSelection().getRanges(),a=i[0],i=!(1==i.length&&a.collapsed&&a.checkBoundaryOfElement(e,CKEDITOR[8==n?"START":"END"]))):i=void 0),i},null,null,1)}function R(t){function e(e){t.focused&&k(t.focused,"cut"==e.name)}var i=t.editor;i.on("contentDom",function(){var t=i.editable();t.attachListener(t,"copy",e),t.attachListener(t,"cut",e)})}function w(t){var e=t.editor;e.on("selectionCheck",function(){t.fire("checkSelection")}),t.on("checkSelection",t.checkSelection,t),e.on("selectionChange",function(i){var n=(i=l(e.editable(),i.data.selection.getStartElement()))&&t.getByElement(i),a=t.widgetHoldingFocusedEditable;a?a===n&&a.focusedEditable.equals(i)||(C(t,a,null),n&&i&&C(t,n,i)):n&&i&&C(t,n,i)}),e.on("dataReady",function(){D(t).commit()}),e.on("blur",function(){var e;(e=t.focused)&&a(t,e),(e=t.widgetHoldingFocusedEditable)&&C(t,e,null)})}function O(t){var e=t.editor,i={};e.on("toDataFormat",function(e){var n=CKEDITOR.tools.getNextNumber(),a=[];e.data.downcastingSessionId=n,i[n]=a,e.data.dataValue.forEach(function(e){var i,n=e.attributes;if("data-cke-widget-id"in n)(n=t.instances[n["data-cke-widget-id"]])&&(i=e.getFirst(h),a.push({wrapper:e,element:i,widget:n,editables:{}}),"1"!=i.attributes["data-cke-widget-keep-attr"]&&delete i.attributes["data-widget"]);else if("data-cke-widget-editable"in n)return a[a.length-1].editables[n["data-cke-widget-editable"]]=e,!1},CKEDITOR.NODE_ELEMENT,!0)},null,null,8),e.on("toDataFormat",function(t){if(t.data.downcastingSessionId)for(var e,n,a,r,o,s,t=i[t.data.downcastingSessionId];e=t.shift();){n=e.widget,a=e.element,r=n._.downcastFn&&n._.downcastFn.call(n,a);for(s in e.editables)o=e.editables[s],delete o.attributes.contenteditable,o.setHtml(n.editables[s].getData());r||(r=a),e.wrapper.replaceWith(r)}},null,null,13),e.on("contentDomUnload",function(){t.destroyAll(!0)})}function _(t){function e(){a.fire("lockSnapshot"),t.checkWidgets({initOnlyNew:!0,focusInited:i}),a.fire("unlockSnapshot")}var i,n,a=t.editor;a.on("toHtml",function(e){var n,a=s(t);for(e.data.dataValue.forEach(a.iterator,CKEDITOR.NODE_ELEMENT,!0);n=a.toBeWrapped.pop();){var r=n[0],o=r.parent;o.type==CKEDITOR.NODE_ELEMENT&&o.attributes["data-cke-widget-wrapper"]&&o.replaceWith(r),t.wrapElement(n[0],n[1])}i=1==e.data.dataValue.children.length&&e.data.dataValue.children[0].type==CKEDITOR.NODE_ELEMENT&&e.data.dataValue.children[0].attributes["data-cke-widget-wrapper"]},null,null,8),a.on("dataReady",function(){if(n)for(var e,i,r=t,o=a.editable().find(".cke_widget_wrapper"),s=0,l=o.count();l>s;++s)e=o.getItem(s),i=e.getFirst(u),i.type==CKEDITOR.NODE_ELEMENT&&i.data("widget")?(i.replace(e),r.wrapElement(i)):e.remove();
n=0,t.destroyAll(!0),t.initOnAll()}),a.on("loadSnapshot",function(e){/data-cke-widget/.test(e.data)&&(n=1),t.destroyAll(!0)},null,null,9),a.on("paste",function(t){t.data.dataValue=t.data.dataValue.replace(F,b)}),a.on("insertText",e,null,null,999),a.on("insertHtml",e,null,null,999)}function D(t){var e=t.selected,i=[],n=e.slice(0),r=null;return{select:function(t){return CKEDITOR.tools.indexOf(e,t)<0&&i.push(t),t=CKEDITOR.tools.indexOf(n,t),t>=0&&n.splice(t,1),this},focus:function(t){return r=t,this},commit:function(){var o,s=t.focused!==r;for(t.editor.fire("lockSnapshot"),s&&(o=t.focused)&&a(t,o);o=n.pop();)e.splice(CKEDITOR.tools.indexOf(e,o),1),o.isInited()&&o.setSelected(!1);for(s&&r&&(t.focused=r,t.fire("widgetFocused",{widget:r}),r.setFocused(!0));o=i.pop();)e.push(o),o.setSelected(!0);t.editor.fire("unlockSnapshot")}}}function x(t){t.cancel()}function k(t,e){var i=t.editor,n=i.document;if(!n.getById("cke_copybin")){var a=i.blockless||CKEDITOR.env.ie?"span":"div",r=n.createElement(a),o=n.createElement(a),a=CKEDITOR.env.ie&&CKEDITOR.env.version<9;o.setAttributes({id:"cke_copybin","data-cke-temp":"1"}),r.setStyles({position:"absolute",width:"1px",height:"1px",overflow:"hidden"}),r.setStyle("ltr"==i.config.contentsLangDirection?"left":"right","-5000px"),r.setHtml('<span data-cke-copybin-start="1">​</span>'+t.wrapper.getOuterHtml()+'<span data-cke-copybin-end="1">​</span>'),i.fire("saveSnapshot"),i.fire("lockSnapshot"),o.append(r),i.editable().append(o);var s=i.on("selectionChange",x,null,null,0),l=t.repository.on("checkSelection",x,null,null,0);if(a)var c=n.getDocumentElement().$,d=c.scrollTop;n=i.createRange(),n.selectNodeContents(r),n.select(),a&&(c.scrollTop=d),setTimeout(function(){e||t.focus(),o.remove(),s.removeListener(),l.removeListener(),i.fire("unlockSnapshot"),e&&(t.repository.del(t),i.fire("saveSnapshot"))},100)}}function K(){var t=CKEDITOR.document.getActive(),e=this.editor,i=e.editable();(i.isInline()?i:e.document.getWindow().getFrame()).equals(t)&&e.focusManager.focus(i)}function q(){CKEDITOR.env.gecko&&this.editor.unlockSelection(),CKEDITOR.env.webkit||(this.editor.forceNextSelectionCheck(),this.editor.selectionChange(1))}function S(t){if(t.draggable){var e,i=t.editor,n=t.wrapper.findOne(".cke_widget_drag_handler_container");n?e=n.findOne("img"):(n=new CKEDITOR.dom.element("span",i.document),n.setAttributes({"class":"cke_reset cke_widget_drag_handler_container",style:"background:rgba(220,220,220,0.5);background-image:url("+i.plugins.widget.path+"images/handle.png)"}),e=new CKEDITOR.dom.element("img",i.document),e.setAttributes({"class":"cke_reset cke_widget_drag_handler","data-cke-widget-drag-handler":"1",src:H,width:$,title:i.lang.widget.move,height:$}),t.inline&&e.setAttribute("draggable","true"),n.append(e),t.wrapper.append(n)),t.wrapper.on("mouseenter",t.updateDragHandlerPosition,t),setTimeout(function(){t.on("data",t.updateDragHandlerPosition,t)},50),t.inline?e.on("dragstart",function(e){e.data.$.dataTransfer.setData("text",JSON.stringify({type:"cke-widget",editor:i.name,id:t.id}))}):e.on("mousedown",N,t),t.dragHandlerContainer=n}}function N(){function t(){var t;for(h.reset();t=l.pop();)t.removeListener();var e=c,i=this.repository.finder;t=this.repository.liner;var n=this.editor,a=this.editor.editable();CKEDITOR.tools.isEmpty(t.visible)||(e=i.getRange(e[0]),this.focus(),n.fire("saveSnapshot"),n.fire("lockSnapshot",{dontUpdate:1}),n.getSelection().reset(),a.insertElementIntoRange(this.wrapper,e),this.focus(),n.fire("unlockSnapshot"),n.fire("saveSnapshot")),a.removeClass("cke_widget_dragging"),t.hideVisible()}var e,i,n=this.repository.finder,a=this.repository.locator,r=this.repository.liner,o=this.editor,s=o.editable(),l=[],c=[],d=n.greedySearch(),h=CKEDITOR.tools.eventsBuffer(50,function(){e=a.locate(d),c=a.sort(i,1),c.length&&(r.prepare(d,e),r.placeLine(c[0]),r.cleanup())});s.addClass("cke_widget_dragging"),l.push(s.on("mousemove",function(t){i=t.data.$.clientY,h.input()})),l.push(o.document.once("mouseup",t,this)),l.push(CKEDITOR.document.once("mouseup",t,this))}function A(t){var e,i,n=t.editables;if(t.editables={},t.editables)for(e in n)i=n[e],t.initEditable(e,"string"==typeof i?{selector:i}:i)}function Q(t){if(t.mask){var e=t.wrapper.findOne(".cke_widget_mask");e||(e=new CKEDITOR.dom.element("img",t.editor.document),e.setAttributes({src:H,"class":"cke_reset cke_widget_mask"}),t.wrapper.append(e)),t.mask=e}}function M(t){if(t.parts){var e,i,n={};for(i in t.parts)e=t.wrapper.findOne(t.parts[i]),n[i]=e;t.parts=n}}function P(t,e){L(t),M(t),A(t),Q(t),S(t),CKEDITOR.env.ie&&CKEDITOR.env.version<9&&t.wrapper.on("dragstart",function(e){var i=e.data.getTarget();!(l(t,i)||t.inline&&i.type==CKEDITOR.NODE_ELEMENT&&i.hasAttribute("data-cke-widget-drag-handler")||!e.data.preventDefault())}),t.wrapper.removeClass("cke_widget_new"),t.element.addClass("cke_widget_element"),t.on("key",function(e){if(e=e.data.keyCode,13==e)t.edit();else{if(e==CKEDITOR.CTRL+67||e==CKEDITOR.CTRL+88)return void k(t,e==CKEDITOR.CTRL+88);if(e in j||CKEDITOR.CTRL&e||CKEDITOR.ALT&e)return}return!1},null,null,999),t.on("doubleclick",function(){t.edit()}),e.data&&t.on("data",e.data),e.edit&&t.on("edit",e.edit)}function L(t){(t.wrapper=t.element.getParent()).setAttribute("data-cke-widget-id",t.id)}function B(t){t.element.data("cke-widget-data",JSON.stringify(t.data))}var $=15;CKEDITOR.plugins.add("widget",{requires:"lineutils,clipboard",onLoad:function(){CKEDITOR.addCss(".cke_widget_wrapper{position:relative;outline:none}.cke_widget_inline{display:inline-block}.cke_widget_wrapper:hover>.cke_widget_element{outline:2px solid yellow;cursor:default}.cke_widget_wrapper:hover .cke_widget_editable{outline:2px solid yellow}.cke_widget_wrapper.cke_widget_focused>.cke_widget_element,.cke_widget_wrapper .cke_widget_editable.cke_widget_editable_focused{outline:2px solid #ace}.cke_widget_editable{cursor:text}.cke_widget_drag_handler_container{position:absolute;width:"+$+"px;height:0;left:-9999px;opacity:0.75;transition:height 0s 0.2s;line-height:0}.cke_widget_wrapper:hover>.cke_widget_drag_handler_container{height:"+$+"px;transition:none}.cke_widget_drag_handler_container:hover{opacity:1}img.cke_widget_drag_handler{cursor:move;width:"+$+"px;height:"+$+"px;display:inline-block}.cke_widget_mask{position:absolute;top:0;left:0;width:100%;height:100%;display:block}.cke_editable.cke_widget_dragging, .cke_editable.cke_widget_dragging *{cursor:move !important}")},beforeInit:function(e){e.widgets=new t(e)},afterInit:function(t){var e,i,n,a=t.widgets.registered;for(i in a)e=a[i],(n=e.button)&&t.ui.addButton&&t.ui.addButton(CKEDITOR.tools.capitalize(e.name,!0),{label:n,command:e.name,toolbar:"insert,10"});I(t)}}),t.prototype={MIN_SELECTION_CHECK_INTERVAL:500,add:function(t,e){e=CKEDITOR.tools.prototypedCopy(e),e.name=t,e._=e._||{},this.editor.fire("widgetDefinition",e),e.template&&(e.template=new CKEDITOR.template(e.template)),n(this.editor,e);var i=e,a=i.upcast;if(a)if("string"==typeof a)for(a=a.split(",");a.length;)this._.upcasts.push([i.upcasts[a.pop()],i.name]);else this._.upcasts.push([a,i.name]);return e.button||this.editor.addFeature(e),this.registered[t]=e},addUpcastCallback:function(t){this._.upcastCallbacks.push(t)},checkSelection:function(){var t,e=this.editor.getSelection(),i=e.getSelectedElement(),n=D(this);if(i&&(t=this.getByElement(i,!0)))return n.focus(t).select(t).commit();if(e=e.getRanges()[0],!e||e.collapsed)return n.commit();for(e=new CKEDITOR.dom.walker(e),e.evaluator=f;i=e.next();)n.select(this.getByElement(i));n.commit()},checkWidgets:function(t){this.fire("checkWidgets",CKEDITOR.tools.copy(t||{}))},del:function(t){if(this.focused===t){var e,i=t.editor,n=i.createRange();(e=n.moveToClosestEditablePosition(t.wrapper,!0))||(e=n.moveToClosestEditablePosition(t.wrapper,!1)),e&&i.getSelection().selectRanges([n])}t.wrapper.remove(),this.destroy(t,!0)},destroy:function(t,e){this.widgetHoldingFocusedEditable===t&&C(this,t,null,e),t.destroy(e),delete this.instances[t.id],this.fire("instanceDestroyed",t)},destroyAll:function(t){var e,i,n=this.instances;for(i in n)e=n[i],this.destroy(e,t)},finalizeCreation:function(t){(t=t.getFirst())&&f(t)&&(this.editor.insertElement(t),t=this.getByElement(t),t.ready=!0,t.fire("ready"),t.focus())},getByElement:function(t,e){if(!t)return null;var i,n;for(n in this.instances)if(i=this.instances[n].wrapper,i.equals(t)||!e&&i.contains(t))return this.instances[n];return null},initOn:function(t,i,n){if(i?"string"==typeof i&&(i=this.registered[i]):i=this.registered[t.data("widget")],!i)return null;var a=this.wrapElement(t,i.name);return a?a.hasClass("cke_widget_new")?(t=new e(this,this._.nextId++,t,i,n),t.isInited()?this.instances[t.id]=t:null):this.getByElement(t):null},initOnAll:function(t){for(var e,t=(t||this.editor.editable()).find(".cke_widget_new"),i=[],n=t.count();n--;)(e=this.initOn(t.getItem(n).getFirst(u)))&&i.push(e);return i},wrapElement:function(t,e){var i,n,a=null;if(t instanceof CKEDITOR.dom.element){if(i=this.registered[e||t.data("widget")],!i)return null;if((a=t.getParent())&&a.type==CKEDITOR.NODE_ELEMENT&&a.data("cke-widget-wrapper"))return a;t.hasAttribute("data-cke-widget-keep-attr")||t.data("cke-widget-keep-attr",t.data("widget")?1:0),e&&t.data("widget",e),n=p(i,t.getName()),a=new CKEDITOR.dom.element(n?"span":"div"),a.setAttributes(c(n)),a.data("cke-display-name",i.pathName?i.pathName:t.getName()),t.getParent(!0)&&a.replace(t),t.appendTo(a)}else if(t instanceof CKEDITOR.htmlParser.element){if(i=this.registered[e||t.attributes["data-widget"]],!i)return null;if((a=t.parent)&&a.type==CKEDITOR.NODE_ELEMENT&&a.attributes["data-cke-widget-wrapper"])return a;"data-cke-widget-keep-attr"in t.attributes||(t.attributes["data-cke-widget-keep-attr"]=t.attributes["data-widget"]?1:0),e&&(t.attributes["data-widget"]=e),n=p(i,t.name),a=new CKEDITOR.htmlParser.element(n?"span":"div",c(n)),a.attributes["data-cke-display-name"]=i.pathName?i.pathName:t.name,i=t.parent;var r;i&&(r=t.getIndex(),t.remove()),a.add(t),i&&d(i,r,a)}return a},_tests_getNestedEditable:l,_tests_createEditableFilter:o},CKEDITOR.event.implementOn(t.prototype),e.prototype={destroy:function(t){if(this.fire("destroy"),this.editables)for(var e in this.editables)this.destroyEditable(e,t);t||("0"==this.element.data("cke-widget-keep-attr")&&this.element.removeAttribute("data-widget"),this.element.removeAttributes(["data-cke-widget-data","data-cke-widget-keep-attr"]),this.element.removeClass("cke_widget_element"),this.element.replace(this.wrapper)),this.wrapper=null},destroyEditable:function(t,e){var i=this.editables[t];i.removeListener("focus",q),i.removeListener("blur",K),this.editor.focusManager.remove(i),e||(i.removeClass("cke_widget_editable"),i.removeClass("cke_widget_editable_focused"),i.removeAttributes(["contenteditable","data-cke-widget-editable","data-cke-enter-mode"])),delete this.editables[t]},edit:function(){var t={dialog:this.dialog},e=this;this.fire("edit",t)!==!1&&t.dialog&&this.editor.openDialog(t.dialog,function(t){var i,n;e.fire("dialog",t)!==!1&&(i=t.on("show",function(){t.setupContent(e)}),n=t.on("ok",function(){var i,n=e.on("data",function(t){i=1,t.cancel()},null,null,0);e.editor.fire("saveSnapshot"),t.commitContent(e),n.removeListener(),i&&(e.fire("data",e.data),e.editor.fire("saveSnapshot"))}),t.once("hide",function(){i.removeListener(),n.removeListener()}))})},initEditable:function(t,e){var n=this.wrapper.findOne(e.selector);return n&&n.is(CKEDITOR.dtd.$editable)?(n=new i(this.editor,n,{filter:o.call(this.repository,this.name,t,e)}),this.editables[t]=n,n.setAttributes({contenteditable:"true","data-cke-widget-editable":t,"data-cke-enter-mode":n.enterMode}),n.filter&&n.data("cke-filter",n.filter.id),n.addClass("cke_widget_editable"),n.removeClass("cke_widget_editable_focused"),e.pathName&&n.data("cke-display-name",e.pathName),this.editor.focusManager.add(n),n.on("focus",q,this),CKEDITOR.env.ie&&n.on("blur",K,this),n.setData(n.getHtml()),!0):!1},isInited:function(){return!(!this.wrapper||!this.inited)},isReady:function(){return this.isInited()&&this.ready},focus:function(){var t=this.editor.getSelection();t&&t.fake(this.wrapper),this.editor.focus()},setData:function(t,e){var i=this.data,n=0;if("string"==typeof t)i[t]!==e&&(i[t]=e,n=1);else{var a=t;for(t in a)i[t]!==a[t]&&(n=1,i[t]=a[t])}return n&&this.dataReady&&(B(this),this.fire("data",i)),this},setFocused:function(t){return this.wrapper[t?"addClass":"removeClass"]("cke_widget_focused"),this.fire(t?"focus":"blur"),this},setSelected:function(t){return this.wrapper[t?"addClass":"removeClass"]("cke_widget_selected"),this.fire(t?"select":"deselect"),this},updateDragHandlerPosition:function(){var t=this.editor,e=this.element.$,i=this._.dragHandlerOffset,e={x:e.offsetLeft,y:e.offsetTop-$};i&&e.x==i.x&&e.y==i.y||(i=t.checkDirty(),t.fire("lockSnapshot"),this.dragHandlerContainer.setStyles({top:e.y+"px",left:e.x+"px"}),t.fire("unlockSnapshot"),!i&&t.resetDirty(),this._.dragHandlerOffset=e)}},CKEDITOR.event.implementOn(e.prototype),i.prototype=CKEDITOR.tools.extend(CKEDITOR.tools.prototypedCopy(CKEDITOR.dom.element.prototype),{setData:function(t){t=this.editor.dataProcessor.toHtml(t,{context:this.getName(),filter:this.filter,enterMode:this.enterMode}),this.setHtml(t)},getData:function(){return this.editor.dataProcessor.toDataFormat(this.getHtml(),{context:this.getName(),filter:this.filter,enterMode:this.enterMode})}});var F=RegExp('^(?:<(?:div|span)(?: data-cke-temp="1")?(?: id="cke_copybin")?(?: data-cke-temp="1")?>)?(?:<(?:div|span)(?: style="[^"]+")?>)?<span [^>]*data-cke-copybin-start="1"[^>]*>.?</span>([\\s\\S]+)<span [^>]*data-cke-copybin-end="1"[^>]*>.?</span>(?:</(?:div|span)>)?(?:</(?:div|span)>)?$'),H="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw%3D%3D",j={37:1,38:1,39:1,40:1,8:1,46:1};CKEDITOR.plugins.widget=e,e.repository=t,e.nestedEditable=i}(),function(){var t="http://cdn.mathjax.org/mathjax/2.2-latest/MathJax.js?config=TeX-AMS_HTML";CKEDITOR.plugins.add("mathjax",{requires:"widget,dialog",icons:"mathjax",init:function(e){var i=e.config.mathJaxClass||"math-tex";e.widgets.add("mathjax",{inline:!0,dialog:"mathjax",button:e.lang.mathjax.button,mask:!0,allowedContent:"span(!"+i+")",pathName:e.lang.mathjax.pathName,template:'<span class="'+i+'" style="display:inline-block" data-cke-survive=1></span>',parts:{span:"span"},defaults:{math:"\\(x = {-b \\pm \\sqrt{b^2-4ac} \\over 2a}\\)"},init:function(){var t=this.parts.span.getChild(0);t&&t.type==CKEDITOR.NODE_ELEMENT&&t.is("iframe")||(t=new CKEDITOR.dom.element("iframe"),t.setAttributes({style:"border:0;width:0;height:0",scrolling:"no",frameborder:0,allowTransparency:!0,src:CKEDITOR.plugins.mathjax.fixSrc}),this.parts.span.append(t)),this.once("ready",function(){CKEDITOR.env.ie&&t.setAttribute("src",CKEDITOR.plugins.mathjax.fixSrc),this.frameWrapper=new CKEDITOR.plugins.mathjax.frameWrapper(t,e),this.frameWrapper.setValue(this.data.math)})},data:function(){this.frameWrapper&&this.frameWrapper.setValue(this.data.math)},upcast:function(t,e){if("span"==t.name&&t.hasClass(i)&&!(t.children.length>1||t.children[0].type!=CKEDITOR.NODE_TEXT)){e.math=t.children[0].value;var n=t.attributes;return n.style=n.style?n.style+";display:inline-block":"display:inline-block",n["data-cke-survive"]=1,t.children[0].remove(),t}},downcast:function(t){t.children[0].replaceWith(new CKEDITOR.htmlParser.text(this.data.math));var e=t.attributes;return e.style=e.style.replace(/display:\s?inline-block;?\s?/,""),""===e.style&&delete e.style,t}}),CKEDITOR.dialog.add("mathjax",this.path+"dialogs/mathjax.js"),e.on("contentPreview",function(i){i.data.dataValue=i.data.dataValue.replace(/<\/head>/,'<script src="'+(e.config.mathJaxLib?CKEDITOR.getUrl(e.config.mathJaxLib):t)+'"></script></head>')}),e.on("paste",function(t){t.data.dataValue=t.data.dataValue.replace(RegExp("<span[^>]*?"+i+".*?</span>","ig"),function(t){return t.replace(/(<iframe.*?\/iframe>)/i,"")})})}}),CKEDITOR.plugins.mathjax={},CKEDITOR.plugins.mathjax.fixSrc=CKEDITOR.env.gecko?"javascript:true":CKEDITOR.env.ie?"javascript:void((function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"})())":"javascript:void(0)",CKEDITOR.plugins.mathjax.loadingIcon=CKEDITOR.plugins.get("mathjax").path+"images/loader.gif",CKEDITOR.plugins.mathjax.copyStyles=function(t,e){for(var i=["color","font-family","font-style","font-weight","font-variant","font-size"],n=0;n<i.length;n++){var a=i[n],r=t.getComputedStyle(a);r&&e.setStyle(a,r)}},CKEDITOR.plugins.mathjax.trim=function(t){var e=t.indexOf("\\(")+2,i=t.lastIndexOf("\\)");return t.substring(e,i)},CKEDITOR.plugins.mathjax.frameWrapper=CKEDITOR.env.ie&&8==CKEDITOR.env.version?function(t,e){return t.getFrameDocument().write('<!DOCTYPE html><html><head><meta charset="utf-8"></head><body style="padding:0;margin:0;background:transparent;overflow:hidden"><span style="white-space:nowrap;" id="tex"></span></body></html>'),{setValue:function(i){var n=t.getFrameDocument(),a=n.getById("tex");a.setHtml(CKEDITOR.plugins.mathjax.trim(i)),CKEDITOR.plugins.mathjax.copyStyles(t,a),e.fire("lockSnapshot"),t.setStyles({width:Math.min(250,a.$.offsetWidth)+"px",height:n.$.body.offsetHeight+"px",display:"inline","vertical-align":"middle"}),e.fire("unlockSnapshot")}}}:function(e,i){function n(){c=e.getFrameDocument(),c.getById("preview")||(CKEDITOR.env.ie&&e.removeAttribute("src"),c.write('<!DOCTYPE html><html><head><meta charset="utf-8"><script type="text/x-mathjax-config">MathJax.Hub.Config( {showMathMenu: false,messageStyle: "none"} );function getCKE() {if ( typeof window.parent.CKEDITOR == \'object\' ) {return window.parent.CKEDITOR;} else {return window.parent.parent.CKEDITOR;}}function update() {MathJax.Hub.Queue([ \'Typeset\', MathJax.Hub, this.buffer ],function() {getCKE().tools.callFunction( '+p+" );});}MathJax.Hub.Queue( function() {getCKE().tools.callFunction("+u+');} );</script><script src="'+(i.config.mathJaxLib||t)+'"></script></head><body style="padding:0;margin:0;background:transparent;overflow:hidden"><span id="preview"></span><span id="buffer" style="display:none"></span></body></html>'))}function a(){h=!0,s=l,i.fire("lockSnapshot"),r.setHtml(s),o.setHtml("<img src="+CKEDITOR.plugins.mathjax.loadingIcon+" alt="+i.lang.mathjax.loading+">"),e.setStyles({height:"16px",width:"16px",display:"inline","vertical-align":"middle"}),i.fire("unlockSnapshot"),c.getWindow().$.update(s)}var r,o,s,l,c=e.getFrameDocument(),d=!1,h=!1,u=CKEDITOR.tools.addFunction(function(){o=c.getById("preview"),r=c.getById("buffer"),d=!0,l&&a(),CKEDITOR.fire("mathJaxLoaded",e)}),p=CKEDITOR.tools.addFunction(function(){CKEDITOR.plugins.mathjax.copyStyles(e,o),o.setHtml(r.getHtml()),i.fire("lockSnapshot"),e.setStyles({height:0,width:0});var t=Math.max(c.$.body.offsetHeight,c.$.documentElement.offsetHeight),n=Math.max(o.$.offsetWidth,c.$.body.scrollWidth);e.setStyles({height:t+"px",width:n+"px"}),i.fire("unlockSnapshot"),CKEDITOR.fire("mathJaxUpdateDone",e),s!=l?a():h=!1});return e.on("load",n),n(),{setValue:function(t){l=t,d&&!h&&a()}}}}(),function(){CKEDITOR.plugins.add("placeholder",{requires:"widget,dialog",onLoad:function(){CKEDITOR.addCss(".cke_placeholder{background-color:#ff0}")},init:function(t){var e=t.lang.placeholder;CKEDITOR.dialog.add("placeholder",this.path+"dialogs/placeholder.js"),t.widgets.add("placeholder",{dialog:"placeholder",pathName:e.pathName,template:'<span class="cke_placeholder">[[]]</span>',downcast:function(){return new CKEDITOR.htmlParser.text("[["+this.data.name+"]]")},init:function(){this.setData("name",this.element.getText().slice(2,-2))},data:function(){this.element.setText("[["+this.data.name+"]]")}}),t.ui.addButton&&t.ui.addButton("CreatePlaceholder",{label:e.toolbar,command:"placeholder",toolbar:"insert,5",icon:"placeholder"})},afterInit:function(t){var e=/\[\[([^\[\]])+\]\]/g;t.dataProcessor.dataFilter.addRules({text:function(i,n){var a=n.parent&&CKEDITOR.dtd[n.parent.name];return!a||a.span?i.replace(e,function(e){var i=null,i=new CKEDITOR.htmlParser.element("span",{"class":"cke_placeholder"});return i.add(new CKEDITOR.htmlParser.text(e)),i=t.widgets.wrapElement(i,"placeholder"),i.getOuterHtml()}):void 0}})}})}(),function(){function t(t){var e="left"==t?"pageXOffset":"pageYOffset";return e in n.$?n.$[e]:CKEDITOR.document.$.documentElement["left"==t?"scrollLeft":"scrollTop"]}function e(e){var r=e.config,o=r.floatSpace||{on:{}},s=!1,l=e.fire("uiSpace",{space:"top",html:""}).html,c=function(){function i(t,e,i){d.setStyle(e,a(i)),d.setStyle("position",t)}function l(t){var e=u.getDocumentPosition();switch(t){case"top":i("absolute","top",e.y-g-I);break;case"pin":i("fixed","top",E);break;case"bottom":i("absolute","top",e.y+(f.height||f.bottom-f.top)+I)}o.on&&"function"==typeof o.on.changeMode&&o.on.changeMode.call(d.$,h,t),h=t}var h,u,p,f,m,g,v,C=r.floatSpaceDockedOffsetX||0,I=r.floatSpaceDockedOffsetY||0,b=r.floatSpacePinnedOffsetX||0,E=r.floatSpacePinnedOffsetY||0;return function(i){if(!u)if(o.centerElement){var r;r="function"==typeof o.centerElement?o.centerElement.call(null):o.centerElement,u=new CKEDITOR.dom.element(r),u.on("mousedown",function(t){t.data.preventDefault()})}else if(!(u=e.editable()))return;s||(i&&"focus"===i.name&&d.show(),d.removeStyle("left"),d.removeStyle("right"),p=d.getClientRect(),f=u.getClientRect(),m=n.getViewPaneSize(),g=p.height,v=t("left"),h?(l(g+I<=f.top?"top":g+I>m.height-f.bottom?"pin":"bottom"),i=m.width/2,i=f.left>0&&f.right<m.width&&f.width>p.width?"rtl"==e.config.contentsLangDirection?"right":"left":i-f.left>f.right-i?"left":"right",p.width>m.width?(i="left",r=0):(r="left"==i?f.left>0?f.left:0:f.right<m.width?m.width-f.right:0,r+p.width>m.width&&(i="left"==i?"right":"left",r=0)),d.setStyle(i,a(("pin"==h?b:C)+r+("pin"==h?0:"left"==i?v:-v)))):(h="pin",l("pin"),c(i)))}}();if(l){var d=CKEDITOR.document.getBody().append(CKEDITOR.dom.element.createFromHtml(i.output({content:l,id:e.id,langDir:e.lang.dir,langCode:e.langCode,name:e.name,style:"display:none;z-index:"+(r.baseFloatZIndex-1),topId:e.ui.spaceId("top"),voiceLabel:e.lang.editorPanel+", "+e.name}))),h=CKEDITOR.tools.eventsBuffer(500,c),u=CKEDITOR.tools.eventsBuffer(100,c);d.unselectable(),d.on("mousedown",function(t){t=t.data,t.getTarget().hasAscendant("a",1)||t.preventDefault()}),e.on("focus",function(t){c(t),e.on("change",h.input),n.on("scroll",u.input),n.on("resize",u.input)}),e.on("blur",function(){d.hide(),e.removeListener("change",h.input),n.removeListener("scroll",u.input),n.removeListener("resize",u.input)}),e.on("destroy",function(){n.removeListener("scroll",u.input),n.removeListener("resize",u.input),d.clearCustomData(),d.remove()}),e.focusManager.hasFocus&&d.show(),e.focusManager.add(d,1),o.on&&"function"==typeof o.on.ready&&o.on.ready.call(d.$,{show:function(){s=!1,d.show(),c()},hide:function(){d.hide(),s=!0}})}}var i=CKEDITOR.addTemplate("floatcontainer",'<div id="cke_{name}" class="cke {id} cke_reset_all cke_chrome cke_editor_{name} cke_float cke_{langDir} '+CKEDITOR.env.cssClass+'" dir="{langDir}" title="'+(CKEDITOR.env.gecko?" ":"")+'" lang="{langCode}" role="application" style="{style}" aria-labelledby="cke_{name}_arialbl"><span id="cke_{name}_arialbl" class="cke_voice_label">{voiceLabel}</span><div class="cke_inner"><div id="{topId}" class="cke_top" role="presentation">{content}</div></div><span class="cke_nose"><span></div>'),n=CKEDITOR.document.getWindow(),a=CKEDITOR.tools.cssLength;CKEDITOR.plugins.add("floatingspace",{init:function(t){t.on("loaded",function(){e(this)},null,null,20)}})}(),CKEDITOR.config.plugins="basicstyles,blockquote,dialogui,dialog,clipboard,panel,floatpanel,menu,contextmenu,resize,button,toolbar,enterkey,entities,listblock,richcombo,format,horizontalrule,htmlwriter,wysiwygarea,indent,indentlist,fakeobjects,link,list,magicline,pastetext,pastefromword,removeformat,sourcearea,specialchar,stylescombo,tab,undo,templates,divarea,justify,liststyle,lineutils,widget,mathjax,placeholder,floatingspace",CKEDITOR.config.skin="moono",function(){var t=function(t,e){for(var i=CKEDITOR.getUrl("plugins/"+e),t=t.split(","),n=0;n<t.length;n++)CKEDITOR.skin.icons[t[n]]={path:i,offset:-t[++n],bgsize:t[++n]}};CKEDITOR.env.hidpi?t("about,0,,bold,24,,italic,48,,strike,72,,subscript,96,,superscript,120,,underline,144,,bidiltr,168,,bidirtl,192,,blockquote,216,,copy-rtl,240,,copy,264,,cut-rtl,288,,cut,312,,paste-rtl,336,,paste,360,,bgcolor,384,,textcolor,408,,creatediv,432,,docprops-rtl,456,,docprops,480,,find-rtl,504,,find,528,,replace,552,,flash,576,,button,600,,checkbox,624,,form,648,,hiddenfield,672,,imagebutton,696,,radio,720,,select-rtl,744,,select,768,,textarea-rtl,792,,textarea,816,,textfield-rtl,840,,textfield,864,,horizontalrule,888,,iframe,912,,image,936,,indent-rtl,960,,indent,984,,outdent-rtl,1008,,outdent,1032,,justifyblock,1056,,justifycenter,1080,,justifyleft,1104,,justifyright,1128,,language,1152,,anchor-rtl,1176,,anchor,1200,,link,1224,,unlink,1248,,bulletedlist-rtl,1272,,bulletedlist,1296,,numberedlist-rtl,1320,,numberedlist,1344,,mathjax,1368,,maximize,1392,,newpage-rtl,1416,,newpage,1440,,pagebreak-rtl,1464,,pagebreak,1488,,pastefromword-rtl,1512,,pastefromword,1536,,pastetext-rtl,1560,,pastetext,1584,,placeholder,1608,,preview-rtl,1632,,preview,1656,,print,1680,,removeformat,1704,,save,1728,,selectall,1752,,showblocks-rtl,1776,,showblocks,1800,,smiley,1824,,source-rtl,1848,,source,1872,,sourcedialog-rtl,1896,,sourcedialog,1920,,specialchar,1944,,table,1968,,templates-rtl,1992,,templates,2016,,uicolor,2040,,redo-rtl,2064,,redo,2088,,undo-rtl,2112,,undo,2136,","icons_hidpi.png"):t("about,0,auto,bold,24,auto,italic,48,auto,strike,72,auto,subscript,96,auto,superscript,120,auto,underline,144,auto,bidiltr,168,auto,bidirtl,192,auto,blockquote,216,auto,copy-rtl,240,auto,copy,264,auto,cut-rtl,288,auto,cut,312,auto,paste-rtl,336,auto,paste,360,auto,bgcolor,384,auto,textcolor,408,auto,creatediv,432,auto,docprops-rtl,456,auto,docprops,480,auto,find-rtl,504,auto,find,528,auto,replace,552,auto,flash,576,auto,button,600,auto,checkbox,624,auto,form,648,auto,hiddenfield,672,auto,imagebutton,696,auto,radio,720,auto,select-rtl,744,auto,select,768,auto,textarea-rtl,792,auto,textarea,816,auto,textfield-rtl,840,auto,textfield,864,auto,horizontalrule,888,auto,iframe,912,auto,image,936,auto,indent-rtl,960,auto,indent,984,auto,outdent-rtl,1008,auto,outdent,1032,auto,justifyblock,1056,auto,justifycenter,1080,auto,justifyleft,1104,auto,justifyright,1128,auto,language,1152,auto,anchor-rtl,1176,auto,anchor,1200,auto,link,1224,auto,unlink,1248,auto,bulletedlist-rtl,1272,auto,bulletedlist,1296,auto,numberedlist-rtl,1320,auto,numberedlist,1344,auto,mathjax,1368,auto,maximize,1392,auto,newpage-rtl,1416,auto,newpage,1440,auto,pagebreak-rtl,1464,auto,pagebreak,1488,auto,pastefromword-rtl,1512,auto,pastefromword,1536,auto,pastetext-rtl,1560,auto,pastetext,1584,auto,placeholder,1608,auto,preview-rtl,1632,auto,preview,1656,auto,print,1680,auto,removeformat,1704,auto,save,1728,auto,selectall,1752,auto,showblocks-rtl,1776,auto,showblocks,1800,auto,smiley,1824,auto,source-rtl,1848,auto,source,1872,auto,sourcedialog-rtl,1896,auto,sourcedialog,1920,auto,specialchar,1944,auto,table,1968,auto,templates-rtl,1992,auto,templates,2016,auto,uicolor,2040,auto,redo-rtl,2064,auto,redo,2088,auto,undo-rtl,2112,auto,undo,2136,auto","icons.png")}())}(),define("ckeditor",function(t){return function(){var e;return e||t.CKEDITOR}}(this)),define("taoQtiItem/qtiCreator/editor/ckEditor/dtdHandler",["lodash"],function(t){"use strict";var e=function(){var e="html",i={},n=function(i){if("xhtml"===i.toLowerCase()&&(i="html"),!t.contains(["html","qti"],i))throw new Error("Unknown mode "+i);return e=i,this},a=["article","aside","bdi","command","datalist","details","dialog","figcaption","figure","footer","header","keygen","main","mark","meter","nav","output","progress","rp","rt","ruby","section","summary","time","wbr","hgroup"],r=function(t){var n,a=[];t=h(t);for(n in i[e])i[e].hasOwnProperty(n)&&0!==n.indexOf("$")&&t in i[e][n]&&a.push(n);return a},o=function(n){return n=h(n),n in i[e]?t.keys(i[e][n]):[]},s=function(e,i){return t.contains(o(i),h(e))},l=function(e,i){return t.contains(r(i),h(e))},c=function(){return i[e]},d=function(){return e},h=function(e){if(t.isObject(e)&&!t.isArray(e)){if("nodeName"in e)return e.nodeName.toLowerCase();if(0 in e&&"nodeName"in e[0])return e[0].nodeName.toLowerCase()}else if(t.isString(e))return e.toLowerCase();throw new Error("Unknown element "+e)};return i.html=function(){var e=t.extend,i=function(e,i){for(var n=t.cloneDeep(e),a=1;a<arguments.length;a++){i=arguments[a];for(var r in i)delete n[r]}return n},n={},a={},r={a:1,abbr:1,area:1,audio:1,b:1,bdi:1,bdo:1,br:1,button:1,canvas:1,cite:1,code:1,command:1,datalist:1,del:1,dfn:1,em:1,embed:1,i:1,iframe:1,img:1,input:1,ins:1,kbd:1,keygen:1,label:1,map:1,mark:1,meter:1,noscript:1,object:1,output:1,progress:1,q:1,ruby:1,s:1,samp:1,script:1,select:1,small:1,span:1,strong:1,sub:1,sup:1,textarea:1,time:1,u:1,"var":1,video:1,wbr:1},o={address:1,article:1,aside:1,blockquote:1,details:1,div:1,dl:1,fieldset:1,figure:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,hr:1,menu:1,nav:1,ol:1,p:1,pre:1,section:1,table:1,ul:1},s={command:1,link:1,meta:1,noscript:1,script:1,style:1},l={},c={"#":1},d={acronym:1,applet:1,basefont:1,big:1,font:1,isindex:1,strike:1,style:1,tt:1},h={center:1,dir:1,noframes:1};e(n,r,c,d),e(a,o,n,h);var u={a:i(n,{a:1,button:1}),abbr:n,address:a,area:l,article:e({style:1},a),aside:e({style:1},a),audio:e({source:1,track:1},a),b:n,base:l,bdi:n,bdo:n,blockquote:a,body:a,br:l,button:i(n,{a:1,button:1}),canvas:n,caption:a,cite:n,code:n,col:l,colgroup:{col:1},command:l,datalist:e({option:1},n),dd:a,del:n,details:e({summary:1},a),dfn:n,div:e({style:1},a),dl:{dt:1,dd:1},dt:a,em:n,embed:l,fieldset:e({legend:1},a),figcaption:a,figure:e({figcaption:1},a),footer:a,form:a,h1:n,h2:n,h3:n,h4:n,h5:n,h6:n,head:e({title:1,base:1},s),header:a,hgroup:{h1:1,h2:1,h3:1,h4:1,h5:1,h6:1},hr:l,html:e({head:1,body:1},a,s),i:n,iframe:c,img:l,input:l,ins:n,kbd:n,keygen:l,label:n,legend:n,li:a,link:l,map:a,mark:n,menu:e({li:1},a),meta:l,meter:i(n,{meter:1}),nav:a,noscript:e({link:1,meta:1,style:1},n),object:e({param:1},n),ol:{li:1},optgroup:{option:1},option:c,output:n,p:n,param:l,pre:n,progress:i(n,{progress:1}),q:n,rp:n,rt:n,ruby:e({rp:1,rt:1},n),s:n,samp:n,script:c,section:e({style:1},a),select:{optgroup:1,option:1},small:n,source:l,span:n,strong:n,style:c,sub:n,summary:n,sup:n,table:{caption:1,colgroup:1,thead:1,tfoot:1,tbody:1,tr:1},tbody:{tr:1},td:a,textarea:c,tfoot:{tr:1},th:a,thead:{tr:1},time:i(n,{time:1}),title:c,tr:{th:1,td:1},track:l,u:n,ul:{li:1},"var":n,video:e({source:1,track:1},a),wbr:l,acronym:n,applet:e({param:1},a),basefont:l,big:n,center:a,dialog:l,dir:{li:1},font:n,isindex:l,noframes:a,strike:n,tt:n};return e(u,{$block:e({audio:1,dd:1,dt:1,figcaption:1,li:1,video:1},o,h),$blockLimit:{article:1,aside:1,audio:1,body:1,caption:1,details:1,dir:1,div:1,dl:1,fieldset:1,figcaption:1,figure:1,footer:1,form:1,header:1,hgroup:1,menu:1,nav:1,ol:1,section:1,table:1,td:1,th:1,tr:1,ul:1,video:1},$cdata:{script:1,style:1},$editable:{address:1,article:1,aside:1,blockquote:1,body:1,details:1,div:1,fieldset:1,figcaption:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,nav:1,p:1,pre:1,section:1},$empty:{area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1},$inline:n,$list:{dl:1,ol:1,ul:1},$listItem:{dd:1,dt:1,li:1},$nonBodyContent:e({body:1,head:1,html:1},u.head),$nonEditable:{applet:1,audio:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,param:1,script:1,textarea:1,video:1},$object:{applet:1,audio:1,button:1,hr:1,iframe:1,img:1,input:1,object:1,select:1,table:1,textarea:1,video:1},$removeEmpty:{abbr:1,acronym:1,b:1,bdi:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,mark:1,meter:1,output:1,q:1,ruby:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,time:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},$transparent:{a:1,audio:1,canvas:1,del:1,ins:1,map:1,noscript:1,object:1,video:1},$intermediate:{caption:1,colgroup:1,dd:1,dt:1,figcaption:1,legend:1,li:1,optgroup:1,option:1,rp:1,rt:1,summary:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1}}),u
}(),i.qti=function(){for(var e,n,r,o,s,l,c,d=["remove","add"],h=d.length,u={pre:{add:[],remove:["img","object","big","small","sub","sup"]},table:{remove:["col"]}},p=t.cloneDeep(i.html),f=a.length;f--;)delete p[a[f]];for(e in p)p.hasOwnProperty(e)&&(c=t.intersection(t.keys(p[e]),a),c.length&&(u[e]||(u[e]={remove:[]}),u[e].remove=u[e].remove.concat(c)));for(e in u)if(u.hasOwnProperty(e)&&p.hasOwnProperty(e))for(o=0;h>o;o++)if(s=d[o],s in u[e])if(n=u[e][s].length,"remove"!==s||"all"!==u[e][s])for(;n--;)r=u[e][s][n],l=t.cloneDeep(p[e]),"remove"===s?(delete l[r],p[e]=l):"add"===s&&"undefined"!=typeof p[r]&&(l[r]=1,p[e]=l[r]);else p[e]={};return p}(),{getDtd:c,getChildrenOf:o,getParentsOf:r,isChildOf:s,isParentOf:l,getMode:d,setMode:n}}();return e}),define("ckConfigurator",["lodash","ckeditor","taoQtiItem/qtiCreator/editor/ckEditor/dtdHandler"],function(t,e,i){var n=t.cloneDeep(CKEDITOR.config),a=function(){var e={TaoMediaManager:{insertAfter:"SpecialChar"}},a={TaoQtiImage:{insertAfter:"SpecialChar"},TaoQtiMaths:{insertAfter:"SpecialChar"}},r={inline:[{name:"basicstyles",items:["Bold","Italic","Subscript","Superscript"]},{name:"insert",items:["SpecialChar"]},{name:"links",items:["Link"]}],flow:[{name:"basicstyles",items:["Bold","Italic","Subscript","Superscript"]},{name:"insert",items:["SpecialChar"]},{name:"links",items:["Link"]}],block:[{name:"basicstyles",items:["Bold","Italic","Subscript","Superscript"]},{name:"insert",items:["Image","Table","SpecialChar"]},{name:"links",items:["Link"]},"/",{name:"styles",items:["Format"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]}]},o={disableAutoInline:!0,entities:!1,entities_processNumerical:!0,autoParagraph:!1,extraPlugins:"confighelper",floatSpaceDockedOffsetY:0,forcePasteAsPlainText:!0,skin:"tao",removePlugins:"",linkShowAdvancedTab:!1,linkShowTargetTab:!1},s=function(e,i){var n,a,r,o,s,l,c,d,h,u,p=e.toolbar.length,f={};for(e.extraPlugins=function(e,i){for(var n=e.length,a=i.split(",");n--;)e[n]=e[n].toLowerCase();return a=t.compact(t.union(a,e)),a.join(",")}(t.keys(i),e.extraPlugins),u=0;p>u;u++)t.isString(e.toolbar[u])&&(f[u]=e.toolbar[u],e.toolbar[u]={items:[]});for(o in i){for(r=function(t){for(var e=t.length;e--;)if(0===t[e].indexOf("insert")||"replace"===t[e])return t[e];throw"Missing key insertBefore | insertAfter | replace in positionedPlugins"}(t.keys(i[o])),c=i[o][r].toLowerCase(),l=i[o].separator||!1,s=-1;p--;){for(a=e.toolbar[p].items.length,n=0;a>n;n++)if(e.toolbar[p].items[n].toLowerCase()===c){s=n;break}if(s>-1){d=~~("replace"===r),"insertAfter"===r&&s++,l&&(e.toolbar[p].items.splice(s,d,"-"),s++),e.toolbar[p].items.splice(s,d,o);break}}p=e.toolbar.length}for(h in f)e.toolbar[h]=f[h]},l=function(l,c,d){if("reset"===c)return n;d=d||{},d.resourcemgr=d.resourcemgr||{};var h,u,p=t.clone(r,!0),f="html";0===c.indexOf("qti")&&(c=c.slice(3).toLowerCase(),o.allowedContent=!0,o.autoParagraph=!1,f="qti"),d.toolbar&&(p[c]=t.clone(d.toolbar),delete d.toolbar);for(h in p)p.hasOwnProperty(h)&&(o["toolbar_"+h]=p[h]);return"undefined"!=typeof p[c]&&(o.toolbar=p[c]),"undefined"!=typeof d.positionedPlugins&&(d.positionedPlugins={}),!1!==d.positionedPlugins&&(e="qti"===f?t.assign(a,t.clone(d.positionedPlugins)):t.assign(e,t.clone(d.positionedPlugins)),delete d.positionedPlugins,s(o,e)),u=t.assign({},t.cloneDeep(n),o,d),l.on("focus",function(){i.setMode(f),CKEDITOR.dtd=i.getDtd()}),l.on("instanceReady",function(t){$(t.editor.element.$).removeAttr("title")}),u};return{getConfig:l}}();return a}),function(t){function e(t,e,i){return t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):void 0}function i(t,e){var i,n;for(i=0,n=t.length;n>i;i++)if(t[i]===e)return!0;return!1}function n(t,e){var i;t.createTextRange?(i=t.createTextRange(),i.move("character",e),i.select()):t.selectionStart&&(t.focus(),t.setSelectionRange(e,e))}function a(t,e){try{return t.type=e,!0}catch(i){return!1}}t.Placeholders={Utils:{addEventListener:e,inArray:i,moveCaret:n,changeType:a}}}(this),function(t){function e(){}function i(){try{return document.activeElement}catch(t){}}function n(t,e){var i,n,a=!!e&&t.value!==e,r=t.value===t.getAttribute(S);return(a||r)&&"true"===t.getAttribute(N)?(t.removeAttribute(N),t.value=t.value.replace(t.getAttribute(S),""),t.className=t.className.replace(q,""),n=t.getAttribute(B),parseInt(n,10)>=0&&(t.setAttribute("maxLength",n),t.removeAttribute(B)),i=t.getAttribute(A),i&&(t.type=i),!0):!1}function a(t){var e,i,n=t.getAttribute(S);return""===t.value&&n?(t.setAttribute(N,"true"),t.value=n,t.className+=" "+K,i=t.getAttribute(B),i||(t.setAttribute(B,t.maxLength),t.removeAttribute("maxLength")),e=t.getAttribute(A),e?t.type="text":"password"===t.type&&z.changeType(t,"text")&&t.setAttribute(A,"password"),!0):!1}function r(t,e){var i,n,a,r,o,s,l;if(t&&t.getAttribute(S))e(t);else for(a=t?t.getElementsByTagName("input"):m,r=t?t.getElementsByTagName("textarea"):g,i=a?a.length:0,n=r?r.length:0,l=0,s=i+n;s>l;l++)o=i>l?a[l]:r[l-i],e(o)}function o(t){r(t,n)}function s(t){r(t,a)}function l(t){return function(){v&&t.value===t.getAttribute(S)&&"true"===t.getAttribute(N)?z.moveCaret(t,0):n(t)}}function c(t){return function(){a(t)}}function d(t){return function(e){return I=t.value,"true"===t.getAttribute(N)&&I===t.getAttribute(S)&&z.inArray(x,e.keyCode)?(e.preventDefault&&e.preventDefault(),!1):void 0}}function h(t){return function(){n(t,I),""===t.value&&(t.blur(),z.moveCaret(t,0))}}function u(t){return function(){t===i()&&t.value===t.getAttribute(S)&&"true"===t.getAttribute(N)&&z.moveCaret(t,0)}}function p(t){return function(){o(t)}}function f(t){t.form&&(R=t.form,"string"==typeof R&&(R=document.getElementById(R)),R.getAttribute(Q)||(z.addEventListener(R,"submit",p(R)),R.setAttribute(Q,"true"))),z.addEventListener(t,"focus",l(t)),z.addEventListener(t,"blur",c(t)),v&&(z.addEventListener(t,"keydown",d(t)),z.addEventListener(t,"keyup",h(t)),z.addEventListener(t,"click",u(t))),t.setAttribute(M,"true"),t.setAttribute(S,y),(v||t!==i())&&a(t)}var m,g,v,C,I,b,E,y,T,R,w,O,_,D=["text","search","url","tel","email","password","number","textarea"],x=[27,33,34,35,36,37,38,39,40,8,46],k="#ccc",K="placeholdersjs",q=new RegExp("(?:^|\\s)"+K+"(?!\\S)"),S="data-placeholder-value",N="data-placeholder-active",A="data-placeholder-type",Q="data-placeholder-submit",M="data-placeholder-bound",P="data-placeholder-focus",L="data-placeholder-live",B="data-placeholder-maxlength",$=document.createElement("input"),F=document.getElementsByTagName("head")[0],H=document.documentElement,j=t.Placeholders,z=j.Utils;if(j.nativeSupport=void 0!==$.placeholder,!j.nativeSupport){for(m=document.getElementsByTagName("input"),g=document.getElementsByTagName("textarea"),v="false"===H.getAttribute(P),C="false"!==H.getAttribute(L),b=document.createElement("style"),b.type="text/css",E=document.createTextNode("."+K+" { color:"+k+"; }"),b.styleSheet?b.styleSheet.cssText=E.nodeValue:b.appendChild(E),F.insertBefore(b,F.firstChild),_=0,O=m.length+g.length;O>_;_++)w=_<m.length?m[_]:g[_-m.length],y=w.attributes.placeholder,y&&(y=y.nodeValue,y&&z.inArray(D,w.type)&&f(w));T=setInterval(function(){for(_=0,O=m.length+g.length;O>_;_++)w=_<m.length?m[_]:g[_-m.length],y=w.attributes.placeholder,y?(y=y.nodeValue,y&&z.inArray(D,w.type)&&(w.getAttribute(M)||f(w),(y!==w.getAttribute(S)||"password"===w.type&&!w.getAttribute(A))&&("password"===w.type&&!w.getAttribute(A)&&z.changeType(w,"text")&&w.setAttribute(A,"password"),w.value===w.getAttribute(S)&&(w.value=y),w.setAttribute(S,y)))):w.getAttribute(N)&&(n(w),w.removeAttribute(S));C||clearInterval(T)},100)}z.addEventListener(t,"beforeunload",function(){j.disable()}),j.disable=j.nativeSupport?e:o,j.enable=j.nativeSupport?e:s}(this),define("polyfill/placeholders",function(){}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction",["lodash","jquery","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/extendedTextInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","i18n","ckeditor","ckConfigurator","polyfill/placeholders"],function(t,e,i,n,a,r,o){var s=function(t,e){var i=new RegExp("^"+e+"$");t.on("keyup",function(){t.removeClass("field-error"),i.test(t.val())||t.addClass("field-error")})},l=function(t){var e=t.getAttributes(),i=t.getResponseDeclaration();return!(!e.maxStrings||"multiple"!==i.attr("cardinality")&&"ordered"!==i.attr("cardinality"))},c=function(t){var i,c,d,h=t.getAttributes(),u=t.getContainer(),p=(t.getResponseDeclaration(),l(t));if(r.on("instanceCreated",function(e){var i=e.editor,a="block";i.on("configLoaded",function(){i.config=o.getConfig(i,a,v)}),i.on("change",function(){n.triggerResponseChangeEvent(t,{})})}),p){if(i=u.find("input"),h.minStrings){var f=function(t){var i=0;return t.each(function(){""!==e(this).val()&&i++}),i},g=parseInt(h.minStrings);g>0&&i.on("blur",function(){setTimeout(function(){!i.is(":focus")&&f(i)<g&&n.appendNotification(t,a("The minimum number of answers is ")+" : "+g,"warning")},100)})}h.expectedLength&&(c=parseInt(h.expectedLength,10),c>0&&i.each(function(){e(this).css("width",c+"em")})),h.patternMask&&i.each(function(){s(e(this),h.patternMask)}),h.placeholderText&&(d="first","multiple"===d?i.each(function(){e(this).attr("placeholder",h.placeholderText)}):"first"===d&&i.first().attr("placeholder",h.placeholderText))}else{i=u.find("textarea");var v={extraPlugins:"confighelper",resize_enabled:!1};h.placeholderText&&i.attr("placeholder",h.placeholderText),"xhtml"==m(t)?(r.replace(t.attr("identifier")),u.find("#text-container").addClass("solid")):i.bind("keyup change",function(){n.triggerResponseChangeEvent(t,{})})}},d=function(t){t.getContainer().find("input, textarea").val("")},h=function(t,e){var i=function(e,i){t.getContainer().find("#"+e).val(i)},n=function(e){t.getContainer().find("textarea").val(e)},a=t.getResponseDeclaration().attr("baseType");if(e.base&&void 0!==e.base[a])n(e.base[a]);else{if(!e.list||!e.list[a])throw new Error("wrong response format in argument.");for(var r in e.list[a]){var o=void 0===e.list.identifier?"":e.list.identifier[r];i(o+"_"+r,e.list[a][r])}}},u=function(t){var i=t.getContainer(),n=t.getAttributes(),a=t.getResponseDeclaration(),r=a.attr("baseType"),o=n.base||10,s=!(!n.maxStrings||"multiple"!==a.attr("cardinality")&&"ordered"!==a.attr("cardinality")),l=s?{list:{}}:{base:{}};if(s){var c=[];i.find("input").each(function(t){$el=e(this),n.placeholderText&&$el.val()===n.placeholderText?c[t]="":"integer"===r?(c[t]=parseInt($el.val(),o),c[t]=isNaN(c[t])?"":c[t]):"float"===r?(c[t]=parseFloat($el.val()),c[t]=isNaN(c[t])?"":c[t]):"string"===r&&(c[t]=$el.val())}),l.list[r]=c}else{var d="";n.placeholderText&&p(t)===n.placeholderText?d="":"integer"===r?d=parseInt(p(t),o):"float"===r?d=parseFloat(p(t)):"string"===r&&(d=p(t)),l.base[r]=isNaN(d)&&"number"==typeof d?"":d}return l},p=function(t){return"xhtml"===m(t)?f(t):n.getContainer(t).find("textarea").val()},f=function(t){return r.instances[t.attr("identifier")].getData()},m=function(t){var e=t.attr("format");switch(e){case"plain":case"xhtml":case"preFormatted":return e;default:return"plain"}},g=function(t,e){n.getContainer(t);"xhtml"==t.attr("format")?r.replace(t.attr("identifier")):"xhtml"==e&&r.instances[t.attr("identifier")].destroy()},v=function(t){var e=n.getContainer(t);e.find("input, textarea").removeAttr("disabled"),"xhtml"==t.attr("format")&&(r.instances[t.attr("identifier")].destroy(),r.replace(t.attr("identifier")))},C=function(t){var e=n.getContainer(t);e.find("input, textarea").attr("disabled","disabled"),"xhtml"==t.attr("format")&&(r.instances[t.attr("identifier")].destroy(),r.replace(t.attr("identifier")))},I=function(t){b(t,"")},b=function(t,e){var i=n.getContainer(t);"xhtml"==t.attr("format")?r.instances[t.attr("identifier")].setData(e):i.find("textarea").val(e)};return{qtiClass:"extendedTextInteraction",template:i,render:c,getContainer:n.getContainer,setResponse:h,getResponse:u,resetResponse:d,updateFormat:g,enable:v,disable:C,clearText:I,setText:b}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/gapMatchInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a;return(a=i.prompt)?n=a.call(t,{hash:{},data:e}):(a=t&&t.prompt,n=typeof a===h?a.call(t,{hash:{},data:e}):a),n||0===n?n:""}function o(t){var e;return e=typeof t===h?t.apply(t):t,e||0===e?e:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var s,l,c,d="",h="function",u=this.escapeExpression,p=this,f=i.blockHelperMissing;return d+='<div class="qti-interaction qti-blockInteraction qti-GapMatchInteraction" data-serial="',(l=i.serial)?s=l.call(e,{hash:{},data:a}):(l=e&&e.serial,s=typeof l===h?l.call(e,{hash:{},data:a}):l),d+=u(s)+'" data-qti-class="gapMatchInteraction">\n    ',s=i["if"].call(e,e&&e.prompt,{hash:{},inverse:p.noop,fn:p.program(1,r,a),data:a}),(s||0===s)&&(d+=s),d+='\n    <ul class="choice-area none block-listing solid horizontal source" data-eyecatcher=">li">\n        ',c={hash:{},inverse:p.noop,fn:p.program(3,o,a),data:a},(l=i.choices)?s=l.call(e,c):(l=e&&e.choices,s=typeof l===h?l.call(e,c):l),i.choices||(s=f.call(e,s,{hash:{},inverse:p.noop,fn:p.program(3,o,a),data:a})),(s||0===s)&&(d+=s),d+='\n    </ul>\n    <div class="instruction-container"></div>\n    <div class="qti-flow-container">',(l=i.body)?s=l.call(e,{hash:{},data:a}):(l=e&&e.body,s=typeof l===h?l.call(e,{hash:{},data:a}):l),(s||0===s)&&(d+=s),d+="</div>\n</div>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GapMatchInteraction",["lodash","i18n","jquery","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/gapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","eyecatcher"],function(t,e,i,n,a,r,o){var s={},l=function(t,e,i){var n=e.data("serial"),a=t.getChoice(n);s[n]||(s[n]=0),s[n]++,i.data("serial",n).html(e.html()).addClass("filled"),!t.responseMappingMode&&a.attr("matchMax")&&s[n]>=a.attr("matchMax")&&e.addClass("deactivated")},c=function(t,e){var i=e.data("serial"),n=a.getContainer(t);n.find(".choice-area [data-serial="+i+"]").removeClass("deactivated"),s[i]--,e.removeClass("filled").removeData("serial").empty(),t.swapping||a.triggerResponseChangeEvent(t)},d=function(t,e){return a.getContainer(t).find(".choice-area [data-identifier="+e+"]")},h=function(t,e){return a.getContainer(t).find(".qti-flow-container [data-identifier="+e+"]")},u=function(t){var n=a.getContainer(t),r=n.find(".choice-area"),s=n.find(".qti-flow-container"),d=null,h=function(t){return r.find("[data-serial="+t+"]")},u=function(e,i){return l(t,e,i)},p=function(){d&&(s.find(".remove-choice").remove(),d.removeClass("active"),n.find(".empty").removeClass("empty"),d=null)},f=function(e){return c(t,e)},m=function(){return d&&d.data("identifier")},g=function(){return d&&!d.data("identifier")};n.on("mousedown.commonRenderer",function(){p()}),r.on("mousedown",">li",function(t){return t.stopPropagation(),i(this).hasClass("deactivated")?void t.preventDefault():void(g()?(f(d),u(i(this),d),p()):i(this).hasClass("active")?p():(p(),d=i(this),i(this).addClass("active"),s.find(".gapmatch-content").addClass("empty")))}),s.on("mousedown",".gapmatch-content",function(t){if(t.stopPropagation(),m()){var n=i(this),a=d.data("serial"),o=n.data("serial");o!==a&&(o&&f(n),u(d,n)),p()}else if(g()){var n=i(this),o=n.data("serial"),a=d.data("serial");o!==a&&(f(d),o&&(f(n),u(h(o),d)),u(h(a),n)),p()}else if(i(this).data("serial")){var l=i(this).data("serial");d=i(this),d.addClass("active"),s.find(">li>div").filter(function(){return i(this).data("serial")!==l}).addClass("empty"),r.find(">li:not(.deactivated)").filter(function(){return i(this).data("serial")!==l}).addClass("empty");var c=i("<span>",{"class":"icon-undo remove-choice",title:e("remove")});c.on("mousedown",function(t){t.stopPropagation(),f(d),p()}),i(this).append(c)}}),o()},p=function(t){a.getContainer(t).find(".gapmatch-content").each(function(){c(t,i(this))})},f=function(e,i){t.each(i,function(t){t&&l(e,d(e,t[0]),h(e,t[1]))})},m=function(t,e){f(t,r.unserialize(e,t))},g=function(t){var e=[];return a.getContainer(t).find(".gapmatch-content").each(function(){var n=i(this).data("serial"),a=[];n&&a.push(t.getChoice(n).attr("identifier")),a.push(i(this).data("identifier")),2===a.length&&e.push(a)}),e},v=function(t){return r.serialize(g(t),t)},C=function(t){var e=a.getContainer(t);e.find(".gapmatch-content .active").mousedown(),i(document).off(".commonRenderer"),e.find(".choice-area, .gapmatch-content").andSelf().off(".commonRenderer"),p(t),a.getContainer(t).find(".gapmatch-content").empty()};return{qtiClass:"gapMatchInteraction",template:n,render:u,getContainer:a.getContainer,setResponse:m,getResponse:v,resetResponse:p,destroy:C}}),function(t){var e,i,n="0.4.2",a="hasOwnProperty",r=/[\.\/]/,o="*",s=function(){},l=function(t,e){return t-e},c={n:{}},d=function(t,n){t=String(t);var a,r=i,o=Array.prototype.slice.call(arguments,2),s=d.listeners(t),c=0,h=[],u={},p=[],f=e;e=t,i=0;for(var m=0,g=s.length;g>m;m++)"zIndex"in s[m]&&(h.push(s[m].zIndex),s[m].zIndex<0&&(u[s[m].zIndex]=s[m]));for(h.sort(l);h[c]<0;)if(a=u[h[c++]],p.push(a.apply(n,o)),i)return i=r,p;for(m=0;g>m;m++)if(a=s[m],"zIndex"in a)if(a.zIndex==h[c]){if(p.push(a.apply(n,o)),i)break;do if(c++,a=u[h[c]],a&&p.push(a.apply(n,o)),i)break;while(a)}else u[a.zIndex]=a;else if(p.push(a.apply(n,o)),i)break;return i=r,e=f,p.length?p:null};d._events=c,d.listeners=function(t){var e,i,n,a,s,l,d,h,u=t.split(r),p=c,f=[p],m=[];for(a=0,s=u.length;s>a;a++){for(h=[],l=0,d=f.length;d>l;l++)for(p=f[l].n,i=[p[u[a]],p[o]],n=2;n--;)e=i[n],e&&(h.push(e),m=m.concat(e.f||[]));f=h}return m},d.on=function(t,e){if(t=String(t),"function"!=typeof e)return function(){};for(var i=t.split(r),n=c,a=0,o=i.length;o>a;a++)n=n.n,n=n.hasOwnProperty(i[a])&&n[i[a]]||(n[i[a]]={n:{}});for(n.f=n.f||[],a=0,o=n.f.length;o>a;a++)if(n.f[a]==e)return s;return n.f.push(e),function(t){+t==+t&&(e.zIndex=+t)}},d.f=function(t){var e=[].slice.call(arguments,1);return function(){d.apply(null,[t,null].concat(e).concat([].slice.call(arguments,0)))}},d.stop=function(){i=1},d.nt=function(t){return t?new RegExp("(?:\\.|\\/|^)"+t+"(?:\\.|\\/|$)").test(e):e},d.nts=function(){return e.split(r)},d.off=d.unbind=function(t,e){if(!t)return void(d._events=c={n:{}});var i,n,s,l,h,u,p,f=t.split(r),m=[c];for(l=0,h=f.length;h>l;l++)for(u=0;u<m.length;u+=s.length-2){if(s=[u,1],i=m[u].n,f[l]!=o)i[f[l]]&&s.push(i[f[l]]);else for(n in i)i[a](n)&&s.push(i[n]);m.splice.apply(m,s)}for(l=0,h=m.length;h>l;l++)for(i=m[l];i.n;){if(e){if(i.f){for(u=0,p=i.f.length;p>u;u++)if(i.f[u]==e){i.f.splice(u,1);break}!i.f.length&&delete i.f}for(n in i.n)if(i.n[a](n)&&i.n[n].f){var g=i.n[n].f;for(u=0,p=g.length;p>u;u++)if(g[u]==e){g.splice(u,1);break}!g.length&&delete i.n[n].f}}else{delete i.f;for(n in i.n)i.n[a](n)&&i.n[n].f&&delete i.n[n].f}i=i.n}},d.once=function(t,e){var i=function(){return d.unbind(t,i),e.apply(this,arguments)};return d.on(t,i)},d.version=n,d.toString=function(){return"You are running Eve "+n},"undefined"!=typeof module&&module.exports?module.exports=d:"undefined"!=typeof define?define("eve",[],function(){return d}):t.eve=d}(this),function(t,e){"function"==typeof define&&define.amd?define("raphael",["eve"],function(i){return e(t,i)}):e(t,t.eve)}(this,function(t,e){function i(t){if(i.is(t,"function"))return b?t():e.on("raphael.DOMload",t);if(i.is(t,W))return i._engine.create[x](i,t.splice(0,3+i.is(t[0],z))).add(t);var n=Array.prototype.slice.call(arguments,0);if(i.is(n[n.length-1],"function")){var a=n.pop();return b?a.call(i._engine.create[x](i,n)):e.on("raphael.DOMload",function(){a.call(i._engine.create[x](i,n))})}return i._engine.create[x](i,arguments)}function n(t){if("function"==typeof t||Object(t)!==t)return t;var e=new t.constructor;for(var i in t)t[w](i)&&(e[i]=n(t[i]));return e}function a(t,e){for(var i=0,n=t.length;n>i;i++)if(t[i]===e)return t.push(t.splice(i,1)[0])}function r(t,e,i){function n(){var r=Array.prototype.slice.call(arguments,0),o=r.join("␀"),s=n.cache=n.cache||{},l=n.count=n.count||[];return s[w](o)?(a(l,o),i?i(s[o]):s[o]):(l.length>=1e3&&delete s[l.shift()],l.push(o),s[o]=t[x](e,r),i?i(s[o]):s[o])}return n}function o(){return this.hex}function s(t,e){for(var i=[],n=0,a=t.length;a-2*!e>n;n+=2){var r=[{x:+t[n-2],y:+t[n-1]},{x:+t[n],y:+t[n+1]},{x:+t[n+2],y:+t[n+3]},{x:+t[n+4],y:+t[n+5]}];e?n?a-4==n?r[3]={x:+t[0],y:+t[1]}:a-2==n&&(r[2]={x:+t[0],y:+t[1]},r[3]={x:+t[2],y:+t[3]}):r[0]={x:+t[a-2],y:+t[a-1]}:a-4==n?r[3]=r[2]:n||(r[0]={x:+t[n],y:+t[n+1]}),i.push(["C",(-r[0].x+6*r[1].x+r[2].x)/6,(-r[0].y+6*r[1].y+r[2].y)/6,(r[1].x+6*r[2].x-r[3].x)/6,(r[1].y+6*r[2].y-r[3].y)/6,r[2].x,r[2].y])}return i}function l(t,e,i,n,a){var r=-3*e+9*i-9*n+3*a,o=t*r+6*e-12*i+6*n;return t*o-3*e+3*i}function c(t,e,i,n,a,r,o,s,c){null==c&&(c=1),c=c>1?1:0>c?0:c;for(var d=c/2,h=12,u=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],p=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],f=0,m=0;h>m;m++){var g=d*u[m]+d,v=l(g,t,i,a,o),C=l(g,e,n,r,s),I=v*v+C*C;f+=p[m]*L.sqrt(I)}return d*f}function d(t,e,i,n,a,r,o,s,l){if(!(0>l||c(t,e,i,n,a,r,o,s)<l)){var d,h=1,u=h/2,p=h-u,f=.01;for(d=c(t,e,i,n,a,r,o,s,p);F(d-l)>f;)u/=2,p+=(l>d?1:-1)*u,d=c(t,e,i,n,a,r,o,s,p);return p}}function h(t,e,i,n,a,r,o,s){if(!(B(t,i)<$(a,o)||$(t,i)>B(a,o)||B(e,n)<$(r,s)||$(e,n)>B(r,s))){var l=(t*n-e*i)*(a-o)-(t-i)*(a*s-r*o),c=(t*n-e*i)*(r-s)-(e-n)*(a*s-r*o),d=(t-i)*(r-s)-(e-n)*(a-o);if(d){var h=l/d,u=c/d,p=+h.toFixed(2),f=+u.toFixed(2);if(!(p<+$(t,i).toFixed(2)||p>+B(t,i).toFixed(2)||p<+$(a,o).toFixed(2)||p>+B(a,o).toFixed(2)||f<+$(e,n).toFixed(2)||f>+B(e,n).toFixed(2)||f<+$(r,s).toFixed(2)||f>+B(r,s).toFixed(2)))return{x:h,y:u}}}}function u(t,e,n){var a=i.bezierBBox(t),r=i.bezierBBox(e);if(!i.isBBoxIntersect(a,r))return n?0:[];for(var o=c.apply(0,t),s=c.apply(0,e),l=B(~~(o/5),1),d=B(~~(s/5),1),u=[],p=[],f={},m=n?0:[],g=0;l+1>g;g++){var v=i.findDotsAtSegment.apply(i,t.concat(g/l));u.push({x:v.x,y:v.y,t:g/l})}for(g=0;d+1>g;g++)v=i.findDotsAtSegment.apply(i,e.concat(g/d)),p.push({x:v.x,y:v.y,t:g/d});for(g=0;l>g;g++)for(var C=0;d>C;C++){var I=u[g],b=u[g+1],E=p[C],y=p[C+1],T=F(b.x-I.x)<.001?"y":"x",R=F(y.x-E.x)<.001?"y":"x",w=h(I.x,I.y,b.x,b.y,E.x,E.y,y.x,y.y);if(w){if(f[w.x.toFixed(4)]==w.y.toFixed(4))continue;f[w.x.toFixed(4)]=w.y.toFixed(4);var O=I.t+F((w[T]-I[T])/(b[T]-I[T]))*(b.t-I.t),_=E.t+F((w[R]-E[R])/(y[R]-E[R]))*(y.t-E.t);O>=0&&1.001>=O&&_>=0&&1.001>=_&&(n?m++:m.push({x:w.x,y:w.y,t1:$(O,1),t2:$(_,1)}))}}return m}function p(t,e,n){t=i._path2curve(t),e=i._path2curve(e);for(var a,r,o,s,l,c,d,h,p,f,m=n?0:[],g=0,v=t.length;v>g;g++){var C=t[g];if("M"==C[0])a=l=C[1],r=c=C[2];else{"C"==C[0]?(p=[a,r].concat(C.slice(1)),a=p[6],r=p[7]):(p=[a,r,a,r,l,c,l,c],a=l,r=c);for(var I=0,b=e.length;b>I;I++){var E=e[I];if("M"==E[0])o=d=E[1],s=h=E[2];else{"C"==E[0]?(f=[o,s].concat(E.slice(1)),o=f[6],s=f[7]):(f=[o,s,o,s,d,h,d,h],o=d,s=h);var y=u(p,f,n);if(n)m+=y;else{for(var T=0,R=y.length;R>T;T++)y[T].segment1=g,y[T].segment2=I,y[T].bez1=p,y[T].bez2=f;m=m.concat(y)}}}}}return m}function f(t,e,i,n,a,r){null!=t?(this.a=+t,this.b=+e,this.c=+i,this.d=+n,this.e=+a,this.f=+r):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function m(){return this.x+S+this.y+S+this.width+" × "+this.height}function g(t,e,i,n,a,r){function o(t){return((h*t+d)*t+c)*t}function s(t,e){var i=l(t,e);return((f*i+p)*i+u)*i}function l(t,e){var i,n,a,r,s,l;for(a=t,l=0;8>l;l++){if(r=o(a)-t,F(r)<e)return a;if(s=(3*h*a+2*d)*a+c,F(s)<1e-6)break;a-=r/s}if(i=0,n=1,a=t,i>a)return i;if(a>n)return n;for(;n>i;){if(r=o(a),F(r-t)<e)return a;t>r?i=a:n=a,a=(n-i)/2+i}return a}var c=3*e,d=3*(n-e)-c,h=1-c-d,u=3*i,p=3*(a-i)-u,f=1-u-p;return s(t,1/(200*r))}function v(t,e){var i=[],n={};if(this.ms=e,this.times=1,t){for(var a in t)t[w](a)&&(n[Z(a)]=t[a],i.push(Z(a)));i.sort(he)}this.anim=n,this.top=i[i.length-1],this.percents=i}function C(t,n,a,r,o,s){a=Z(a);var l,c,d,h,u,p,m=t.ms,v={},C={},I={};if(r)for(E=0,T=li.length;T>E;E++){var b=li[E];if(b.el.id==n.id&&b.anim==t){b.percent!=a?(li.splice(E,1),d=1):c=b,n.attr(b.totalOrigin);break}}else r=+C;for(var E=0,T=t.percents.length;T>E;E++){if(t.percents[E]==a||t.percents[E]>r*t.top){a=t.percents[E],u=t.percents[E-1]||0,m=m/t.top*(a-u),h=t.percents[E+1],l=t.anim[a];break}r&&n.attr(t.anim[t.percents[E]])}if(l){if(c)c.initstatus=r,c.start=new Date-c.ms*r;else{for(var R in l)if(l[w](R)&&(ne[w](R)||n.paper.customAttributes[w](R)))switch(v[R]=n.attr(R),null==v[R]&&(v[R]=ie[R]),C[R]=l[R],ne[R]){case z:I[R]=(C[R]-v[R])/m;break;case"colour":v[R]=i.getRGB(v[R]);var O=i.getRGB(C[R]);I[R]={r:(O.r-v[R].r)/m,g:(O.g-v[R].g)/m,b:(O.b-v[R].b)/m};break;case"path":var _=Qe(v[R],C[R]),D=_[1];for(v[R]=_[0],I[R]=[],E=0,T=v[R].length;T>E;E++){I[R][E]=[0];for(var x=1,K=v[R][E].length;K>x;x++)I[R][E][x]=(D[E][x]-v[R][E][x])/m}break;case"transform":var q=n._,S=$e(q[R],C[R]);if(S)for(v[R]=S.from,C[R]=S.to,I[R]=[],I[R].real=!0,E=0,T=v[R].length;T>E;E++)for(I[R][E]=[v[R][E][0]],x=1,K=v[R][E].length;K>x;x++)I[R][E][x]=(C[R][E][x]-v[R][E][x])/m;else{var Q=n.matrix||new f,M={_:{transform:q.transform},getBBox:function(){return n.getBBox(1)}};v[R]=[Q.a,Q.b,Q.c,Q.d,Q.e,Q.f],Le(M,C[R]),C[R]=M._.transform,I[R]=[(M.matrix.a-Q.a)/m,(M.matrix.b-Q.b)/m,(M.matrix.c-Q.c)/m,(M.matrix.d-Q.d)/m,(M.matrix.e-Q.e)/m,(M.matrix.f-Q.f)/m]}break;case"csv":var P=N(l[R])[A](y),L=N(v[R])[A](y);if("clip-rect"==R)for(v[R]=L,I[R]=[],E=L.length;E--;)I[R][E]=(P[E]-v[R][E])/m;C[R]=P;break;default:for(P=[][k](l[R]),L=[][k](v[R]),I[R]=[],E=n.paper.customAttributes[R].length;E--;)I[R][E]=((P[E]||0)-(L[E]||0))/m}var B=l.easing,$=i.easing_formulas[B];if(!$)if($=N(B).match(Y),$&&5==$.length){var F=$;$=function(t){return g(t,+F[1],+F[2],+F[3],+F[4],m)}}else $=pe;if(p=l.start||t.start||+new Date,b={anim:t,percent:a,timestamp:p,start:p+(t.del||0),status:0,initstatus:r||0,stop:!1,ms:m,easing:$,from:v,diff:I,to:C,el:n,callback:l.callback,prev:u,next:h,repeat:s||t.times,origin:n.attr(),totalOrigin:o},li.push(b),r&&!c&&!d&&(b.stop=!0,b.start=new Date-m*r,1==li.length))return di();d&&(b.start=new Date-b.ms*r),1==li.length&&ci(di)}e("raphael.anim.start."+n.id,n,t)}}function I(t){for(var e=0;e<li.length;e++)li[e].el.paper==t&&li.splice(e--,1)}i.version="2.1.0",i.eve=e;var b,E,y=/[, ]+/,T={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},R=/\{(\d+)\}/g,w="hasOwnProperty",O={doc:document,win:t},_={was:Object.prototype[w].call(O.win,"Raphael"),is:O.win.Raphael},D=function(){this.ca=this.customAttributes={}},x="apply",k="concat",K="ontouchstart"in O.win||O.win.DocumentTouch&&O.doc instanceof DocumentTouch,q="",S=" ",N=String,A="split",Q="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[A](S),M={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},P=N.prototype.toLowerCase,L=Math,B=L.max,$=L.min,F=L.abs,H=L.pow,j=L.PI,z="number",U="string",W="array",V=Object.prototype.toString,G=(i._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),X={NaN:1,Infinity:1,"-Infinity":1},Y=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,J=L.round,Z=parseFloat,te=parseInt,ee=N.prototype.toUpperCase,ie=i._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},ne=i._availableAnimAttrs={blur:z,"clip-rect":"csv",cx:z,cy:z,fill:"colour","fill-opacity":z,"font-size":z,height:z,opacity:z,path:"path",r:z,rx:z,ry:z,stroke:"colour","stroke-opacity":z,"stroke-width":z,transform:"transform",width:z,x:z,y:z},ae=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,re={hs:1,rg:1},oe=/,?([achlmqrstvxz]),?/gi,se=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,le=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,ce=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,de=(i._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),he=function(t,e){return Z(t)-Z(e)},ue=function(){},pe=function(t){return t},fe=i._rectPath=function(t,e,i,n,a){return a?[["M",t+a,e],["l",i-2*a,0],["a",a,a,0,0,1,a,a],["l",0,n-2*a],["a",a,a,0,0,1,-a,a],["l",2*a-i,0],["a",a,a,0,0,1,-a,-a],["l",0,2*a-n],["a",a,a,0,0,1,a,-a],["z"]]:[["M",t,e],["l",i,0],["l",0,n],["l",-i,0],["z"]]},me=function(t,e,i,n){return null==n&&(n=i),[["M",t,e],["m",0,-n],["a",i,n,0,1,1,0,2*n],["a",i,n,0,1,1,0,-2*n],["z"]]},ge=i._getPath={path:function(t){return t.attr("path")},circle:function(t){var e=t.attrs;return me(e.cx,e.cy,e.r)},ellipse:function(t){var e=t.attrs;return me(e.cx,e.cy,e.rx,e.ry)},rect:function(t){var e=t.attrs;return fe(e.x,e.y,e.width,e.height,e.r)},image:function(t){var e=t.attrs;return fe(e.x,e.y,e.width,e.height)},text:function(t){var e=t._getBBox();return fe(e.x,e.y,e.width,e.height)},set:function(t){var e=t._getBBox();return fe(e.x,e.y,e.width,e.height)}},ve=i.mapPath=function(t,e){if(!e)return t;var i,n,a,r,o,s,l;for(t=Qe(t),a=0,o=t.length;o>a;a++)for(l=t[a],r=1,s=l.length;s>r;r+=2)i=e.x(l[r],l[r+1]),n=e.y(l[r],l[r+1]),l[r]=i,l[r+1]=n;return t};if(i._g=O,i.type=O.win.SVGAngle||O.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML","VML"==i.type){var Ce,Ie=O.doc.createElement("div");if(Ie.innerHTML='<v:shape adj="1"/>',Ce=Ie.firstChild,Ce.style.behavior="url(#default#VML)",!Ce||"object"!=typeof Ce.adj)return i.type=q;Ie=null}i.svg=!(i.vml="VML"==i.type),i._Paper=D,i.fn=E=D.prototype=i.prototype,i._id=0,i._oid=0,i.is=function(t,e){return e=P.call(e),"finite"==e?!X[w](+t):"array"==e?t instanceof Array:"null"==e&&null===t||e==typeof t&&null!==t||"object"==e&&t===Object(t)||"array"==e&&Array.isArray&&Array.isArray(t)||V.call(t).slice(8,-1).toLowerCase()==e
},i.angle=function(t,e,n,a,r,o){if(null==r){var s=t-n,l=e-a;return s||l?(180+180*L.atan2(-l,-s)/j+360)%360:0}return i.angle(t,e,r,o)-i.angle(n,a,r,o)},i.rad=function(t){return t%360*j/180},i.deg=function(t){return 180*t/j%360},i.snapTo=function(t,e,n){if(n=i.is(n,"finite")?n:10,i.is(t,W)){for(var a=t.length;a--;)if(F(t[a]-e)<=n)return t[a]}else{t=+t;var r=e%t;if(n>r)return e-r;if(r>t-n)return e-r+t}return e};i.createUUID=function(t,e){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(t,e).toUpperCase()}}(/[xy]/g,function(t){var e=16*L.random()|0,i="x"==t?e:3&e|8;return i.toString(16)});i.setWindow=function(t){e("raphael.setWindow",i,O.win,t),O.win=t,O.doc=O.win.document,i._engine.initWin&&i._engine.initWin(O.win)};var be=function(t){if(i.vml){var e,n=/^\s+|\s+$/g;try{var a=new ActiveXObject("htmlfile");a.write("<body>"),a.close(),e=a.body}catch(o){e=createPopup().document.body}var s=e.createTextRange();be=r(function(t){try{e.style.color=N(t).replace(n,q);var i=s.queryCommandValue("ForeColor");return i=(255&i)<<16|65280&i|(16711680&i)>>>16,"#"+("000000"+i.toString(16)).slice(-6)}catch(a){return"none"}})}else{var l=O.doc.createElement("i");l.title="Raphaël Colour Picker",l.style.display="none",O.doc.body.appendChild(l),be=r(function(t){return l.style.color=t,O.doc.defaultView.getComputedStyle(l,q).getPropertyValue("color")})}return be(t)},Ee=function(){return"hsb("+[this.h,this.s,this.b]+")"},ye=function(){return"hsl("+[this.h,this.s,this.l]+")"},Te=function(){return this.hex},Re=function(t,e,n){if(null==e&&i.is(t,"object")&&"r"in t&&"g"in t&&"b"in t&&(n=t.b,e=t.g,t=t.r),null==e&&i.is(t,U)){var a=i.getRGB(t);t=a.r,e=a.g,n=a.b}return(t>1||e>1||n>1)&&(t/=255,e/=255,n/=255),[t,e,n]},we=function(t,e,n,a){t*=255,e*=255,n*=255;var r={r:t,g:e,b:n,hex:i.rgb(t,e,n),toString:Te};return i.is(a,"finite")&&(r.opacity=a),r};i.color=function(t){var e;return i.is(t,"object")&&"h"in t&&"s"in t&&"b"in t?(e=i.hsb2rgb(t),t.r=e.r,t.g=e.g,t.b=e.b,t.hex=e.hex):i.is(t,"object")&&"h"in t&&"s"in t&&"l"in t?(e=i.hsl2rgb(t),t.r=e.r,t.g=e.g,t.b=e.b,t.hex=e.hex):(i.is(t,"string")&&(t=i.getRGB(t)),i.is(t,"object")&&"r"in t&&"g"in t&&"b"in t?(e=i.rgb2hsl(t),t.h=e.h,t.s=e.s,t.l=e.l,e=i.rgb2hsb(t),t.v=e.b):(t={hex:"none"},t.r=t.g=t.b=t.h=t.s=t.v=t.l=-1)),t.toString=Te,t},i.hsb2rgb=function(t,e,i,n){this.is(t,"object")&&"h"in t&&"s"in t&&"b"in t&&(i=t.b,e=t.s,t=t.h,n=t.o),t*=360;var a,r,o,s,l;return t=t%360/60,l=i*e,s=l*(1-F(t%2-1)),a=r=o=i-l,t=~~t,a+=[l,s,0,0,s,l][t],r+=[s,l,l,s,0,0][t],o+=[0,0,s,l,l,s][t],we(a,r,o,n)},i.hsl2rgb=function(t,e,i,n){this.is(t,"object")&&"h"in t&&"s"in t&&"l"in t&&(i=t.l,e=t.s,t=t.h),(t>1||e>1||i>1)&&(t/=360,e/=100,i/=100),t*=360;var a,r,o,s,l;return t=t%360/60,l=2*e*(.5>i?i:1-i),s=l*(1-F(t%2-1)),a=r=o=i-l/2,t=~~t,a+=[l,s,0,0,s,l][t],r+=[s,l,l,s,0,0][t],o+=[0,0,s,l,l,s][t],we(a,r,o,n)},i.rgb2hsb=function(t,e,i){i=Re(t,e,i),t=i[0],e=i[1],i=i[2];var n,a,r,o;return r=B(t,e,i),o=r-$(t,e,i),n=0==o?null:r==t?(e-i)/o:r==e?(i-t)/o+2:(t-e)/o+4,n=(n+360)%6*60/360,a=0==o?0:o/r,{h:n,s:a,b:r,toString:Ee}},i.rgb2hsl=function(t,e,i){i=Re(t,e,i),t=i[0],e=i[1],i=i[2];var n,a,r,o,s,l;return o=B(t,e,i),s=$(t,e,i),l=o-s,n=0==l?null:o==t?(e-i)/l:o==e?(i-t)/l+2:(t-e)/l+4,n=(n+360)%6*60/360,r=(o+s)/2,a=0==l?0:.5>r?l/(2*r):l/(2-2*r),{h:n,s:a,l:r,toString:ye}},i._path2string=function(){return this.join(",").replace(oe,"$1")};i._preload=function(t,e){var i=O.doc.createElement("img");i.style.cssText="position:absolute;left:-9999em;top:-9999em",i.onload=function(){e.call(this),this.onload=null,O.doc.body.removeChild(this)},i.onerror=function(){O.doc.body.removeChild(this)},O.doc.body.appendChild(i),i.src=t};i.getRGB=r(function(t){if(!t||(t=N(t)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:o};if("none"==t)return{r:-1,g:-1,b:-1,hex:"none",toString:o};!(re[w](t.toLowerCase().substring(0,2))||"#"==t.charAt())&&(t=be(t));var e,n,a,r,s,l,c=t.match(G);return c?(c[2]&&(a=te(c[2].substring(5),16),n=te(c[2].substring(3,5),16),e=te(c[2].substring(1,3),16)),c[3]&&(a=te((s=c[3].charAt(3))+s,16),n=te((s=c[3].charAt(2))+s,16),e=te((s=c[3].charAt(1))+s,16)),c[4]&&(l=c[4][A](ae),e=Z(l[0]),"%"==l[0].slice(-1)&&(e*=2.55),n=Z(l[1]),"%"==l[1].slice(-1)&&(n*=2.55),a=Z(l[2]),"%"==l[2].slice(-1)&&(a*=2.55),"rgba"==c[1].toLowerCase().slice(0,4)&&(r=Z(l[3])),l[3]&&"%"==l[3].slice(-1)&&(r/=100)),c[5]?(l=c[5][A](ae),e=Z(l[0]),"%"==l[0].slice(-1)&&(e*=2.55),n=Z(l[1]),"%"==l[1].slice(-1)&&(n*=2.55),a=Z(l[2]),"%"==l[2].slice(-1)&&(a*=2.55),("deg"==l[0].slice(-3)||"°"==l[0].slice(-1))&&(e/=360),"hsba"==c[1].toLowerCase().slice(0,4)&&(r=Z(l[3])),l[3]&&"%"==l[3].slice(-1)&&(r/=100),i.hsb2rgb(e,n,a,r)):c[6]?(l=c[6][A](ae),e=Z(l[0]),"%"==l[0].slice(-1)&&(e*=2.55),n=Z(l[1]),"%"==l[1].slice(-1)&&(n*=2.55),a=Z(l[2]),"%"==l[2].slice(-1)&&(a*=2.55),("deg"==l[0].slice(-3)||"°"==l[0].slice(-1))&&(e/=360),"hsla"==c[1].toLowerCase().slice(0,4)&&(r=Z(l[3])),l[3]&&"%"==l[3].slice(-1)&&(r/=100),i.hsl2rgb(e,n,a,r)):(c={r:e,g:n,b:a,toString:o},c.hex="#"+(16777216|a|n<<8|e<<16).toString(16).slice(1),i.is(r,"finite")&&(c.opacity=r),c)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:o}},i),i.hsb=r(function(t,e,n){return i.hsb2rgb(t,e,n).hex}),i.hsl=r(function(t,e,n){return i.hsl2rgb(t,e,n).hex}),i.rgb=r(function(t,e,i){return"#"+(16777216|i|e<<8|t<<16).toString(16).slice(1)}),i.getColor=function(t){var e=this.getColor.start=this.getColor.start||{h:0,s:1,b:t||.75},i=this.hsb2rgb(e.h,e.s,e.b);return e.h+=.075,e.h>1&&(e.h=0,e.s-=.2,e.s<=0&&(this.getColor.start={h:0,s:1,b:e.b})),i.hex},i.getColor.reset=function(){delete this.start},i.parsePathString=function(t){if(!t)return null;var e=Oe(t);if(e.arr)return De(e.arr);var n={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},a=[];return i.is(t,W)&&i.is(t[0],W)&&(a=De(t)),a.length||N(t).replace(se,function(t,e,i){var r=[],o=e.toLowerCase();if(i.replace(ce,function(t,e){e&&r.push(+e)}),"m"==o&&r.length>2&&(a.push([e][k](r.splice(0,2))),o="l",e="m"==e?"l":"L"),"r"==o)a.push([e][k](r));else for(;r.length>=n[o]&&(a.push([e][k](r.splice(0,n[o]))),n[o]););}),a.toString=i._path2string,e.arr=De(a),a},i.parseTransformString=r(function(t){if(!t)return null;var e=[];return i.is(t,W)&&i.is(t[0],W)&&(e=De(t)),e.length||N(t).replace(le,function(t,i,n){{var a=[];P.call(i)}n.replace(ce,function(t,e){e&&a.push(+e)}),e.push([i][k](a))}),e.toString=i._path2string,e});var Oe=function(t){var e=Oe.ps=Oe.ps||{};return e[t]?e[t].sleep=100:e[t]={sleep:100},setTimeout(function(){for(var i in e)e[w](i)&&i!=t&&(e[i].sleep--,!e[i].sleep&&delete e[i])}),e[t]};i.findDotsAtSegment=function(t,e,i,n,a,r,o,s,l){var c=1-l,d=H(c,3),h=H(c,2),u=l*l,p=u*l,f=d*t+3*h*l*i+3*c*l*l*a+p*o,m=d*e+3*h*l*n+3*c*l*l*r+p*s,g=t+2*l*(i-t)+u*(a-2*i+t),v=e+2*l*(n-e)+u*(r-2*n+e),C=i+2*l*(a-i)+u*(o-2*a+i),I=n+2*l*(r-n)+u*(s-2*r+n),b=c*t+l*i,E=c*e+l*n,y=c*a+l*o,T=c*r+l*s,R=90-180*L.atan2(g-C,v-I)/j;return(g>C||I>v)&&(R+=180),{x:f,y:m,m:{x:g,y:v},n:{x:C,y:I},start:{x:b,y:E},end:{x:y,y:T},alpha:R}},i.bezierBBox=function(t,e,n,a,r,o,s,l){i.is(t,"array")||(t=[t,e,n,a,r,o,s,l]);var c=Ae.apply(null,t);return{x:c.min.x,y:c.min.y,x2:c.max.x,y2:c.max.y,width:c.max.x-c.min.x,height:c.max.y-c.min.y}},i.isPointInsideBBox=function(t,e,i){return e>=t.x&&e<=t.x2&&i>=t.y&&i<=t.y2},i.isBBoxIntersect=function(t,e){var n=i.isPointInsideBBox;return n(e,t.x,t.y)||n(e,t.x2,t.y)||n(e,t.x,t.y2)||n(e,t.x2,t.y2)||n(t,e.x,e.y)||n(t,e.x2,e.y)||n(t,e.x,e.y2)||n(t,e.x2,e.y2)||(t.x<e.x2&&t.x>e.x||e.x<t.x2&&e.x>t.x)&&(t.y<e.y2&&t.y>e.y||e.y<t.y2&&e.y>t.y)},i.pathIntersection=function(t,e){return p(t,e)},i.pathIntersectionNumber=function(t,e){return p(t,e,1)},i.isPointInsidePath=function(t,e,n){var a=i.pathBBox(t);return i.isPointInsideBBox(a,e,n)&&p(t,[["M",e,n],["H",a.x2+10]],1)%2==1},i._removedFactory=function(t){return function(){e("raphael.log",null,"Raphaël: you are calling to method “"+t+"” of removed object",t)}};var _e=i.pathBBox=function(t){var e=Oe(t);if(e.bbox)return n(e.bbox);if(!t)return{x:0,y:0,width:0,height:0,x2:0,y2:0};t=Qe(t);for(var i,a=0,r=0,o=[],s=[],l=0,c=t.length;c>l;l++)if(i=t[l],"M"==i[0])a=i[1],r=i[2],o.push(a),s.push(r);else{var d=Ae(a,r,i[1],i[2],i[3],i[4],i[5],i[6]);o=o[k](d.min.x,d.max.x),s=s[k](d.min.y,d.max.y),a=i[5],r=i[6]}var h=$[x](0,o),u=$[x](0,s),p=B[x](0,o),f=B[x](0,s),m=p-h,g=f-u,v={x:h,y:u,x2:p,y2:f,width:m,height:g,cx:h+m/2,cy:u+g/2};return e.bbox=n(v),v},De=function(t){var e=n(t);return e.toString=i._path2string,e},xe=i._pathToRelative=function(t){var e=Oe(t);if(e.rel)return De(e.rel);i.is(t,W)&&i.is(t&&t[0],W)||(t=i.parsePathString(t));var n=[],a=0,r=0,o=0,s=0,l=0;"M"==t[0][0]&&(a=t[0][1],r=t[0][2],o=a,s=r,l++,n.push(["M",a,r]));for(var c=l,d=t.length;d>c;c++){var h=n[c]=[],u=t[c];if(u[0]!=P.call(u[0]))switch(h[0]=P.call(u[0]),h[0]){case"a":h[1]=u[1],h[2]=u[2],h[3]=u[3],h[4]=u[4],h[5]=u[5],h[6]=+(u[6]-a).toFixed(3),h[7]=+(u[7]-r).toFixed(3);break;case"v":h[1]=+(u[1]-r).toFixed(3);break;case"m":o=u[1],s=u[2];default:for(var p=1,f=u.length;f>p;p++)h[p]=+(u[p]-(p%2?a:r)).toFixed(3)}else{h=n[c]=[],"m"==u[0]&&(o=u[1]+a,s=u[2]+r);for(var m=0,g=u.length;g>m;m++)n[c][m]=u[m]}var v=n[c].length;switch(n[c][0]){case"z":a=o,r=s;break;case"h":a+=+n[c][v-1];break;case"v":r+=+n[c][v-1];break;default:a+=+n[c][v-2],r+=+n[c][v-1]}}return n.toString=i._path2string,e.rel=De(n),n},ke=i._pathToAbsolute=function(t){var e=Oe(t);if(e.abs)return De(e.abs);if(i.is(t,W)&&i.is(t&&t[0],W)||(t=i.parsePathString(t)),!t||!t.length)return[["M",0,0]];var n=[],a=0,r=0,o=0,l=0,c=0;"M"==t[0][0]&&(a=+t[0][1],r=+t[0][2],o=a,l=r,c++,n[0]=["M",a,r]);for(var d,h,u=3==t.length&&"M"==t[0][0]&&"R"==t[1][0].toUpperCase()&&"Z"==t[2][0].toUpperCase(),p=c,f=t.length;f>p;p++){if(n.push(d=[]),h=t[p],h[0]!=ee.call(h[0]))switch(d[0]=ee.call(h[0]),d[0]){case"A":d[1]=h[1],d[2]=h[2],d[3]=h[3],d[4]=h[4],d[5]=h[5],d[6]=+(h[6]+a),d[7]=+(h[7]+r);break;case"V":d[1]=+h[1]+r;break;case"H":d[1]=+h[1]+a;break;case"R":for(var m=[a,r][k](h.slice(1)),g=2,v=m.length;v>g;g++)m[g]=+m[g]+a,m[++g]=+m[g]+r;n.pop(),n=n[k](s(m,u));break;case"M":o=+h[1]+a,l=+h[2]+r;default:for(g=1,v=h.length;v>g;g++)d[g]=+h[g]+(g%2?a:r)}else if("R"==h[0])m=[a,r][k](h.slice(1)),n.pop(),n=n[k](s(m,u)),d=["R"][k](h.slice(-2));else for(var C=0,I=h.length;I>C;C++)d[C]=h[C];switch(d[0]){case"Z":a=o,r=l;break;case"H":a=d[1];break;case"V":r=d[1];break;case"M":o=d[d.length-2],l=d[d.length-1];default:a=d[d.length-2],r=d[d.length-1]}}return n.toString=i._path2string,e.abs=De(n),n},Ke=function(t,e,i,n){return[t,e,i,n,i,n]},qe=function(t,e,i,n,a,r){var o=1/3,s=2/3;return[o*t+s*i,o*e+s*n,o*a+s*i,o*r+s*n,a,r]},Se=function(t,e,i,n,a,o,s,l,c,d){var h,u=120*j/180,p=j/180*(+a||0),f=[],m=r(function(t,e,i){var n=t*L.cos(i)-e*L.sin(i),a=t*L.sin(i)+e*L.cos(i);return{x:n,y:a}});if(d)R=d[0],w=d[1],y=d[2],T=d[3];else{h=m(t,e,-p),t=h.x,e=h.y,h=m(l,c,-p),l=h.x,c=h.y;var g=(L.cos(j/180*a),L.sin(j/180*a),(t-l)/2),v=(e-c)/2,C=g*g/(i*i)+v*v/(n*n);C>1&&(C=L.sqrt(C),i=C*i,n=C*n);var I=i*i,b=n*n,E=(o==s?-1:1)*L.sqrt(F((I*b-I*v*v-b*g*g)/(I*v*v+b*g*g))),y=E*i*v/n+(t+l)/2,T=E*-n*g/i+(e+c)/2,R=L.asin(((e-T)/n).toFixed(9)),w=L.asin(((c-T)/n).toFixed(9));R=y>t?j-R:R,w=y>l?j-w:w,0>R&&(R=2*j+R),0>w&&(w=2*j+w),s&&R>w&&(R-=2*j),!s&&w>R&&(w-=2*j)}var O=w-R;if(F(O)>u){var _=w,D=l,x=c;w=R+u*(s&&w>R?1:-1),l=y+i*L.cos(w),c=T+n*L.sin(w),f=Se(l,c,i,n,a,0,s,D,x,[w,_,y,T])}O=w-R;var K=L.cos(R),q=L.sin(R),S=L.cos(w),N=L.sin(w),Q=L.tan(O/4),M=4/3*i*Q,P=4/3*n*Q,B=[t,e],$=[t+M*q,e-P*K],H=[l+M*N,c-P*S],z=[l,c];if($[0]=2*B[0]-$[0],$[1]=2*B[1]-$[1],d)return[$,H,z][k](f);f=[$,H,z][k](f).join()[A](",");for(var U=[],W=0,V=f.length;V>W;W++)U[W]=W%2?m(f[W-1],f[W],p).y:m(f[W],f[W+1],p).x;return U},Ne=function(t,e,i,n,a,r,o,s,l){var c=1-l;return{x:H(c,3)*t+3*H(c,2)*l*i+3*c*l*l*a+H(l,3)*o,y:H(c,3)*e+3*H(c,2)*l*n+3*c*l*l*r+H(l,3)*s}},Ae=r(function(t,e,i,n,a,r,o,s){var l,c=a-2*i+t-(o-2*a+i),d=2*(i-t)-2*(a-i),h=t-i,u=(-d+L.sqrt(d*d-4*c*h))/2/c,p=(-d-L.sqrt(d*d-4*c*h))/2/c,f=[e,s],m=[t,o];return F(u)>"1e12"&&(u=.5),F(p)>"1e12"&&(p=.5),u>0&&1>u&&(l=Ne(t,e,i,n,a,r,o,s,u),m.push(l.x),f.push(l.y)),p>0&&1>p&&(l=Ne(t,e,i,n,a,r,o,s,p),m.push(l.x),f.push(l.y)),c=r-2*n+e-(s-2*r+n),d=2*(n-e)-2*(r-n),h=e-n,u=(-d+L.sqrt(d*d-4*c*h))/2/c,p=(-d-L.sqrt(d*d-4*c*h))/2/c,F(u)>"1e12"&&(u=.5),F(p)>"1e12"&&(p=.5),u>0&&1>u&&(l=Ne(t,e,i,n,a,r,o,s,u),m.push(l.x),f.push(l.y)),p>0&&1>p&&(l=Ne(t,e,i,n,a,r,o,s,p),m.push(l.x),f.push(l.y)),{min:{x:$[x](0,m),y:$[x](0,f)},max:{x:B[x](0,m),y:B[x](0,f)}}}),Qe=i._path2curve=r(function(t,e){var i=!e&&Oe(t);if(!e&&i.curve)return De(i.curve);for(var n=ke(t),a=e&&ke(e),r={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},s=(function(t,e,i){var n,a;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in{T:1,Q:1})&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"][k](Se[x](0,[e.x,e.y][k](t.slice(1))));break;case"S":"C"==i||"S"==i?(n=2*e.x-e.bx,a=2*e.y-e.by):(n=e.x,a=e.y),t=["C",n,a][k](t.slice(1));break;case"T":"Q"==i||"T"==i?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),t=["C"][k](qe(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"][k](qe(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"][k](Ke(e.x,e.y,t[1],t[2]));break;case"H":t=["C"][k](Ke(e.x,e.y,t[1],e.y));break;case"V":t=["C"][k](Ke(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"][k](Ke(e.x,e.y,e.X,e.Y))}return t}),l=function(t,e){if(t[e].length>7){t[e].shift();for(var i=t[e];i.length;)t.splice(e++,0,["C"][k](i.splice(0,6)));t.splice(e,1),h=B(n.length,a&&a.length||0)}},c=function(t,e,i,r,o){t&&e&&"M"==t[o][0]&&"M"!=e[o][0]&&(e.splice(o,0,["M",r.x,r.y]),i.bx=0,i.by=0,i.x=t[o][1],i.y=t[o][2],h=B(n.length,a&&a.length||0))},d=0,h=B(n.length,a&&a.length||0);h>d;d++){n[d]=s(n[d],r),l(n,d),a&&(a[d]=s(a[d],o)),a&&l(a,d),c(n,a,r,o,d),c(a,n,o,r,d);var u=n[d],p=a&&a[d],f=u.length,m=a&&p.length;r.x=u[f-2],r.y=u[f-1],r.bx=Z(u[f-4])||r.x,r.by=Z(u[f-3])||r.y,o.bx=a&&(Z(p[m-4])||o.x),o.by=a&&(Z(p[m-3])||o.y),o.x=a&&p[m-2],o.y=a&&p[m-1]}return a||(i.curve=De(n)),a?[n,a]:n},null,De),Me=(i._parseDots=r(function(t){for(var e=[],n=0,a=t.length;a>n;n++){var r={},o=t[n].match(/^([^:]*):?([\d\.]*)/);if(r.color=i.getRGB(o[1]),r.color.error)return null;r.color=r.color.hex,o[2]&&(r.offset=o[2]+"%"),e.push(r)}for(n=1,a=e.length-1;a>n;n++)if(!e[n].offset){for(var s=Z(e[n-1].offset||0),l=0,c=n+1;a>c;c++)if(e[c].offset){l=e[c].offset;break}l||(l=100,c=a),l=Z(l);for(var d=(l-s)/(c-n+1);c>n;n++)s+=d,e[n].offset=s+"%"}return e}),i._tear=function(t,e){t==e.top&&(e.top=t.prev),t==e.bottom&&(e.bottom=t.next),t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next)}),Pe=(i._tofront=function(t,e){e.top!==t&&(Me(t,e),t.next=null,t.prev=e.top,e.top.next=t,e.top=t)},i._toback=function(t,e){e.bottom!==t&&(Me(t,e),t.next=e.bottom,t.prev=null,e.bottom.prev=t,e.bottom=t)},i._insertafter=function(t,e,i){Me(t,i),e==i.top&&(i.top=t),e.next&&(e.next.prev=t),t.next=e.next,t.prev=e,e.next=t},i._insertbefore=function(t,e,i){Me(t,i),e==i.bottom&&(i.bottom=t),e.prev&&(e.prev.next=t),t.prev=e.prev,e.prev=t,t.next=e},i.toMatrix=function(t,e){var i=_e(t),n={_:{transform:q},getBBox:function(){return i}};return Le(n,e),n.matrix}),Le=(i.transformPath=function(t,e){return ve(t,Pe(t,e))},i._extractTransform=function(t,e){if(null==e)return t._.transform;e=N(e).replace(/\.{3}|\u2026/g,t._.transform||q);var n=i.parseTransformString(e),a=0,r=0,o=0,s=1,l=1,c=t._,d=new f;if(c.transform=n||[],n)for(var h=0,u=n.length;u>h;h++){var p,m,g,v,C,I=n[h],b=I.length,E=N(I[0]).toLowerCase(),y=I[0]!=E,T=y?d.invert():0;"t"==E&&3==b?y?(p=T.x(0,0),m=T.y(0,0),g=T.x(I[1],I[2]),v=T.y(I[1],I[2]),d.translate(g-p,v-m)):d.translate(I[1],I[2]):"r"==E?2==b?(C=C||t.getBBox(1),d.rotate(I[1],C.x+C.width/2,C.y+C.height/2),a+=I[1]):4==b&&(y?(g=T.x(I[2],I[3]),v=T.y(I[2],I[3]),d.rotate(I[1],g,v)):d.rotate(I[1],I[2],I[3]),a+=I[1]):"s"==E?2==b||3==b?(C=C||t.getBBox(1),d.scale(I[1],I[b-1],C.x+C.width/2,C.y+C.height/2),s*=I[1],l*=I[b-1]):5==b&&(y?(g=T.x(I[3],I[4]),v=T.y(I[3],I[4]),d.scale(I[1],I[2],g,v)):d.scale(I[1],I[2],I[3],I[4]),s*=I[1],l*=I[2]):"m"==E&&7==b&&d.add(I[1],I[2],I[3],I[4],I[5],I[6]),c.dirtyT=1,t.matrix=d}t.matrix=d,c.sx=s,c.sy=l,c.deg=a,c.dx=r=d.e,c.dy=o=d.f,1==s&&1==l&&!a&&c.bbox?(c.bbox.x+=+r,c.bbox.y+=+o):c.dirtyT=1}),Be=function(t){var e=t[0];switch(e.toLowerCase()){case"t":return[e,0,0];case"m":return[e,1,0,0,1,0,0];case"r":return 4==t.length?[e,0,t[2],t[3]]:[e,0];case"s":return 5==t.length?[e,1,1,t[3],t[4]]:3==t.length?[e,1,1]:[e,1]}},$e=i._equaliseTransform=function(t,e){e=N(e).replace(/\.{3}|\u2026/g,t),t=i.parseTransformString(t)||[],e=i.parseTransformString(e)||[];for(var n,a,r,o,s=B(t.length,e.length),l=[],c=[],d=0;s>d;d++){if(r=t[d]||Be(e[d]),o=e[d]||Be(r),r[0]!=o[0]||"r"==r[0].toLowerCase()&&(r[2]!=o[2]||r[3]!=o[3])||"s"==r[0].toLowerCase()&&(r[3]!=o[3]||r[4]!=o[4]))return;for(l[d]=[],c[d]=[],n=0,a=B(r.length,o.length);a>n;n++)n in r&&(l[d][n]=r[n]),n in o&&(c[d][n]=o[n])}return{from:l,to:c}};i._getContainer=function(t,e,n,a){var r;return r=null!=a||i.is(t,"object")?t:O.doc.getElementById(t),null!=r?r.tagName?null==e?{container:r,width:r.style.pixelWidth||r.offsetWidth,height:r.style.pixelHeight||r.offsetHeight}:{container:r,width:e,height:n}:{container:1,x:t,y:e,width:n,height:a}:void 0},i.pathToRelative=xe,i._engine={},i.path2curve=Qe,i.matrix=function(t,e,i,n,a,r){return new f(t,e,i,n,a,r)},function(t){function e(t){return t[0]*t[0]+t[1]*t[1]}function n(t){var i=L.sqrt(e(t));t[0]&&(t[0]/=i),t[1]&&(t[1]/=i)}t.add=function(t,e,i,n,a,r){var o,s,l,c,d=[[],[],[]],h=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],u=[[t,i,a],[e,n,r],[0,0,1]];for(t&&t instanceof f&&(u=[[t.a,t.c,t.e],[t.b,t.d,t.f],[0,0,1]]),o=0;3>o;o++)for(s=0;3>s;s++){for(c=0,l=0;3>l;l++)c+=h[o][l]*u[l][s];d[o][s]=c}this.a=d[0][0],this.b=d[1][0],this.c=d[0][1],this.d=d[1][1],this.e=d[0][2],this.f=d[1][2]},t.invert=function(){var t=this,e=t.a*t.d-t.b*t.c;return new f(t.d/e,-t.b/e,-t.c/e,t.a/e,(t.c*t.f-t.d*t.e)/e,(t.b*t.e-t.a*t.f)/e)},t.clone=function(){return new f(this.a,this.b,this.c,this.d,this.e,this.f)},t.translate=function(t,e){this.add(1,0,0,1,t,e)},t.scale=function(t,e,i,n){null==e&&(e=t),(i||n)&&this.add(1,0,0,1,i,n),this.add(t,0,0,e,0,0),(i||n)&&this.add(1,0,0,1,-i,-n)},t.rotate=function(t,e,n){t=i.rad(t),e=e||0,n=n||0;var a=+L.cos(t).toFixed(9),r=+L.sin(t).toFixed(9);this.add(a,r,-r,a,e,n),this.add(1,0,0,1,-e,-n)},t.x=function(t,e){return t*this.a+e*this.c+this.e},t.y=function(t,e){return t*this.b+e*this.d+this.f},t.get=function(t){return+this[N.fromCharCode(97+t)].toFixed(4)},t.toString=function(){return i.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},t.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},t.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},t.split=function(){var t={};t.dx=this.e,t.dy=this.f;var a=[[this.a,this.c],[this.b,this.d]];t.scalex=L.sqrt(e(a[0])),n(a[0]),t.shear=a[0][0]*a[1][0]+a[0][1]*a[1][1],a[1]=[a[1][0]-a[0][0]*t.shear,a[1][1]-a[0][1]*t.shear],t.scaley=L.sqrt(e(a[1])),n(a[1]),t.shear/=t.scaley;var r=-a[0][1],o=a[1][1];return 0>o?(t.rotate=i.deg(L.acos(o)),0>r&&(t.rotate=360-t.rotate)):t.rotate=i.deg(L.asin(r)),t.isSimple=!(+t.shear.toFixed(9)||t.scalex.toFixed(9)!=t.scaley.toFixed(9)&&t.rotate),t.isSuperSimple=!+t.shear.toFixed(9)&&t.scalex.toFixed(9)==t.scaley.toFixed(9)&&!t.rotate,t.noRotation=!+t.shear.toFixed(9)&&!t.rotate,t},t.toTransformString=function(t){var e=t||this[A]();return e.isSimple?(e.scalex=+e.scalex.toFixed(4),e.scaley=+e.scaley.toFixed(4),e.rotate=+e.rotate.toFixed(4),(e.dx||e.dy?"t"+[e.dx,e.dy]:q)+(1!=e.scalex||1!=e.scaley?"s"+[e.scalex,e.scaley,0,0]:q)+(e.rotate?"r"+[e.rotate,0,0]:q)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(f.prototype);var Fe=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);E.safari="Apple Computer, Inc."==navigator.vendor&&(Fe&&Fe[1]<4||"iP"==navigator.platform.slice(0,2))||"Google Inc."==navigator.vendor&&Fe&&Fe[1]<8?function(){var t=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){t.remove()})}:ue;for(var He=function(){this.returnValue=!1},je=function(){return this.originalEvent.preventDefault()},ze=function(){this.cancelBubble=!0},Ue=function(){return this.originalEvent.stopPropagation()},We=function(t){var e=O.doc.documentElement.scrollTop||O.doc.body.scrollTop,i=O.doc.documentElement.scrollLeft||O.doc.body.scrollLeft;return{x:t.clientX+i,y:t.clientY+e}},Ve=function(){return O.doc.addEventListener?function(t,e,i,n){var a=function(t){var e=We(t);return i.call(n,t,e.x,e.y)};if(t.addEventListener(e,a,!1),K&&M[e]){var r=function(e){for(var a=We(e),r=e,o=0,s=e.targetTouches&&e.targetTouches.length;s>o;o++)if(e.targetTouches[o].target==t){e=e.targetTouches[o],e.originalEvent=r,e.preventDefault=je,e.stopPropagation=Ue;break}return i.call(n,e,a.x,a.y)};t.addEventListener(M[e],r,!1)}return function(){return t.removeEventListener(e,a,!1),K&&M[e]&&t.removeEventListener(M[e],a,!1),!0}}:O.doc.attachEvent?function(t,e,i,n){var a=function(t){t=t||O.win.event;var e=O.doc.documentElement.scrollTop||O.doc.body.scrollTop,a=O.doc.documentElement.scrollLeft||O.doc.body.scrollLeft,r=t.clientX+a,o=t.clientY+e;return t.preventDefault=t.preventDefault||He,t.stopPropagation=t.stopPropagation||ze,i.call(n,t,r,o)};t.attachEvent("on"+e,a);var r=function(){return t.detachEvent("on"+e,a),!0};return r}:void 0}(),Ge=[],Xe=function(t){for(var i,n=t.clientX,a=t.clientY,r=O.doc.documentElement.scrollTop||O.doc.body.scrollTop,o=O.doc.documentElement.scrollLeft||O.doc.body.scrollLeft,s=Ge.length;s--;){if(i=Ge[s],K&&t.touches){for(var l,c=t.touches.length;c--;)if(l=t.touches[c],l.identifier==i.el._drag.id){n=l.clientX,a=l.clientY,(t.originalEvent?t.originalEvent:t).preventDefault();break}}else t.preventDefault();var d,h=i.el.node,u=h.nextSibling,p=h.parentNode,f=h.style.display;O.win.opera&&p.removeChild(h),h.style.display="none",d=i.el.paper.getElementByPoint(n,a),h.style.display=f,O.win.opera&&(u?p.insertBefore(h,u):p.appendChild(h)),d&&e("raphael.drag.over."+i.el.id,i.el,d),n+=o,a+=r,e("raphael.drag.move."+i.el.id,i.move_scope||i.el,n-i.el._drag.x,a-i.el._drag.y,n,a,t)}},Ye=function(t){i.unmousemove(Xe).unmouseup(Ye);for(var n,a=Ge.length;a--;)n=Ge[a],n.el._drag={},e("raphael.drag.end."+n.el.id,n.end_scope||n.start_scope||n.move_scope||n.el,t);Ge=[]},Je=i.el={},Ze=Q.length;Ze--;)!function(t){i[t]=Je[t]=function(e,n){return i.is(e,"function")&&(this.events=this.events||[],this.events.push({name:t,f:e,unbind:Ve(this.shape||this.node||O.doc,t,e,n||this)})),this},i["un"+t]=Je["un"+t]=function(e){for(var n=this.events||[],a=n.length;a--;)n[a].name!=t||!i.is(e,"undefined")&&n[a].f!=e||(n[a].unbind(),n.splice(a,1),!n.length&&delete this.events);return this}}(Q[Ze]);Je.data=function(t,n){var a=de[this.id]=de[this.id]||{};if(0==arguments.length)return a;if(1==arguments.length){if(i.is(t,"object")){for(var r in t)t[w](r)&&this.data(r,t[r]);return this}return e("raphael.data.get."+this.id,this,a[t],t),a[t]}return a[t]=n,e("raphael.data.set."+this.id,this,n,t),this},Je.removeData=function(t){return null==t?de[this.id]={}:de[this.id]&&delete de[this.id][t],this},Je.getData=function(){return n(de[this.id]||{})},Je.hover=function(t,e,i,n){return this.mouseover(t,i).mouseout(e,n||i)},Je.unhover=function(t,e){return this.unmouseover(t).unmouseout(e)};var ti=[];Je.drag=function(t,n,a,r,o,s){function l(l){(l.originalEvent||l).preventDefault();var c=l.clientX,d=l.clientY,h=O.doc.documentElement.scrollTop||O.doc.body.scrollTop,u=O.doc.documentElement.scrollLeft||O.doc.body.scrollLeft;if(this._drag.id=l.identifier,K&&l.touches)for(var p,f=l.touches.length;f--;)if(p=l.touches[f],this._drag.id=p.identifier,p.identifier==this._drag.id){c=p.clientX,d=p.clientY;break}this._drag.x=c+u,this._drag.y=d+h,!Ge.length&&i.mousemove(Xe).mouseup(Ye),Ge.push({el:this,move_scope:r,start_scope:o,end_scope:s}),n&&e.on("raphael.drag.start."+this.id,n),t&&e.on("raphael.drag.move."+this.id,t),a&&e.on("raphael.drag.end."+this.id,a),e("raphael.drag.start."+this.id,o||r||this,l.clientX+u,l.clientY+h,l)}return this._drag={},ti.push({el:this,start:l}),this.mousedown(l),this},Je.onDragOver=function(t){t?e.on("raphael.drag.over."+this.id,t):e.unbind("raphael.drag.over."+this.id)},Je.undrag=function(){for(var t=ti.length;t--;)ti[t].el==this&&(this.unmousedown(ti[t].start),ti.splice(t,1),e.unbind("raphael.drag.*."+this.id));!ti.length&&i.unmousemove(Xe).unmouseup(Ye),Ge=[]},E.circle=function(t,e,n){var a=i._engine.circle(this,t||0,e||0,n||0);return this.__set__&&this.__set__.push(a),a},E.rect=function(t,e,n,a,r){var o=i._engine.rect(this,t||0,e||0,n||0,a||0,r||0);return this.__set__&&this.__set__.push(o),o},E.ellipse=function(t,e,n,a){var r=i._engine.ellipse(this,t||0,e||0,n||0,a||0);return this.__set__&&this.__set__.push(r),r},E.path=function(t){t&&!i.is(t,U)&&!i.is(t[0],W)&&(t+=q);var e=i._engine.path(i.format[x](i,arguments),this);return this.__set__&&this.__set__.push(e),e},E.image=function(t,e,n,a,r){var o=i._engine.image(this,t||"about:blank",e||0,n||0,a||0,r||0);return this.__set__&&this.__set__.push(o),o},E.text=function(t,e,n){var a=i._engine.text(this,t||0,e||0,N(n));return this.__set__&&this.__set__.push(a),a},E.set=function(t){!i.is(t,"array")&&(t=Array.prototype.splice.call(arguments,0,arguments.length));var e=new ui(t);return this.__set__&&this.__set__.push(e),e.paper=this,e.type="set",e},E.setStart=function(t){this.__set__=t||this.set()},E.setFinish=function(){var t=this.__set__;return delete this.__set__,t},E.setSize=function(t,e){return i._engine.setSize.call(this,t,e)},E.setViewBox=function(t,e,n,a,r){return i._engine.setViewBox.call(this,t,e,n,a,r)},E.top=E.bottom=null,E.raphael=i;var ei=function(t){var e=t.getBoundingClientRect(),i=t.ownerDocument,n=i.body,a=i.documentElement,r=a.clientTop||n.clientTop||0,o=a.clientLeft||n.clientLeft||0,s=e.top+(O.win.pageYOffset||a.scrollTop||n.scrollTop)-r,l=e.left+(O.win.pageXOffset||a.scrollLeft||n.scrollLeft)-o;return{y:s,x:l}};E.getElementByPoint=function(t,e){var i=this,n=i.canvas,a=O.doc.elementFromPoint(t,e);if(O.win.opera&&"svg"==a.tagName){var r=ei(n),o=n.createSVGRect();o.x=t-r.x,o.y=e-r.y,o.width=o.height=1;var s=n.getIntersectionList(o,null);s.length&&(a=s[s.length-1])}if(!a)return null;for(;a.parentNode&&a!=n.parentNode&&!a.raphael;)a=a.parentNode;return a==i.canvas.parentNode&&(a=n),a=a&&a.raphael?i.getById(a.raphaelid):null},E.getElementsByBBox=function(t){var e=this.set();return this.forEach(function(n){i.isBBoxIntersect(n.getBBox(),t)&&e.push(n)}),e},E.getById=function(t){for(var e=this.bottom;e;){if(e.id==t)return e;e=e.next}return null},E.forEach=function(t,e){for(var i=this.bottom;i;){if(t.call(e,i)===!1)return this;i=i.next}return this},E.getElementsByPoint=function(t,e){var i=this.set();return this.forEach(function(n){n.isPointInside(t,e)&&i.push(n)}),i},Je.isPointInside=function(t,e){var n=this.realPath=ge[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(n=i.transformPath(n,this.attr("transform"))),i.isPointInsidePath(n,t,e)},Je.getBBox=function(t){if(this.removed)return{};var e=this._;return t?((e.dirty||!e.bboxwt)&&(this.realPath=ge[this.type](this),e.bboxwt=_e(this.realPath),e.bboxwt.toString=m,e.dirty=0),e.bboxwt):((e.dirty||e.dirtyT||!e.bbox)&&((e.dirty||!this.realPath)&&(e.bboxwt=0,this.realPath=ge[this.type](this)),e.bbox=_e(ve(this.realPath,this.matrix)),e.bbox.toString=m,e.dirty=e.dirtyT=0),e.bbox)},Je.clone=function(){if(this.removed)return null;var t=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(t),t},Je.glow=function(t){if("text"==this.type)return null;t=t||{};var e={width:(t.width||10)+(+this.attr("stroke-width")||1),fill:t.fill||!1,opacity:t.opacity||.5,offsetx:t.offsetx||0,offsety:t.offsety||0,color:t.color||"#000"},i=e.width/2,n=this.paper,a=n.set(),r=this.realPath||ge[this.type](this);r=this.matrix?ve(r,this.matrix):r;for(var o=1;i+1>o;o++)a.push(n.path(r).attr({stroke:e.color,fill:e.fill?e.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(e.width/i*o).toFixed(3),opacity:+(e.opacity/i).toFixed(3)}));return a.insertBefore(this).translate(e.offsetx,e.offsety)};var ii=function(t,e,n,a,r,o,s,l,h){return null==h?c(t,e,n,a,r,o,s,l):i.findDotsAtSegment(t,e,n,a,r,o,s,l,d(t,e,n,a,r,o,s,l,h))},ni=function(t,e){return function(n,a,r){n=Qe(n);for(var o,s,l,c,d,h="",u={},p=0,f=0,m=n.length;m>f;f++){if(l=n[f],"M"==l[0])o=+l[1],s=+l[2];else{if(c=ii(o,s,l[1],l[2],l[3],l[4],l[5],l[6]),p+c>a){if(e&&!u.start){if(d=ii(o,s,l[1],l[2],l[3],l[4],l[5],l[6],a-p),h+=["C"+d.start.x,d.start.y,d.m.x,d.m.y,d.x,d.y],r)return h;u.start=h,h=["M"+d.x,d.y+"C"+d.n.x,d.n.y,d.end.x,d.end.y,l[5],l[6]].join(),p+=c,o=+l[5],s=+l[6];continue}if(!t&&!e)return d=ii(o,s,l[1],l[2],l[3],l[4],l[5],l[6],a-p),{x:d.x,y:d.y,alpha:d.alpha}}p+=c,o=+l[5],s=+l[6]}h+=l.shift()+l}return u.end=h,d=t?p:e?u:i.findDotsAtSegment(o,s,l[0],l[1],l[2],l[3],l[4],l[5],1),d.alpha&&(d={x:d.x,y:d.y,alpha:d.alpha}),d}},ai=ni(1),ri=ni(),oi=ni(0,1);i.getTotalLength=ai,i.getPointAtLength=ri,i.getSubpath=function(t,e,i){if(this.getTotalLength(t)-i<1e-6)return oi(t,e).end;var n=oi(t,i,1);return e?oi(n,e).end:n},Je.getTotalLength=function(){var t=this.getPath();if(t)return this.node.getTotalLength?this.node.getTotalLength():ai(t)},Je.getPointAtLength=function(t){var e=this.getPath();if(e)return ri(e,t)},Je.getPath=function(){var t,e=i._getPath[this.type];if("text"!=this.type&&"set"!=this.type)return e&&(t=e(this)),t},Je.getSubpath=function(t,e){var n=this.getPath();if(n)return i.getSubpath(n,t,e)};var si=i.easing_formulas={linear:function(t){return t},"<":function(t){return H(t,1.7)},">":function(t){return H(t,.48)},"<>":function(t){var e=.48-t/1.04,i=L.sqrt(.1734+e*e),n=i-e,a=H(F(n),1/3)*(0>n?-1:1),r=-i-e,o=H(F(r),1/3)*(0>r?-1:1),s=a+o+.5;return 3*(1-s)*s*s+s*s*s},backIn:function(t){var e=1.70158;return t*t*((e+1)*t-e)},backOut:function(t){t-=1;var e=1.70158;return t*t*((e+1)*t+e)+1},elastic:function(t){return t==!!t?t:H(2,-10*t)*L.sin(2*(t-.075)*j/.3)+1},bounce:function(t){var e,i=7.5625,n=2.75;return 1/n>t?e=i*t*t:2/n>t?(t-=1.5/n,e=i*t*t+.75):2.5/n>t?(t-=2.25/n,e=i*t*t+.9375):(t-=2.625/n,e=i*t*t+.984375),e}};si.easeIn=si["ease-in"]=si["<"],si.easeOut=si["ease-out"]=si[">"],si.easeInOut=si["ease-in-out"]=si["<>"],si["back-in"]=si.backIn,si["back-out"]=si.backOut;var li=[],ci=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(t){setTimeout(t,16)},di=function(){for(var t=+new Date,n=0;n<li.length;n++){var a=li[n];if(!a.el.removed&&!a.paused){var r,o,s=t-a.start,l=a.ms,c=a.easing,d=a.from,h=a.diff,u=a.to,p=(a.t,a.el),f={},m={};if(a.initstatus?(s=(a.initstatus*a.anim.top-a.prev)/(a.percent-a.prev)*l,a.status=a.initstatus,delete a.initstatus,a.stop&&li.splice(n--,1)):a.status=(a.prev+(a.percent-a.prev)*(s/l))/a.anim.top,!(0>s))if(l>s){var g=c(s/l);for(var v in d)if(d[w](v)){switch(ne[v]){case z:r=+d[v]+g*l*h[v];break;case"colour":r="rgb("+[hi(J(d[v].r+g*l*h[v].r)),hi(J(d[v].g+g*l*h[v].g)),hi(J(d[v].b+g*l*h[v].b))].join(",")+")";break;case"path":r=[];for(var I=0,b=d[v].length;b>I;I++){r[I]=[d[v][I][0]];for(var E=1,y=d[v][I].length;y>E;E++)r[I][E]=+d[v][I][E]+g*l*h[v][I][E];r[I]=r[I].join(S)}r=r.join(S);break;case"transform":if(h[v].real)for(r=[],I=0,b=d[v].length;b>I;I++)for(r[I]=[d[v][I][0]],E=1,y=d[v][I].length;y>E;E++)r[I][E]=d[v][I][E]+g*l*h[v][I][E];else{var T=function(t){return+d[v][t]+g*l*h[v][t]};r=[["m",T(0),T(1),T(2),T(3),T(4),T(5)]]}break;case"csv":if("clip-rect"==v)for(r=[],I=4;I--;)r[I]=+d[v][I]+g*l*h[v][I];break;default:var R=[][k](d[v]);for(r=[],I=p.paper.customAttributes[v].length;I--;)r[I]=+R[I]+g*l*h[v][I]}f[v]=r}p.attr(f),function(t,i,n){setTimeout(function(){e("raphael.anim.frame."+t,i,n)
})}(p.id,p,a.anim)}else{if(function(t,n,a){setTimeout(function(){e("raphael.anim.frame."+n.id,n,a),e("raphael.anim.finish."+n.id,n,a),i.is(t,"function")&&t.call(n)})}(a.callback,p,a.anim),p.attr(u),li.splice(n--,1),a.repeat>1&&!a.next){for(o in u)u[w](o)&&(m[o]=a.totalOrigin[o]);a.el.attr(m),C(a.anim,a.el,a.anim.percents[0],null,a.totalOrigin,a.repeat-1)}a.next&&!a.stop&&C(a.anim,a.el,a.next,null,a.totalOrigin,a.repeat)}}}i.svg&&p&&p.paper&&p.paper.safari(),li.length&&ci(di)},hi=function(t){return t>255?255:0>t?0:t};Je.animateWith=function(t,e,n,a,r,o){var s=this;if(s.removed)return o&&o.call(s),s;var l=n instanceof v?n:i.animation(n,a,r,o);C(l,s,l.percents[0],null,s.attr());for(var c=0,d=li.length;d>c;c++)if(li[c].anim==e&&li[c].el==t){li[d-1].start=li[c].start;break}return s},Je.onAnimation=function(t){return t?e.on("raphael.anim.frame."+this.id,t):e.unbind("raphael.anim.frame."+this.id),this},v.prototype.delay=function(t){var e=new v(this.anim,this.ms);return e.times=this.times,e.del=+t||0,e},v.prototype.repeat=function(t){var e=new v(this.anim,this.ms);return e.del=this.del,e.times=L.floor(B(t,0))||1,e},i.animation=function(t,e,n,a){if(t instanceof v)return t;(i.is(n,"function")||!n)&&(a=a||n||null,n=null),t=Object(t),e=+e||0;var r,o,s={};for(o in t)t[w](o)&&Z(o)!=o&&Z(o)+"%"!=o&&(r=!0,s[o]=t[o]);return r?(n&&(s.easing=n),a&&(s.callback=a),new v({100:s},e)):new v(t,e)},Je.animate=function(t,e,n,a){var r=this;if(r.removed)return a&&a.call(r),r;var o=t instanceof v?t:i.animation(t,e,n,a);return C(o,r,o.percents[0],null,r.attr()),r},Je.setTime=function(t,e){return t&&null!=e&&this.status(t,$(e,t.ms)/t.ms),this},Je.status=function(t,e){var i,n,a=[],r=0;if(null!=e)return C(t,this,-1,$(e,1)),this;for(i=li.length;i>r;r++)if(n=li[r],n.el.id==this.id&&(!t||n.anim==t)){if(t)return n.status;a.push({anim:n.anim,status:n.status})}return t?0:a},Je.pause=function(t){for(var i=0;i<li.length;i++)li[i].el.id!=this.id||t&&li[i].anim!=t||e("raphael.anim.pause."+this.id,this,li[i].anim)!==!1&&(li[i].paused=!0);return this},Je.resume=function(t){for(var i=0;i<li.length;i++)if(li[i].el.id==this.id&&(!t||li[i].anim==t)){var n=li[i];e("raphael.anim.resume."+this.id,this,n.anim)!==!1&&(delete n.paused,this.status(n.anim,n.status))}return this},Je.stop=function(t){for(var i=0;i<li.length;i++)li[i].el.id!=this.id||t&&li[i].anim!=t||e("raphael.anim.stop."+this.id,this,li[i].anim)!==!1&&li.splice(i--,1);return this},e.on("raphael.remove",I),e.on("raphael.clear",I),Je.toString=function(){return"Raphaël’s object"};var ui=function(t){if(this.items=[],this.length=0,this.type="set",t)for(var e=0,i=t.length;i>e;e++)!t[e]||t[e].constructor!=Je.constructor&&t[e].constructor!=ui||(this[this.items.length]=this.items[this.items.length]=t[e],this.length++)},pi=ui.prototype;pi.push=function(){for(var t,e,i=0,n=arguments.length;n>i;i++)t=arguments[i],!t||t.constructor!=Je.constructor&&t.constructor!=ui||(e=this.items.length,this[e]=this.items[e]=t,this.length++);return this},pi.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},pi.forEach=function(t,e){for(var i=0,n=this.items.length;n>i;i++)if(t.call(e,this.items[i],i)===!1)return this;return this};for(var fi in Je)Je[w](fi)&&(pi[fi]=function(t){return function(){var e=arguments;return this.forEach(function(i){i[t][x](i,e)})}}(fi));return pi.attr=function(t,e){if(t&&i.is(t,W)&&i.is(t[0],"object"))for(var n=0,a=t.length;a>n;n++)this.items[n].attr(t[n]);else for(var r=0,o=this.items.length;o>r;r++)this.items[r].attr(t,e);return this},pi.clear=function(){for(;this.length;)this.pop()},pi.splice=function(t,e){t=0>t?B(this.length+t,0):t,e=B(0,$(this.length-t,e));var i,n=[],a=[],r=[];for(i=2;i<arguments.length;i++)r.push(arguments[i]);for(i=0;e>i;i++)a.push(this[t+i]);for(;i<this.length-t;i++)n.push(this[t+i]);var o=r.length;for(i=0;i<o+n.length;i++)this.items[t+i]=this[t+i]=o>i?r[i]:n[i-o];for(i=this.items.length=this.length-=e-o;this[i];)delete this[i++];return new ui(a)},pi.exclude=function(t){for(var e=0,i=this.length;i>e;e++)if(this[e]==t)return this.splice(e,1),!0},pi.animate=function(t,e,n,a){(i.is(n,"function")||!n)&&(a=n||null);var r,o,s=this.items.length,l=s,c=this;if(!s)return this;a&&(o=function(){!--s&&a.call(c)}),n=i.is(n,U)?n:o;var d=i.animation(t,e,n,o);for(r=this.items[--l].animate(d);l--;)this.items[l]&&!this.items[l].removed&&this.items[l].animateWith(r,d,d),this.items[l]&&!this.items[l].removed||s--;return this},pi.insertAfter=function(t){for(var e=this.items.length;e--;)this.items[e].insertAfter(t);return this},pi.getBBox=function(){for(var t=[],e=[],i=[],n=[],a=this.items.length;a--;)if(!this.items[a].removed){var r=this.items[a].getBBox();t.push(r.x),e.push(r.y),i.push(r.x+r.width),n.push(r.y+r.height)}return t=$[x](0,t),e=$[x](0,e),i=B[x](0,i),n=B[x](0,n),{x:t,y:e,x2:i,y2:n,width:i-t,height:n-e}},pi.clone=function(t){t=this.paper.set();for(var e=0,i=this.items.length;i>e;e++)t.push(this.items[e].clone());return t},pi.toString=function(){return"Raphaël‘s set"},pi.glow=function(t){var e=this.paper.set();return this.forEach(function(i){var n=i.glow(t);null!=n&&n.forEach(function(t){e.push(t)})}),e},pi.isPointInside=function(t,e){var i=!1;return this.forEach(function(n){return n.isPointInside(t,e)?(console.log("runned"),i=!0,!1):void 0}),i},i.registerFont=function(t){if(!t.face)return t;this.fonts=this.fonts||{};var e={w:t.w,face:{},glyphs:{}},i=t.face["font-family"];for(var n in t.face)t.face[w](n)&&(e.face[n]=t.face[n]);if(this.fonts[i]?this.fonts[i].push(e):this.fonts[i]=[e],!t.svg){e.face["units-per-em"]=te(t.face["units-per-em"],10);for(var a in t.glyphs)if(t.glyphs[w](a)){var r=t.glyphs[a];if(e.glyphs[a]={w:r.w,k:{},d:r.d&&"M"+r.d.replace(/[mlcxtrv]/g,function(t){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[t]||"M"})+"z"},r.k)for(var o in r.k)r[w](o)&&(e.glyphs[a].k[o]=r.k[o])}}return t},E.getFont=function(t,e,n,a){if(a=a||"normal",n=n||"normal",e=+e||{normal:400,bold:700,lighter:300,bolder:800}[e]||400,i.fonts){var r=i.fonts[t];if(!r){var o=new RegExp("(^|\\s)"+t.replace(/[^\w\d\s+!~.:_-]/g,q)+"(\\s|$)","i");for(var s in i.fonts)if(i.fonts[w](s)&&o.test(s)){r=i.fonts[s];break}}var l;if(r)for(var c=0,d=r.length;d>c&&(l=r[c],l.face["font-weight"]!=e||l.face["font-style"]!=n&&l.face["font-style"]||l.face["font-stretch"]!=a);c++);return l}},E.print=function(t,e,n,a,r,o,s,l){o=o||"middle",s=B($(s||0,1),-1),l=B($(l||1,3),1);var c,d=N(n)[A](q),h=0,u=0,p=q;if(i.is(a,"string")&&(a=this.getFont(a)),a){c=(r||16)/a.face["units-per-em"];for(var f=a.face.bbox[A](y),m=+f[0],g=f[3]-f[1],v=0,C=+f[1]+("baseline"==o?g+ +a.face.descent:g/2),I=0,b=d.length;b>I;I++){if("\n"==d[I])h=0,T=0,u=0,v+=g*l;else{var E=u&&a.glyphs[d[I-1]]||{},T=a.glyphs[d[I]];h+=u?(E.w||a.w)+(E.k&&E.k[d[I]]||0)+a.w*s:0,u=1}T&&T.d&&(p+=i.transformPath(T.d,["t",h*c,v*c,"s",c,c,m,C,"t",(t-m)/c,(e-C)/c]))}}return this.path(p).attr({fill:"#000",stroke:"none"})},E.add=function(t){if(i.is(t,"array"))for(var e,n=this.set(),a=0,r=t.length;r>a;a++)e=t[a]||{},T[w](e.type)&&n.push(this[e.type]().attr(e));return n},i.format=function(t,e){var n=i.is(e,W)?[0][k](e):arguments;return t&&i.is(t,U)&&n.length-1&&(t=t.replace(R,function(t,e){return null==n[++e]?q:n[e]})),t||q},i.fullfill=function(){var t=/\{([^\}]+)\}/g,e=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,i=function(t,i,n){var a=n;return i.replace(e,function(t,e,i,n,r){e=e||n,a&&(e in a&&(a=a[e]),"function"==typeof a&&r&&(a=a()))}),a=(null==a||a==n?t:a)+""};return function(e,n){return String(e).replace(t,function(t,e){return i(t,e,n)})}}(),i.ninja=function(){return _.was?O.win.Raphael=_.is:delete Raphael,i},i.st=pi,function(t,e,n){function a(){/in/.test(t.readyState)?setTimeout(a,9):i.eve("raphael.DOMload")}null==t.readyState&&t.addEventListener&&(t.addEventListener(e,n=function(){t.removeEventListener(e,n,!1),t.readyState="complete"},!1),t.readyState="loading"),a()}(document,"DOMContentLoaded"),e.on("raphael.DOMload",function(){b=!0}),function(){if(i.svg){var t="hasOwnProperty",e=String,n=parseFloat,a=parseInt,r=Math,o=r.max,s=r.abs,l=r.pow,c=/[, ]+/,d=i.eve,h="",u=" ",p="http://www.w3.org/1999/xlink",f={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},m={};i.toString=function(){return"Your browser supports SVG.\nYou are running Raphaël "+this.version};var g=function(n,a){if(a){"string"==typeof n&&(n=g(n));for(var r in a)a[t](r)&&("xlink:"==r.substring(0,6)?n.setAttributeNS(p,r.substring(6),e(a[r])):n.setAttribute(r,e(a[r])))}else n=i._g.doc.createElementNS("http://www.w3.org/2000/svg",n),n.style&&(n.style.webkitTapHighlightColor="rgba(0,0,0,0)");return n},v=function(t,a){var c="linear",d=t.id+a,u=.5,p=.5,f=t.node,m=t.paper,v=f.style,C=i._g.doc.getElementById(d);if(!C){if(a=e(a).replace(i._radial_gradient,function(t,e,i){if(c="radial",e&&i){u=n(e),p=n(i);var a=2*(p>.5)-1;l(u-.5,2)+l(p-.5,2)>.25&&(p=r.sqrt(.25-l(u-.5,2))*a+.5)&&.5!=p&&(p=p.toFixed(5)-1e-5*a)}return h}),a=a.split(/\s*\-\s*/),"linear"==c){var I=a.shift();if(I=-n(I),isNaN(I))return null;var b=[0,0,r.cos(i.rad(I)),r.sin(i.rad(I))],E=1/(o(s(b[2]),s(b[3]))||1);b[2]*=E,b[3]*=E,b[2]<0&&(b[0]=-b[2],b[2]=0),b[3]<0&&(b[1]=-b[3],b[3]=0)}var y=i._parseDots(a);if(!y)return null;if(d=d.replace(/[\(\)\s,\xb0#]/g,"_"),t.gradient&&d!=t.gradient.id&&(m.defs.removeChild(t.gradient),delete t.gradient),!t.gradient){C=g(c+"Gradient",{id:d}),t.gradient=C,g(C,"radial"==c?{fx:u,fy:p}:{x1:b[0],y1:b[1],x2:b[2],y2:b[3],gradientTransform:t.matrix.invert()}),m.defs.appendChild(C);for(var T=0,R=y.length;R>T;T++)C.appendChild(g("stop",{offset:y[T].offset?y[T].offset:T?"100%":"0%","stop-color":y[T].color||"#fff"}))}}return g(f,{fill:"url(#"+d+")",opacity:1,"fill-opacity":1}),v.fill=h,v.opacity=1,v.fillOpacity=1,1},C=function(t){var e=t.getBBox(1);g(t.pattern,{patternTransform:t.matrix.invert()+" translate("+e.x+","+e.y+")"})},I=function(n,a,r){if("path"==n.type){for(var o,s,l,c,d,u=e(a).toLowerCase().split("-"),p=n.paper,v=r?"end":"start",C=n.node,I=n.attrs,b=I["stroke-width"],E=u.length,y="classic",T=3,R=3,w=5;E--;)switch(u[E]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":y=u[E];break;case"wide":R=5;break;case"narrow":R=2;break;case"long":T=5;break;case"short":T=2}if("open"==y?(T+=2,R+=2,w+=2,l=1,c=r?4:1,d={fill:"none",stroke:I.stroke}):(c=l=T/2,d={fill:I.stroke,stroke:"none"}),n._.arrows?r?(n._.arrows.endPath&&m[n._.arrows.endPath]--,n._.arrows.endMarker&&m[n._.arrows.endMarker]--):(n._.arrows.startPath&&m[n._.arrows.startPath]--,n._.arrows.startMarker&&m[n._.arrows.startMarker]--):n._.arrows={},"none"!=y){var O="raphael-marker-"+y,_="raphael-marker-"+v+y+T+R;i._g.doc.getElementById(O)?m[O]++:(p.defs.appendChild(g(g("path"),{"stroke-linecap":"round",d:f[y],id:O})),m[O]=1);var D,x=i._g.doc.getElementById(_);x?(m[_]++,D=x.getElementsByTagName("use")[0]):(x=g(g("marker"),{id:_,markerHeight:R,markerWidth:T,orient:"auto",refX:c,refY:R/2}),D=g(g("use"),{"xlink:href":"#"+O,transform:(r?"rotate(180 "+T/2+" "+R/2+") ":h)+"scale("+T/w+","+R/w+")","stroke-width":(1/((T/w+R/w)/2)).toFixed(4)}),x.appendChild(D),p.defs.appendChild(x),m[_]=1),g(D,d);var k=l*("diamond"!=y&&"oval"!=y);r?(o=n._.arrows.startdx*b||0,s=i.getTotalLength(I.path)-k*b):(o=k*b,s=i.getTotalLength(I.path)-(n._.arrows.enddx*b||0)),d={},d["marker-"+v]="url(#"+_+")",(s||o)&&(d.d=i.getSubpath(I.path,o,s)),g(C,d),n._.arrows[v+"Path"]=O,n._.arrows[v+"Marker"]=_,n._.arrows[v+"dx"]=k,n._.arrows[v+"Type"]=y,n._.arrows[v+"String"]=a}else r?(o=n._.arrows.startdx*b||0,s=i.getTotalLength(I.path)-o):(o=0,s=i.getTotalLength(I.path)-(n._.arrows.enddx*b||0)),n._.arrows[v+"Path"]&&g(C,{d:i.getSubpath(I.path,o,s)}),delete n._.arrows[v+"Path"],delete n._.arrows[v+"Marker"],delete n._.arrows[v+"dx"],delete n._.arrows[v+"Type"],delete n._.arrows[v+"String"];for(d in m)if(m[t](d)&&!m[d]){var K=i._g.doc.getElementById(d);K&&K.parentNode.removeChild(K)}}},b={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},E=function(t,i,n){if(i=b[e(i).toLowerCase()]){for(var a=t.attrs["stroke-width"]||"1",r={round:a,square:a,butt:0}[t.attrs["stroke-linecap"]||n["stroke-linecap"]]||0,o=[],s=i.length;s--;)o[s]=i[s]*a+(s%2?1:-1)*r;g(t.node,{"stroke-dasharray":o.join(",")})}},y=function(n,r){var l=n.node,d=n.attrs,u=l.style.visibility;l.style.visibility="hidden";for(var f in r)if(r[t](f)){if(!i._availableAttrs[t](f))continue;var m=r[f];switch(d[f]=m,f){case"blur":n.blur(m);break;case"href":case"title":var b=g("title"),y=i._g.doc.createTextNode(m);b.appendChild(y),l.appendChild(b);break;case"target":var T=l.parentNode;if("a"!=T.tagName.toLowerCase()){var b=g("a");T.insertBefore(b,l),b.appendChild(l),T=b}"target"==f?T.setAttributeNS(p,"show","blank"==m?"new":m):T.setAttributeNS(p,f,m);break;case"cursor":l.style.cursor=m;break;case"transform":n.transform(m);break;case"arrow-start":I(n,m);break;case"arrow-end":I(n,m,1);break;case"clip-rect":var w=e(m).split(c);if(4==w.length){n.clip&&n.clip.parentNode.parentNode.removeChild(n.clip.parentNode);var O=g("clipPath"),_=g("rect");O.id=i.createUUID(),g(_,{x:w[0],y:w[1],width:w[2],height:w[3]}),O.appendChild(_),n.paper.defs.appendChild(O),g(l,{"clip-path":"url(#"+O.id+")"}),n.clip=_}if(!m){var D=l.getAttribute("clip-path");if(D){var x=i._g.doc.getElementById(D.replace(/(^url\(#|\)$)/g,h));x&&x.parentNode.removeChild(x),g(l,{"clip-path":h}),delete n.clip}}break;case"path":"path"==n.type&&(g(l,{d:m?d.path=i._pathToAbsolute(m):"M0,0"}),n._.dirty=1,n._.arrows&&("startString"in n._.arrows&&I(n,n._.arrows.startString),"endString"in n._.arrows&&I(n,n._.arrows.endString,1)));break;case"width":if(l.setAttribute(f,m),n._.dirty=1,!d.fx)break;f="x",m=d.x;case"x":d.fx&&(m=-d.x-(d.width||0));case"rx":if("rx"==f&&"rect"==n.type)break;case"cx":l.setAttribute(f,m),n.pattern&&C(n),n._.dirty=1;break;case"height":if(l.setAttribute(f,m),n._.dirty=1,!d.fy)break;f="y",m=d.y;case"y":d.fy&&(m=-d.y-(d.height||0));case"ry":if("ry"==f&&"rect"==n.type)break;case"cy":l.setAttribute(f,m),n.pattern&&C(n),n._.dirty=1;break;case"r":"rect"==n.type?g(l,{rx:m,ry:m}):l.setAttribute(f,m),n._.dirty=1;break;case"src":"image"==n.type&&l.setAttributeNS(p,"href",m);break;case"stroke-width":(1!=n._.sx||1!=n._.sy)&&(m/=o(s(n._.sx),s(n._.sy))||1),n.paper._vbSize&&(m*=n.paper._vbSize),l.setAttribute(f,m),d["stroke-dasharray"]&&E(n,d["stroke-dasharray"],r),n._.arrows&&("startString"in n._.arrows&&I(n,n._.arrows.startString),"endString"in n._.arrows&&I(n,n._.arrows.endString,1));break;case"stroke-dasharray":E(n,m,r);break;case"fill":var k=e(m).match(i._ISURL);if(k){O=g("pattern");var K=g("image");O.id=i.createUUID(),g(O,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),g(K,{x:0,y:0,"xlink:href":k[1]}),O.appendChild(K),function(t){i._preload(k[1],function(){var e=this.offsetWidth,i=this.offsetHeight;g(t,{width:e,height:i}),g(K,{width:e,height:i}),n.paper.safari()})}(O),n.paper.defs.appendChild(O),g(l,{fill:"url(#"+O.id+")"}),n.pattern=O,n.pattern&&C(n);break}var q=i.getRGB(m);if(q.error){if(("circle"==n.type||"ellipse"==n.type||"r"!=e(m).charAt())&&v(n,m)){if("opacity"in d||"fill-opacity"in d){var S=i._g.doc.getElementById(l.getAttribute("fill").replace(/^url\(#|\)$/g,h));if(S){var N=S.getElementsByTagName("stop");g(N[N.length-1],{"stop-opacity":("opacity"in d?d.opacity:1)*("fill-opacity"in d?d["fill-opacity"]:1)})}}d.gradient=m,d.fill="none";break}}else delete r.gradient,delete d.gradient,!i.is(d.opacity,"undefined")&&i.is(r.opacity,"undefined")&&g(l,{opacity:d.opacity}),!i.is(d["fill-opacity"],"undefined")&&i.is(r["fill-opacity"],"undefined")&&g(l,{"fill-opacity":d["fill-opacity"]});q[t]("opacity")&&g(l,{"fill-opacity":q.opacity>1?q.opacity/100:q.opacity});case"stroke":q=i.getRGB(m),l.setAttribute(f,q.hex),"stroke"==f&&q[t]("opacity")&&g(l,{"stroke-opacity":q.opacity>1?q.opacity/100:q.opacity}),"stroke"==f&&n._.arrows&&("startString"in n._.arrows&&I(n,n._.arrows.startString),"endString"in n._.arrows&&I(n,n._.arrows.endString,1));break;case"gradient":("circle"==n.type||"ellipse"==n.type||"r"!=e(m).charAt())&&v(n,m);break;case"opacity":d.gradient&&!d[t]("stroke-opacity")&&g(l,{"stroke-opacity":m>1?m/100:m});case"fill-opacity":if(d.gradient){S=i._g.doc.getElementById(l.getAttribute("fill").replace(/^url\(#|\)$/g,h)),S&&(N=S.getElementsByTagName("stop"),g(N[N.length-1],{"stop-opacity":m}));break}default:"font-size"==f&&(m=a(m,10)+"px");var A=f.replace(/(\-.)/g,function(t){return t.substring(1).toUpperCase()});l.style[A]=m,n._.dirty=1,l.setAttribute(f,m)}}R(n,r),l.style.visibility=u},T=1.2,R=function(n,r){if("text"==n.type&&(r[t]("text")||r[t]("font")||r[t]("font-size")||r[t]("x")||r[t]("y"))){var o=n.attrs,s=n.node,l=s.firstChild?a(i._g.doc.defaultView.getComputedStyle(s.firstChild,h).getPropertyValue("font-size"),10):10;if(r[t]("text")){for(o.text=r.text;s.firstChild;)s.removeChild(s.firstChild);for(var c,d=e(r.text).split("\n"),u=[],p=0,f=d.length;f>p;p++)c=g("tspan"),p&&g(c,{dy:l*T,x:o.x}),c.appendChild(i._g.doc.createTextNode(d[p])),s.appendChild(c),u[p]=c}else for(u=s.getElementsByTagName("tspan"),p=0,f=u.length;f>p;p++)p?g(u[p],{dy:l*T,x:o.x}):g(u[0],{dy:0});g(s,{x:o.x,y:o.y}),n._.dirty=1;var m=n._getBBox(),v=o.y-(m.y+m.height/2);v&&i.is(v,"finite")&&g(u[0],{dy:v})}},w=function(t,e){this[0]=this.node=t,t.raphael=!0,this.id=i._oid++,t.raphaelid=this.id,this.matrix=i.matrix(),this.realPath=null,this.paper=e,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!e.bottom&&(e.bottom=this),this.prev=e.top,e.top&&(e.top.next=this),e.top=this,this.next=null},O=i.el;w.prototype=O,O.constructor=w,i._engine.path=function(t,e){var i=g("path");e.canvas&&e.canvas.appendChild(i);var n=new w(i,e);return n.type="path",y(n,{fill:"none",stroke:"#000",path:t}),n},O.rotate=function(t,i,a){if(this.removed)return this;if(t=e(t).split(c),t.length-1&&(i=n(t[1]),a=n(t[2])),t=n(t[0]),null==a&&(i=a),null==i||null==a){var r=this.getBBox(1);i=r.x+r.width/2,a=r.y+r.height/2}return this.transform(this._.transform.concat([["r",t,i,a]])),this},O.scale=function(t,i,a,r){if(this.removed)return this;if(t=e(t).split(c),t.length-1&&(i=n(t[1]),a=n(t[2]),r=n(t[3])),t=n(t[0]),null==i&&(i=t),null==r&&(a=r),null==a||null==r)var o=this.getBBox(1);return a=null==a?o.x+o.width/2:a,r=null==r?o.y+o.height/2:r,this.transform(this._.transform.concat([["s",t,i,a,r]])),this},O.translate=function(t,i){return this.removed?this:(t=e(t).split(c),t.length-1&&(i=n(t[1])),t=n(t[0])||0,i=+i||0,this.transform(this._.transform.concat([["t",t,i]])),this)},O.transform=function(e){var n=this._;if(null==e)return n.transform;if(i._extractTransform(this,e),this.clip&&g(this.clip,{transform:this.matrix.invert()}),this.pattern&&C(this),this.node&&g(this.node,{transform:this.matrix}),1!=n.sx||1!=n.sy){var a=this.attrs[t]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":a})}return this},O.hide=function(){return!this.removed&&this.paper.safari(this.node.style.display="none"),this},O.show=function(){return!this.removed&&this.paper.safari(this.node.style.display=""),this},O.remove=function(){if(!this.removed&&this.node.parentNode){var t=this.paper;t.__set__&&t.__set__.exclude(this),d.unbind("raphael.*.*."+this.id),this.gradient&&t.defs.removeChild(this.gradient),i._tear(this,t),"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.removeChild(this.node.parentNode):this.node.parentNode.removeChild(this.node);for(var e in this)this[e]="function"==typeof this[e]?i._removedFactory(e):null;this.removed=!0}},O._getBBox=function(){if("none"==this.node.style.display){this.show();var t=!0}var e={};try{e=this.node.getBBox()}catch(i){}finally{e=e||{}}return t&&this.hide(),e},O.attr=function(e,n){if(this.removed)return this;if(null==e){var a={};for(var r in this.attrs)this.attrs[t](r)&&(a[r]=this.attrs[r]);return a.gradient&&"none"==a.fill&&(a.fill=a.gradient)&&delete a.gradient,a.transform=this._.transform,a}if(null==n&&i.is(e,"string")){if("fill"==e&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==e)return this._.transform;for(var o=e.split(c),s={},l=0,h=o.length;h>l;l++)e=o[l],s[e]=e in this.attrs?this.attrs[e]:i.is(this.paper.customAttributes[e],"function")?this.paper.customAttributes[e].def:i._availableAttrs[e];return h-1?s:s[o[0]]}if(null==n&&i.is(e,"array")){for(s={},l=0,h=e.length;h>l;l++)s[e[l]]=this.attr(e[l]);return s}if(null!=n){var u={};u[e]=n}else null!=e&&i.is(e,"object")&&(u=e);for(var p in u)d("raphael.attr."+p+"."+this.id,this,u[p]);for(p in this.paper.customAttributes)if(this.paper.customAttributes[t](p)&&u[t](p)&&i.is(this.paper.customAttributes[p],"function")){var f=this.paper.customAttributes[p].apply(this,[].concat(u[p]));this.attrs[p]=u[p];for(var m in f)f[t](m)&&(u[m]=f[m])}return y(this,u),this},O.toFront=function(){if(this.removed)return this;"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.appendChild(this.node.parentNode):this.node.parentNode.appendChild(this.node);var t=this.paper;return t.top!=this&&i._tofront(this,t),this},O.toBack=function(){if(this.removed)return this;var t=this.node.parentNode;"a"==t.tagName.toLowerCase()?t.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild):t.firstChild!=this.node&&t.insertBefore(this.node,this.node.parentNode.firstChild),i._toback(this,this.paper);this.paper;return this},O.insertAfter=function(t){if(this.removed)return this;var e=t.node||t[t.length-1].node;return e.nextSibling?e.parentNode.insertBefore(this.node,e.nextSibling):e.parentNode.appendChild(this.node),i._insertafter(this,t,this.paper),this},O.insertBefore=function(t){if(this.removed)return this;var e=t.node||t[0].node;return e.parentNode.insertBefore(this.node,e),i._insertbefore(this,t,this.paper),this},O.blur=function(t){var e=this;if(0!==+t){var n=g("filter"),a=g("feGaussianBlur");e.attrs.blur=t,n.id=i.createUUID(),g(a,{stdDeviation:+t||1.5}),n.appendChild(a),e.paper.defs.appendChild(n),e._blur=n,g(e.node,{filter:"url(#"+n.id+")"})}else e._blur&&(e._blur.parentNode.removeChild(e._blur),delete e._blur,delete e.attrs.blur),e.node.removeAttribute("filter");return e},i._engine.circle=function(t,e,i,n){var a=g("circle");t.canvas&&t.canvas.appendChild(a);var r=new w(a,t);return r.attrs={cx:e,cy:i,r:n,fill:"none",stroke:"#000"},r.type="circle",g(a,r.attrs),r},i._engine.rect=function(t,e,i,n,a,r){var o=g("rect");t.canvas&&t.canvas.appendChild(o);var s=new w(o,t);return s.attrs={x:e,y:i,width:n,height:a,r:r||0,rx:r||0,ry:r||0,fill:"none",stroke:"#000"},s.type="rect",g(o,s.attrs),s},i._engine.ellipse=function(t,e,i,n,a){var r=g("ellipse");t.canvas&&t.canvas.appendChild(r);var o=new w(r,t);return o.attrs={cx:e,cy:i,rx:n,ry:a,fill:"none",stroke:"#000"},o.type="ellipse",g(r,o.attrs),o},i._engine.image=function(t,e,i,n,a,r){var o=g("image");g(o,{x:i,y:n,width:a,height:r,preserveAspectRatio:"none"}),o.setAttributeNS(p,"href",e),t.canvas&&t.canvas.appendChild(o);var s=new w(o,t);return s.attrs={x:i,y:n,width:a,height:r,src:e},s.type="image",s},i._engine.text=function(t,e,n,a){var r=g("text");t.canvas&&t.canvas.appendChild(r);var o=new w(r,t);return o.attrs={x:e,y:n,"text-anchor":"middle",text:a,font:i._availableAttrs.font,stroke:"none",fill:"#000"},o.type="text",y(o,o.attrs),o},i._engine.setSize=function(t,e){return this.width=t||this.width,this.height=e||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},i._engine.create=function(){var t=i._getContainer.apply(0,arguments),e=t&&t.container,n=t.x,a=t.y,r=t.width,o=t.height;if(!e)throw new Error("SVG container not found.");var s,l=g("svg"),c="overflow:hidden;";return n=n||0,a=a||0,r=r||512,o=o||342,g(l,{height:o,version:1.1,width:r,xmlns:"http://www.w3.org/2000/svg"}),1==e?(l.style.cssText=c+"position:absolute;left:"+n+"px;top:"+a+"px",i._g.doc.body.appendChild(l),s=1):(l.style.cssText=c+"position:relative",e.firstChild?e.insertBefore(l,e.firstChild):e.appendChild(l)),e=new i._Paper,e.width=r,e.height=o,e.canvas=l,e.clear(),e._left=e._top=0,s&&(e.renderfix=function(){}),e.renderfix(),e},i._engine.setViewBox=function(t,e,i,n,a){d("raphael.setViewBox",this,this._viewBox,[t,e,i,n,a]);var r,s,l=o(i/this.width,n/this.height),c=this.top,h=a?"meet":"xMinYMin";for(null==t?(this._vbSize&&(l=1),delete this._vbSize,r="0 0 "+this.width+u+this.height):(this._vbSize=l,r=t+u+e+u+i+u+n),g(this.canvas,{viewBox:r,preserveAspectRatio:h});l&&c;)s="stroke-width"in c.attrs?c.attrs["stroke-width"]:1,c.attr({"stroke-width":s}),c._.dirty=1,c._.dirtyT=1,c=c.prev;return this._viewBox=[t,e,i,n,!!a],this},i.prototype.renderfix=function(){var t,e=this.canvas,i=e.style;try{t=e.getScreenCTM()||e.createSVGMatrix()}catch(n){t=e.createSVGMatrix()}var a=-t.e%1,r=-t.f%1;(a||r)&&(a&&(this._left=(this._left+a)%1,i.left=this._left+"px"),r&&(this._top=(this._top+r)%1,i.top=this._top+"px"))},i.prototype.clear=function(){i.eve("raphael.clear",this);for(var t=this.canvas;t.firstChild;)t.removeChild(t.firstChild);this.bottom=this.top=null,(this.desc=g("desc")).appendChild(i._g.doc.createTextNode("Created with Raphaël "+i.version)),t.appendChild(this.desc),t.appendChild(this.defs=g("defs"))},i.prototype.remove=function(){d("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var t in this)this[t]="function"==typeof this[t]?i._removedFactory(t):null};var _=i.st;for(var D in O)O[t](D)&&!_[t](D)&&(_[D]=function(t){return function(){var e=arguments;return this.forEach(function(i){i[t].apply(i,e)})}}(D))}}(),function(){if(i.vml){var t="hasOwnProperty",e=String,n=parseFloat,a=Math,r=a.round,o=a.max,s=a.min,l=a.abs,c="fill",d=/[, ]+/,h=i.eve,u=" progid:DXImageTransform.Microsoft",p=" ",f="",m={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},g=/([clmz]),?([^clmz]*)/gi,v=/ progid:\S+Blur\([^\)]+\)/g,C=/-?[^,\s-]+/g,I="position:absolute;left:0;top:0;width:1px;height:1px",b=21600,E={path:1,rect:1,image:1},y={circle:1,ellipse:1},T=function(t){var n=/[ahqstv]/gi,a=i._pathToAbsolute;if(e(t).match(n)&&(a=i._path2curve),n=/[clmz]/g,a==i._pathToAbsolute&&!e(t).match(n)){var o=e(t).replace(g,function(t,e,i){var n=[],a="m"==e.toLowerCase(),o=m[e];return i.replace(C,function(t){a&&2==n.length&&(o+=n+m["m"==e?"l":"L"],n=[]),n.push(r(t*b))}),o+n});return o}var s,l,c=a(t);o=[];for(var d=0,h=c.length;h>d;d++){s=c[d],l=c[d][0].toLowerCase(),"z"==l&&(l="x");for(var u=1,v=s.length;v>u;u++)l+=r(s[u]*b)+(u!=v-1?",":f);o.push(l)}return o.join(p)},R=function(t,e,n){var a=i.matrix();return a.rotate(-t,.5,.5),{dx:a.x(e,n),dy:a.y(e,n)}},w=function(t,e,i,n,a,r){var o=t._,s=t.matrix,d=o.fillpos,h=t.node,u=h.style,f=1,m="",g=b/e,v=b/i;if(u.visibility="hidden",e&&i){if(h.coordsize=l(g)+p+l(v),u.rotation=r*(0>e*i?-1:1),r){var C=R(r,n,a);n=C.dx,a=C.dy}if(0>e&&(m+="x"),0>i&&(m+=" y")&&(f=-1),u.flip=m,h.coordorigin=n*-g+p+a*-v,d||o.fillsize){var I=h.getElementsByTagName(c);I=I&&I[0],h.removeChild(I),d&&(C=R(r,s.x(d[0],d[1]),s.y(d[0],d[1])),I.position=C.dx*f+p+C.dy*f),o.fillsize&&(I.size=o.fillsize[0]*l(e)+p+o.fillsize[1]*l(i)),h.appendChild(I)}u.visibility="visible"}};i.toString=function(){return"Your browser doesn’t support SVG. Falling down to VML.\nYou are running Raphaël "+this.version};var O=function(t,i,n){for(var a=e(i).toLowerCase().split("-"),r=n?"end":"start",o=a.length,s="classic",l="medium",c="medium";o--;)switch(a[o]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":s=a[o];break;case"wide":case"narrow":c=a[o];break;case"long":case"short":l=a[o]}var d=t.node.getElementsByTagName("stroke")[0];d[r+"arrow"]=s,d[r+"arrowlength"]=l,d[r+"arrowwidth"]=c},_=function(a,l){a.attrs=a.attrs||{};var h=a.node,u=a.attrs,m=h.style,g=E[a.type]&&(l.x!=u.x||l.y!=u.y||l.width!=u.width||l.height!=u.height||l.cx!=u.cx||l.cy!=u.cy||l.rx!=u.rx||l.ry!=u.ry||l.r!=u.r),v=y[a.type]&&(u.cx!=l.cx||u.cy!=l.cy||u.r!=l.r||u.rx!=l.rx||u.ry!=l.ry),C=a;for(var I in l)l[t](I)&&(u[I]=l[I]);if(g&&(u.path=i._getPath[a.type](a),a._.dirty=1),l.href&&(h.href=l.href),l.title&&(h.title=l.title),l.target&&(h.target=l.target),l.cursor&&(m.cursor=l.cursor),"blur"in l&&a.blur(l.blur),(l.path&&"path"==a.type||g)&&(h.path=T(~e(u.path).toLowerCase().indexOf("r")?i._pathToAbsolute(u.path):u.path),"image"==a.type&&(a._.fillpos=[u.x,u.y],a._.fillsize=[u.width,u.height],w(a,1,1,0,0,0))),"transform"in l&&a.transform(l.transform),v){var R=+u.cx,_=+u.cy,x=+u.rx||+u.r||0,k=+u.ry||+u.r||0;h.path=i.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",r((R-x)*b),r((_-k)*b),r((R+x)*b),r((_+k)*b),r(R*b)),a._.dirty=1}if("clip-rect"in l){var q=e(l["clip-rect"]).split(d);if(4==q.length){q[2]=+q[2]+ +q[0],q[3]=+q[3]+ +q[1];var S=h.clipRect||i._g.doc.createElement("div"),N=S.style;N.clip=i.format("rect({1}px {2}px {3}px {0}px)",q),h.clipRect||(N.position="absolute",N.top=0,N.left=0,N.width=a.paper.width+"px",N.height=a.paper.height+"px",h.parentNode.insertBefore(S,h),S.appendChild(h),h.clipRect=S)}l["clip-rect"]||h.clipRect&&(h.clipRect.style.clip="auto")}if(a.textpath){var A=a.textpath.style;l.font&&(A.font=l.font),l["font-family"]&&(A.fontFamily='"'+l["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,f)+'"'),l["font-size"]&&(A.fontSize=l["font-size"]),l["font-weight"]&&(A.fontWeight=l["font-weight"]),l["font-style"]&&(A.fontStyle=l["font-style"])}if("arrow-start"in l&&O(C,l["arrow-start"]),"arrow-end"in l&&O(C,l["arrow-end"],1),null!=l.opacity||null!=l["stroke-width"]||null!=l.fill||null!=l.src||null!=l.stroke||null!=l["stroke-width"]||null!=l["stroke-opacity"]||null!=l["fill-opacity"]||null!=l["stroke-dasharray"]||null!=l["stroke-miterlimit"]||null!=l["stroke-linejoin"]||null!=l["stroke-linecap"]){var Q=h.getElementsByTagName(c),M=!1;if(Q=Q&&Q[0],!Q&&(M=Q=K(c)),"image"==a.type&&l.src&&(Q.src=l.src),l.fill&&(Q.on=!0),(null==Q.on||"none"==l.fill||null===l.fill)&&(Q.on=!1),Q.on&&l.fill){var P=e(l.fill).match(i._ISURL);if(P){Q.parentNode==h&&h.removeChild(Q),Q.rotate=!0,Q.src=P[1],Q.type="tile";var L=a.getBBox(1);Q.position=L.x+p+L.y,a._.fillpos=[L.x,L.y],i._preload(P[1],function(){a._.fillsize=[this.offsetWidth,this.offsetHeight]})}else Q.color=i.getRGB(l.fill).hex,Q.src=f,Q.type="solid",i.getRGB(l.fill).error&&(C.type in{circle:1,ellipse:1}||"r"!=e(l.fill).charAt())&&D(C,l.fill,Q)&&(u.fill="none",u.gradient=l.fill,Q.rotate=!1)}if("fill-opacity"in l||"opacity"in l){var B=((+u["fill-opacity"]+1||2)-1)*((+u.opacity+1||2)-1)*((+i.getRGB(l.fill).o+1||2)-1);B=s(o(B,0),1),Q.opacity=B,Q.src&&(Q.color="none")}h.appendChild(Q);var $=h.getElementsByTagName("stroke")&&h.getElementsByTagName("stroke")[0],F=!1;!$&&(F=$=K("stroke")),(l.stroke&&"none"!=l.stroke||l["stroke-width"]||null!=l["stroke-opacity"]||l["stroke-dasharray"]||l["stroke-miterlimit"]||l["stroke-linejoin"]||l["stroke-linecap"])&&($.on=!0),("none"==l.stroke||null===l.stroke||null==$.on||0==l.stroke||0==l["stroke-width"])&&($.on=!1);var H=i.getRGB(l.stroke);$.on&&l.stroke&&($.color=H.hex),B=((+u["stroke-opacity"]+1||2)-1)*((+u.opacity+1||2)-1)*((+H.o+1||2)-1);var j=.75*(n(l["stroke-width"])||1);if(B=s(o(B,0),1),null==l["stroke-width"]&&(j=u["stroke-width"]),l["stroke-width"]&&($.weight=j),j&&1>j&&(B*=j)&&($.weight=1),$.opacity=B,l["stroke-linejoin"]&&($.joinstyle=l["stroke-linejoin"]||"miter"),$.miterlimit=l["stroke-miterlimit"]||8,l["stroke-linecap"]&&($.endcap="butt"==l["stroke-linecap"]?"flat":"square"==l["stroke-linecap"]?"square":"round"),l["stroke-dasharray"]){var z={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};$.dashstyle=z[t](l["stroke-dasharray"])?z[l["stroke-dasharray"]]:f}F&&h.appendChild($)}if("text"==C.type){C.paper.canvas.style.display=f;var U=C.paper.span,W=100,V=u.font&&u.font.match(/\d+(?:\.\d*)?(?=px)/);m=U.style,u.font&&(m.font=u.font),u["font-family"]&&(m.fontFamily=u["font-family"]),u["font-weight"]&&(m.fontWeight=u["font-weight"]),u["font-style"]&&(m.fontStyle=u["font-style"]),V=n(u["font-size"]||V&&V[0])||10,m.fontSize=V*W+"px",C.textpath.string&&(U.innerHTML=e(C.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));
var G=U.getBoundingClientRect();C.W=u.w=(G.right-G.left)/W,C.H=u.h=(G.bottom-G.top)/W,C.X=u.x,C.Y=u.y+C.H/2,("x"in l||"y"in l)&&(C.path.v=i.format("m{0},{1}l{2},{1}",r(u.x*b),r(u.y*b),r(u.x*b)+1));for(var X=["x","y","text","font","font-family","font-weight","font-style","font-size"],Y=0,J=X.length;J>Y;Y++)if(X[Y]in l){C._.dirty=1;break}switch(u["text-anchor"]){case"start":C.textpath.style["v-text-align"]="left",C.bbx=C.W/2;break;case"end":C.textpath.style["v-text-align"]="right",C.bbx=-C.W/2;break;default:C.textpath.style["v-text-align"]="center",C.bbx=0}C.textpath.style["v-text-kern"]=!0}},D=function(t,r,o){t.attrs=t.attrs||{};var s=(t.attrs,Math.pow),l="linear",c=".5 .5";if(t.attrs.gradient=r,r=e(r).replace(i._radial_gradient,function(t,e,i){return l="radial",e&&i&&(e=n(e),i=n(i),s(e-.5,2)+s(i-.5,2)>.25&&(i=a.sqrt(.25-s(e-.5,2))*(2*(i>.5)-1)+.5),c=e+p+i),f}),r=r.split(/\s*\-\s*/),"linear"==l){var d=r.shift();if(d=-n(d),isNaN(d))return null}var h=i._parseDots(r);if(!h)return null;if(t=t.shape||t.node,h.length){t.removeChild(o),o.on=!0,o.method="none",o.color=h[0].color,o.color2=h[h.length-1].color;for(var u=[],m=0,g=h.length;g>m;m++)h[m].offset&&u.push(h[m].offset+p+h[m].color);o.colors=u.length?u.join():"0% "+o.color,"radial"==l?(o.type="gradientTitle",o.focus="100%",o.focussize="0 0",o.focusposition=c,o.angle=0):(o.type="gradient",o.angle=(270-d)%360),t.appendChild(o)}return 1},x=function(t,e){this[0]=this.node=t,t.raphael=!0,this.id=i._oid++,t.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=e,this.matrix=i.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!e.bottom&&(e.bottom=this),this.prev=e.top,e.top&&(e.top.next=this),e.top=this,this.next=null},k=i.el;x.prototype=k,k.constructor=x,k.transform=function(t){if(null==t)return this._.transform;var n,a=this.paper._viewBoxShift,r=a?"s"+[a.scale,a.scale]+"-1-1t"+[a.dx,a.dy]:f;a&&(n=t=e(t).replace(/\.{3}|\u2026/g,this._.transform||f)),i._extractTransform(this,r+t);var o,s=this.matrix.clone(),l=this.skew,c=this.node,d=~e(this.attrs.fill).indexOf("-"),h=!e(this.attrs.fill).indexOf("url(");if(s.translate(1,1),h||d||"image"==this.type)if(l.matrix="1 0 0 1",l.offset="0 0",o=s.split(),d&&o.noRotation||!o.isSimple){c.style.filter=s.toFilter();var u=this.getBBox(),m=this.getBBox(1),g=u.x-m.x,v=u.y-m.y;c.coordorigin=g*-b+p+v*-b,w(this,1,1,g,v,0)}else c.style.filter=f,w(this,o.scalex,o.scaley,o.dx,o.dy,o.rotate);else c.style.filter=f,l.matrix=e(s),l.offset=s.offset();return n&&(this._.transform=n),this},k.rotate=function(t,i,a){if(this.removed)return this;if(null!=t){if(t=e(t).split(d),t.length-1&&(i=n(t[1]),a=n(t[2])),t=n(t[0]),null==a&&(i=a),null==i||null==a){var r=this.getBBox(1);i=r.x+r.width/2,a=r.y+r.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",t,i,a]])),this}},k.translate=function(t,i){return this.removed?this:(t=e(t).split(d),t.length-1&&(i=n(t[1])),t=n(t[0])||0,i=+i||0,this._.bbox&&(this._.bbox.x+=t,this._.bbox.y+=i),this.transform(this._.transform.concat([["t",t,i]])),this)},k.scale=function(t,i,a,r){if(this.removed)return this;if(t=e(t).split(d),t.length-1&&(i=n(t[1]),a=n(t[2]),r=n(t[3]),isNaN(a)&&(a=null),isNaN(r)&&(r=null)),t=n(t[0]),null==i&&(i=t),null==r&&(a=r),null==a||null==r)var o=this.getBBox(1);return a=null==a?o.x+o.width/2:a,r=null==r?o.y+o.height/2:r,this.transform(this._.transform.concat([["s",t,i,a,r]])),this._.dirtyT=1,this},k.hide=function(){return!this.removed&&(this.node.style.display="none"),this},k.show=function(){return!this.removed&&(this.node.style.display=f),this},k._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},k.remove=function(){if(!this.removed&&this.node.parentNode){this.paper.__set__&&this.paper.__set__.exclude(this),i.eve.unbind("raphael.*.*."+this.id),i._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape);for(var t in this)this[t]="function"==typeof this[t]?i._removedFactory(t):null;this.removed=!0}},k.attr=function(e,n){if(this.removed)return this;if(null==e){var a={};for(var r in this.attrs)this.attrs[t](r)&&(a[r]=this.attrs[r]);return a.gradient&&"none"==a.fill&&(a.fill=a.gradient)&&delete a.gradient,a.transform=this._.transform,a}if(null==n&&i.is(e,"string")){if(e==c&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;for(var o=e.split(d),s={},l=0,u=o.length;u>l;l++)e=o[l],s[e]=e in this.attrs?this.attrs[e]:i.is(this.paper.customAttributes[e],"function")?this.paper.customAttributes[e].def:i._availableAttrs[e];return u-1?s:s[o[0]]}if(this.attrs&&null==n&&i.is(e,"array")){for(s={},l=0,u=e.length;u>l;l++)s[e[l]]=this.attr(e[l]);return s}var p;null!=n&&(p={},p[e]=n),null==n&&i.is(e,"object")&&(p=e);for(var f in p)h("raphael.attr."+f+"."+this.id,this,p[f]);if(p){for(f in this.paper.customAttributes)if(this.paper.customAttributes[t](f)&&p[t](f)&&i.is(this.paper.customAttributes[f],"function")){var m=this.paper.customAttributes[f].apply(this,[].concat(p[f]));this.attrs[f]=p[f];for(var g in m)m[t](g)&&(p[g]=m[g])}p.text&&"text"==this.type&&(this.textpath.string=p.text),_(this,p)}return this},k.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&i._tofront(this,this.paper),this},k.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),i._toback(this,this.paper)),this)},k.insertAfter=function(t){return this.removed?this:(t.constructor==i.st.constructor&&(t=t[t.length-1]),t.node.nextSibling?t.node.parentNode.insertBefore(this.node,t.node.nextSibling):t.node.parentNode.appendChild(this.node),i._insertafter(this,t,this.paper),this)},k.insertBefore=function(t){return this.removed?this:(t.constructor==i.st.constructor&&(t=t[0]),t.node.parentNode.insertBefore(this.node,t.node),i._insertbefore(this,t,this.paper),this)},k.blur=function(t){var e=this.node.runtimeStyle,n=e.filter;return n=n.replace(v,f),0!==+t?(this.attrs.blur=t,e.filter=n+p+u+".Blur(pixelradius="+(+t||1.5)+")",e.margin=i.format("-{0}px 0 0 -{0}px",r(+t||1.5))):(e.filter=n,e.margin=0,delete this.attrs.blur),this},i._engine.path=function(t,e){var i=K("shape");i.style.cssText=I,i.coordsize=b+p+b,i.coordorigin=e.coordorigin;var n=new x(i,e),a={fill:"none",stroke:"#000"};t&&(a.path=t),n.type="path",n.path=[],n.Path=f,_(n,a),e.canvas.appendChild(i);var r=K("skew");return r.on=!0,i.appendChild(r),n.skew=r,n.transform(f),n},i._engine.rect=function(t,e,n,a,r,o){var s=i._rectPath(e,n,a,r,o),l=t.path(s),c=l.attrs;return l.X=c.x=e,l.Y=c.y=n,l.W=c.width=a,l.H=c.height=r,c.r=o,c.path=s,l.type="rect",l},i._engine.ellipse=function(t,e,i,n,a){{var r=t.path();r.attrs}return r.X=e-n,r.Y=i-a,r.W=2*n,r.H=2*a,r.type="ellipse",_(r,{cx:e,cy:i,rx:n,ry:a}),r},i._engine.circle=function(t,e,i,n){{var a=t.path();a.attrs}return a.X=e-n,a.Y=i-n,a.W=a.H=2*n,a.type="circle",_(a,{cx:e,cy:i,r:n}),a},i._engine.image=function(t,e,n,a,r,o){var s=i._rectPath(n,a,r,o),l=t.path(s).attr({stroke:"none"}),d=l.attrs,h=l.node,u=h.getElementsByTagName(c)[0];return d.src=e,l.X=d.x=n,l.Y=d.y=a,l.W=d.width=r,l.H=d.height=o,d.path=s,l.type="image",u.parentNode==h&&h.removeChild(u),u.rotate=!0,u.src=e,u.type="tile",l._.fillpos=[n,a],l._.fillsize=[r,o],h.appendChild(u),w(l,1,1,0,0,0),l},i._engine.text=function(t,n,a,o){var s=K("shape"),l=K("path"),c=K("textpath");n=n||0,a=a||0,o=o||"",l.v=i.format("m{0},{1}l{2},{1}",r(n*b),r(a*b),r(n*b)+1),l.textpathok=!0,c.string=e(o),c.on=!0,s.style.cssText=I,s.coordsize=b+p+b,s.coordorigin="0 0";var d=new x(s,t),h={fill:"#000",stroke:"none",font:i._availableAttrs.font,text:o};d.shape=s,d.path=l,d.textpath=c,d.type="text",d.attrs.text=e(o),d.attrs.x=n,d.attrs.y=a,d.attrs.w=1,d.attrs.h=1,_(d,h),s.appendChild(c),s.appendChild(l),t.canvas.appendChild(s);var u=K("skew");return u.on=!0,s.appendChild(u),d.skew=u,d.transform(f),d},i._engine.setSize=function(t,e){var n=this.canvas.style;return this.width=t,this.height=e,t==+t&&(t+="px"),e==+e&&(e+="px"),n.width=t,n.height=e,n.clip="rect(0 "+t+" "+e+" 0)",this._viewBox&&i._engine.setViewBox.apply(this,this._viewBox),this},i._engine.setViewBox=function(t,e,n,a,r){i.eve("raphael.setViewBox",this,this._viewBox,[t,e,n,a,r]);var s,l,c=this.width,d=this.height,h=1/o(n/c,a/d);return r&&(s=d/a,l=c/n,c>n*s&&(t-=(c-n*s)/2/s),d>a*l&&(e-=(d-a*l)/2/l)),this._viewBox=[t,e,n,a,!!r],this._viewBoxShift={dx:-t,dy:-e,scale:h},this.forEach(function(t){t.transform("...")}),this};var K;i._engine.initWin=function(t){var e=t.document;e.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!e.namespaces.rvml&&e.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),K=function(t){return e.createElement("<rvml:"+t+' class="rvml">')}}catch(i){K=function(t){return e.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},i._engine.initWin(i._g.win),i._engine.create=function(){var t=i._getContainer.apply(0,arguments),e=t.container,n=t.height,a=t.width,r=t.x,o=t.y;if(!e)throw new Error("VML container not found.");var s=new i._Paper,l=s.canvas=i._g.doc.createElement("div"),c=l.style;return r=r||0,o=o||0,a=a||512,n=n||342,s.width=a,s.height=n,a==+a&&(a+="px"),n==+n&&(n+="px"),s.coordsize=1e3*b+p+1e3*b,s.coordorigin="0 0",s.span=i._g.doc.createElement("span"),s.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",l.appendChild(s.span),c.cssText=i.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",a,n),1==e?(i._g.doc.body.appendChild(l),c.left=r+"px",c.top=o+"px",c.position="absolute"):e.firstChild?e.insertBefore(l,e.firstChild):e.appendChild(l),s.renderfix=function(){},s},i.prototype.clear=function(){i.eve("raphael.clear",this),this.canvas.innerHTML=f,this.span=i._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},i.prototype.remove=function(){i.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas);for(var t in this)this[t]="function"==typeof this[t]?i._removedFactory(t):null;return!0};var q=i.st;for(var S in k)k[t](S)&&!q[t](S)&&(q[S]=function(t){return function(){var e=arguments;return this.forEach(function(i){i[t].apply(i,e)})}}(S))}}(),_.was?O.win.Raphael=i:Raphael=i,i}),define("scale.raphael",["jquery","raphael"],function(t,e){var i=function(i,n,a){var r=i.style?i:document.getElementById(i);r.style.position||(r.style.position="relative"),r.style.width=n+"px",r.style.height=a+"px",r.style.overflow="hidden";var o;"VML"===e.type?(r.innerHTML="<rvml:group style='position : absolute; width: 1000px; height: 1000px; top: 0px; left: 0px' coordsize='1000,1000' class='rvml'></rvml:group>",o=t(".rvml",t(r))[0]):(r.innerHTML="<div class='svggroup'></div>",o=t(".svggroup",t(r))[0]);var s,l=new e(o,n,a);return"SVG"===e.type?l.canvas.setAttribute("viewBox","0 0 "+n+" "+a):s=r.getElementsByTagName("div")[0],l.changeSize=function(t,i,c,d){d=!d;var h=t/n,u=i/a,p=u>h?h:u,f=parseInt(a*p),m=parseInt(n*p);if("VML"===e.type){var g=document.getElementsByTagName("textpath");for(var v in g){var C=g[v];if(C.style){if(!C._fontSize){var I=C.style.font.split("px");C._fontSize=parseInt(I[0]),C._font=I[1]}C.style.font=C._fontSize*p+"px"+C._font}}var b;b=f>m?1e3*m/n:1e3*f/a,b=parseInt(b),o.style.width=b+"px",o.style.height=b+"px",d&&(o.style.left=parseInt((t-m)/2)+"px",o.style.top=parseInt((i-f)/2)+"px"),s.style.overflow="visible"}d&&(m=t,f=i),r.style.width=m+"px",r.style.height=f+"px",l.setSize(m,f),c&&(r.style.position="absolute",r.style.left=parseInt((t-m)/2)+"px",r.style.top=parseInt((i-f)/2)+"px")},l.scaleAll=function(t){l.changeSize(n*t,a*t)},l.changeSize(n,a),l.w=n,l.h=a,l};return i}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicAssociateInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a;return(a=i.prompt)?n=a.call(t,{hash:{},data:e}):(a=t&&t.prompt,n=typeof a===c?a.call(t,{hash:{},data:e}):a),n||0===n?n:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l="",c="function",d=this.escapeExpression,h=this;return l+='<div class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-graphicAssociateInteraction '+d((o=e&&e.attributes,o=null==o||o===!1?o:o["class"],typeof o===c?o.apply(e):o))+'" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.serial,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'">\n    ',o=i["if"].call(e,e&&e.prompt,{hash:{},inverse:h.noop,fn:h.program(1,r,a),data:a}),(o||0===o)&&(l+=o),l+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',(s=i.serial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.serial,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'\' class="main-image-box"></div>\n        <div class="clear"></div>\n    </div>\n</div>\n'})}),define("json!taoQtiItem/qtiCommonRenderer/renderers/graphic-style.json",function(){return{basic:{stroke:"#8D949E","stroke-width":2,"stroke-dasharray":"","stroke-linejoin":"round",fill:"#cccccc","fill-opacity":.5,cursor:"pointer"},hover:{stroke:"#3E7DA7",fill:"#0E5D91","fill-opacity":.3},selectable:{"stroke-dasharray":"-",stroke:"#3E7DA7",fill:"#cccccc","fill-opacity":.5},active:{stroke:"#3E7DA7","stroke-dasharray":"",fill:"#0E5D91","fill-opacity":.5},error:{stroke:"#C74155","stroke-dasharray":"","fill-opacity":.5,fill:"#661728"},success:{stroke:"#C74155","stroke-dasharray":"",fill:"#0E914B","fill-opacity":.5},layer:{fill:"#ffffff",opacity:0,cursor:"pointer"},creator:{"fill-opacity":.5,stroke:"#3E7DA7","stroke-dasharray":"",fill:"#0E5D91",cursor:"pointer"},"imageset-rect":{fill:"#ffffff",stroke:"#000000","stroke-width":1,"stroke-linejoin":"round",cursor:"pointer"},"imageset-img":{cursor:"pointer"},"order-text":{fill:"#ffffff",stroke:"#000000","stroke-width":.7,"font-family":"sans-serif","font-weight":"bold","font-size":22,cursor:"pointer"},"score-text-default":{fill:"#dddddd",stroke:"#000000","stroke-width":.6,"font-family":"sans-serif","font-weight":"bold","font-size":18,cursor:"pointer"},"score-text":{fill:"#ffffff",stroke:"#000000","stroke-width":.6,"font-family":"sans-serif","font-weight":"bold","font-size":18,cursor:"pointer"},target:{path:"m 18,8.4143672 -1.882582,0 C 15.801891,4.9747852 13.071059,2.2344961 9.63508,1.9026738 L 9.63508,0 8.2305176,0 l 0,1.9026387 C 4.7947148,2.2343027 2.0637246,4.9746621 1.7481973,8.4143672 l -1.7481973,0 0,1.4045625 1.754877,0 c 0.3460429,3.4066753 3.0632871,6.1119843 6.4756406,6.4413813 l 0,1.739689 1.4045624,0 0,-1.739725 c 3.412547,-0.329537 6.129633,-3.034793 6.475641,-6.4413453 l 1.889279,0 z m -8.36492,6.5188648 0,-4.064673 -1.4045624,0 0,4.063882 C 5.5511016,14.612555 3.4232695,12.494619 3.0864551,9.8189297 l 4.0449512,0 0,-1.4045625 -4.0546368,0 C 3.3788672,5.6984941 5.5228887,3.5393379 8.2305176,3.2161113 l 0,3.9153125 1.4045624,0 0,-3.9160859 c 2.711162,0.3203965 4.858576,2.4808887 5.160955,5.1990293 l -3.927441,0 0,1.4045625 3.917773,0 C 14.449289,12.496957 12.318363,14.616158 9.63508,14.933232 z",fill:"#0E914B",width:1,"stroke-width":0,cursor:"pointer"},"target-hover":{fill:"#3E7DA7","fill-opacity":1},"target-success":{fill:"#0E914B","fill-opacity":1},assoc:{"stroke-width":2,"stroke-linecap":"round",cursor:"pointer"},"assoc-layer":{"stroke-width":12,cursor:"pointer","stroke-opacity":0},"assoc-bullet":{fill:"#000000"},close:{path:"m 8.9997236,18.000001 c -4.9703918,0 -8.99972284217367,-4.02901 -8.99972284217367,-9 C 7.5782633e-7,4.029011 4.0293108,9.8531742e-7 8.9997236,9.8531742e-7 13.970691,9.8531742e-7 18.000001,4.029011 18.000001,9.000001 c 0,4.97099 -4.02931,9 -9.0002774,9 z m 0.0045,-16.37151 c -4.06191,0 -7.35492,3.29635 -7.35492,7.36251 0,4.06562 3.292989,7.36255 7.35492,7.36255 4.0630384,0 7.3554334,-3.29693 7.3554334,-7.36255 0,-4.06614 -3.292969,-7.36251 -7.3554334,-7.36251 v 0 z m 3.1314894,9.31167 -1.953823,-1.94014 1.953843,-1.94018 c 0.08964,-0.089 0.134622,-0.19099 0.135073,-0.30584 4.31e-4,-0.11488 -0.04383,-0.21712 -0.132838,-0.30681 l -0.54267,-0.54685 c -0.08898,-0.0897 -0.190903,-0.13473 -0.305719,-0.13514 -0.114837,-4.4e-4 -0.217064,0.0439 -0.306703,0.1329 l -1.9623724,1.94865 -1.962395,-1.94865 c -0.08964,-0.089 -0.191845,-0.13336 -0.306702,-0.1329 -0.114837,4.3e-4 -0.216736,0.0455 -0.305719,0.13514 l -0.54265,0.54685 c -0.08902,0.0897 -0.133269,0.19193 -0.132838,0.30681 4.3e-4,0.11485 0.04543,0.21681 0.135073,0.30584 l 1.953823,1.94018 -1.953782,1.94014 c -0.0896,0.089 -0.134684,0.19094 -0.135114,0.3058 -4.31e-4,0.11486 0.04386,0.21716 0.132838,0.30681 l 0.542671,0.54687 c 0.08896,0.0897 0.190923,0.13467 0.305718,0.13516 0.114857,3.9e-4 0.217105,-0.0439 0.306724,-0.13288 l 1.962332,-1.94863 1.9623324,1.94863 c 0.08962,0.089 0.191886,0.13323 0.306744,0.13288 0.114836,-4.5e-4 0.216736,-0.0455 0.305698,-0.13516 l 0.542691,-0.54687 c 0.089,-0.0897 0.133227,-0.19193 0.132838,-0.30681 -3.9e-4,-0.1149 -0.0455,-0.21683 -0.135073,-0.3058 z",fill:"#0E5D91",width:1,opacity:0,"stroke-width":0,cursor:"pointer"},"close-bg":{fill:"#ffffff",stroke:"none",cursor:"pointer",opacity:0},"touch-circle":{fill:"none",stroke:"#3E7DA7","stroke-width":2}}}),define("taoQtiItem/qtiCommonRenderer/helpers/Graphic",["jquery","lodash","raphael","scale.raphael","json!taoQtiItem/qtiCommonRenderer/renderers/graphic-style.json"],function(t,e,i,n,a){var r={"default":"rect",poly:"path"},o={rect:4,ellipse:4,circle:3,poly:6,"default":0},s={rect:function(t){return[t[0],t[1],t[2]-t[0],t[3]-t[1]]},"default":function(t){return[0,0,t.width,t.height]},poly:function(t){var e,i=t.length;for(t[0]!==t[i-2]&&t[1]!==t[i-1]&&(t.push(t[0]),t.push(t[1])),t[0]="M"+t[0],e=1;i>e;e++)e%2===0&&(t[e]="L"+t[e]);return[t.join(" ")]}},l={rect:function(t){return[t.x,t.y,t.x+t.width,t.y+t.height]},circle:function(t){return[t.cx,t.cy,t.r]},ellipse:function(t){return[t.cx,t.cy,t.rx,t.ry]},"default":function(t){return this.rect(t)},path:function(t){var i,n=[];if(e.isArray(t.path))for(i=1;i<t.path.length;i++)3===t.path[i].length&&(n.push(t.path[i][1]),n.push(t.path[i][2]));return n}},c={_style:a,setStyle:function(t,e){t&&a[e]&&t.attr(a[e])},responsivePaper:function(a,r){function o(t,e){var i=d.innerWidth();e=e||c.innerWidth()-(g+8),e>i&&(e=i-(g+8)),s.changeSize(e,u,!1,!1),f&&s.scaleAll(e/h),"function"==typeof r.resize&&r.resize(e),c.trigger("resized.qti-widget")}var s,l,c=r.container||t("#"+a).parent(),d=c.closest(".qti-itemBody"),h=r.width||c.width(),u=r.height||c.height(),p="SVG"===i.type?n:i,f=c.hasClass("responsive"),m=c.parent().outerWidth(),g=r.diff||(m>h?m-h:28),v=e.throttle(o,10);return s=p.call(null,a,h,u),l=s.image(r.img,0,0,h,u),r.imgId&&(l.id=r.imgId),"SVG"===i.type?(v(),t(window).on("resize.qti-widget",v),c.on("resize.qti-widget",v)):(s.canvas.setAttribute("viewBox","0 0 "+h+" "+u),c.find(".main-image-box").width(h),"function"==typeof r.resize&&r.resize(h)),s},createElement:function(t,e,i,n){var o,s=this,l=r[e]?t[r[e]]:t[e],c=n.qtiCoords!==!1?s.raphaelCoords(t,e,i):i;if("function"!=typeof l)throw new Error("Unable to find method "+e+" on paper");return o=l.apply(t,c),o&&(n.id&&(o.id=n.id),n.title&&o.attr("title",n.title),o.attr(a[n.style||"basic"]).toFront(),n.hover!==!1&&o.hover(function(){o.flashing||s.updateElementState(this,"hover")},function(){o.flashing||s.updateElementState(this,this.active?"active":this.selectable?"selectable":"basic")}),n.touchEffect!==!1&&o.touchstart(function(){s.createTouchCircle(t,o.getBBox())})),o},createTarget:function(t,i){var n=this;i=i||{};var r=i.point||{x:0,y:0},o=(r.x>=9?r.x-9:0,r.y>=9?r.y-9:0,t.path(a.target.path).transform("T"+(r.x-9)+","+(r.y-9)).attr(a.target).attr("title",e("Click again to remove")));if(i.id)o.id=i.id;else{var s=0;t.forEach(function(t){t.data("target")&&s++}),o.id="target-"+s}var l=t.rect(r.x-9,r.y-9,18,18).attr(a.layer).hover(function(){o.flashing||n.setStyle(o,"target-hover")},function(){o.flashing||n.setStyle(o,"target-success")}).click(function(){var t=o.id,n=this.data("point");e.isFunction(i.select)&&i.select(o,n,this),e.isFunction(i.remove)&&(this.remove(),o.remove(),i.remove(t,n))});return l.id="layer-"+o.id,l.data("point",r),o.data("target",r),e.isFunction(i.create)&&i.create(o),o},raphaelCoords:function(t,i,n){var a;if(e.isString(n)&&(n=e.map(n.split(","),function(t){return parseInt(t,10)})),!e.isArray(n)||n.length<o[i])throw new Error("Invalid coords "+JSON.stringify(n)+"  for type "+i);switch(i){case"rect":a=s.rect(n);break;case"default":a=s["default"].call(null,t);break;case"poly":a=s.poly(n);break;default:a=n}return a},qtiCoords:function(t){var i=l[t.type],n="";return e.isFunction(i)&&(n=e.map(i.call(l,t.attr()),function(t){return e.parseInt(t)}).join(",")),n},createTouchCircle:function(t,i){var n=i.width>i.height?i.width:i.height,r=t.circle(i.x+i.width/2,i.y+i.height/2,n);r.attr(a["touch-circle"]),e.defer(function(){r.animate({r:n+5,opacity:.7},300,function(){r.remove()})})},createShapeText:function(t,e,i){var n=this,a=i.content||"",r=i.style||"text",o=i.title||"",s=e.getBBox(),l=t.text(s.x+s.width/2,s.y+s.height/2,a).toFront();return i.id&&(l.id=i.id),this.updateElementState(l,r,o),i.shapeClick&&l.click(function(){n.trigger(e,"click")}),l},createBorderedImage:function(t,e){var n=e.padding||6,r=n/2,o=e.left,s=e.top,l=e.width+n,c=e.height+n,d=e.left+r,h=e.top+r,u=e.width,p=e.height,f=t.set(),m=t.rect(o,s,l,c).attr(a["imageset-rect"]),g=t.image(e.url,d,h,u,p).attr(a["imageset-img"]);return f.push(m,g),f.move=function(t,e,n){var a=i.animation({x:t,y:e},n||400),o=m.animate(a);return g.animateWith(o,a,{x:t+r,y:e+r},n||400),f},f},updateElementState:function(t,e,i){t&&t.animate&&(t.animate(a[e],200,"linear",function(){t.attr(a[e])}),i&&this.updateTitle(t,i))},updateTitle:function(t,i){e.forEach(t.node.children,function(e){"title"===e.nodeName.toLowerCase()&&t.node.removeChild(e)}),t.attr("title",i)},highlightError:function(t,i){var n=this;t&&(t.flashing=!0,n.updateElementState(t,"error"),e.delay(function(){n.updateElementState(t,i||"basic"),t.flashing=!1},800))},trigger:function(t,i){var n=e.where(t.events,{name:i});n.length&&n[0]&&"function"==typeof n[0].f&&n[0].f.apply(t,Array.prototype.slice.call(arguments,2))},getPoint:function(t,e,i,n){var a,r,o,s=this.clickPoint(i,t);return e.w&&e.w!==e.width&&(n?(o=e.w/e.width,s.x=Math.round(s.x*o),s.y=Math.round(s.y*o)):e.width>e.w?(a=(e.width-e.w)/2,s.x=Math.round(s.x-a)):(o=e.w/e.width,s.x=Math.round(s.x*o),r=(e.height-e.height*(2-o))/2,s.y=Math.round(s.y*o-r))),s},position:function(t,e){var i=parseInt(e.w||e.width,10),n=parseInt(t.width(),10),a=parseInt(e.w||e.width,10),r=parseInt(t.height(),10);return{left:(n-i)/2,top:(r-a)/2}},clickPoint:function(t,e){var i,n,a=t.offset();return e.pageX||e.pageY?(i=e.pageX-a.left,n=e.pageY-a.top):(e.clientX||e.clientY)&&(i=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft-a.left,n=e.clientY+document.body.scrollTop+document.documentElement.scrollTop-a.top),{x:i,y:n}}};return c}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction",["jquery","lodash","i18n","raphael","scale.raphael","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicAssociateInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e,i,n,a,r,o,s,l){var c=function(i){var n=l.getContainer(i),a=i.object.attributes;i.paper=o.responsivePaper("graphic-paper-"+i.serial,{width:a.width,height:a.height,img:this.getOption("baseUrl")+a.data,imgId:"bg-image-"+i.serial,container:n,diff:t(".image-editor",n).outerWidth()-t(".main-image-box",n).outerWidth()}),e.forEach(i.getChoices(),e.partial(d,i)),h(i),l.minMaxChoiceInstructions(i,{min:i.attr("minAssociations"),max:i.attr("maxAssociations"),getResponse:v,onError:function(t){t.target.active&&o.highlightError(t.target)}})},d=function(t,n){{var a=n.attr("shape"),r=n.attr("coords");o.createElement(t.paper,a,r,{id:n.serial,title:i("Select this area to start an association")}).data("max",n.attr("matchMax")).data("matching",0).click(function(){var a,r,s=this;this.selectable?(a=u(t),a&&(a.data("matching",a.data("matching")+1),this.data("matching",this.data("matching")+1),r=a.data("assocs")||[],r.push(n.id()),a.data("assocs",r),p(t,a,this,function(){a.data("matching",a.data("matching")-1),s.data("matching",s.data("matching")-1),a.data("assocs",e.remove(a.data("assocs")||[],n.id())),l.triggerResponseChangeEvent(t),l.validateInstructions(t,{choice:n,target:s})})),m(t)):this.active?(o.updateElementState(this,"basic",i("Select this area to start an association")),this.active=!1,m(t)):g(this)&&(o.updateElementState(this,"active",i("Select another area to complete the association")),this.active=!0,f(t)),l.triggerResponseChangeEvent(t),l.validateInstructions(t,{choice:n,target:this})})}},h=function(t){var e=l.getContainer(t),i=t.paper.getById("bg-image-"+t.serial);i&&i.click(function(){m(t),e.trigger("unselect.graphicassociate")})},u=function(t){var i;return e.forEach(t.getChoices(),function(e){var n=t.paper.getById(e.serial);return n&&n.active===!0?(i=n,!1):void 0}),i},p=function(t,i,n,a){function r(){T.animate({opacity:.8},300).toFront().click(c),R.animate({opacity:1},300).toFront().click(c)}function s(){T&&T.type&&(T.animate({opacity:0},300).toBack().unclick(),R.animate({opacity:0},300).toBack().unclick())}function c(){e.invoke(h,"remove"),"function"==typeof a&&a()}var d=l.getContainer(t),h=[],u=i.getBBox(),p=u.x+u.width/2,f=u.y+u.height/2,m=n.getBBox(),g=m.x+m.width/2,v=m.y+m.height/2,C=t.paper.circle(p,f,3).attr(o._style["assoc-bullet"]),I=t.paper.circle(g,v,3).attr(o._style["assoc-bullet"]),b=t.paper.path("M"+p+","+f+"L"+p+","+f).attr(o._style.assoc).animate({path:"M"+p+","+f+"L"+g+","+v},300),E=t.paper.path("M"+p+","+f+"L"+g+","+v).attr(o._style["assoc-layer"]),y=E.getPointAtLength(E.getTotalLength()/2),T=t.paper.circle(y.x,y.y,9).attr(o._style["close-bg"]).toBack(),R=t.paper.path(o._style.close.path).attr(o._style.close).transform("T"+(y.x-9)+","+(y.y-9)).attr("title",e("Click again to remove")).toBack();i.toFront(),n.toFront(),h=[C,b,I,E,T,R],e.invoke(h,"data","assoc-path",!0),E.click(function(){0===R.attrs.opacity?r():s()}),d.on("unselect.graphicassociate",function(){s()})},f=function(t){e.forEach(t.getChoices(),function(e){var i=t.paper.getById(e.serial);g(i)&&!i.active&&(i.selectable=!0,o.updateElementState(i,"selectable"))})},m=function(t){e.forEach(t.getChoices(),function(e){var i=t.paper.getById(e.serial);i&&(i.selectable=!1,i.active=!1,o.updateElementState(i,"basic"))})},g=function(t){var e,i,n=!1;return t&&(i=t.data("max")||1,e=t.data("matching")||0,n=0===i||i>e),n},v=function(t){var i=[];return e.forEach(t.getChoices(),function(n){var a=t.paper.getById(n.serial),r=a.data("assocs");a&&r&&(i=i.concat(e.map(r,function(t){return[n.id(),t]})))}),i},C=function(t,i){var n;if(i&&t.paper){try{n=s.unserialize(i,t)}catch(a){}if(e.isArray(n)){var r=e.transform(t.getChoices(),function(e,i){e[i.id()]=t.paper.getById(i.serial)});e.forEach(n,function(t){var i,n;e.isArray(t)&&2===t.length&&(i=r[t[0]],n=r[t[1]],i&&n&&(o.trigger(i,"click"),o.trigger(n,"click")))})}}},I=function(t){var i=[];e.forEach(t.getChoices(),function(e){var i=t.paper.getById(e.serial);i&&i.data({max:e.attr("matchMax"),matching:0,assocs:[]})}),t.paper.forEach(function(t){t.data("assoc-path")&&i.push(t)}),e.invoke(i,"remove")},b=function(t){var e=(v(t),s.serialize(v(t),t));return e},E=function(e){var i;e.paper&&(i=l.getContainer(e),t(window).off("resize.qti-widget"),e.paper.clear(),l.removeInstructions(e),t(".main-image-box",i).empty().removeAttr("style"),t(".image-editor",i).removeAttr("style"),t("ul",i).empty())};return{qtiClass:"graphicAssociateInteraction",template:r,render:c,getContainer:l.getContainer,setResponse:C,getResponse:b,resetResponse:I,destroy:E}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicGapMatchInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a;return(a=i.prompt)?n=a.call(t,{hash:{},data:e}):(a=t&&t.prompt,n=typeof a===h?a.call(t,{hash:{},data:e}):a),n||0===n?n:""}function o(t){var e;return e=typeof t===h?t.apply(t):t,e||0===e?e:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var s,l,c,d="",h="function",u=this.escapeExpression,p=this,f=i.blockHelperMissing;return d+='<div class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-graphicGapMatchInteraction '+u((s=e&&e.attributes,s=null==s||s===!1?s:s["class"],typeof s===h?s.apply(e):s))+'" data-serial="',(l=i.serial)?s=l.call(e,{hash:{},data:a}):(l=e&&e.serial,s=typeof l===h?l.call(e,{hash:{},data:a}):l),d+=u(s)+'">\n    ',s=i["if"].call(e,e&&e.prompt,{hash:{},inverse:p.noop,fn:p.program(1,r,a),data:a}),(s||0===s)&&(d+=s),d+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',(l=i.serial)?s=l.call(e,{hash:{},data:a}):(l=e&&e.serial,s=typeof l===h?l.call(e,{hash:{},data:a}):l),d+=u(s)+'\' class="main-image-box"></div>\n        <div class="clear"></div>\n        <ul class="none block-listing solid horizontal source">\n            ',c={hash:{},inverse:p.noop,fn:p.program(3,o,a),data:a},(l=i.gapImgs)?s=l.call(e,c):(l=e&&e.gapImgs,s=typeof l===h?l.call(e,c):l),i.gapImgs||(s=f.call(e,s,{hash:{},inverse:p.noop,fn:p.program(3,o,a),data:a})),(s||0===s)&&(d+=s),d+="\n        </ul>\n    </div>\n</div>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicGapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e,i,n,a,r,o){var s=function(i){var n=o.getContainer(i),r=t("ul",n),s=t(".main-image-box",n),h=i.object.attributes,u=this.getOption("baseUrl")||"",p=t(".image-editor",n).outerWidth(!0)-s.innerWidth();i.gapFillers=[],i.paper=a.responsivePaper("graphic-paper-"+i.serial,{width:h.width,height:h.height,img:u+h.data,imgId:"bg-image-"+i.serial,container:n,diff:p,resize:function(t){var e=s.innerWidth()-p;h.width<e&&(e=h.width),r.width((e>t?t:e)+"px")}}),e.forEach(i.getChoices(),e.partial(l,i)),c(i,r),d(i)},l=function(t,e){a.createElement(t.paper,e.attr("shape"),e.attr("coords"),{id:e.serial,title:i("Select an image first"),hover:!1}).data("max",e.attr("matchMax")).data("matching",[]).click(function(){f(this)&&this.selectable===!0&&(h(t,this),o.triggerResponseChangeEvent(t))})},c=function(e,i){i.children("li").click(function(n){n.preventDefault();var a=t(this);a.hasClass("disabled")||(a.hasClass("active")?(a.removeClass("active"),p(e)):(i.children("li").removeClass("active"),a.addClass("active"),u(e)))})},d=function(e){var i=o.getContainer(e),n=t("ul > li",i),a=e.paper.getById("bg-image-"+e.serial);a&&a.click(function(){p(e),n.removeClass("active")})},h=function(i,n,r){var s,l,c,d,h,u,f;"undefined"==typeof r&&(r=!0);var m=o.getContainer(i),g=t("ul",m),v=g.find(".active:first");v.length&&(c=v.data("identifier"),u=n.data("matching")||[],u.push(c),n.data("matching",u),f=u.length,s=v.find("img"),d=n.getBBox(),h=parseInt(v.width(),10)*g.children().index(v),l=a.createBorderedImage(i.paper,{url:s.attr("src"),left:h,top:i.paper.height,width:s.width(),height:s.height(),padding:6}).data("identifier",c).toFront().move(d.x+3*f,d.y+3*f).unclick().click(function(t){t.preventDefault(),t.stopPropagation(),g.find(".active").length>0?a.trigger(n,"click"):(n.data("matching",e.without(n.data("matching")||[],this.data("identifier"))),i.gapFillers=e.without(i.gapFillers,l),l.remove(),o.triggerResponseChangeEvent(i))}),i.gapFillers.push(l),p(i),g.children().removeClass("active"))
},u=function(t){var n=i("Select the area to add an image");e.forEach(t.getChoices(),function(e){var i=t.paper.getById(e.serial);f(i)&&(i.selectable=!0,a.updateElementState(i,"selectable",n))}),e.forEach(t.gapFillers,function(t){t.forEach(function(t){a.updateTitle(t,n)})})},p=function(t){e.forEach(t.getChoices(),function(e){var n=t.paper.getById(e.serial);n&&(n.selectable=!1,a.updateElementState(n,"basic",i("Select an image first")))}),e.forEach(t.gapFillers,function(t){t.forEach(function(t){a.updateTitle(t,i("Remove"))})})},f=function(t){var e,i,n=!1;return t&&(i=t.data("max")||1,e=t.data("matching")||[],n=0===i||i>e.length),n},m=function(t){var i=[];return e.forEach(t.getChoices(),function(n){var a=t.paper.getById(n.serial);a&&e.isArray(a.data("matching"))&&e.forEach(a.data("matching"),function(t){i.push([n.id(),t])})}),i},g=function(i,n){var a,s=o.getContainer(i);if(n&&i.paper){try{a=r.unserialize(n,i)}catch(l){}e.isArray(a)&&e.forEach(i.getChoices(),function(n){var r=i.paper.getById(n.serial);r&&e.forEach(a,function(a){var o=e.indexOf(a,n.id());o>-1&&2===a.length&&(t("[data-identifier="+a[0===o?1:0]+"]",s).addClass("active"),h(i,r,!1))})})}},v=function(t){o.getContainer(t);p(t),e.forEach(t.gapFillers,function(t){a.trigger(t.items[0],"click")})},C=function(t){var e=(m(t),r.serialize(m(t),t));return e},I=function(e){var i;e.paper&&(i=o.getContainer(e),t(window).off("resize.qti-widget"),e.paper.clear(),o.removeInstructions(e),t(".main-image-box",i).empty().removeAttr("style"),t(".image-editor",i).removeAttr("style"),t("ul",i).empty())};return{qtiClass:"graphicGapMatchInteraction",template:n,render:s,getContainer:o.getContainer,setResponse:g,getResponse:C,resetResponse:v,destroy:I}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicOrderInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a;return(a=i.prompt)?n=a.call(t,{hash:{},data:e}):(a=t&&t.prompt,n=typeof a===c?a.call(t,{hash:{},data:e}):a),n||0===n?n:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l="",c="function",d=this.escapeExpression,h=this;return l+='<div class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-graphicOrderInteraction '+d((o=e&&e.attributes,o=null==o||o===!1?o:o["class"],typeof o===c?o.apply(e):o))+'" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.serial,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'">\n    ',o=i["if"].call(e,e&&e.prompt,{hash:{},inverse:h.noop,fn:h.program(1,r,a),data:a}),(o||0===o)&&(l+=o),l+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',(s=i.serial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.serial,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'\' class="main-image-box"></div>\n        <div class="clear"></div>\n        <ul class="none block-listing solid horizontal ordinals"></ul>\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicOrderInteraction",["jquery","lodash","i18n","raphael","scale.raphael","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicOrderInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e,i,n,a,r,o,s,l){var c=function(i){var n=l.getContainer(i),a=t("ul",n),r=i.object.attributes,s=this.getOption("baseUrl")||"";i.paper=o.responsivePaper("graphic-paper-"+i.serial,{width:r.width,height:r.height,img:s+r.data,imgId:"bg-image-"+i.serial,container:n,diff:t(".image-editor",n).outerWidth()-t(".main-image-box",n).outerWidth(),resize:function(t){var e=a.outerWidth(!0)-a.width(),i=(t<r.width?t:r.width)-(e>0?e:0)+8;a.width(i)}}),h(i,a),e.forEach(i.getChoices(),e.partial(d,i,a)),l.minMaxChoiceInstructions(i,{min:i.attr("minChoices"),max:i.attr("maxChoices"),getResponse:v,onError:function(t){o.highlightError(t.target)}})},d=function(t,e,n){o.createElement(t.paper,n.attr("shape"),n.attr("coords"),{id:n.serial,title:i("Select this area")}).click(function(){this.active?p(t.paper,this,e):u(t.paper,this,e),l.triggerResponseChangeEvent(t),l.validateInstructions(t,{choice:n})})},h=function(i,n){var a,r=e.size(i.getChoices()),o=i.attr("minChoices"),s=i.attr("maxChoices");s>0&&r>s?r=s:o>0&&r>o&&(r=o),e.times(r,function(e){var i=e+1,a=t('<li class="selectable" data-number="'+i+'">'+i+"</li>");0===e&&a.addClass("active"),n.append(a)}),f(i.paper,r,n),a=n.children("li"),a.click(function(e){e.preventDefault();var i=t(this);i.hasClass("active")||i.hasClass("disabled")||(a.removeClass("active"),i.addClass("active"))})},u=function(t,e,i){var n=i.find(".active:first");n.length&&n.data("number")>0&&(e.data("number",n.data("number")),e.active=!0,m(t,e),o.updateElementState(e,"active"),n.toggleClass("active disabled").siblings(":not(.disabled)").first().toggleClass("active"))},p=function(t,e,i){var n=e.data("number");e.active=!1,g(t,e),e.removeData("number"),o.updateElementState(e,"basic"),i.children().removeClass("active").filter("[data-number="+n+"]").removeClass("disabled").addClass("active")},f=function(t,n){var a=[];return e.times(n,function(n){var r=n+1,s=t.text(0,0,r);s.hide(),s.id="text-"+r,o.updateElementState(s,"order-text",i("Remove")),s.click(function(){t.forEach(function(t){if(t.data("number")===r&&t.events){var i=e.where(t.events,{name:"click"});i.length&&i[0]&&"function"==typeof i[0].f&&i[0].f.call(t)}})}),a.push(s)}),a},m=function(t,e){var i,n=e.getBBox(),a=t.getById("text-"+e.data("number"));a&&(i="T"+(n.x+n.width/2)+","+(n.y+n.height/2),a.transform(i).show().toFront())},g=function(t,e){var i=t.getById("text-"+e.data("number"));i&&i.hide()},v=function(t){var i=[];return e.forEach(t.getChoices(),function(e){var n=t.paper.getById(e.serial);n&&n.data("number")&&i.push({index:n.data("number"),id:e.id()})}),e(i).sortBy("index").map("id").value()},C=function(i,n){var a,r=l.getContainer(i),o=t("ul",r);if(n&&i.paper){try{a=s.unserialize(n,i)}catch(c){}e.isArray(a)&&e.forEach(a,function(t,n){var a,r=n+1,s=e(i.getChoices()).where({attributes:{identifier:t}}).first();s&&(a=i.paper.getById(s.serial),a&&(o.children("[data-number="+r+"]").addClass("active"),u(i.paper,a,o)))})}},I=function(i){var n=l.getContainer(i),a=t("ul",n);e.forEach(i.getChoices(),function(t){var e=i.paper.getById(t.serial);e&&p(i.paper,e,a)}),a.children("li").removeClass("active disabled").first().addClass("active")},b=function(t){return s.serialize(v(t),t)},E=function(e){var i;e.paper&&(i=l.getContainer(e),t(window).off("resize.qti-widget"),e.paper.clear(),l.removeInstructions(e),t(".main-image-box",i).empty().removeAttr("style"),t(".image-editor",i).removeAttr("style"),t("ul",i).empty())};return{qtiClass:"graphicOrderInteraction",template:r,render:c,getContainer:l.getContainer,setResponse:C,getResponse:b,resetResponse:I,destroy:E}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hotspotInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a;return(a=i.prompt)?n=a.call(t,{hash:{},data:e}):(a=t&&t.prompt,n=typeof a===c?a.call(t,{hash:{},data:e}):a),n||0===n?n:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l="",c="function",d=this.escapeExpression,h=this;return l+='<div class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-hotspotInteraction '+d((o=e&&e.attributes,o=null==o||o===!1?o:o["class"],typeof o===c?o.apply(e):o))+'" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.serial,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'">\n    ',o=i["if"].call(e,e&&e.prompt,{hash:{},inverse:h.noop,fn:h.program(1,r,a),data:a}),(o||0===o)&&(l+=o),l+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',(s=i.serial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.serial,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'\' class="main-image-box"></div>\n    </div>\n    <div class="clear"></div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction",["jquery","lodash","i18n","raphael","scale.raphael","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hotspotInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e,i,n,a,r,o,s,l){var c=function(n){var a=l.getContainer(n),r=n.object.attributes,s=this.getOption("baseUrl")||"",c=s+r.data;/^\//.test(c)&&(c=c.replace(/^\//,"")),n.paper=o.responsivePaper("graphic-paper-"+n.serial,{width:r.width,height:r.height,img:c,diff:t(".image-editor",a).outerWidth()-t(".main-image-box",a).outerWidth(),container:a}),e.forEach(n.getChoices(),e.partial(d,n)),l.minMaxChoiceInstructions(n,{min:n.attr("minChoices"),max:n.attr("maxChoices"),getResponse:h,onError:function(t){t.target.active&&(t.target.active=!1,o.updateElementState(this,"basic",i("Select this area")),o.highlightError(t.target),l.triggerResponseChangeEvent(n),a.trigger("inactiveChoice.qti-widget",[t.choice,t.target]))}})},d=function(t,e){{var n=l.getContainer(t);o.createElement(t.paper,e.attr("shape"),e.attr("coords"),{id:e.serial,title:i("Select this area")}).click(function(){this.active?(o.updateElementState(this,"basic",i("Select this area")),this.active=!1,n.trigger("inactiveChoice.qti-widget",[e,this])):(o.updateElementState(this,"active",i("Click again to remove")),this.active=!0,n.trigger("activeChoice.qti-widget",[e,this])),l.triggerResponseChangeEvent(t),l.validateInstructions(t,{choice:e,target:this})})}},h=function(t){return e(t.getChoices()).map(function(e){var i=t.paper.getById(e.serial);return i&&i.active===!0?e.id():!1}).filter(e.isString).value()},u=function(t,n){var a;if(n&&t.paper){try{a=s.unserialize(n,t)}catch(r){}e.isArray(a)&&e.forEach(t.getChoices(),function(n){var r;e.contains(a,n.attributes.identifier)&&(r=t.paper.getById(n.serial),r&&(r.active=!0,o.updateElementState(r,"active",i("Click again to remove")),l.validateInstructions(t,{choice:n,target:r})))})}},p=function(t){e.forEach(t.getChoices(),function(e){var i=t.paper.getById(e.serial);i&&(i.active=!1,o.updateElementState(i,"basic"))}),l.resetInstructions(t)},f=function(t){var e=(h(t),s.serialize(h(t),t));return e},m=function(e){var i;e.paper&&(i=l.getContainer(e),t(window).off("resize.qti-widget"),e.paper.clear(),l.removeInstructions(e),t(".main-image-box",i).empty().removeAttr("style"),t(".image-editor",i).removeAttr("style"))};return{qtiClass:"hotspotInteraction",template:r,render:c,getContainer:l.getContainer,setResponse:u,getResponse:f,resetResponse:p,destroy:m}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hottextInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a;return(a=i.prompt)?n=a.call(t,{hash:{},data:e}):(a=t&&t.prompt,n=typeof a===c?a.call(t,{hash:{},data:e}):a),n||0===n?n:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l="",c="function",d=this.escapeExpression,h=this;return l+='<div id="'+d((o=e&&e.attributes,o=null==o||o===!1?o:o.identifier,typeof o===c?o.apply(e):o))+'" class="qti-interaction qti-blockInteraction qti-hottextInteraction" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.serial,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'" data-qti-class="hottextInteraction">\n  ',o=i["if"].call(e,e&&e.prompt,{hash:{},inverse:h.noop,fn:h.program(1,r,a),data:a}),(o||0===o)&&(l+=o),l+='\n  <div class="instruction-container"></div>\n  <div class="qti_flow_container">',(s=i.body)?o=s.call(e,{hash:{},data:a}):(s=e&&e.body,o=typeof s===c?s.call(e,{hash:{},data:a}):s),(o||0===o)&&(l+=o),l+="</div>\n</div>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/HottextInteraction",["lodash","jquery","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hottextInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","i18n"],function(t,e,i,n,a,r){var o=function(t){var i=function(e){var i=e.find("input");i.prop("checked")?i.prop("checked",!1):i.prop("checked",!0),n.validateInstructions(t,{choice:e})};n.getContainer(t).find(".hottext").on("click",function(t){i(e(this)),t.preventDefault()}),n.getContainer(t).find("input").on("click",function(i){n.validateInstructions(t,{choice:e(this).parents(".hottext")}),i.stopPopagation()})},s=function(t){o(t),l(t)},l=function(t){var e=t.attr("minChoices"),i=t.attr("maxChoices"),a=t.getBody(),o=0,s=!1;for(var l in a.getElements())o++;if(i>1&&o>i){var c=function(t){var e=t.find("input"),i=t.css("color","#BA122B"),n=t.find(">label>span").css("color","#BA122B").addClass("cross error");setTimeout(function(){e.prop("checked",!1),i.removeAttr("style"),n.removeAttr("style").removeClass("cross")},150)};if(i===e){s=!0;var d=r("You must select exactly")+" "+i+" "+r("choices");n.appendInstruction(t,d,function(e){h(t).length>=i?(this.setLevel("success"),this.checkState("fulfilled")&&this.update({level:"warning",message:r("Maximum choices reached"),timeout:2e3,start:function(){c(e.choice)},stop:function(){this.update({level:"success",message:d})}}),this.setState("fulfilled")):this.reset()})}else i>e&&n.appendInstruction(t,r("You can select maximum")+" "+i+" "+r("choices"),function(e){h(t).length>=i?(this.setMessage(r("Maximum choices reached")),this.checkState("fulfilled")&&this.update({level:"warning",timeout:2e3,start:function(){c(e.choice)},stop:function(){this.setLevel("info")}}),this.setState("fulfilled")):this.reset()})}!s&&e>0&&o>e&&n.appendInstruction(t,r("You must select at least")+" "+e+" "+r("choices"),function(){h(t).length>=e?this.setLevel("success"):this.reset()})},c=function(t){n.getContainer(t).find("input").prop("checked",!1)},d=function(e,i){var r=n.getContainer(e);try{t.each(a.unserialize(i,e),function(t){r.find("input[value="+t+"]").prop("checked",!0)}),n.validateInstructions(e)}catch(o){throw new Error("wrong response format in argument : "+o)}},h=function(t){var i=[];return n.getContainer(t).find("input:checked").each(function(){i.push(e(this).val())}),i},u=function(t){return a.serialize(h(t),t)};return{qtiClass:"hottextInteraction",template:i,render:s,getContainer:n.getContainer,setResponse:d,getResponse:u,resetResponse:c}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/inlineChoiceInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t){var e;return e=typeof t===d?t.apply(t):t,e||0===e?e:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l,c="",d="function",h=this.escapeExpression,u=this,p=i.blockHelperMissing;return c+='<select class="qti-interaction qti-inlineInteraction qti-inlineChoiceInteraction" \n        data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.serial,o=typeof s===d?s.call(e,{hash:{},data:a}):s),c+=h(o)+'" \n        data-qti-class="inlineChoiceInteraction" \n        data-has-search="false">\n    <option></option>\n    <option value="empty"></option>\n    ',l={hash:{},inverse:u.noop,fn:u.program(1,r,a),data:a},(s=i.choices)?o=s.call(e,l):(s=e&&e.choices,o=typeof s===d?s.call(e,l):s),i.choices||(o=p.call(e,o,{hash:{},inverse:u.noop,fn:u.program(1,r,a),data:a})),(o||0===o)&&(c+=o),c+="\n</select>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/InlineChoiceInteraction",["lodash","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/inlineChoiceInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","i18n","select2","tooltipster"],function(t,e,i,n,a){var r="empty",o={allowEmpty:!0,placeholderText:a("select a choice")},s=function(e,n){var s=t.clone(o),c=!!e.attr("required");t.extend(s,n);var d=i.getContainer(e);s.allowEmpty?d.find("option[value="+r+"]").text("--- "+a("leave empty")+" ---"):d.find("option[value="+r+"]").remove(),d.select2({width:"resolve",placeholder:s.placeholderText,minimumResultsForSearch:-1});var h=d.select2("container");l(e),d.on("change",function(){c&&""!==d.val()&&h.tooltipster("hide"),i.triggerResponseChangeEvent(e)})},l=function(t){var e=!!t.attr("required"),i=t.getContainer(),n=i.select2("container");e&&(n.tooltipster({theme:"tao-error-tooltip",content:a("A choice must be selected"),delay:350,trigger:"custom"}),""===i.val()&&n.tooltipster("show"))},c=function(t){d(t,r)},d=function(t,e){i.getContainer(t).val(e).select2("val",e)},h=function(t,e){d(t,n.unserialize(e,t)[0])},u=function(t){var e=i.getContainer(t).val();return e&&e!==r?[e]:[]},p=function(t){return n.serialize(u(t),t)};return{qtiClass:"inlineChoiceInteraction",template:e,render:s,getContainer:i.getContainer,setResponse:h,getResponse:p,resetResponse:c}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/matchInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a;return(a=i.prompt)?n=a.call(t,{hash:{},data:e}):(a=t&&t.prompt,n=typeof a===p?a.call(t,{hash:{},data:e}):a),n||0===n?n:""}function o(t){var e;return e=typeof t===p?t.apply(t):t,e||0===e?e:""}function s(t,e,n){var a,r="";return r+="\n      <tr>\n        ",a=typeof t===p?t.apply(t):t,(a||0===a)&&(r+=a),r+="\n        ",a=i.each.call(t,n&&n.matchSet1,{hash:{},inverse:f.noop,fn:f.program(6,l,e),data:e}),(a||0===a)&&(r+=a),r+="\n      </tr>\n      "}function l(){return'\n        <td>\n          <label>\n            <input type="checkbox" >\n            <span class="icon-checkbox cross"></span>\n          </label>\n        </td>\n        '}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var c,d,h,u="",p="function",f=this,m=this.escapeExpression,g=i.blockHelperMissing;return u+='<div class="qti-interaction qti-blockInteraction qti-matchInteraction" data-serial="',(d=i.serial)?c=d.call(e,{hash:{},data:a}):(d=e&&e.serial,c=typeof d===p?d.call(e,{hash:{},data:a}):d),u+=m(c)+'" data-qti-class="matchInteraction">\n  ',c=i["if"].call(e,e&&e.prompt,{hash:{},inverse:f.noop,fn:f.program(1,r,a),data:a}),(c||0===c)&&(u+=c),u+='\n  <div class="instruction-container"></div>\n  <div class="match-interaction-area">\n    <table class="matrix">\n      <thead>\n      <tr>\n        <th> </th>\n        ',h={hash:{},inverse:f.noop,fn:f.program(3,o,a),data:a},(d=i.matchSet1)?c=d.call(e,h):(d=e&&e.matchSet1,c=typeof d===p?d.call(e,h):d),i.matchSet1||(c=g.call(e,c,{hash:{},inverse:f.noop,fn:f.program(3,o,a),data:a})),(c||0===c)&&(u+=c),u+="\n      </tr>\n      </thead>\n      <tbody>\n      ",h={hash:{},inverse:f.noop,fn:f.programWithDepth(5,s,a,e),data:a},(d=i.matchSet2)?c=d.call(e,h):(d=e&&e.matchSet2,c=typeof d===p?d.call(e,h):d),i.matchSet2||(c=g.call(e,c,{hash:{},inverse:f.noop,fn:f.programWithDepth(5,s,a,e),data:a})),(c||0===c)&&(u+=c),u+='\n      </tbody>\n    </table>\n  </div>\n  <div class="notification-container"></div>\n</div>'})}),function(t,e){function i(t,e,i){var n=h[e.type]||{};return null==t?i||!e.def?null:e.def:(t=n.floor?~~t:parseFloat(t),isNaN(t)?e.def:n.mod?(t+n.mod)%n.mod:0>t?0:n.max<t?n.max:t)}function n(e){var i=c(),n=i._rgba=[];return e=e.toLowerCase(),f(l,function(t,a){var r,o=a.re.exec(e),s=o&&a.parse(o),l=a.space||"rgba";return s?(r=i[l](s),i[d[l].cache]=r[d[l].cache],n=i._rgba=r._rgba,!1):void 0}),n.length?("0,0,0,0"===n.join()&&t.extend(n,r.transparent),i):r[e]}function a(t,e,i){return i=(i+1)%1,1>6*i?t+(e-t)*i*6:1>2*i?e:2>3*i?t+(e-t)*(2/3-i)*6:t}var r,o="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",s=/^([\-+])=\s*(\d+\.?\d*)/,l=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],c=t.Color=function(e,i,n,a){return new t.Color.fn.parse(e,i,n,a)},d={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},h={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},u=c.support={},p=t("<p>")[0],f=t.each;p.style.cssText="background-color:rgba(1,1,1,.5)",u.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(d,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),c.fn=t.extend(c.prototype,{parse:function(a,o,s,l){if(a===e)return this._rgba=[null,null,null,null],this;(a.jquery||a.nodeType)&&(a=t(a).css(o),o=e);var h=this,u=t.type(a),p=this._rgba=[];return o!==e&&(a=[a,o,s,l],u="array"),"string"===u?this.parse(n(a)||r._default):"array"===u?(f(d.rgba.props,function(t,e){p[e.idx]=i(a[e.idx],e)}),this):"object"===u?(a instanceof c?f(d,function(t,e){a[e.cache]&&(h[e.cache]=a[e.cache].slice())}):f(d,function(e,n){var r=n.cache;f(n.props,function(t,e){if(!h[r]&&n.to){if("alpha"===t||null==a[t])return;h[r]=n.to(h._rgba)}h[r][e.idx]=i(a[t],e,!0)}),h[r]&&t.inArray(null,h[r].slice(0,3))<0&&(h[r][3]=1,n.from&&(h._rgba=n.from(h[r])))}),this):void 0},is:function(t){var e=c(t),i=!0,n=this;return f(d,function(t,a){var r,o=e[a.cache];return o&&(r=n[a.cache]||a.to&&a.to(n._rgba)||[],f(a.props,function(t,e){return null!=o[e.idx]?i=o[e.idx]===r[e.idx]:void 0})),i}),i},_space:function(){var t=[],e=this;return f(d,function(i,n){e[n.cache]&&t.push(i)}),t.pop()},transition:function(t,e){var n=c(t),a=n._space(),r=d[a],o=0===this.alpha()?c("transparent"):this,s=o[r.cache]||r.to(o._rgba),l=s.slice();return n=n[r.cache],f(r.props,function(t,a){var r=a.idx,o=s[r],c=n[r],d=h[a.type]||{};null!==c&&(null===o?l[r]=c:(d.mod&&(c-o>d.mod/2?o+=d.mod:o-c>d.mod/2&&(o-=d.mod)),l[r]=i((c-o)*e+o,a)))}),this[a](l)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),n=i.pop(),a=c(e)._rgba;return c(t.map(i,function(t,e){return(1-n)*a[e]+n*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),n=i.pop();return e&&i.push(~~(255*n)),"#"+t.map(i,function(t){return t=(t||0).toString(16),1===t.length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),c.fn.parse.prototype=c.fn,d.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,i,n=t[0]/255,a=t[1]/255,r=t[2]/255,o=t[3],s=Math.max(n,a,r),l=Math.min(n,a,r),c=s-l,d=s+l,h=.5*d;return e=l===s?0:n===s?60*(a-r)/c+360:a===s?60*(r-n)/c+120:60*(n-a)/c+240,i=0===c?0:.5>=h?c/d:c/(2-d),[Math.round(e)%360,i,h,null==o?1:o]},d.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],n=t[2],r=t[3],o=.5>=n?n*(1+i):n+i-n*i,s=2*n-o;return[Math.round(255*a(s,o,e+1/3)),Math.round(255*a(s,o,e)),Math.round(255*a(s,o,e-1/3)),r]},f(d,function(n,a){var r=a.props,o=a.cache,l=a.to,d=a.from;c.fn[n]=function(n){if(l&&!this[o]&&(this[o]=l(this._rgba)),n===e)return this[o].slice();var a,s=t.type(n),h="array"===s||"object"===s?n:arguments,u=this[o].slice();return f(r,function(t,e){var n=h["object"===s?t:e.idx];null==n&&(n=u[e.idx]),u[e.idx]=i(n,e)}),d?(a=c(d(u)),a[o]=u,a):c(u)},f(r,function(e,i){c.fn[e]||(c.fn[e]=function(a){var r,o=t.type(a),l="alpha"===e?this._hsla?"hsla":"rgba":n,c=this[l](),d=c[i.idx];return"undefined"===o?d:("function"===o&&(a=a.call(this,d),o=t.type(a)),null==a&&i.empty?this:("string"===o&&(r=s.exec(a),r&&(a=d+parseFloat(r[2])*("+"===r[1]?1:-1))),c[i.idx]=a,this[l](c)))})})}),c.hook=function(e){var i=e.split(" ");f(i,function(e,i){t.cssHooks[i]={set:function(e,a){var r,o,s="";if("transparent"!==a&&("string"!==t.type(a)||(r=n(a)))){if(a=c(r||a),!u.rgba&&1!==a._rgba[3]){for(o="backgroundColor"===i?e.parentNode:e;(""===s||"transparent"===s)&&o&&o.style;)try{s=t.css(o,"backgroundColor"),o=o.parentNode}catch(l){}a=a.blend(s&&"transparent"!==s?s:"_default")}a=a.toRgbaString()}try{e.style[i]=a}catch(l){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=c(e.elem,i),e.end=c(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})},c.hook(o),t.cssHooks.borderColor={expand:function(t){var e={};return f(["Top","Right","Bottom","Left"],function(i,n){e["border"+n+"Color"]=t}),e}},r=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),define("lib/jquery.color",function(){}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/MatchInteraction",["lodash","jquery","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/matchInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","i18n","lib/jquery.color"],function(t,e,i,n,a,r){var o=!1,s=function(t){var e=n.getContainer(t);b(t),e.on("click.commonRenderer","input[type=checkbox]",function(e){f(t,e)}),n.validateInstructions(t)},l=function(i,a){a=h(a),"undefined"!=typeof a.list&&"undefined"!=typeof a.list.directedPair&&t(a.list.directedPair).forEach(function(t){var i=e("th[data-identifier="+t[0]+"]").index()-1,n=e("th[data-identifier="+t[1]+"]").parent().index();e(".matrix > tbody tr").eq(n).find("input[type=checkbox]").eq(i).attr("checked",!0)}),n.validateInstructions(i)},c=function(t){var e=a.serialize(u(t),t);return e},d=function(t){n.getContainer(t).find("input[type=checkbox]:checked").each(function(){e(this).prop("checked",!1)}),n.validateInstructions(t)},h=function(t){if("undefined"==typeof t.list){if("undefined"==typeof t.base)throw"The given response is not compliant with PCI JSON representation.";if(null==t.base)return{list:{directedPair:[]}};if("undefined"==typeof t.base.directedPair)throw"The matchInteraction only accepts directedPair values as responses.";return{list:{directedPair:[t.base.directedPair]}}}if("undefined"==typeof t.list.directedPair)throw"The matchInteraction only accept directedPair values as responses.";return t},u=function(t){var e=n.getContainer(t),i=[];return e.find("input[type=checkbox]:checked").each(function(){i.push(p(this))}),i},p=function(t){var i=e(t),n=i.closest("tr").index(),a=i.closest("td").index(),r=e(".matrix > thead th").eq(a).data("identifier"),o=e(".matrix > tbody th").eq(n).data("identifier");return[r,o]},f=function(e,i){var a=u(e),r=(e.attr("minAssociations"),e.attr("maxAssociations"));0===r&&(r=v(e)),t.size(a)>r?(i.preventDefault(),n.validateInstructions(e)):(choice=m(e,i.target))!==!1?(i.preventDefault(),n.validateInstructions(e,choice)):(n.triggerResponseChangeEvent(e,{}),n.validateInstructions(e))},m=function(e,i){var n=p(i),a=!1;return t(n).forEach(function(t){var i=C(e,t),n=(i.attributes.matchMin,i.attributes.matchMax),r=g(e,i);n>0&&r>n&&(a=i)}),a},g=function(e,i){var n=u(e),a=0;return t(n).forEach(function(t){(t[0]==i.attributes.identifier||t[1]==i.attributes.identifier)&&a++}),a},v=function(t){var e=n.getContainer(t);return e.find("input[type=checkbox]").length},C=function(t,e){var i=I(t);return i[e]},I=function(e){var i={};return t(e.choices).forEach(function(e){t(e).forEach(function(t){i[t.attributes.identifier]=t})}),i},b=function(e){var i=e.attr("minAssociations"),a=e.attr("maxAssociations"),s=v(e),l=function(){var l=function(t,e){o===!1&&(o=!0,t.update({level:"warning",message:r("Maximum number of choices reached."),timeout:2e3,stop:function(){t.update({level:"success",message:e}),o=!1}}))},c=function(t,e,i,a,s){var l=n.getContainer(t);if(o===!1){o=!0;var c=l.find('.qti-simpleAssociableChoice[data-identifier="'+e.attributes.identifier+'"]'),d=c.css("background-color"),h=c.css("color");i.update({level:"warning",message:r("The highlighted choice cannot be associated more than %d time(s).").replace("%d",e.attributes.matchMax),timeout:3e3,start:function(){c.animate({backgroundColor:"#fff",color:"#ba122b"},250,function(){c.animate({backgroundColor:"#ba122b",color:"#fff"},250)})},stop:function(){c.animate({backgroundColor:d,color:h},500),i.update({level:s,message:a}),o=!1}})}};if(0==i&&a>0){var d=r("You must select 0 to %d choices.").replace("%d",a);n.appendInstruction(e,d,function(i){var n=t.size(u(e)),r="undefined"!=typeof i;1==r&&i.attributes.matchMax>0&&g(e,i)>i.attributes.matchMax?c(e,i,this,d,this.getLevel()):a>=n?this.setLevel("success"):n>a?l(this,d):this.reset()})}else if(0==i&&0==a){var d=r("You must select 0 to %d choices.").replace("%d",s);n.appendInstruction(e,d,function(t){var i="undefined"!=typeof t;1==i&&t.attributes.matchMax>0&&g(e,t)>t.attributes.matchMax?c(e,t,this,d,this.getLevel()):this.setLevel("success")})}else if(i>0&&0==a){var d=r("You must select %1$d to %2$d choices.");d=d.replace("%1$d",i),d=d.replace("%2$d",s),n.appendInstruction(e,d,function(n){var a=t.size(u(e)),r="undefined"!=typeof n;1==r&&n.attributes.matchMax>0&&g(e,n)>n.attributes.matchMax?c(e,n,this,d,this.getLevel()):i>a?this.setLevel("info"):a>s?l(this,d):this.setLevel("success")})}else if(i>0&&a>0){if(i!=a){var d=r("You must select %1$d to %2$d choices.");d=d.replace("%1$d",i),d=d.replace("%2$d",a)}else{var d=r("You must select exactly %d choice(s).");d=d.replace("%d",i)}n.appendInstruction(e,d,function(n){var r=t.size(u(e)),o="undefined"!=typeof n;1==o&&n.attributes.matchMax>0&&g(e,n)>n.attributes.matchMax?c(e,n,this,d,this.getLevel()):i>r?this.setLevel("info"):r>a?l(this,d):r>=i&&a>=r&&this.setLevel("success")})}};l()},E=function(t){n.getContainer(t).off(".commonRenderer"),d(t),n.removeInstructions(t)};return{qtiClass:"matchInteraction",template:i,render:s,getContainer:n.getContainer,setResponse:l,getResponse:c,resetResponse:d,destroy:E,inferValue:p}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/mediaInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a;return(a=i.prompt)?n=a.call(t,{hash:{},data:e}):(a=t&&t.prompt,n=typeof a===c?a.call(t,{hash:{},data:e}):a),n||0===n?n:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l="",c="function",d=this.escapeExpression,h=this;return l+='<div class="qti-interaction qti-blockInteraction qti-mediarInteraction" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.serial,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'">\n    ',o=i["if"].call(e,e&&e.prompt,{hash:{},inverse:h.noop,fn:h.program(1,r,a),data:a}),(o||0===o)&&(l+=o),l+='\n    <div class="instruction-container"></div>\n   \n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/MediaInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/mediaInteraction","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/Helper","mediaElement"],function(t,e,i,n,a,r,o){var s=function(t){var e="",i=t.type;return""!==i&&(-1!==i.indexOf("youtube")?e="video/youtube":0===i.indexOf("video")?e="video":0===i.indexOf("audio")&&(e="audio")),e},l=function(i,n){var a=r.getContainer(i);if(n){var l={data:"",type:"video/mp4",width:480,height:270};e.defaults(i.object.attributes,l)}var c=i.object.attributes,d=c.type,h=i.renderer.getOption("baseUrl"),u=s(c),p=!1,f=!1,m={defaultVideoWidth:480,defaultVideoHeight:270,videoWidth:c.width,videoHeight:c.height,audioWidth:c.width?c.width:400,audioHeight:30,features:"audio"===u?["playpause","current","duration","volume"]:["current","duration","volume"],startVolume:1,loop:i.attributes.loop?i.attributes.loop:!1,enableAutosize:!0,alwaysShowControls:!0,iPadUseNativeControls:!1,iPhoneUseNativeControls:!1,AndroidUseNativeControls:!1,alwaysShowHours:!1,enableKeyboard:!1,pauseOtherPlayers:!1,success:function(e,n){var o=t(n).closest("div.mejs-container").find(".mejs-playpause-button");
t(o).on("click",function(t){return f=!0,t.preventDefault(),t.stopPropagation(),!1});var s=null,l=null;void 0===a.data("timesPlayed")&&a.data("timesPlayed",0),i.attributes.autostart&&(0===i.attributes.maxPlays||a.data("timesPlayed")<i.attributes.maxPlays)&&e.addEventListener("canplay",function(){e.play()},!1),e.addEventListener("ended",function(){if(a.data("timesPlayed",a.data("timesPlayed")+1),r.triggerResponseChangeEvent(i),0===i.attr("maxPlays")||a.data("timesPlayed")<i.attr("maxPlays"))if("audio"==u);else if("video"===u&&"flash"!==e.pluginType){var o=t(n).closest("div.mejs-container").find(".mejs-layers");o.append(s)}else("video/youtube"===u||"flash"===e.pluginType)&&l.remove()},!1),e.addEventListener("play",function(){if(p===!0)p=!1;else if(0!==i.attributes.maxPlays&&a.data("timesPlayed")>=i.attributes.maxPlays)e.pause(),e.setSrc(""),"video/youtube"===u&&t(n).empty();else if("audio"===u);else if("video"===u&&"flash"!==e.pluginType)s=t(n).closest("div.mejs-container").find(".mejs-overlay-play").detach();else if("video/youtube"===u||"flash"===e.pluginType){var r=t(n).closest("div.mejs-container").find("div.mejs-controls").outerHeight();t(n).closest("div.mejs-container").find(".mejs-layers").append('<div class="flashOverlayDiv" style="background:#000; width: '+m.videoWidth+"px; height: "+(m.videoHeight-r)+'px; z-iindex: 99; position:relative;"></div>'),l=t(n).closest("div.mejs-container").find(".mejs-layers").find(".flashOverlayDiv"),l.css({opacity:0})}},!1),e.addEventListener("pause",function(){f&&(p=!0,f=!1,e.play())})},error:function(e){t(e).closest("div.mejs-container").find(".me-cannotplay").remove()}},g=a.children(".instruction-container").first();void 0===m.videoWidth&&(m.videoWidth=m.defaultVideoWidth),void 0===m.videoHeight&&(m.videoHeight=m.defaultVideoHeight);var v=c.data;if("video"===u||"audio"===u){v=c.data.trim();var C=v.toLowerCase();0!==C.indexOf("http://www.")&&0!==C.indexOf("http://")&&0!==C.indexOf("www.")&&(v=h+v)}var I;"video"===u?I=t('<video src="'+v+'" width="'+m.videoWidth+'px" height="'+m.videoHeight+'px" type="'+d+'"></video>').appendTo(g):"video/youtube"===u?I=t('<video width="'+m.videoWidth+'px" height="'+m.videoHeight+'px" preload="none">  <source type="video/youtube" src="'+v+'" /> </video>').appendTo(g):"audio"===u&&(I=t('<audio src="'+v+'" width="'+m.audioWidth+'px"  type="'+d+'"></audio>').appendTo(g)),I.on("contextmenu",function(t){t.preventDefault()}).on("click",function(t){return f=!0,t.preventDefault(),t.stopPropagation(),!1}),n?new o(I,m):a.on("responseSet",function(){new o(I,m)})},c=function(t){var e=r.getContainer(t);e.children(".instruction-container").empty(),r.getContainer(t).removeData("timesPlayed",0)},d=function(t){return[r.getContainer(t).data("timesPlayed")]},h=function(t,e){if(e)try{var i;i=a.unserialize(e,t),r.getContainer(t).data("timesPlayed",i[0])}catch(n){}},u=function(t){r.getContainer(t).data("timesPlayed",0)},p=function(t){return a.serialize(d(t),t)};return{qtiClass:"mediaInteraction",template:n,render:l,getContainer:r.getContainer,setResponse:h,getResponse:p,resetResponse:u,destroy:c}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/orderInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(){return"qti-horizontal"}function o(){return"qti-vertical"}function s(){return"horizontal"}function l(){return"vertical"}function c(t,e){var n,a;return(a=i.prompt)?n=a.call(t,{hash:{},data:e}):(a=t&&t.prompt,n=typeof a===I?a.call(t,{hash:{},data:e}):a),n||0===n?n:""}function d(t){var e;return e=typeof t===I?t.apply(t):t,e||0===e?e:""}function h(){return"icon-down"}function u(){return"icon-right"}function p(){return"icon-up"}function f(){return"icon-left"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var m,g,v,C="",I="function",b=this,E=this.escapeExpression,y=i.blockHelperMissing;return C+='<div class="qti-interaction qti-blockInteraction qti-orderInteraction ',m=i["if"].call(e,e&&e.horizontal,{hash:{},inverse:b.program(3,o,a),fn:b.program(1,r,a),data:a}),(m||0===m)&&(C+=m),C+='" \n     data-serial="',(g=i.serial)?m=g.call(e,{hash:{},data:a}):(g=e&&e.serial,m=typeof g===I?g.call(e,{hash:{},data:a}):g),C+=E(m)+'" \n     data-qti-class="orderInteraction" \n     data-orientation="',m=i["if"].call(e,e&&e.horizontal,{hash:{},inverse:b.program(7,l,a),fn:b.program(5,s,a),data:a}),(m||0===m)&&(C+=m),C+='">\n    ',m=i["if"].call(e,e&&e.prompt,{hash:{},inverse:b.noop,fn:b.program(9,c,a),data:a}),(m||0===m)&&(C+=m),C+='\n    <div class="instruction-container"></div>\n    <div class="order-interaction-area">\n        <ul class="choice-area square source solid block-listing ',m=i["if"].call(e,e&&e.horizontal,{hash:{},inverse:b.noop,fn:b.program(5,s,a),data:a}),(m||0===m)&&(C+=m),C+='">\n            ',v={hash:{},inverse:b.noop,fn:b.program(11,d,a),data:a},(g=i.choices)?m=g.call(e,v):(g=e&&e.choices,m=typeof g===I?g.call(e,v):g),i.choices||(m=y.call(e,m,{hash:{},inverse:b.noop,fn:b.program(11,d,a),data:a})),(m||0===m)&&(C+=m),C+='\n        </ul>\n        <div class="arrow-bar middle">\n            <span class="icon-add-to-selection ',m=i["if"].call(e,e&&e.horizontal,{hash:{},inverse:b.program(15,u,a),fn:b.program(13,h,a),data:a}),(m||0===m)&&(C+=m),C+='"></span>\n            <span class="icon-remove-from-selection ',m=i["if"].call(e,e&&e.horizontal,{hash:{},inverse:b.program(19,f,a),fn:b.program(17,p,a),data:a}),(m||0===m)&&(C+=m),C+=' inactive"></span>\n        </div>\n        <ul class="result-area decimal target solid block-listing ',m=i["if"].call(e,e&&e.horizontal,{hash:{},inverse:b.noop,fn:b.program(5,s,a),data:a}),(m||0===m)&&(C+=m),C+='">\n        </ul>\n        <div class="arrow-bar">\n            <span class="icon-move-before ',m=i["if"].call(e,e&&e.horizontal,{hash:{},inverse:b.program(17,p,a),fn:b.program(19,f,a),data:a}),(m||0===m)&&(C+=m),C+=' inactive"></span>\n            <span class="icon-move-after ',m=i["if"].call(e,e&&e.horizontal,{hash:{},inverse:b.program(13,h,a),fn:b.program(15,u,a),data:a}),(m||0===m)&&(C+=m),C+=' inactive"></span>\n        </div>\n    </div>\n    <div class="notification-container"></div>\n</div>'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/OrderInteraction",["lodash","jquery","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/orderInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","i18n","jqueryui"],function(t,e,i,n,a,r){var o=function(t){var i=n.getContainer(t),a=i.find(".choice-area"),r=i.find(".result-area"),o=i.find(".icon-add-to-selection"),c=i.find(".icon-remove-from-selection"),d=i.find(".icon-move-before"),h=i.find(".icon-move-after"),u=null,p=function(){o.addClass("inactive"),c.removeClass("inactive").addClass("active"),d.removeClass("inactive").addClass("active"),h.removeClass("inactive").addClass("active")},f=function(){o.removeClass("inactive"),c.removeClass("active").addClass("inactive"),d.removeClass("active").addClass("inactive"),h.removeClass("active").addClass("inactive")},m=function(t){u&&u.removeClass("active"),u=t,u.addClass("active"),p()},g=function(){u&&(u.removeClass("active"),u=null),f()};i.on("mousedown.commonRenderer",function(){g()}),a.on("mousedown.commonRenderer",">li:not(.deactivated)",function(i){i.stopPropagation(),g(),o.addClass("triggered"),setTimeout(function(){o.removeClass("triggered")},150),r.append(e(this)),n.triggerResponseChangeEvent(t),n.validateInstructions(t)}),r.on("mousedown.commonRenderer",">li",function(t){t.stopPropagation();var i=e(this);i.hasClass("active")?g():m(e(this))}),c.on("mousedown.commonRenderer",function(e){e.stopPropagation(),u&&(a.append(u),n.triggerResponseChangeEvent(t),n.validateInstructions(t)),g()}),d.on("mousedown.commonRenderer",function(e){e.stopPropagation();var i=u.prev();i.length&&(i.before(u),n.triggerResponseChangeEvent(t))}),h.on("mousedown.commonRenderer",function(e){e.stopPropagation();var i=u.next();i.length&&(i.after(u),n.triggerResponseChangeEvent(t))}),l(t),e(document).on("attributeChange.qti-widget.commonRenderer",function(e,i){i.element.getSerial()===t.getSerial()&&("maxChoices"===i.key||"minChoices"===i.key)&&(n.removeInstructions(t),l(t),n.validateInstructions(t))}),s(i)},s=function(t){var e=t.find(".order-interaction-area");e.height(e.height())},l=function(i){var a=n.getContainer(i).find(".choice-area"),o=n.getContainer(i).find(".result-area"),s=parseInt(i.attr("minChoices")),l=parseInt(i.attr("maxChoices"));if(s&&n.appendInstruction(i,r("You must use at least "+s+" choices"),function(){o.find(">li").length>=s?this.setLevel("success"):this.reset()}),l&&l<t.size(i.getChoices())){var c=n.appendInstruction(i,r("You can use maximum "+l+" choices"),function(){o.find(">li").length>=l?(a.find(">li").addClass("deactivated"),this.setMessage(r("Maximum choices reached"))):(a.find(">li").removeClass("deactivated"),this.reset())});a.on("mousedown.commonRenderer",">li.deactivated",function(){var t=e(this);t.addClass("brd-error"),c.setLevel("warning",2e3),setTimeout(function(){t.removeClass("brd-error")},150)})}},c=function(i){var a=t.keys(i.getChoices()),r=n.getContainer(i).find(".choice-area").append(n.getContainer(i).find(".result-area>li")),o=r.children(".qti-choice");o.detach().sort(function(i,n){return t.indexOf(a,e(i).data("serial"))>t.indexOf(a,e(n).data("serial"))}),r.prepend(o)},d=function(e,i){var r=n.getContainer(e).find(".choice-area"),o=n.getContainer(e).find(".result-area");if(null===i||t.isEmpty(i))c(e);else try{t.each(a.unserialize(i,e),function(t){o.append(r.find("[data-identifier="+t+"]"))})}catch(s){throw new Error("wrong response format in argument : "+s)}n.validateInstructions(e)},h=function(t){var i=[];return n.getContainer(t).find(".result-area>li").each(function(){i.push(e(this).data("identifier"))}),i},u=function(t){return a.serialize(h(t),t)},p=function(e,i){return t.merge(i||{},{horizontal:"horizontal"===e.attr("orientation")})},f=function(t){var i=n.getContainer(t);i.find(".qti-choice.active").mousedown();var a=[".choice-area",".result-area",".icon-add-to-selection",".icon-remove-from-selection",".icon-move-before",".icon-move-after"];i.find(a.join(",")).andSelf().off(".commonRenderer"),e(document).off(".commonRenderer"),i.find(".order-interaction-area").removeAttr("style"),c(t),n.removeInstructions(t)};return{qtiClass:"orderInteraction",getData:p,template:i,render:o,getContainer:n.getContainer,setResponse:d,getResponse:u,destroy:f}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/prompt",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l="function",c=this.escapeExpression;return s+='<div class="qti-prompt-container" data-html-editable-container>\n    <p class="qti-prompt" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'" data-html-editable>',(o=i.body)?r=o.call(e,{hash:{},data:a}):(o=e&&e.body,r=typeof o===l?o.call(e,{hash:{},data:a}):o),(r||0===r)&&(s+=r),s+="</p>\n</div>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/Prompt",["tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/prompt","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"prompt",template:t,getContainer:e.getContainer}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/selectPointInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a;return(a=i.prompt)?n=a.call(t,{hash:{},data:e}):(a=t&&t.prompt,n=typeof a===c?a.call(t,{hash:{},data:e}):a),n||0===n?n:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l="",c="function",d=this.escapeExpression,h=this;return l+='<div class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-selectPointInteraction '+d((o=e&&e.attributes,o=null==o||o===!1?o:o["class"],typeof o===c?o.apply(e):o))+'" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.serial,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'">\n    ',o=i["if"].call(e,e&&e.prompt,{hash:{},inverse:h.noop,fn:h.program(1,r,a),data:a}),(o||0===o)&&(l+=o),l+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',(s=i.serial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.serial,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'\' class="main-image-box"></div>\n        <div class="clear"></div>\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/SelectPointInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/selectPointInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e,i,n,a,r,o){var s=function(e){var i=o.getContainer(e),n=e.object.attributes,r=this.getOption("baseUrl")||"";e.paper=a.responsivePaper("graphic-paper-"+e.serial,{width:n.width,height:n.height,img:r+n.data,imgId:"bg-image-"+e.serial,diff:t(".image-editor",i).outerWidth()-t(".main-image-box",i).outerWidth(),container:i}),l(e),o.minMaxChoiceInstructions(e,{min:e.attr("minChoices"),max:e.attr("maxChoices"),choiceCount:!1,getResponse:c,onError:function(t){t&&a.highlightError(t.target,"success")}})},l=function(t){function e(e){d&&e&&a.createTouchCircle(t.paper,e.getBBox()),o.triggerResponseChangeEvent(t),o.validateInstructions(t,{target:e})}var i=t.attr("maxChoices"),n=o.getContainer(t),r=n.find(".main-image-box"),s=n.hasClass("responsive"),l=t.paper.getById("bg-image-"+t.serial),d=!1;l.touchstart(function(){d=!0,l.untouchstart()}),l.click(function(n){if(i>0&&c(t).length>=i)return void o.validateInstructions(t);var l=a.getPoint(n,t.paper,r,s);a.createTarget(t.paper,{point:l,create:e,remove:function(){e()}})})},c=function(t){var e=[];return t.paper.forEach(function(t){var i=t.data("point");"object"==typeof i&&i.x&&i.y&&e.push([i.x,i.y])}),e},d=function(t,i){var n;if(i&&t.paper){try{n=r.unserialize(i,t)}catch(o){}e.isArray(n)&&e(n).flatten().map(function(t,e){return e%2===0?{x:t,y:n[e+1]}:void 0}).filter(e.isObject).forEach(function(e){a.createTarget(t.paper,{point:e})})}},h=function(t){t.paper.forEach(function(t){var e=t.data("point");"object"==typeof e&&a.trigger(t,"click")})},u=function(t){var e=(c(t),r.serialize(c(t),t));return e},p=function(e){var i;e.paper&&(i=o.getContainer(e),t(window).off("resize.qti-widget"),e.paper.clear(),o.removeInstructions(e),t(".main-image-box",i).empty().removeAttr("style"),t(".image-editor",i).removeAttr("style"))};return{qtiClass:"selectPointInteraction",template:n,render:s,getContainer:o.getContainer,setResponse:d,getResponse:u,resetResponse:h,destroy:p}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/sliderInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a;return(a=i.prompt)?n=a.call(t,{hash:{},data:e}):(a=t&&t.prompt,n=typeof a===c?a.call(t,{hash:{},data:e}):a),n||0===n?n:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l="",c="function",d=this.escapeExpression,h=this;return l+='<div class="qti-interaction qti-blockInteraction qti-sliderInteraction" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.serial,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'" data-qti-class="sliderInteraction" >\r\n    ',o=i["if"].call(e,e&&e.prompt,{hash:{},inverse:h.noop,fn:h.program(1,r,a),data:a}),(o||0===o)&&(l+=o),l+='\r\n    <div class="instruction-container"></div>\r\n</div>'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/SliderInteraction",["lodash","jquery","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/sliderInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","nouislider"],function(t,e,i,n,a){var r=function(t){t.sliderCurrentValue.find(".qti-slider-cur-value").text(t.value),t.sliderValue.val(t.value)},o=function(t){var i=t.getAttributes(),a=t.getContainer(),o=e("<div />").attr({id:i.identifier+"-qti-slider","class":"qti-slider"}),s=e("<div />").attr({"class":"qti-slider-values"}),l=e("<div />").attr({id:i.identifier+"-qti-slider-cur-value","class":"qti-slider-cur-value"}),c=e("<input />").attr({type:"hidden",id:i.identifier+"-qti-slider-value"}),d="horizontal",h="undefined"!=typeof i.reverse&&i.reverse?!0:!1,u=parseInt(i.lowerBound),p=parseInt(i.upperBound),f="undefined"!=typeof i.step&&i.step?parseInt(i.step):1,m=(p-u)/f;l.append('<span class="qti-slider-cur-value-text">Current value: </span>').append('<span class="qti-slider-cur-value"></span>'),s.append('<span class="slider-min">'+(h?p:u)+"</span>").append('<span class="slider-max">'+(h?u:p)+"</span>"),t.getContainer().append(o).append(s).append(l).append(c),"undefined"!=typeof i.orientation&&e.inArray(i.orientation,["horizontal","vertical"])>-1&&(d=i.orientation);var g=0;if("horizontal"===d)a.addClass("qti-slider-horizontal");else{var v=300;g=20*m,g>v&&(g=v),a.addClass("qti-slider-vertical"),o.height(g+"px"),s.height(g+"px")}if("undefined"!=typeof i.stepLabel&&i.stepLabel){var C=parseInt(m/2),I=100/m*C,b=h?p-C*f:u+C*f;s.find(".slider-min").after("horizontal"===d?'<span class="slider-middle" style="left:'+I+'%">'+b+"</span>":'<span class="slider-middle" style="top:'+I+'%">'+b+"</span>")}o.noUiSlider({start:h?p:u,range:{min:u,max:p},step:f,orientation:d}).on("slide",function(){var i=parseInt(e(this).val());t.attr("reverse")&&(i=p+u-i),i=Math.round(1e3*i)/1e3,r({value:i,sliderValue:c,sliderCurrentValue:l}),n.triggerResponseChangeEvent(t)}),r({value:u,sliderValue:c,sliderCurrentValue:l})},s=function(t){var i=t.getAttributes(),n=e("#"+i.identifier+"-qti-slider"),a=e("#"+i.identifier+"-qti-slider-value"),o=e("#"+i.identifier+"-qti-slider-cur-value"),s=parseInt(i.lowerBound),l=parseInt(i.upperBound),c="undefined"!=typeof i.reverse&&i.reverse?!0:!1,d=c?l:s;r({value:s,sliderValue:a,sliderCurrentValue:o}),n.val(d)},l=function(t,i){var n,o=t.getAttributes(),s=e("#"+o.identifier+"-qti-slider-value"),l=e("#"+o.identifier+"-qti-slider-cur-value"),c=e("#"+o.identifier+"-qti-slider"),d=parseInt(o.lowerBound),h=parseInt(o.upperBound);n=a.unserialize(i,t)[0],r({value:n,sliderValue:s,sliderCurrentValue:l}),c.val(t.attr("reverse")?h+d-n:n)},c=function(t){var i,n=t.getAttributes(),a=t.getResponseDeclaration().attr("baseType"),r=parseInt(n.lowerBound),o=e("#"+n.identifier+"-qti-slider-value");return"integer"===a?i=parseInt(o.val()):"float"===a&&(i=parseFloat(o.val())),isNaN(i)?r:i},d=function(t){return a.serialize([c(t)],t)},h=function(t){var e=t.getContainer();e.empty()};return{qtiClass:"sliderInteraction",template:i,render:o,getContainer:n.getContainer,setResponse:l,getResponse:d,resetResponse:s,destroy:h}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/textEntryInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l="function",c=this.escapeExpression;return s+='<input class="qti-interaction qti-inlineInteraction qti-textEntryInteraction" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'" data-qti-class="textEntryInteraction" type="text">'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/TextEntryInteraction",["lodash","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/textEntryInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","i18n","polyfill/placeholders","tooltipster"],function(t,e,i,n,a){var r=function(t,e){var i=new RegExp("^"+e+"$"),n="pattern"in document.createElement("input");t.attr("pattern",e),t.on("keyup",function(){t.removeClass("field-error"),i.test(t.val())?t.tooltipster("hide"):((!n||navigator.userAgent.match(/Safari/i))&&t.addClass("field-error"),t.tooltipster("show"))})},o=function(t){var e=t.getAttributes(),i=t.getContainer();e.expectedLength&&i.css("width",parseInt(e.expectedLength)+"em"),e.patternMask&&(i.tooltipster({theme:"tao-error-tooltip",content:a("Invalid pattern"),delay:350,trigger:"custom"}),r(i,e.patternMask)),e.placeholderText&&i.attr("placeholder",e.placeholderText)},s=function(t){t.getContainer().val("")},l=function(t,e){var i;try{i=n.unserialize(e,t)}catch(a){}i&&i.length&&t.getContainer().val(i[0])},c=function(t){var e,i={base:{}},n=t.getContainer(),a=t.getAttributes(),r=t.getResponseDeclaration().attr("baseType"),o=a.base||10;return a.placeholderText&&n.val()===a.placeholderText?e="":"integer"===r?e=parseInt(n.val(),o):"float"===r?e=parseFloat(n.val()):"string"===r&&(e=n.val()),i.base[r]=isNaN(e)&&"number"==typeof e?"":e,i};return{qtiClass:"textEntryInteraction",template:e,render:o,getContainer:i.getContainer,setResponse:l,getResponse:c,resetResponse:s}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/uploadInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a;return(a=i.prompt)?n=a.call(t,{hash:{},data:e}):(a=t&&t.prompt,n=typeof a===c?a.call(t,{hash:{},data:e}):a),n||0===n?n:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l="",c="function",d=this.escapeExpression,h=this;return l+='<div class="qti-interaction qti-blockInteraction qti-uploadInteraction" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.serial,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'">\n	',o=i["if"].call(e,e&&e.prompt,{hash:{},inverse:h.noop,fn:h.program(1,r,a),data:a}),(o||0===o)&&(l+=o),l+='\n	<div class="instruction-container"></div>\n    <div class="file-upload grid-row">\n        <div class="progressbar"></div>\n        <span class="btn-info small col-4"></span>\n        <span class="file-name placeholder col-8 truncate"></span>\n        <input type="file">\n    </div>\n</div> '})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/UploadInteraction",["lodash","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/uploadInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","jquery","jqueryui","i18n","context","filereader"],function(t,e,i,n,a,r,o){var s={base:null},l=r("Browse your computer and select the appropriate file."),c=r("The selected file is ready to be sent."),d=function(t,e){i.removeInstructions(t),i.appendInstruction(t,l);var n=i.getContainer(t),a=e.name,r=(e.size,e.type);n.find(".file-name").empty().append(a);var o=new FileReader;o.onload=function(e){i.removeInstructions(t),i.appendInstruction(t,c,function(){this.setLevel("success")}),i.validateInstructions(t),n.find(".progressbar").progressbar({value:100});var o=e.target.result,l=o.indexOf(",");base64Raw=o.substring(l+1),r=r,s={base:{file:{data:base64Raw,mime:r,name:a}}}},o.onloadstart=function(){i.removeInstructions(t),n.find(".progressbar").progressbar({value:0})},o.onprogress=function(t){var e=Math.ceil(Math.round(t.loaded)/Math.round(t.total)*100);n.find(".progressbar").progressbar({value:e})},o.readAsDataURL(e)},h=function(t){$container=i.getContainer(t),$container.find(".file-name").text(r("No file selected")),$container.find(".btn-info").text(r("Browse..."))},u=function(t){$container=i.getContainer(t),h(t),i.appendInstruction(t,l);var e=function(e){var i=e.target.files[0];"undefined"!=typeof i&&d(t,i)};$input=$container.find("input"),window.File&&window.FileReader&&window.FileList?$input.bind("change",e):$input.fileReader({id:"fileReaderSWFObject",filereader:o.taobase_www+"js/lib/polyfill/filereader.swf",callback:function(){$input.bind("change",e)}}),$input.bind("mousedown",function(t){return t.preventDefault(),n(this).blur(),!1})},p=function(t){$container=i.getContainer(t),h(t)},f=function(t,e){$container=i.getContainer(t);var n="undefined"!=typeof e.base.file.name?e.base.file.name:"previously-uploaded-file";$container.find(".file-name").empty().text(n),s=e},m=function(){return s};return{qtiClass:"uploadInteraction",template:e,render:u,getContainer:i.getContainer,setResponse:f,getResponse:m,resetResponse:p,resetGui:h}}),define("taoQtiItem/qtiCreator/editor/MathEditor",["lodash","jquery","mathJax"],function(t,e,i){var n=function(t){if(t=t||{},this.mathML=t.mathML||"",this.tex=t.tex||"",this.display=t.display||"inline",this.processing=!1,this.$target=t.target||e(),!(t.buffer&&t.buffer instanceof e&&t.buffer.length))throw'missing required element in config "buffer"';this.$buffer=t.buffer};n.prototype.setMathML=function(t){return this.mathML=r(t),this},n.prototype.setTex=function(t){return this.tex=t,this};var a=function(i,n){var a={target:null,callback:null};if(t.each(n,function(i){t.isFunction(i)?a.callback=i:i instanceof e&&(a.target=i)}),!a.target){if(!i.$target)throw"no target defined for rendering";a.target=i.$target}return a};n.prototype.renderFromMathML=function(){var t=a(this,arguments);if("undefined"!=typeof i){if(this.processing)return;var e=i.Hub.queue,n=s(this.mathML,"block"===this.display);this.$buffer.html(n);var r=this;e.Push(["Typeset",i.Hub,this.$buffer[0]],function(){r.processing=!1,t.target.html(r.$buffer.html()),r.$buffer.empty()}),t.callback&&e.Push(t.callback)}},n.prototype.renderFromTex=function(){var t=a(this,arguments);if("undefined"!=typeof i){var e=this,n=i.Hub.queue;e.$buffer.html("block"===this.display?"\\[\\displaystyle{"+e.tex+"}\\]":"\\(\\displaystyle{"+e.tex+"}\\)"),n.Push(["Typeset",i.Hub,e.$buffer[0]],function(){t.target.html(e.$buffer.html());var i=o(e.$buffer);e.$buffer.empty(),e.texToMathML(i,function(t){e.setMathML(r(t))})}),t.callback&&n.Push(t.callback)}};var r=function(t){return t=t.replace(/<(\/)?math[^>]*>/g,""),t=t.replace(/^\s*[\r\n]/gm,""),t=t.replace(/\s*[\r\n]$/gm,"")},o=function(t){if(t instanceof e&&t.length){var i=t.find("script");if(i.length&&i[0].MathJax&&i[0].MathJax.elementJax)return i[0].MathJax.elementJax}},s=function(t,e){if(!t.match(/<math[^>]*>/)){var i=e?' display="block"':"";t="<math"+i+">"+t}return t.match(/<\/math[^>]*>/)||(t+="</math>"),t};return n.prototype.texToMathML=function(t,e){var n=this,a="";try{a=t.root.toMathML("")}catch(r){if(!r.restart)throw r;return i.Callback.After(function(){n.texToMathML(t,e)},r.restart)}i.Callback(e)(a)},n}),define("taoQtiItem/qtiCreator/editor/ckEditor/ckConfigurator",["lodash","ckeditor","taoQtiItem/qtiCreator/editor/ckEditor/dtdHandler"],function(t,e,i){var n=t.cloneDeep(CKEDITOR.config),a=function(){var e={TaoMediaManager:{insertAfter:"SpecialChar"}},a={TaoQtiImage:{insertAfter:"SpecialChar"},TaoQtiMaths:{insertAfter:"SpecialChar"}},r={inline:[{name:"basicstyles",items:["Bold","Italic","Subscript","Superscript"]},{name:"insert",items:["SpecialChar"]},{name:"links",items:["Link"]}],flow:[{name:"basicstyles",items:["Bold","Italic","Subscript","Superscript"]},{name:"insert",items:["SpecialChar"]},{name:"links",items:["Link"]}],block:[{name:"basicstyles",items:["Bold","Italic","Subscript","Superscript"]},{name:"insert",items:["Image","Table","SpecialChar"]},{name:"links",items:["Link"]},"/",{name:"styles",items:["Format"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]}]},o={disableAutoInline:!0,entities:!1,entities_processNumerical:!0,autoParagraph:!1,extraPlugins:"confighelper",floatSpaceDockedOffsetY:0,forcePasteAsPlainText:!0,skin:"tao",removePlugins:"",linkShowAdvancedTab:!1,linkShowTargetTab:!1},s=function(e,i){var n,a,r,o,s,l,c,d,h,u,p=e.toolbar.length,f={};for(e.extraPlugins=function(e,i){for(var n=e.length,a=i.split(",");n--;)e[n]=e[n].toLowerCase();return a=t.compact(t.union(a,e)),a.join(",")}(t.keys(i),e.extraPlugins),u=0;p>u;u++)t.isString(e.toolbar[u])&&(f[u]=e.toolbar[u],e.toolbar[u]={items:[]});for(o in i){for(r=function(t){for(var e=t.length;e--;)if(0===t[e].indexOf("insert")||"replace"===t[e])return t[e];throw"Missing key insertBefore | insertAfter | replace in positionedPlugins"}(t.keys(i[o])),c=i[o][r].toLowerCase(),l=i[o].separator||!1,s=-1;p--;){for(a=e.toolbar[p].items.length,n=0;a>n;n++)if(e.toolbar[p].items[n].toLowerCase()===c){s=n;break}if(s>-1){d=~~("replace"===r),"insertAfter"===r&&s++,l&&(e.toolbar[p].items.splice(s,d,"-"),s++),e.toolbar[p].items.splice(s,d,o);break}}p=e.toolbar.length}for(h in f)e.toolbar[h]=f[h]},l=function(l,c,d){if("reset"===c)return n;d=d||{},d.resourcemgr=d.resourcemgr||{};var h,u,p=t.clone(r,!0),f="html";0===c.indexOf("qti")&&(c=c.slice(3).toLowerCase(),o.allowedContent=!0,o.autoParagraph=!1,f="qti"),d.toolbar&&(p[c]=t.clone(d.toolbar),delete d.toolbar);for(h in p)p.hasOwnProperty(h)&&(o["toolbar_"+h]=p[h]);return"undefined"!=typeof p[c]&&(o.toolbar=p[c]),"undefined"!=typeof d.positionedPlugins&&(d.positionedPlugins={}),!1!==d.positionedPlugins&&(e="qti"===f?t.assign(a,t.clone(d.positionedPlugins)):t.assign(e,t.clone(d.positionedPlugins)),delete d.positionedPlugins,s(o,e)),u=t.assign({},t.cloneDeep(n),o,d),l.on("focus",function(){i.setMode(f),CKEDITOR.dtd=i.getDtd()}),l.on("instanceReady",function(t){$(t.editor.element.$).removeAttr("title")}),u};return{getConfig:l}}();return a}),define("taoQtiItem/qtiCreator/editor/ckEditor/ckProtector",["jquery","i18n"],function(t,e){var i=function(){var i=".widget-box",n=function(t){var e=t[0],i=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;if(i){var n=new i(function(e){e.forEach(function(){t.trigger("contentchange.protector")})});n.observe(e,{subtree:!0,characterData:!0})}else e.addEventListener("DOMCharacterDataModified",function(){t.trigger("contentchange.protector")},!1)},a=function(){return i},r=function(a,r){r&&(i=r),a.find(i).each(function(){var i,r=t(this),o=r.outerWidth(),s=r.outerHeight(),l=t('<button class="cke-cover-up">'),c=function(e){return t('[data-serial="'+e+'"]').each(function(){var e=t(this);return e.parent().hasClass("cke-qti-wrapper")?!1:void 0}),r.length?r:t()},d=function(t){var e=c(t.prop("serial")).parent(".cke-qti-wrapper"),i=e.offset();t.css({left:i.left,top:i.top})};return r.parent(".cke-qti-wrapper").length?!1:(r.find("*").each(function(){this.innerHTML||(this.innerHTML="&#8203;")}),r.wrap(t('<span class="cke-qti-wrapper" />')),i=r.parent(),l.css({width:o,height:s}),t("body").append(l),i.css({width:o,height:s}),i.attr("contenteditable",!1),i.prop("cover",l),l.prop("serial",r.data("serial")),d(l),l.attr("title",e("Click to display interaction widget")),l.on("click",function(){var e=c(t(this).prop("serial"));t(document).trigger("removeprotection.ckprotector",{context:a,widget:e})}),n(a),void a.on("contentchange.protector",function(){d(l)}))})},o=function(e){e.each(function(){var e=t(this),i=e.parent(".cke-qti-wrapper");i.length&&(i.prop("cover").remove(),e.unwrap())})};return{protect:r,unprotect:o,getSelector:a}}();return i}),define("taoQtiItem/qtiCreator/editor/gridEditor/arrow",["lodash"],function(t){var e="arrowenter.gridEdit.gridDragDrop",i=function(i,r){var o={insertZoneWidth:20,marginWidth:0};r=t.extend(o,r);var s=$("<div>",{"class":"grid-edit-insert-box"}).css({top:0,width:r.insertZoneWidth,right:-(r.marginWidth+(r.insertZoneWidth-r.marginWidth)/2),height:i.parent(".grid-row").height()-parseFloat(i.css("margin-bottom"))}).append($("<div>",{"class":"grid-edit-insert-square"})).append($("<div>",{"class":"grid-edit-insert-triangle"})).append($("<div>",{"class":"grid-edit-insert-line"})).on("mouseenter",".grid-edit-insert-triangle, .grid-edit-insert-square",function(){i.trigger(e,["right"]),n(i)}),l=s.clone().css({left:-(r.marginWidth+5),right:"auto"}).on("mouseenter",".grid-edit-insert-triangle, .grid-edit-insert-square",function(){i.trigger(e,["left"]),n(i)});i.append(s).append(l),a(s,function(){i.trigger(e,["right"]),n(i)}),a(l,function(){i.trigger(e,["left"]),n(i)})},n=function(t){t.find(".grid-edit-insert-box").remove()},a=function(t,e){var i=null;t.on("mouseenter",function(t){var n=t.pageY-$(this).offset().top-parseInt($(this).find(".grid-edit-insert-triangle").outerHeight())-parseInt($(this).find(".grid-edit-insert-square").outerHeight()),a=$(this).find(".grid-edit-insert-triangle, .grid-edit-insert-square"),r=0;
i=setInterval(function(){var t=4.905*Math.pow(r,2)/100;a.css("top",t),t>n&&(clearInterval(i),e()),r++},10)}).on("mouseleave",function(){$(this).find(".grid-edit-insert-triangle, .grid-edit-insert-square").css("top",0),clearInterval(i)})};return{create:i}}),define("taoQtiItem/qtiCreator/editor/gridEditor/config",[],function(){return{min:{interaction:2,text:1,rubricBlock:12},throttle:{resize:100}}}),define("taoQtiItem/qtiCreator/editor/gridEditor/helper",[],function(){var t={getColUnits:function(t){var e=t.attr("class");if(!e)throw new Error("the element has no css class");var i=e.match(/col-([\d]+)/);if(i&&i.length)return parseInt(i.pop());throw"the element has no col-* class"},setUnitsFromClass:function(e){var i=t.getColUnits(e);return e.attr("data-units",i),i}};return t}),define("taoQtiItem/qtiCreator/helper/qtiElements",["jquery","lodash"],function(t,e){var i={};return i.classes={itemBody:{parents:["bodyElement"],contains:["block"],"abstract":!0},atomicBlock:{parents:["blockStatic","bodyElement","flowStatic"],contains:["inline"],"abstract":!0},atomicInline:{parents:["bodyElement","flowStatic","inlineStatic"],contains:["inline"],"abstract":!0},simpleBlock:{parents:["blockStatic","bodyElement","flowStatic"],contains:["block"],"abstract":!0},simpleInline:{parents:["bodyElement","flowStatic","inlineStatic"],contains:["inline"],"abstract":!0},flowStatic:{parents:["flow"],"abstract":!0},blockStatic:{parents:["block"],"abstract":!0},inlineStatic:{parents:["inline"],"abstract":!0},flow:{parents:["objectFlow"],"abstract":!0},tableCell:{parents:["bodyElement"],contains:["flow"],"abstract":!0},caption:{parents:["bodyElement"],contains:["inline"],xhtml:!0},col:{parents:["bodyElement"],xhtml:!0},colgroup:{parents:["bodyElement"],contains:["col"],xhtml:!0},div:{parents:["blockStatic","bodyElement","flowStatic"],contains:["flow"],xhtml:!0},dl:{parents:["blockStatic","bodyElement","flowStatic"],contains:["dlElement"],xhtml:!0},dt:{parents:["dlElement"],contains:["inline"],xhtml:!0},dd:{parents:["dlElement"],contains:["flow"],xhtml:!0},hr:{parents:["blockStatic","bodyElement","flowStatic"],xhtml:!0},math:{parents:["blockStatic","flowStatic","inlineStatic"],xhtml:!0},li:{parents:["bodyElement"],contains:["flow"],xhtml:!0},ol:{parents:["blockStatic","bodyElement","flowStatic"],contains:["li"],xhtml:!0},ul:{parents:["blockStatic","bodyElement","flowStatic"],contains:["li"],xhtml:!0},object:{parents:["bodyElement","flowStatic","inlineStatic"],contains:["objectFlow"],xhtml:!0},param:{parents:["objectFlow"],xhtml:!0},table:{parents:["blockStatic","bodyElement","flowStatic"],contains:["caption","col","colgroup","thead","tfoot","tbody"],xhtml:!0},tbody:{parents:["bodyElement"],contains:["tr"],xhtml:!0},tfoot:{parents:["bodyElement"],contains:["tr"],xhtml:!0},thead:{parents:["bodyElement"],contains:["tr"],xhtml:!0},td:{parents:["tableCell"],xhtml:!0},th:{parents:["tableCell"],xhtml:!0},tr:{parents:["bodyElement"],contains:["tableCell"],xhtml:!0},a:{parents:["simpleInline"],xhtml:!0},abbr:{parents:["simpleInline"],xhtml:!0},acronym:{parents:["simpleInline"],xhtml:!0},b:{parents:["simpleInline"],xhtml:!0},big:{parents:["simpleInline"],xhtml:!0},cite:{parents:["simpleInline"],xhtml:!0},code:{parents:["simpleInline"],xhtml:!0},dfn:{parents:["simpleInline"],xhtml:!0},em:{parents:["simpleInline"],xhtml:!0},i:{parents:["simpleInline"],xhtml:!0},kbd:{parents:["simpleInline"],xhtml:!0},q:{parents:["simpleInline"],xhtml:!0},samp:{parents:["simpleInline"],xhtml:!0},small:{parents:["simpleInline"],xhtml:!0},span:{parents:["simpleInline"],xhtml:!0},strong:{parents:["simpleInline"],xhtml:!0},sub:{parents:["simpleInline"],xhtml:!0},sup:{parents:["simpleInline"],xhtml:!0},tt:{parents:["simpleInline"],xhtml:!0},"var":{parents:["simpleInline"],xhtml:!0},blockquote:{parents:["simpleBlock"],xhtml:!0},address:{parents:["atomicBlock"],xhtml:!0},h1:{parents:["atomicBlock"],xhtml:!0},h2:{parents:["atomicBlock"],xhtml:!0},h3:{parents:["atomicBlock"],xhtml:!0},h4:{parents:["atomicBlock"],xhtml:!0},h5:{parents:["atomicBlock"],xhtml:!0},h6:{parents:["atomicBlock"],xhtml:!0},p:{parents:["atomicBlock"],xhtml:!0},pre:{parents:["atomicBlock"],xhtml:!0},img:{parents:["atomicInline"],xhtml:!0,attributes:["src","alt","longdesc","height","width"]},br:{parents:["atomicInline"],xhtml:!0},infoControl:{parents:["blockStatic","bodyElement","flowStatic"],qti:!0},textRun:{parents:["inlineStatic","flowstatic"],qti:!0},feedbackInline:{parents:["simpleInline","feedbackElement"],qti:!0},feedbackBlock:{parents:["simpleBlock"],qti:!0},rubricBlock:{parents:["simpleBlock"],qti:!0},blockInteraction:{parents:["block","flow","interaction"],qti:!0},inlineInteraction:{parents:["inline","flow","interaction"],qti:!0},gap:{parents:["inlineStatic"],qti:!0},hottext:{parents:["flowstatic","inlineStatic"],contains:["inlineStatic"],qti:!0},printedVariable:{parents:["bodyElement","flowStatic","inlineStatic","textOrVariable"],qti:!0},prompt:{parents:["bodyElement"],contains:["inlineStatic"],qti:!0},templateElement:{parents:["bodyElement"],qti:!0},templateBlock:{parents:["blockStatic","flowStatic","templateElement"],contains:["blockStatic"],qti:!0},templateInline:{parents:["inlineStatic","flowStatic","templateElement"],contains:["inlineStatic"],qti:!0},choiceInteraction:{parents:["blockInteraction"],qti:!0},associateInteraction:{parents:["blockInteraction"],qti:!0},orderInteraction:{parents:["blockInteraction"],qti:!0},matchInteraction:{parents:["blockInteraction"],qti:!0},hottextInteraction:{parents:["blockInteraction"],qti:!0},gapMatchInteraction:{parents:["blockInteraction"],qti:!0},mediaInteraction:{parents:["blockInteraction"],qti:!0},sliderInteraction:{parents:["blockInteraction"],qti:!0},uploadInteraction:{parents:["blockInteraction"],qti:!0},drawingInteraction:{parents:["blockInteraction"],qti:!0},graphicInteraction:{parents:["blockInteraction"],qti:!0},hotspotInteraction:{parents:["graphicInteraction"],qti:!0},graphicAssociateInteraction:{parents:["graphicInteraction"],qti:!0},graphicOrderInteraction:{parents:["graphicInteraction"],qti:!0},graphicGapMatchInteraction:{parents:["graphicInteraction"],qti:!0},selectPointInteraction:{parents:["graphicInteraction"],qti:!0},textEntryInteraction:{parents:["stringInteraction","inlineInteraction"],qti:!0},extendedTextInteraction:{parents:["stringInteraction","blockInteraction"],qti:!0},inlineChoiceInteraction:{parents:["inlineInteraction"],qti:!0},_container:{parents:["block"],qti:!0}},i.cache={containable:{},children:{},parents:{}},i.getAllowedContainersElements=function(e,n){var a=i.getAllowedContainers(e),r="";for(var o in a)a[o].qti||(r+=a[o]+", ");return r&&(r=r.substring(0,r.length-2)),t(r,n?n:t(document)).filter(":not([data-qti-type])")},i.getAllowedContainers=function(t){if(i.cache.containable[t])var n=i.cache.containable[t];else{var n=[],a=i.getParentClasses(t,!0);for(var r in i.classes){var o=i.classes[r];if(o.contains){var s=e.intersection(o.contains,a);s.length&&(o.abstract||n.push(r),n=e.union(n,i.getChildClasses(r,!0)))}}i.cache.containable[t]=n}return n},i.getAllowedContents=function(t,n,a){var r=[];a=a||{};var o=i.classes[t];if(o&&o.contains)for(var s in o.contains){var l=o.contains[s];if(!a[l]){a[l]=!0,r.push(l);var c=i.getChildClasses(l,!0);for(var s in c){var d=c[s];a[d]||(a[d]=!0,r.push(d),n&&(r=e.union(r,i.getAllowedContents(d,!0,a))))}n&&(r=e.union(r,i.getAllowedContents(l,!0,a)))}}var h=i.getParentClasses(t,!0);for(var s in h)r=e.union(r,i.getAllowedContents(h[s],n,a));return e.uniq(r,!1)},i.isAllowedClass=function(t,n){var a=i.getAllowedContents(t);return e.indexOf(a,n)>=0},i.getParentClasses=function(t,n){if(n&&i.cache.parents[t])var a=i.cache.parents[t];else{var a=[];if(i.classes[t]&&(a=i.classes[t].parents,n)){for(var r in a)a=e.union(a,i.getParentClasses(a[r],n));a=e.uniq(a,!1)}i.cache.parents[t]=a}return a},i.getChildClasses=function(t,n,a){var r=a?a:"all";if(n&&i.cache.children[t]&&i.cache.children[t][r])var o=i.cache.children[t][r];else{var o=[];for(var s in i.classes){var l=i.classes[s];e.indexOf(l.parents,t)>=0&&(a?l[a]&&o.push(s):o.push(s),n&&(o=e.union(o,i.getChildClasses(s,n,a))))}i.cache.children[t]||(i.cache.children[t]={}),i.cache.children[t][r]=o}return o},i.isBlock=function(t){return i.is(t,"block")},i.isInline=function(t){return i.is(t,"inline")},i.is=function(t,n){if(t===n)return!0;var a=i.getParentClasses(t,!0);return e.indexOf(a,n)>=0},i}),define("taoQtiItem/qtiCreator/editor/gridEditor/resizable",["lodash","jquery","taoQtiItem/qtiCreator/editor/gridEditor/config","taoQtiItem/qtiCreator/editor/gridEditor/helper","taoQtiItem/qtiCreator/helper/qtiElements","jqueryui"],function(t,e,i,n,a){var r=function(t){var e=t.height()-parseFloat(t.children('[class^="col-"], [class*=" col-"]').css("margin-bottom"));t.find(".grid-edit-resizable-zone").height(e)},o=function(r){var c=parseFloat(r.find('[class^="col-"]:last, [class*=" col-"]:last').css("margin-left")),d=20;r.find('[class^="col-"], [class*=" col-"]').each(function(){var h=e(this);if(h.children(".grid-edit-resizable-zone").length)return!0;var u=h.next(),p=h.parent(".grid-row"),f=h.offset(),m=12,g=a.is(h.data("qti-class"),"interaction")?i.min.interaction:i.min.text,v=a.is(u.data("qti-class"),"interaction")?i.min.interaction:i.min.text,C=p.width()/m,I=p.height()-parseFloat(h.css("margin-bottom")),b=e("<div>",{"class":"grid-edit-resizable-zone grid-edit-resizable-zone-active"}).css({top:0,right:-(c+(d-c)/2),width:d,height:I}),E=e("<span>",{"class":"grid-edit-resizable-handle"});b.append(E),h.append(b);var y=function(){var t=p.height()-parseFloat(h.css("margin-bottom"));h.find(".grid-edit-resizable-outline").height(t),b.height(t)};b.draggable({containment:u.length?[f.left+g*C-2*c+10,f.top,f.left+h.outerWidth()+c+u.outerWidth()-v*C-d/2-10,f.top+h.height()]:[f.left+g*C-c-d/2-10,f.top,p.offset().left+p.outerWidth()-c-d/2-12,f.top+h.height()],axis:"x",cursor:"col-resize",start:function(){h.trigger("resizestart.gridEdit");var t=e("<div>",{"class":"grid-edit-resizable-outline"});u.length?t.width(parseFloat(h.outerWidth())+c+parseFloat(u.outerWidth())):t.css({width:"100%","border-right-width":0}),e(this).data("overlay",t),h.append(t),E.addClass("grid-edit-resizable-active"),r.find(".grid-edit-resizable-zone-active").removeClass("grid-edit-resizable-zone-active"),y()},drag:t.throttle(function(){var t=e(this).offset().left+d/2-f.left,i=n.getColUnits(h),a=u.length?n.getColUnits(u):0;u.length||h.find(".grid-edit-resizable-outline").width(E.offset().left-f.left),(i-1)*C>t+0*c?(i--,l(h,i),u.length&&(a++,l(u,a)),y()):t+c+20>(i+1)*C&&(i++,l(h,i),u.length&&(a--,l(u,a)),y())},i.throttle.resize),stop:function(){h.find(".grid-edit-resizable-outline").remove(),s(r),o(r),h.trigger("resizestop.gridEdit")}}).css("position","absolute")}),r.off(".gridEdit.resizable").on("dragoverstart.gridEdit.resizable",function(){s(r)}).on("dragoverstop.gridEdit.resizable",function(){o(r)}).on("contentChange.gridEdit.resizable",".grid-row",function(){s(r),o(r)})},s=function(t){t.find(".grid-edit-resizable-zone").remove()},l=function(t,i){if(!t.attr("class").match(/col-([\d]+)/))throw e.error("the element is not a grid column");var n=t.attr("data-units"),a=t.parent(".grid-row"),r=a.attr("data-units");a.attr("data-units",r-n+i),t.attr("data-units",i),t.removeClass("col-"+n).addClass("col-"+i)};return{create:function(t){o(t),e(window).off("resize.qtiEdit.resizable").on("resize.qtiEdit.resizable",function(){s(t),o(t)})},destroy:function(t,i){s(t),i||e(window).off("resize.qtiEdit.resizable")},syncHandleHeight:function(t){t.hasClass("grid-row")?r(t):t.find(".grid-row").each(function(){r(e(this))})}}}),define("taoQtiItem/qtiCreator/editor/gridEditor/content",["jquery","lodash","taoQtiItem/qtiCreator/editor/gridEditor/resizable"],function(t,e,i){var n={};return n.getContent=function(i,a){var r=e.defaults({inner:!0},a),o=r.inner?t(i).clone():t("<div>",{"class":"col-fictive content-helper-wrapper"}).append(t(i).clone());return n.destroyGridWidgets(o,!0),n.serializeElements(o),o.html()},n.getChangeCallback=function(i){return e.throttle(function(e){var a=t("<div>").html(e),r=n.getContent(a);i.body(r)},800)},n.serializeElements=function(e){var i=[];return e.find(".widget-box:not(.widget-box *)").each(function(){var e=t(this);if(e.data("serial")){var n=e.data("serial");e.replaceWith("{{"+n+"}}"),i.push(n)}else{if(!e.data("new")||!e.data("qti-class"))throw"unknown qti-widget type";var a=e.data("qti-class");e.replaceWith("{{"+a+":new}}")}}),i},n.destroyGridWidgets=function(t,e){t.removeData("qti-grid-options"),t.find('.grid-row, [class*=" col-"], [class^="col-"]').removeAttr("style").removeAttr("data-active").removeAttr("data-units"),t.children(".ui-draggable-dragging").remove(),i.destroy(t,e)},n}),define("taoQtiItem/qtiCreator/helper/gridUnits",["lodash"],function(t){function e(e,i,n){n=n||12;var a=0,r=0,o={},s={},l=[],c=[];for(var d in e)o[d]=t.clone(e[d]),a+=e[d].units,r++;var h=a/r;if(o[r+1]={elt:"middle",units:h,min:i},a+Math.round(h)>n){var u=0;for(var d in o){var p=o[d],f=p.units*n/(n+h);c[d]=Math.round(f%1*100),p.refactoredUnits=Math.round(f),p.min&&p.refactoredUnits<p.min&&(p.refactoredUnits=p.min,l[d]=!0),u+=p.refactoredUnits}if(u>n)for(var d;r+1>d;d++){var p=o[d];if(p.decimal>50&&p.refactoredUnits-1>p.min&&(p.refactoredUnits--,u--),u===n)break}var m=o[r+1].refactoredUnits,g=u>n?n:m;delete o[r+1],s={last:g,middle:m,cols:o,refactoredTotalUnits:u}}else{var v=n-a;s={last:v,middle:v,cols:{}}}return s}function i(e,i){i=i||12;var n=0,a=[],r=0,o=[],s=[],l=[];if(t.each(e,function(t){a.push(t),n+=t.units}),n>i)throw"the total number of units exceed the maximum of "+i;return t.each(a,function(t){var e=t.units*i/n,a=Math.round(e);r+=a,t.refactoredUnits=a,a>e?s.push(t):o.push(t)}),s=t.sortBy(s,"refactoredUnits"),o=t.sortBy(o,"refactoredUnits"),r>i?t.eachRight(s,function(t){return t.refactoredUnits--,r--,r===i?!1:void 0}):i>r&&t.each(o,function(t){return t.refactoredUnits++,r++,r===i?!1:void 0}),t.each(o,function(t){l.push(t)}),t.each(s,function(t){l.push(t)}),a}return{distribute:function(t,i,n){return e(t,i,n)},redistribute:function(t,e){return i(t,e)}}}),define("taoQtiItem/qtiCreator/editor/targetFinder",["jquery","lodash","taoQtiItem/qtiCreator/editor/ckEditor/dtdHandler","taoQtiItem/qtiCreator/helper/qtiElements"],function(t,e,i,n){"use strict";var a={itemBody:".widget-textBlock > [data-html-editable]",prompt:".qti-prompt[data-html-editable]",choice:".qti-choice [data-html-editable]"},r=function(t,e,i){var r=function(){var t,e={};for(t in i)i.hasOwnProperty(t)&&i[t]instanceof Function&&(e[t]=i[t]);return e}(),o=function(r,o){var s,l,c=t();if(o=o||document.body,o=t(o),n.is(r,"inlineInteraction"))l=o.find(a.itemBody),s="object";else switch(l=o.find(e.values(a).join(",")),l=o.find(a.itemBody),r){case"math":s="object";break;case"object.audio":case"object.video":s="object";break;default:s=r}var d=i.getParentsOf(s),h=d.join(",");return l.each(function(){var e=t(this),i=e.closest(".widget-box");e.is(h)&&(c=c.add(e)),c=c.add(e.find(h).not(function(){var e=t(this).closest(".widget-box");return e.length&&e[0]!==i[0]}))}),c};return e.extend(r,{getTargetsFor:o})}(jQuery,e,i);return r}),define("taoQtiItem/qtiCreator/editor/gridEditor/droppable",["jquery","lodash","taoQtiItem/qtiCreator/helper/gridUnits","taoQtiItem/qtiCreator/helper/qtiElements","taoQtiItem/qtiCreator/editor/gridEditor/helper","taoQtiItem/qtiCreator/editor/gridEditor/arrow","taoQtiItem/qtiCreator/editor/targetFinder"],function(t,e,i,n,a,r,o){var s={};s.createDroppableBlocks=function(n,o,s){s=s||{};var l="string"==typeof s.min?s.min:0,c=s.initialPosition instanceof t?s.initialPosition:null,d=s.namespace?"."+s.namespace:"",m=s.data||{},g=t("<div>",{id:"qti-block-element-placeholder","class":"qti-droppable-block-hover"}),v=parseFloat(o.find('[class^="col-"]:last, [class*=" col-"]:last').css("margin-left")),C=0===o.children(".grid-row").length;o.addClass("dropping"),C?o.append(u().append(p().addClass("col-12"))):o.find(".grid-row").each(function(){var e=t(this),n=[],a=0,r=e.children(":not(.new-col)").each(function(){t(this).before(p().attr("data-index",t(this).index()/2)),a=Math.max(t(this).height(),a),n.push({elt:t(this),units:parseInt(t(this).attr("data-units"))})});r.last().after(p().attr("data-index","last")),r.height(a),e.data("distributed-units",i.distribute(n,l,12)),e.before(u().append(p()))}).last().after(u().append(p()));var I=function(t){t.length&&(g.data("dropped",!0).show().parent().removeClass("col-12").parent().removeData("active"),t.append(g))},b=function(){g.parent().parent().removeData("active"),g.removeData("dropped").hide(),o.append(g)},E=function(i,n){if("left"===n||"right"===n){f(o);var a=i.parent().attr("data-active",!0);a.children(":not(.new-col)").each(function(){t(this).attr("data-original-class",t(this).attr("class"))});var r=a.data("distributed-units"),s="left"===n?i.prev():i.next();if(I(s),r.refactoredTotalUnits>12){var l=s.is(":last-child")&&r.last?r.last:r.middle;s.attr("class","new-col col-"+l);var c=0,d=s.data("index"),h=function(t,e){t.next().attr("data-active",!0).append(e)};if("last"===d)h(a,s);else for(var u in r.cols){u==d&&(c+l>12&&h(a,s),c+=l);var p=r.cols[u];c+p.refactoredUnits>12&&h(a,p.elt),p.elt.attr("class","col-"+p.refactoredUnits),c+=p.refactoredUnits}}else s.is(":last-child")&&r.last?s.attr("class","new-col col-"+r.last):s.attr("class","new-col col-"+r.middle),e.each(r.cols,function(t){t.elt.attr("class","col-"+t.refactoredUnits)});var m=y(i);g.css("height","100%").parent().height(m)}},y=function(e,i){var n=0;void 0===i&&(i=!0),g.css("height","auto").parent().removeAttr("style");var a=e.siblings('[class^="col-"]:not(.new-col), [class*=" col-"]:not(.new-col)').andSelf();return a.removeAttr("style"),a.each(function(){n=Math.max(t(this).height(),n)}),a.height(n),i||e.removeAttr("style"),n};if(b(),c&&c.length){var T=c.prevAll('[class^="col-"], [class*=" col-"]').first(),R=c.nextAll('[class^="col-"], [class*=" col-"]').first();T.length?E(T,"right"):R.length&&E(R,"left")}o.on("mouseover.gridEdit.gridDragDrop",function(){var t=g.parent(".new-col");f(o),y(t,!1);var e=o.find(".new-col:last").css("background","1px solid red");I(e),e.addClass("col-12")}).on("mouseover.gridEdit.gridDragDrop",".grid-row",function(t){t.stopPropagation()}).on("mouseenter.gridEdit.gridDragDrop",'[class^="col-"]:not(.new-col), [class*=" col-"]:not(.new-col)',function(){var e=t(this),i=g.parent(".new-col");b(),f(o),y(i,!1),y(e),r.create(e,{marginWidth:v})}).on("arrowenter.gridEdit.gridDragDrop",'[class^="col-"]:not(.new-col), [class*=" col-"]:not(.new-col)',function(e,i){E(t(this),i)}).on("mousemove.gridEdit.gridDragDrop",'[class^="col-"]:not(.new-col), [class*=" col-"]:not(.new-col)',e.throttle(function(e){var i=t(this),n=i.height(),a=e.pageY-i.offset().top,r=n/2>a?i.parent().prev():i.parent().next();if(!r.find("#qti-block-element-placeholder").length){var o=r.attr("data-active",!0).children(".new-col").addClass("col-12");o.length?I(o):console.log("insert form col failure ",i,r)}},100)).on("mouseleave.gridEdit.gridDragDrop",'[class^="col-"], [class*=" col-"]',function(e){e.stopPropagation(),t(this).find(".grid-edit-insert-box").remove()}).on("mouseleave.gridEdit.gridDragDrop",function(){g.hide(),b(),f(o)}),o.one("dragoverstop.gridEdit",function(){o.off(".gridEdit.gridDragDrop");var e=g.parent(".new-col"),i=!!e.length;i&&(g.removeAttr("id").removeClass("qti-droppable-block-hover"),e.data("qti-class",n).removeClass("new-col").removeAttr("data-index"),a.setUnitsFromClass(e),e.parent(".grid-row-new").removeClass("grid-row-new"),o.find(".grid-row[data-active=true]").each(function(){var e=t(this);e.removeClass("grid-row-new"),e.children(":not(.new-col)").removeAttr("data-original-class").each(function(){a.setUnitsFromClass(t(this))})})),h(o),i&&g.data("dropped")&&o.trigger("dropped.gridEdit"+d,[n,g,m])})};var l=null,c=function(t){l&&clearInterval(l);var e=1e3;setInterval(function(){t.animate({opacity:.1},.5*e,function(){t.animate({opacity:.9},.5*e)})},e)};s.createDroppableInlines=function(e,i,n){var a=n.namespace?"."+n.namespace:"",r=n.data||{},s=o.getTargetsFor(e,i),l=!1;s.addClass("drop-target"),s.contents().each(function(){3!==this.nodeType||this.nodeValue.match(/^\s+$/)||t(this).replaceWith(t.map(this.nodeValue.split(/(\S+)/),function(e){return e.match(/^\s*$/)?document.createTextNode(e):t("<span>",{text:e,"class":"qti-word-wrap"}).get()}))});var h=t("<span>",{id:"qti-inline-element-placeholder","data-inline":!0}).hide();h.append(t("<span>",{"class":"cursor-h"})).append(t("<span>",{"class":"cursor-v"})),c(h);var u=function(t){t.after(h.hide()),l=!1};u(i);var p=function(){return l=!0,h.css("display","inline-block")};i.on("mousemove.gridEdit.gridDragDrop","span.qti-word-wrap",function(e){var i=t(this).width(),n=t(this).offset(),a=e.pageX-n.left;h.show().css("display","inline-block"),i/2>a?t(this).before(p()):t(this).after(p())}).on("mouseover.gridEdit.gridDragDrop",function(e){e.stopPropagation();var n=t(e.target);n.hasClass("drop-target")&&!n.find(h).length?n.append(p()):n[0]===h[0]||n.hasClass("qti-word-wrap")||n.children(".qti-word-wrap").length||u(i)}),i.one("dragoverstop.gridEdit",function(){l&&h.removeAttr("id").removeAttr("class"),d(i),l&&i.trigger("dropped.gridEdit"+a,[e,h,r])})},s.destroyDroppables=function(t){d(t),h(t)};var d=function(e){e.off(".gridEdit.gridDragDrop"),e.find("span.qti-word-wrap, span.qti-droppable").replaceWith(function(){return t(this).text()}),e.find(".drop-target").removeClass("drop-target"),e.find("#qti-inline-element-placeholder").remove()},h=function(t){t.removeClass("dropping").off(".gridEdit.gridDragDrop"),t.find('[class^="col-"], [class*=" col-"]').removeAttr("style"),f(t);var e=["#qti-block-element-placeholder",".new-col",".grid-row-new",".grid-edit-insert-box"];t.find(e.join(",")).remove()},u=function(){return t("<div>",{"class":"grid-row grid-row-new","data-units":0})},p=function(){return t("<div>",{"class":"new-col"})},f=function(e){e.find(".grid-row").each(function(){var e=t(this);if(e.children(".new-col").attr("class","new-col").removeAttr("style"),e.hasClass("grid-row-new")){var i=e.children();i.length>1&&(e.prev().append(i),e.append(i.first()))}e.children(":not(.new-col)").each(function(){var e=t(this),i=e.attr("data-original-class");i&&e.attr("class",i).removeAttr("data-original-class")}),e.removeAttr("data-active")})};return s}),define("taoQtiItem/qtiCreator/editor/gridEditor/draggable",["jquery","lodash","taoQtiItem/qtiCreator/helper/qtiElements","taoQtiItem/qtiCreator/editor/gridEditor/droppable","jqueryui"],function(t,e,i,n){var a={helper:function(){return t(this).clone()}},r=function(t,i,n){var r=e.defaults(n,a);o(t,i,{helper:r.helper,namespace:"insertable"})},o=function(a,r,o){var s=e.defaults(o,{distance:1,helper:"original"});a.draggable({distance:parseInt(s.distance),helper:s.helper,appendTo:r,opacity:1,scroll:!1,cursor:"crosshair",cursorAt:{left:-5,bottom:-5},create:function(){t(this).addClass("grid-draggable")},start:function(e,a){r.trigger("beforedragoverstart.gridEdit"),"function"==typeof s.start&&s.start.call(this,e,a),t(this).removeClass("grid-draggable-active");var o=t(this).data("qti-class");if(i.isInline(o))n.createDroppableInlines(o,r,s);else{if(!i.isBlock(o))throw"undefined qti class";n.createDroppableBlocks(o,r,s)}r.trigger("dragoverstart.gridEdit")},stop:function(e,i){t("body").css("cursor","auto"),i.helper.remove(),"function"==typeof s.stop&&s.stop.call(this,e,i),r.trigger("dragoverstop.gridEdit")}}),a.on("mousedown.gridDraggable.gridEdit",function(){t(this).addClass("grid-draggable-active")}).on("mouseup.gridDraggable.gridEdit",function(){t(this).removeClass("grid-draggable-active")})},s=function(e,i){var n=e.parent('[class^="col-"], [class*=" col-"]');o(e,i,{distance:5,initialPosition:e.parent(),namespace:"movable",start:function(){e.hide(),n.data({"initial-position":!0,"initial-class":n.attr("class")}).attr("class","new-col")},helper:function(){return t(this).clone().addClass("grid-draggable-helper").css({height:t(this).height(),width:t(this).width()})},stop:function(){e.data("grid-element-dropped")||n.attr("class",n.data("initial-class")),e.data("grid-element-dropped",!1),e.show()},data:{widget:e.data("widget")}})},l=function(t){t.draggable("destroy"),t.removeClass("grid-draggable"),t.off(".gridDraggable")};return{createInsertable:function(t,e,i){r(t,e,i)},createMovable:function(t,e,i){s(t,e,i)},destroy:l}}),define("taoQtiItem/qtiCreator/editor/jquery.gridEditor",["jquery","taoQtiItem/qtiCreator/editor/gridEditor/helper","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/editor/gridEditor/draggable","taoQtiItem/qtiCreator/editor/gridEditor/resizable"],function(t,e,i,n,a){function r(t){return"object"==typeof t.data("qti-grid-options")}function o(i,n){i.data("qti-grid-options",n),i.find(".grid-row").each(function(){var i=0;t(this).children('[class*=" col-"], [class^="col-"]').each(function(){i+=e.setUnitsFromClass(t(this))})})}function s(t){i.destroyGridWidgets(t)}function l(t){return i.getContent(t)}t.fn.gridEditor=function(e){var i={},n="",a=[],s=void 0;return"object"==typeof e?i=t.extend({},t.fn.gridEditor.defaults,e):void 0===e?i=t.extend({},t.fn.gridEditor.defaults):"string"==typeof e&&"function"==typeof c[e]&&(n=e,a=Array.prototype.slice.call(arguments,1)),this.each(function(){var e=t(this);n?r(e)?s=c[n].apply(t(this),a):t.error("call of method of gridEditor while it has not been initialized"):r(e)||"object"!=typeof i||o(e,i)}),void 0===s?this:s},t.fn.gridEditor.defaults={elementClass:"itemBody"};var c={addInsertables:function(e,i){var a=t(this);e.each(function(){n.createInsertable(t(this),a,i)})},createMovables:function(e){var i=t(this);e.each(function(){n.createMovable(t(this),i)})},destroy:function(){s(t(this))},getContent:function(){return l(t(this))},setContent:function(e){e&&setContent(t(this),e)},resizable:function(){a.create(t(this))}}}),define("taoQtiItem/qtiCreator/editor/widgetToolbar",["jquery","i18n"],function(t,e){"use strict";var i=[[{title:"Question","class":"question-trigger",status:"off",fn:function(){var t=arguments[1],e=arguments[2],i=e.find(".answer-trigger a"),n=t.find('[data-edit="answer"]'),a=t.find('[data-edit="question"]');i.removeClass("tlb-text-button-on").addClass("tlb-text-button-off"),a.show(),n.hide(),t.data("mode","question")}},{title:"Answer","class":"answer-trigger",fn:function(){var e=arguments[1],i=arguments[2],n=i.find(".question-trigger a"),a=e.find('[data-edit="answer"]'),r=e.find('[data-edit="question"]');n.removeClass("tlb-text-button-on").addClass("tlb-text-button-off"),a.show(),r.hide(),e.data("mode","answer"),e.find("[contenteditable]").attr("contenteditable",!1),t(document).trigger("widgetBlur")}}],"spacer",[{icon:"bin",title:"Delete",fn:function(){var i=arguments[1],n=arguments[2],a=t("<span>",{text:e("You have deleted an element.")+" "}),r=t("<a>",{text:e("Undo"),href:"#"}),o=t("<span>",{"class":"icon-info"}),s=t("<span>",{title:"Remove Message","class":"icon-close close-trigger"}),l=t("<div>",{"class":"feedback-info"}).hide();s.on("click",function(){l.fadeOut(function(){l.remove(),i.remove(),n.remove()})}),r.on("click",function(t){t.preventDefault(),l.remove(),i.removeClass("deleted").fadeIn()}),l.append(o),l.append(a),l.append(r),l.append(s),i.before(l),n.hide(),i.hide().addClass("deleted"),l.fadeIn(function(){setTimeout(function(){s.trigger("click")},6500)})}}]],n=function(e){switch(e){case"/":e="break";break;case"-":e="separator";break;case" ":e="spacer"}return t("<span>",{"class":"tlb-"+e})},a=function(e,i,a){var o,s,l=t("<div>",{"class":"tlb-bar"}),c=!e[0].icon,d=e.length;if(l.append(n("start")),c)for(s=0;d>s;s++)"string"===t.type(e[s])?l.append(n(e[s])):(e[s].target=i,e[s].toolbar=a,l.append(r(e[s],c)));else for(o=t("<div>",{"class":"tlb-group"}),l.append(o),s=0;d>s;s++)"string"===t.type(e[s])?o.append(n(e[s])):(e[s].target=i,e[s].toolbar=a,o.append(r(e[s],c)));return l.append(n("end")),l},r=function(i,n){var a,r,o,s,l,c=i.status||"off",d=i.fn||function(){},h=i.target||t(),u=i.toolbar||t();return delete i.status,delete i.fn,delete i.target,delete i.toolbar,n?(l=e(i.title),delete i.title,i["class"]=i["class"]?i["class"]+" tlb-text-button-box":"tlb-text-button-box",o=t("<span>",i),a=t("<a>",{"class":"tlb-text-button-"+c}),r=t("<span>",{"class":"tlb-text",text:l}),o.append(a),a.append(r)):(s="icon-"+i.icon.replace("icon-",""),delete i.icon,i["class"]=i["class"]?i["class"]+" tlb-button-"+c:"tlb-button-"+c,o=t("<a>",i),r=t("<span>",{"class":s}),o.append(r)),o.on("click.toolbar",function(t){return o.hasClass("tlb-text-button-disabled")||o.hasClass("tlb-button-disabled")?!1:(n?o.find("a").toggleClass("tlb-text-button-off").toggleClass("tlb-text-button-on"):o.toggleClass("tlb-button-off").toggleClass("tlb-button-on"),void d.apply(this,[t,h,u]))}),o},o=function(e,n){return t.isArray(e)&&!e.length&&(e=!1),e?n&&(e=t.extend(i,e)):e=i,e},s=function(e,i,r){var o,s=t("<div>",{"class":"tlb"}),l=t("<div>",{"class":"tlb-top"}),c=t("<div>",{"class":"tlb-box"}),d=e.length;for(l.append(c),s.append(l),o=0;d>o;o++)c.append("string"===t.type(e[o])?n(e[o]):a(e[o],i,r));return s.data("edit","toolbar"),s};return function(){var e=function(e,i){var n,a,r,l={offsetTop:-2,title:"",extendDefaultConfig:!1,target:t()},c=t(i.target),d=c.prop("tlb")||t("<div>",{"class":"tlb-wrapper"});return c.prop("tlb")||(e=o(e,i.extendDefaultConfig),i=t.extend(l,i||{}),n=s(e,c,d),i.title&&(a=t("<span>",{text:i.title,"class":"tlb-title",title:i.title}),d.append(a)),d.append(n),c.prop("tlb",d),c.append(d),d.css("position","absolute"),d.css("display","none"),d.css("width","100%"),r=l.offsetTop-d.height(),d.css("top",r)),d.fadeIn(),d};return{attach:e}}()}),define("tpl!taoQtiItem/qtiCreator/tpl/container",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a,r="";return r+='<div data-html-editable="true">',(a=i.body)?n=a.call(t,{hash:{},data:e}):(a=t&&t.body,n=typeof a===d?a.call(t,{hash:{},data:e}):a),(n||0===n)&&(r+=n),r+="</div>"}function o(t,e){var n,a,r="";return(a=i.body)?n=a.call(t,{hash:{},data:e}):(a=t&&t.body,n=typeof a===d?a.call(t,{hash:{},data:e}):a),(n||0===n)&&(r+=n),r}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var s,l,c,d="function",h=this,u=i.helperMissing;return l=i.equal||e&&e.equal,c={hash:{},inverse:h.program(3,o,a),fn:h.program(1,r,a),data:a},s=l?l.call(e,e&&e.contentModel,"blockStatic",c):u.call(e,"equal",e&&e.contentModel,"blockStatic",c),s||0===s?s:""})}),define("taoQtiItem/qtiCreator/renderers/Container",["tpl!taoQtiItem/qtiCreator/tpl/container"],function(t){return{qtiClass:"_container",template:t}}),define("taoQtiItem/qtiCreator/widgets/Widget",["lodash","jquery","taoQtiItem/qtiItem/core/Element"],function(t,e,i){var n=function(t,e){var i=new t.registeredStates[e](t);t.stateStack.push(i),i.init()},a=function(t){var e=t.stateStack.pop();e&&e.exit()},r={init:function(e,n,a,r){if(!(e instanceof i))throw new Error("element is not a QTI Element");return r=r||{},this.element=e,this.serial=e.getSerial(),this.$original=n,this.$form=a,this.stateStack=[],this.registeredStates={},this.buildContainer(),this.$container.data("widget",this),this.$original.data("widget",this),this.element.data("widget",this),this.offEvents(),t.each(this.getRequiredOptions(),function(t){if(!r[t])throw new Error("missing required option for image creator : "+t)}),this.options=r,this.initCreator(r),this.changeState(r.state?r.state:"sleep"),t.isFunction(r.ready)&&r.ready.call(this,this),this},getRequiredOptions:function(){return[]},buildContainer:function(){throw new Error("method buildContainer must be implemented")},build:function(t,e,i,n){return this.clone().init(t,e,i,n)},clone:function(){return t.clone(this)},initCreator:function(){},getCurrentState:function(){return t.last(this.stateStack)},changeState:function(e){var i,r,o=this,s=this.getCurrentState();if(!this.registeredStates[e])throw new Error("unknown target state : "+e);if(i=new this.registeredStates[e],s){if(s.name===i.name)return this;
if(t.indexOf(i.superState,s.name)>=0)for(var l=t.indexOf(i.superState,s.name)-1;l>=0;l--)r=i.superState[l],n(this,r);else{if(t.indexOf(s.superState,i.name)>=0){for(var l=0;l<=t.indexOf(s.superState,i.name);l++)a(o);return this}a(o);var c=t.difference(s.superState,i.superState);t.each(c,function(){a(o)});var d=t.difference(i.superState,s.superState);t.eachRight(d,function(t){n(o,t)})}}else t.eachRight(i.superState,function(t){n(o,t)});return n(this,e),this},registerState:function(t,e){if(!t||!e)throw new Error("missing required arguments in state registration");this.registeredStates[t]=e},registerStates:function(e){var i=this;t.forIn(e,function(t,e){i.registerState(e,t)})},afterStateInit:function(t,i){var n="afterStateInit.qti-widget."+this.serial+(i?"."+i:"");e(document).on(n,t)},beforeStateInit:function(t,i){var n="beforeStateInit.qti-widget."+this.serial+(i?"."+i:"");e(document).on(n,t)},beforeStateExit:function(t,i){var n="beforeStateExit.qti-widget."+this.serial+(i?"."+i:"");e(document).on(n,t)},offEvents:function(t){var i=".qti-widget."+this.serial+(t?"."+t:"");e(document).off(i)},destroy:function(){this.changeState("sleep"),this.$container.find("[data-edit]").remove(),this.offEvents()},rebuild:function(e){e=e||{};var i=this.element,n={};t.isFunction(e.ready)&&(n.ready=e.ready);var a=null;a=e.context&&e.context.length?e.context.find(".widget-box[data-serial="+i.serial+"]"):this.$container,this.destroy();var r=i.getRenderer();if(r&&r.isRenderer){if("creatorRenderer"===r.name)return i.render(a),i.postRender(n);throw new Error("The renderer is no longer the creatorRenderer")}throw new Error("No renderer found to rebuild the widget")},on:function(t,i,n){var a=this,r=[t,"qti-widget",this.serial];return n||r.push(this.getCurrentState().name),e(document).on(r.join("."),function(t,e){i.call(a,e)}),this}};return r}),define("taoQtiItem/qtiCreator/widgets/static/Widget",["jquery","taoQtiItem/qtiCreator/widgets/Widget","taoQtiItem/qtiCreator/editor/widgetToolbar"],function(t,e){var i=e.clone();return i.initCreator=function(){e.initCreator.call(this),this.createToolbar()},i.buildContainer=function(){var e=t("<div>",{"data-serial":this.element.serial,"class":"widget-box"});this.$original.wrap(e),this.$container=this.$original.parent()},i.createToolbar=function(){return this},i.createOkButton=function(){var e=this;this.$container.append(t("<button>",{"class":"btn-info small",type:"button",text:"OK","data-edit":"active"}).css({margin:"5px 10px",display:"none"}).on("click.qti-widget",function(t){t.stopPropagation(),e.changeState("sleep")}))},i}),define("taoQtiItem/qtiCreator/widgets/states/factory",["lodash"],function(t){var e=function(e){return t.isFunction(e)?e.prototype.name&&e.prototype.superState?t.isFunction(e.prototype.init)&&t.isFunction(e.prototype.exit)?!0:!1:!1:!1},i=function(t,e,i,n){var a=function(t){this.widget=t};return a.prototype.name=t,a.prototype.superState=e||[],i&&n&&(a.prototype.init=function(){var e=this.widget.$container;e.data("edit")===t&&e.show();var n=e.find('[data-edit="'+t+'"]').filter(function(){var t=$(this).closest(".widget-box");return t.length&&t[0]===e[0]?!0:!1});n.show(),this.widget.$container.addClass("edit-"+t),$(document).trigger("beforeStateInit.qti-widget",[this.widget.element,this]),i.call(this),$(document).trigger("afterStateInit.qti-widget",[this.widget.element,this])},a.init=i,a.prototype.exit=function(){this.widget.$container.data("edit")===t&&this.widget.$container.hide(),this.widget.$container.find('[data-edit="'+t+'"]').hide(),this.widget.$container.removeClass("edit-"+t),$(document).trigger("beforeStateExit.qti-widget",[this.widget.element,this]),$(document).off([".qti-widget",t,this.widget.serial].join(".")),n.call(this),$(document).trigger("afterStateExit.qti-widget",[this.widget.element,this])},a.exit=n),a};return{create:function(){var n,a,r,o,s;if(t.isString(arguments[0]))if(a=arguments[0],t.isArray(arguments[1])){if(r=arguments[1],!t.isFunction(arguments[2])||!t.isFunction(arguments[3]))throw new Error("the third and fourth arguments are expected to be functions: init() & exit()");o=arguments[2],s=arguments[3],n=i(a,r,o,s)}else{if(r=[],!t.isFunction(arguments[1])||!t.isFunction(arguments[2]))throw new Error("the second and third arguments are expected to be functions: init() & exit()");o=arguments[1],s=arguments[2],n=i(a,r,o,s)}else{if(!e(arguments[0]))throw new Error("invalid first argument : expected the state name (string) or a State (function)");if(a=arguments[0].prototype.name,r=arguments[0].prototype.superState,!t.isFunction(arguments[1])||!t.isFunction(arguments[2]))throw new Error("the second and third arguments are expected to be functions: init() & exit()");o=arguments[1],s=arguments[2],n=i(a,r,o,s)}return n},extend:function(n,a,r){var o,s,l=null;if(!e(n))throw new Error("invalid state to be cloned");return t.isFunction(a)&&(o=function(){n.init.call(this),a.call(this)}),t.isFunction(r)&&(s=function(){r.call(this),n.exit.call(this)}),l=i(n.prototype.name,n.prototype.superState,o,s),t.forIn(n.prototype,function(e,i){if(t.isFunction(e)){if(o&&"init"===i||s&&"exit"===i)return!0;l.prototype[i]=e,l[i]=e}}),l},createBundle:function(){var i={},n=[],a=[];return arguments.length>=2?(i=t.clone(arguments[0]),n=arguments[1],a=arguments[2]||a):n=arguments[0],t.each(n,function(t){e(t)&&(i[t.prototype.name]=t)}),t.each(a,function(t){delete i[t]}),i},throwMissingRequiredImplementationError:function(t){throw new Error("Missing required implementation of the function "+t+"()")}}}),define("taoQtiItem/qtiCreator/widgets/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory"],function(t){return t.create("sleep",function(){var t=this.widget.$container;t.on("mouseenter.sleep",function(){t.addClass("hover"),t.parent().trigger("mouseleave")}).on("mouseleave.sleep",function(){t.removeClass("hover"),t.parent().trigger("mouseenter")})},function(){this.widget.$container.removeClass("hover").off(".sleep")})}),define("taoQtiItem/qtiCreator/widgets/static/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Sleep"],function(t,e){var i=t.extend(e,function(){var t=this.widget;t.$container.on("click.qti-widget.sleep",function(e){e.stopPropagation(),t.changeState("active")})},function(){var t=this.widget;t.$container.off(".sleep")});return i}),define("taoQtiItem/qtiCreator/widgets/helpers/content",["jquery","lodash","taoQtiItem/qtiCreator/helper/creatorRenderer","taoQtiItem/qtiCreator/model/helper/container","taoQtiItem/qtiCreator/editor/gridEditor/content"],function(t,e,i,n,a){var r={};return r.createElements=function(e,r,o,s){var l=t("<div>").html(o);n.createElements(e,a.getContent(l),function(t){i.get().load(function(){for(var e in t){var i,n,a=t[e],o=r.find(".widget-box[data-new][data-qti-class="+a.qtiClass+"]");a.setRenderer(this),a.render(o),n=a.postRender(),i=n.$original,i.trigger("contentChange.gridEdit"),s(n)}},this.getUsedClasses())})},r.changeInnerWidgetState=function(i,n){var a=[];e.each(["img","math","object"],function(t){a.push("[data-html-editable] .widget-"+t)}),i.$container.find(a.join(",")).each(function(){var e=t(this).data("widget");e&&e.changeState(n)})},r}),define("taoQtiItem/qtiCreator/widgets/states/Active",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/helpers/content"],function(t,e,i){return e.create("active",function(){var e=this.widget,i=e.$container[0],n=this.widget.element.getRelatedItem();t("#item-editor-panel").on("click.active",function(n){i===n.target||t.contains(i,n.target)||e.changeState("sleep")}).on("styleedit.active",function(){e.changeState("sleep")}),n&&n.data("widget").$container.on("resizestart.gridEdit.active beforedragoverstart.gridEdit.active",function(){e.changeState("sleep")})},function(){i.changeInnerWidgetState(this.widget,"sleep"),this.widget.$container.off(".active"),t("#item-editor-panel").off(".active");var e=this.widget.element.getRelatedItem();e&&e.data("widget").$container.off(".active")})}),define("taoQtiItem/qtiCreator/widgets/static/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Active"],function(t,e){return t.extend(e,function(){var t=this.widget,e=t.$container;t.beforeStateInit(function(e,i,n){var a=i.getSerial();"active"===n.name&&a!==t.serial&&t.changeState("sleep")},"otherActive"),e.on("mouseenter.active",function(t){t.stopPropagation(),e.parent().trigger("mouseleave.sleep")}).on("mouseleave.active",function(t){t.stopPropagation(),e.parent().trigger("mouseenter.sleep")}).on("click.active",function(t){t.stopPropagation()})},function(){this.widget.$container.off(".active"),$("#item-editor-panel").off(".active"),this.widget.offEvents("otherActive")})}),define("taoQtiItem/qtiCreator/widgets/states/Inactive",["taoQtiItem/qtiCreator/widgets/states/factory"],function(t){return t.create("inactive",function(){},function(){})}),define("tpl!taoQtiItem/qtiCreator/tpl/notifications/deletingInfoBox",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a,r="";return r+="\n        "+u((n=i.__||t&&t.__,a={hash:{},data:e},n?n.call(t,"You have deleted an element",a):h.call(t,"__","You have deleted an element",a)))+".\n    "}function o(t,e){var n,a,r,o="";return o+="\n        "+u((a=i.__||t&&t.__,r={hash:{},data:e},a?a.call(t,"You have deleted",r):h.call(t,"__","You have deleted",r)))+" ",(a=i.count)?n=a.call(t,{hash:{},data:e}):(a=t&&t.count,n=typeof a===p?a.call(t,{hash:{},data:e}):a),o+=u(n)+" "+u((a=i.__||t&&t.__,r={hash:{},data:e},a?a.call(t,"elements",r):h.call(t,"__","elements",r)))+".\n    "}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var s,l,c,d="",h=i.helperMissing,u=this.escapeExpression,p="function",f=this;return d+='<div class="feedback-info popup" data-for="',(l=i.serial)?s=l.call(e,{hash:{},data:a}):(l=e&&e.serial,s=typeof l===p?l.call(e,{hash:{},data:a}):l),d+=u(s)+'">\n    <span class="icon-info"></span>\n    ',l=i.equal||e&&e.equal,c={hash:{},inverse:f.program(3,o,a),fn:f.program(1,r,a),data:a},s=l?l.call(e,e&&e.count,1,c):h.call(e,"equal",e&&e.count,1,c),(s||0===s)&&(d+=s),d+='\n    <a class="undo" href="#">'+u((l=i.__||e&&e.__,c={hash:{},data:a},l?l.call(e,"undo",c):h.call(e,"__","undo",c)))+'</a>\n    <span title="'+u((l=i.__||e&&e.__,c={hash:{},data:a},l?l.call(e,"Remove Message",c):h.call(e,"__","Remove Message",c)))+'" class="icon-close close-trigger"></span>\n</div>'})}),define("taoQtiItem/qtiCreator/widgets/helpers/deletingState",["lodash","jquery","tpl!taoQtiItem/qtiCreator/tpl/notifications/deletingInfoBox"],function(t,e,i){var n=1e4,a=function(t){var i=setTimeout(function(){r(t,1e3)},n);e("body").on("mousedown.deleting",function(i){i.target===t[0]||e.contains(t[0],i.target)||r(t,400)}),t.find("a.undo").on("click",function(e){e.preventDefault(),t.trigger("undo.deleting"),clearTimeout(i),t.remove()}),t.find(".close-trigger").on("click",function(e){e.preventDefault(),r(t,0)})},r=function(t,i){t.trigger("confirm.deleting"),t.fadeOut(i,function(){e(this).remove()})},o={createInfoBox:function(n){var o=e(i({serial:"widgets",count:n.length}));return e("body").append(o),o.css({display:"block",position:"fixed",top:"50px",left:"50%","margin-left":"-200px",width:"400px",zIndex:999999}),a(o),t.each(n,function(t){t.on("beforeStateInit",function(){r(o,400)})}),o}};return o}),define("taoQtiItem/qtiCreator/widgets/states/Deleting",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/helpers/deletingState","taoQtiItem/qtiCreator/helper/gridUnits","taoQtiItem/qtiCreator/editor/gridEditor/helper","taoQtiItem/qtiCreator/editor/gridEditor/content","lodash"],function(t,e,i,n,a,r){var o=t.create("deleting",function(){this.refactoredUnits=[],this.$elementToRemove=this.getElementToRemove(),this.hideWidget(),this.showMessage(this.widget.element)},function(){this.showWidget(),$("body").off(".deleting")});o.prototype.getElementToRemove=function(){var t=this.widget.$container;if(t.hasClass("qti-choice")){if("TH"!==t.prop("tagName"))return t;if("THEAD"===t.parent().parent().prop("tagName")){var e=t.closest("table.matrix").children("tbody"),i=e.children("tr").find("td:last");return t.add(i)}if("TBODY"===t.parent().parent().prop("tagName"))return t.parent()}if(t.hasClass("widget-inline"))return t.add(this.widget.$original);var n=t.parent(),a=n.parent(".grid-row");return a.length?1===a.children().length?a:n:t.hasClass("grid-row")?t:void 0},o.prototype.hideWidget=function(){var t=this.$elementToRemove;t.length&&(t.hide(),s(t)&&(this.refactoredUnits=l(t)))};var s=function(t){var e=t.attr("class");return e&&/col-([\d]+)/.test(e)},l=function(t){var e=t.data("units"),a=t.siblings(),o=[];return a.each(function(){var t=$(this),i=t.data("units");o.push({elt:t,units:i}),e+=i}),o=i.redistribute(o),r.each(o,function(t){t.elt.removeClass("col-"+t.units).addClass("col-"+t.refactoredUnits),n.setUnitsFromClass(t.elt)}),t.data("redistributedUnits",o),o};return o.prototype.showWidget=function(){var t=this.$elementToRemove;t.length&&(t.show(),s(t)&&r.each(this.refactoredUnits,function(t){t.elt.removeClass("col-"+t.refactoredUnits).addClass("col-"+t.units),n.setUnitsFromClass(t.elt)}))},o.prototype.showMessage=function(){var t=this,i=this.widget,n=e.createInfoBox([i]);n.on("confirm.deleting",function(){t.deleteElement()}).on("undo.deleting",function(){try{i.changeState("question")}catch(t){i.changeState("active")}}),this.messageBox=n},o.prototype.deleteElement=function(){var t=this.$elementToRemove.hasClass("grid-row");if(this.widget.destroy(),this.$elementToRemove.remove(),this.widget.element.remove(),t){var e=this.widget.element.getRelatedItem(),i=e.data("widget").$container.find(".qti-itemBody");e.body(a.getContent(i))}},o}),define("taoQtiItem/qtiCreator/widgets/static/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep","taoQtiItem/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCreator/widgets/states/Inactive","taoQtiItem/qtiCreator/widgets/states/Deleting"],function(t){return t.createBundle(arguments)}),define("taoQtiItem/qtiCreator/widgets/static/img/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep"],function(t,e){var i=t.extend(e,function(){},function(){});return i}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/img",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s,l="",c=i.helperMissing,d=this.escapeExpression,h="function";return l+='<div class="panel">\n    <label for="src">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"File",s):c.call(e,"__","File",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"The file path to the image.",s):c.call(e,"__","The file path to the image.",s)))+'</div>\n    <input type="text" name="src" value="',(o=i.src)?r=o.call(e,{hash:{},data:a}):(o=e&&e.src,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(o=i.baseUrl)?r=o.call(e,{hash:{},data:a}):(o=e&&e.baseUrl,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+')"/>\n    <button class="btn-info small block" data-role="upload-trigger">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Select image",s):c.call(e,"__","Select image",s)))+'</button>\n</div>\n\n<div class="panel">\n    <label for="alt">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Label",s):c.call(e,"__","Label",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"The text to be displayed if the image is not available.",s):c.call(e,"__","The text to be displayed if the image is not available.",s)))+'</div>\n    <input type="text" name="alt" value="',(o=i.alt)?r=o.call(e,{hash:{},data:a}):(o=e&&e.alt,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-validate="$notEmpty" placeholder="e.g. House with a garden"/>\n</div>\n\n\n<div data-role="advanced" style="display:none">\n    <div class="panel">\n        <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Size and position",s):c.call(e,"__","Size and position",s)))+'</h3>\n\n        <!--not available yet-->\n        <!--    <label>\n        <input name="responsive" type="checkbox" />\n        <span class="icon-checkbox"></span>\n        '+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Adapt to item size",s):c.call(e,"__","Adapt to item size",s)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n        Recommended.\n        Define whether the image size should automatically adapt to item size.\n        If this option is active, the image width and height will be a percentage of its text container.\n    </span>-->\n\n        <p class="img-resizer-slider"></p>\n\n        <label for="height">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Height (optional)",s):c.call(e,"__","Height (optional)",s)))+'</label>\n        <span id="item-editor-font-size-manual-input" class="item-editor-unit-input-box">\n            <input type="text" name="height" value="',(o=i.height)?r=o.call(e,{hash:{},data:a}):(o=e&&e.height,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-validate="$numeric"/>\n            <span class="unit-indicator">px</span>\n        </span>\n    </div>\n    <div class="panel">\n\n        <label for="width">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Width (optional)",s):c.call(e,"__","Width (optional)",s)))+'</label>\n        <span id="item-editor-font-size-manual-input" class="item-editor-unit-input-box">\n            <input type="text" name="width" value="',(o=i.width)?r=o.call(e,{hash:{},data:a}):(o=e&&e.width,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-validate="$numeric"/>\n            <span class="unit-indicator">px</span>\n        </span>\n    </div>\n    <div class="panel">\n\n        <label for="align">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Alignment (optional)",s):c.call(e,"__","Alignment (optional)",s)))+'</label>\n        <select name="align" class="select2" data-has-search="false">\n            <option value="default">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"default",s):c.call(e,"__","default",s)))+'</option>\n            <option value="left">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"left",s):c.call(e,"__","left",s)))+'</option>\n            <option value="right">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"right",s):c.call(e,"__","right",s)))+"</option>\n        </select>\n    </div>\n</div>\n"})}),define("taoQtiItem/qtiCreator/widgets/helpers/validators",["core/validator/validators","lodash","i18n","taoQtiItem/qtiItem/core/Element"],function(t,e,i,n){var a=/^[_a-zA-Z]{1}[a-zA-Z0-9\-._]{0,31}$/i,r=[{name:"qtiIdentifier",message:i("invalid identifier"),validate:function(t,e){"function"==typeof e&&e(a.test(t))}},{name:"availableIdentifier",message:i("this identifier is already in use"),validate:function(t,e,i){if(!i.serial)throw'missing required option "serial"';var a=n.getElementBySerial(i.serial);if(a&&"function"==typeof e){var r=a.getRelatedItem().getUsedIdentifiers(),o=!r[t]||r[t].serial===a.serial;e(o)}}}];return e.each(r,function(e){t.register(e.name,e)}),t}),define("taoQtiItem/qtiCreator/widgets/helpers/formElement",["lodash","taoQtiItem/qtiItem/core/Element","ui/incrementer","ui/tooltipster","ui/selecter","ui/inplacer","ui/groupvalidator","taoQtiItem/qtiCreator/widgets/helpers/validators","polyfill/placeholders"],function(t,e,i,n,a){var r={initWidget:function(t){i(t),n(t),a(t)},initDataBinding:function(e,i,n){n=n||{};var a=function(e,a,r){var o=n[e];t.isFunction(o)&&o.call(r[0],i,a,e)},r={simple:function(){var t=$(this),e=t.attr("name");t.is(":checkbox")?a(e,t.prop("checked"),t):a(e,t.val(),t)},withValidation:function(t,e,i){if("group"===t.namespace){var n=$(i),r=n.attr("name");e&&a(r,n.val(),n)}}};e.off(".databinding"),e.on("change.databinding keyup.databinding",":checkbox, :radio, select, :text:not([data-validate])",r.simple),e.on("keyup.databinding input.databinding propertychange.databinding","textarea",r.simple),e.groupValidator({events:["change","blur",{type:"keyup",length:0}],callback:s}),e.on("validated.group.databinding",r.withValidation)},initTitle:function(t,e){var i=t.hasClass("qti-title")?t:t.find(".qti-title");i.inplacer({target:$("#qti-title")}),i.on("change",function(){e.attr("title",$(this).text())})},getAttributeChangeCallback:function(t){return function(e,i,n){t||""!==i?e.attr(n,i):e.removeAttr(n)}},getMinMaxAttributeCallbacks:function(t,i,n,a){var r=t.find("input[name="+n+"]"),s={};return s[i]=function(t,e,i){var n={min:null};if(""===e)t.removeAttr(i);else{e=parseInt(e),t.attr(i,e),n.min=e;var a=parseInt(r.val());e>a&&r.val(e)}r.incrementer("options",n).keyup()},s[n]=function(t,i,n){i=i||0,i=parseInt(i),e.isA(t,"interaction")&&o(t,i,a),t.attr(n,i)},s}},o=function(i,n,a){if(!e.isA(i,"interaction"))throw new Error("the first argument must be an interaction, the current element is "+i.qtiClass);a=void 0===a?!0:!!a;var r=i.getResponseDeclaration();if(a&&r.attr("cardinality",1===n?"single":"multiple"),n){var o=[];t.each(r.getCorrect(),function(t){return o.length<n?void o.push(t):!1}),r.setCorrect(o)}},s=function(e,i){var n,a=$(this);l(a),a.tooltipster("hide"),e||(n=t.where(i,{type:"failure"})[0],n&&n.data.message&&(a.tooltipster("content",n.data.message),a.tooltipster("show")))},l=function(t){t.hasClass("tooltipstered")||t.tooltipster({theme:"tao-error-tooltip",content:"",delay:350,trigger:"custom"})};return r}),define("taoQtiItem/qtiCreator/helper/dummyElement",["jquery","lodash"],function(t,e){var i=function(){var i={maths:{icon:"maths",css:{width:40,height:22}},image:{icon:"image",css:{width:50,height:35}},video:{icon:"video",css:{width:200,height:150}},media:{icon:"media",css:{width:150,height:100}}},n=function(n){var a,r,o,s,l,c={element:"span","class":"dummy-element",css:{width:80,height:22}};return n&&(t.isPlainObject(n)?(n.class&&(c.class+=" "+n.class,delete n.class),c=t.extend(!0,{},c,n)):i[n]&&(c=t.extend({},c,i[n]))),o=c.icon?t("<span>",{"class":"icon-"+c.icon.replace("icon-","")}):!1,a="<"+c.element+">",s=e.cloneDeep(c.css),s["font-size"]=s.height&&!s["font-size"]?.8*s.height:14,s.height>30&&(s["padding-top"]=(s.height-s["font-size"])/2*.9),s.height&&s.height>100&&(s["background-size"]="auto"),l=e.cloneDeep(c),delete l.icon,delete l.element,delete l.css,r=t(a,l).css(s),o&&r.append(o),r};return{get:n}}();return i}),define("taoQtiItem/qtiCreator/widgets/static/helpers/inline",["lodash","taoQtiItem/qtiCreator/helper/dummyElement"],function(t,e){var i={math:"maths",img:"image",object:"media"};return{togglePlaceholder:function(n,a){var r=t.defaults(a||{},{container:n.$original,type:n.element.qtiClass}),o=r.container,s=o.siblings(".dummy-element");if(n.element.isEmpty()){o.hide();var l=i[r.type]||r.type;s.length||(s=e.get(l),o.after(s)),s.show()}else o.show(),s.hide();n.$container.trigger("contentChange.qti-widget")},positionFloat:function(t,e){var i=t.$container,n=t.element;switch(i.removeClass("rgt lft"),n.removeClass("rgt"),n.removeClass("lft"),e){case"right":i.addClass("rgt"),n.addClass("rgt");break;case"left":i.addClass("lft"),n.addClass("lft")}}}}),define("util/image",[],function(){return{getSize:function(t,e,i){var n,a=document.createElement("img");"function"==typeof e&&(i=e,e=2),a.onload=function(){n&&(clearTimeout(n),i({width:a.naturalWidth||a.width,height:a.naturalHeight||a.height}))},a.onerror=function(){n&&(clearTimeout(n),i(null))},n=setTimeout(function(){i(null)},1e3*e),a.src=t}}}),define("taoQtiItem/qtiCreator/widgets/static/img/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","tpl!taoQtiItem/qtiCreator/tpl/forms/static/img","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/static/helpers/inline","lodash","util/image","helpers","ui/resourcemgr","nouislider"],function(t,e,i,n,a,r,o){var s=t.extend(e,function(){this.initForm()},function(){this.widget.$form.empty()}),l=function(t,e){var i=r.debounce(function(t,e,i){t.attr(i,e)},1e3);return r.throttle(function(n,a,r){t[e](a),i(n,a,r),t.trigger("contentChange.qti-widget")},100)};s.prototype.initForm=function(){var t=this.widget,e=t.$original,r=t.$form,o=t.element,s=t.options.baseUrl,p=!0;r.html(i({baseUrl:s||"",src:o.attr("src"),alt:o.attr("alt"),height:o.attr("height")||0,width:o.attr("width")||0,responsive:p})),h(t),d(t),c(t),u(t),n.initWidget(r),n.initDataBinding(r,o,{src:function(i,n){i.attr("src",n),n.match(/^http/i)||(n=s+"/"+n),e.attr("src",n),a.togglePlaceholder(t),d(t),h(t)},alt:n.getAttributeChangeCallback(),longdesc:n.getAttributeChangeCallback(),align:function(e,i){a.positionFloat(t,i)},height:l(e,"height"),width:l(e,"width")})};var c=function(t){var e="default";t.element.hasClass("rgt")?e="right":t.element.hasClass("lft")&&(e="left"),a.positionFloat(t,e),t.$form.find("select[name=align]").val(e)},d=function(t){var e=t.$container,i=t.$form,n=i.find(".img-resizer-slider"),a=t.element,o=e.find("img"),s=i.find("[name=height]"),l=i.find("[name=width]"),c={h:a.attr("height")||o.height(),w:a.attr("width")||o.width()};n.noUiSlider({range:{min:10,max:200},start:100},n.hasClass("noUi-target")),n.off("slide").on("slide",r.throttle(function(t,e){var i=e/100,n=parseInt(i*c.w),a=parseInt(i*c.h);l.val(n).change(),s.val(a).change()},100))},h=function(t){var e=t.$form,i=t.element.attr("src");i?e.find("[data-role=advanced]").show():e.find("[data-role=advanced]").hide()},u=function(t){var e=t.$form,i=t.options,n=e.find('[data-role="upload-trigger"]'),a=e.find("input[name=src]"),r=e.find("input[name=width]"),s=e.find("input[name=height]");n.on("click",function(){n.resourcemgr({appendContainer:i.mediaManager.appendContainer,root:"/",browseUrl:i.mediaManager.browseUrl,uploadUrl:i.mediaManager.uploadUrl,deleteUrl:i.mediaManager.deleteUrl,downloadUrl:i.mediaManager.downloadUrl,params:{uri:i.uri,lang:i.lang,filters:"image/jpeg,image/png,image/gif"},pathParam:"path",select:function(t,e){var n,l=e.length;for(n=0;l>n;n++){o.getSize(i.baseUrl+e[n].file,function(t){t&&t.width>=0&&(r.val(t.width).trigger("change"),s.val(t.height).trigger("change")),a.val(e[n].file).trigger("change")});break}}})})};return s}),define("taoQtiItem/qtiCreator/widgets/static/img/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/img/states/Sleep","taoQtiItem/qtiCreator/widgets/static/img/states/Active"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/static/helpers/widget",["jquery","lodash"],function(t,e){var i={buildInlineContainer:function(e){var i="";e.element.hasClass("lft")?i=" lft":e.element.hasClass("rgt")&&(i=" rgt");var n=t("<span>",{"data-serial":e.element.serial,"class":"widget-box widget-inline widget-"+e.element.qtiClass+i,"data-qti-class":e.element.qtiClass});e.$container=e.$original.wrap(n).parent();var a=e.$container[0].nextSibling;a&&(a.nodeValue=" "+a.nodeValue)},buildBlockContainer:function(e){var i=t("<div>",{"data-serial":e.element.serial,"class":"widget-box widget-block widget-"+e.element.qtiClass,"data-qti-class":e.element.qtiClass});e.$container=e.$original.wrap(i).parent()},createToolbar:function(i,n){if(!e.isFunction(n))throw"the toolbarTpl must be a handlebars function";var a=t(n({serial:i.serial,state:"active"}));i.$container.append(a),a.find('[data-role="delete"]').on("click.widget-box",function(t){t.stopPropagation(),i.changeState("deleting")})}};return i}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/media",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l="function",c=this.escapeExpression;return s+='<span class="mini-tlb" data-edit="',(o=i.state)?r=o.call(e,{hash:{},data:a}):(o=e&&e.state,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'" data-for="',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'">\n    <span class="rgt tlb-button" title="Delete" data-role="delete">\n        <span class="icon-bin"></span>\n    </span>\n</span>\n'})}),define("taoQtiItem/qtiCreator/widgets/static/img/Widget",["taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/img/states/states","taoQtiItem/qtiCreator/widgets/static/helpers/widget","tpl!taoQtiItem/qtiCreator/tpl/toolbars/media","taoQtiItem/qtiCreator/widgets/static/helpers/inline"],function(t,e,i,n,a){var r=t.clone();return r.initCreator=function(){this.registerStates(e),t.initCreator.call(this),a.togglePlaceholder(this)},r.getRequiredOptions=function(){return["baseUrl","uri","lang","mediaManager"]},r.buildContainer=function(){return i.buildInlineContainer(this),this},r.createToolbar=function(){return i.createToolbar(this,n),this},r}),define("taoQtiItem/qtiCreator/renderers/Img",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Img","taoQtiItem/qtiCreator/widgets/static/img/Widget"],function(t,e,i){var n=t.clone(e);return n.render=function(t,n){return n=n||{},n.baseUrl=this.getOption("baseUrl"),n.uri=this.getOption("uri"),n.lang=this.getOption("lang"),n.mediaManager=this.getOption("mediaManager"),i.build(t,e.getContainer(t),this.getOption("bodyElementOptionForm"),n)},n}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/item",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l,c="",d=i.helperMissing,h=this.escapeExpression,u="function",p=this;return c+='<div class="panel">\n    <label for="">'+h((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"Identifier",l):d.call(e,"__","Identifier",l)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+h((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"The principle identifier of the item. This identifier must have a corresponding entry in the item's metadata.",l):d.call(e,"__","The principle identifier of the item. This identifier must have a corresponding entry in the item's metadata.",l)))+'</div>\n\n    <input type="text" \n           name="identifier" \n           value="',(s=i.identifier)?o=s.call(e,{hash:{},data:a}):(s=e&&e.identifier,o=typeof s===u?s.call(e,{hash:{},data:a}):s),c+=h(o)+'" \n           placeholder="e.g. my-item_123456" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(s=i.serial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.serial,o=typeof s===u?s.call(e,{hash:{},data:a}):s),c+=h(o)+');">\n    \n</div>\n\n<div class="panel">\n    <label>\n        <input name="timeDependent" type="checkbox" ',o=i["if"].call(e,e&&e.timeDependent,{hash:{},inverse:p.noop,fn:p.program(1,r,a),data:a}),(o||0===o)&&(c+=o),c+='/>\n        <span class="icon-checkbox"></span>\n        '+h((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"Time dependent",l):d.call(e,"__","Time dependent",l)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n        '+h((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"Define whether the item should be time dependent on delivery.",l):d.call(e,"__","Define whether the item should be time dependent on delivery.",l)))+"\n    </span>\n</div>\n"})}),define("taoQtiItem/qtiCreator/widgets/item/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Active","tpl!taoQtiItem/qtiCreator/tpl/forms/item","taoQtiItem/qtiCreator/widgets/helpers/formElement"],function(t,e,i,n){var a=t.create(e,function(){this.initForm()
},function(){});return a.prototype.initForm=function(){var t=this.widget,e=t.element,a=t.$form;a.html(i({serial:e.getSerial(),identifier:e.id(),timeDependent:!!e.attr("timeDependent")})),n.initWidget(a),n.initDataBinding(a,e,{identifier:n.getAttributeChangeCallback(),timeDependent:n.getAttributeChangeCallback()})},a}),define("taoQtiItem/qtiCreator/widgets/item/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/item/states/Active"],function(t){return t.createBundle(arguments)}),define("taoQtiItem/qtiXmlRenderer/renderers/config",[],function(){return{name:"xmlRenderer",locations:{_container:"taoQtiItem/qtiXmlRenderer/renderers/Container",assessmentItem:"taoQtiItem/qtiXmlRenderer/renderers/Item",stylesheet:"taoQtiItem/qtiXmlRenderer/renderers/Stylesheet",responseDeclaration:"taoQtiItem/qtiXmlRenderer/renderers/ResponseDeclaration",outcomeDeclaration:"taoQtiItem/qtiXmlRenderer/renderers/OutcomeDeclaration",responseProcessing:"taoQtiItem/qtiXmlRenderer/renderers/ResponseProcessing",_simpleFeedbackRule:"taoQtiItem/qtiXmlRenderer/renderers/responses/SimpleFeedbackRule",math:"taoQtiItem/qtiXmlRenderer/renderers/Math",img:"taoQtiItem/qtiXmlRenderer/renderers/Img",object:"taoQtiItem/qtiXmlRenderer/renderers/Object",modalFeedback:"taoQtiItem/qtiXmlRenderer/renderers/feedbacks/ModalFeedback",rubricBlock:"taoQtiItem/qtiXmlRenderer/renderers/RubricBlock",associateInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/AssociateInteraction",choiceInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/ChoiceInteraction",extendedTextInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/ExtendedTextInteraction",gapMatchInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/GapMatchInteraction",graphicAssociateInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/GraphicAssociateInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/GraphicGapMatchInteraction",graphicOrderInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/GraphicOrderInteraction",hotspotInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/HotspotInteraction",hottextInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/HottextInteraction",inlineChoiceInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/InlineChoiceInteraction",matchInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/MatchInteraction",mediaInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/MediaInteraction",orderInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/OrderInteraction",selectPointInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/SelectPointInteraction",sliderInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/SliderInteraction",textEntryInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/TextEntryInteraction",uploadInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/UploadInteraction",prompt:"taoQtiItem/qtiXmlRenderer/renderers/interactions/Prompt",associableHotspot:"taoQtiItem/qtiXmlRenderer/renderers/choices/AssociableHotspot",gap:"taoQtiItem/qtiXmlRenderer/renderers/choices/Gap",gapImg:"taoQtiItem/qtiXmlRenderer/renderers/choices/GapImg",gapText:"taoQtiItem/qtiXmlRenderer/renderers/choices/GapText",hotspotChoice:"taoQtiItem/qtiXmlRenderer/renderers/choices/HotspotChoice",hottext:"taoQtiItem/qtiXmlRenderer/renderers/choices/Hottext",inlineChoice:"taoQtiItem/qtiXmlRenderer/renderers/choices/InlineChoice",simpleAssociableChoice:"taoQtiItem/qtiXmlRenderer/renderers/choices/SimpleAssociableChoice",simpleChoice:"taoQtiItem/qtiXmlRenderer/renderers/choices/SimpleChoice"}}}),define("taoQtiItem/qtiXmlRenderer/renderers/Renderer",["taoQtiItem/qtiRunner/core/Renderer","taoQtiItem/qtiXmlRenderer/renderers/config"],function(t,e){return t.build(e.locations,e.name)}),define("taoQtiItem/qtiCreator/helper/xmlRenderer",["taoQtiItem/qtiXmlRenderer/renderers/Renderer"],function(t){var e=new t({shuffleChoices:!1}).load(),i=function(t){var i="";try{i=t.render(e)}catch(n){console.log(n)}return i};return{render:i}}),define("taoQtiItem/qtiCreator/helper/devTools",["lodash","jquery","taoQtiItem/qtiCreator/helper/xmlRenderer"],function(t,e,i){var n={};n.listenStateChange=function(){e(document).on("afterStateInit.qti-widget",function(t,e,i){console.log("->state : "+i.name+" : "+e.serial)}),e(document).on("afterStateExit.qti-widget",function(t,e,i){console.log("<-state : "+i.name+" : "+e.serial)})},n.liveXmlPreview=function(n,a){var o=["containerBodyChange","attributeChange.qti-widget","choiceCreated.qti-widget","correctResponseChange.qti-widget","mapEntryChange.qti-widget","mapEntryRemove.qti-widget","deleted.qti-widget","choiceTextChange.qti-widget","responseTemplateChange.qti-widget","mappingAttributeChange.qti-widget","feedbackRuleConditionChange.qti-widget","feedbackRuleCreated.qti-widget","feedbackRuleRemoved.qti-widget","feedbackRuleElseCreated.qti-widget","feedbackRuleElseRemoved.qti-widget"];e(document).on(o.join(" "),t.throttle(function(){var t=i.render(n);r(t,a)},200))};var a=function(t){return vkbeautify.xml(t,"	")},r=function(t,i){var n=e(),r=a(t);r=r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),i.hasClass("language-markup")?n=i:(n=i.find("code.language-markup"),n.length||(n=e("<code>",{"class":"language-markup"}),i.addClass("line-numbers").html(n))),n.length&&(n.html(r),Prism.highlightElement(n[0]))};return n}),define("taoQtiItem/qtiCreator/widgets/static/text/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep"],function(t,e){var i=t.extend(e,function(){},function(){});return i}),define("taoQtiItem/qtiCreator/helper/htmlEditor",["lodash","i18n","jquery","ckeditor","ckConfigurator","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/widgets/helpers/content","taoQtiItem/qtiCreator/widgets/helpers/deletingState"],function(t,e,i,n,a,r,o,s){n.disableAutoInline=!0;var l={placeholder:e("some text ...")},c=function(e,r,s){var c,d;if(s=t.defaults(s,l),!e instanceof i||!e.length)throw"invalid jquery element for $editable";if(!r instanceof i||!r.length)throw"invalid jquery element for $editableContainer";c=r.find('[data-role="cke-launcher"]'),e.attr("placeholder",s.placeholder),d=r.hasClass("widget-blockInteraction")||r.hasClass("widget-textBlock")||r.hasClass("widget-rubricBlock")?"qtiBlock":r.hasClass("qti-prompt-container")||r.hasClass("widget-hottext")?"qtiInline":"qtiFlow";var u={autoParagraph:!1,floatSpaceDockedOffsetY:10,taoQtiItem:{insert:function(){s.data&&s.data.container&&s.data.widget&&o.createElements(s.data.container,e,this.getData(),function(t){m(s.data.widget,t)})}},floatSpace:{debug:!0,initialHide:!0,centerElement:function(){return r.find('[data-role="cke-launcher"]')[0]},on:{ready:function(t){var e=i(this).find(".cke_nose"),n=e.parent(),a=i(this).find(".cke_toolbox");n.is(".cke")&&a.append(e),t.hide(),c.on("click",function(){c.hasClass("active")?(c.removeClass("active"),t.hide()):(c.addClass("active"),t.show())})},changeMode:function(t,e){var n=this,a=i(n),r=a.find(".cke_nose"),o=function(t){var e=new i.Deferred,n=0,a=setInterval(function(){var i=t.getAttribute("style");(n>5||i.indexOf("left")>-1||i.indexOf("right")>-1)&&(e.resolve(),clearInterval(a)),n++},1e3);return e.promise()};t!==e&&r.removeClass("float-space-"+t).addClass("float-space-"+e),i.when(o(n)).done(function(){n.style.left&&!n.style.right?r.removeClass("float-space-right").addClass("float-space-left"):r.removeClass("float-space-left").addClass("float-space-right")})}}},on:{instanceReady:function(n){var a={};e.data("editor",n.editor),n.editor.on("change",function(i){if(p(e,a,i.editor),t.isFunction(s.change)){var n=this.getData();s.change.call(this,g(n))}}),s.data&&s.data.container&&(e.data("qti-container",s.data.container),a=h(s.data.container,e),f(e,s.data.widget)),v(n.editor),e.trigger("editorready",[n.editor]),i(".qti-item").trigger("toolbarchange")},focus:function(){r.find('[data-role="cke-launcher"]').hide(),c.show(),t.isFunction(s.focus)&&s.focus.call(this,this.getData())},blur:function(){},configLoaded:function(t){t.editor.config=a.getConfig(t.editor,d,u)}}};return n.inline(e[0],u)},d=function(t,e){var i;return i=t.data(e)?t:t.find("[data-"+e+"=true]")},h=function(e,i){var n={};return t.each(t.values(e.elements),function(t){n[t.serial]=t.data("widget").rebuild({context:i})}),i.trigger("widgetCreated",[n,e]),n},u=function(t,e){return t.find(".widget-box[data-serial="+e+"]")},p=function(e,i,n){var a=[];if(t.each(i,function(t){var i=u(e,t.serial);i.length||a.push(t)}),a.length){var r=s.createInfoBox(a);r.on("confirm.deleting",function(){t.each(a,function(t){t.element.remove(),t.destroy()})}).on("undo.deleting",function(){n.undoManager.undo()})}},f=function(t,e){t.find(".widget-box").each(function(){var t=i(this),n=t.data("widget"),a=i("<button>",{"class":"html-editable-shield"});t.attr("contenteditable",!1),t.append(a),a.on("click",function(t){t.stopPropagation(),m(e,n)})})},m=function(e,i){e&&e.element&&e.element.qtiClass?(e.$container.one("widgetCreated",function(e,n){var a=n[i.serial];a&&t.delay(function(){a.changeState("active")},100)}),r.isA(e.element,"_container")?e.changeState("sleep"):r.isA(e.element,"choice")&&e.changeState("question")):i.changeState("active")},g=function(t){var e="";return t&&(e=t,e=e.replace(/<br([^>]*)?>/gi,"<br />"),e=e.replace(/<hr([^>]*)?>/gi,"<hr />"),e=e.replace(/(<img([^>]*)?\s?[^\/]>)+/gi,function(t){return t.replace(">"," />")})),e},v=function(t){t.focus();var e=t.createRange();e.moveToElementEditablePosition(t.editable(),!0),t.getSelection().selectRanges([e])},C={hasEditor:function(t){var e=!1;return d(t,"html-editable").each(function(){return e=!!i(this).data("editor")}),e},buildEditor:function(t,e){d(t,"html-editable-container").each(function(){var t,n=i(this),a=n.find("[data-html-editable]");a.attr("contenteditable",!0),t=c(a,n,e)})},destroyEditor:function(t){d(t,"html-editable-container").each(function(){var t=i(this),e=t.find("[data-html-editable]");if(t.find('[data-role="cke-launcher"]').off().removeClass("active").hide(),e.removeAttr("contenteditable"),e.data("editor")){var n=e.data("editor");n.focusManager.blur(),n.destroy(),e.removeData("editor"),e.data("qti-container")&&h(e.data("qti-container"),e)}})}};return C}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/text",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l=i.helperMissing,c=this.escapeExpression;return s+='<div class="panel">\n    <em>'+c((r=i.__||e&&e.__,o={hash:{},data:a},r?r.call(e,"no configuration property needed",o):l.call(e,"__","no configuration property needed",o)))+"</em>\n</div>\n"})}),define("taoQtiItem/qtiCreator/widgets/static/text/states/Active",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCreator/helper/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content","tpl!taoQtiItem/qtiCreator/tpl/forms/static/text"],function(t,e,i,n,a,r){var o=e.extend(i,function(){this.buildEditor(),this.initForm()},function(){this.destroyEditor(),this.widget.$form.empty()});o.prototype.buildEditor=function(){var t=this.widget,e=t.$container,i=t.element;e.attr("data-html-editable-container",!0),n.hasEditor(e)||n.buildEditor(e,{change:a.getChangeCallback(i),blur:function(){t.changeState("sleep")},data:{widget:t,container:i}})},o.prototype.destroyEditor=function(){n.destroyEditor(this.widget.$container)},o.prototype.initForm=function(){this.widget.$form.html(r())};return o}),define("taoQtiItem/qtiCreator/widgets/static/text/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/text/states/Sleep","taoQtiItem/qtiCreator/widgets/static/text/states/Active"],function(t,e){return t.createBundle(e,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/textBlock",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l="function",c=this.escapeExpression;return s+='<div class="mini-tlb" data-edit="',(o=i.state)?r=o.call(e,{hash:{},data:a}):(o=e&&e.state,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'" data-for="',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'">\n    <div class="rgt tlb-button" title="Delete" data-role="delete">\n        <span class="icon-bin"></span>\n    </div>\n    <div class="rgt tlb-button" data-role="cke-launcher" title="Formatting options">\n        <span class="icon-font"></span>\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/static/text/Widget",["taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/text/states/states","tpl!taoQtiItem/qtiCreator/tpl/toolbars/textBlock"],function(t,e,i){var n=t.clone();return n.initCreator=function(){t.initCreator.call(this),this.registerStates(e)},n.buildContainer=function(){var t=$("<div>",{"data-serial":this.element.serial,"data-qti-class":"_container","class":"widget-box widget-block widget-textBlock"}).append($("<div>",{"data-html-editable":!0}));this.$original.wrapInner(t),this.$container=this.$original.children(".widget-box")},n.createToolbar=function(){var t=this,e=$(i({serial:this.serial,state:"active"}));return this.$container.append(e),e.find('[data-role="delete"]').on("click.widget-box",function(e){e.stopPropagation(),t.changeState("deleting")}),this},n}),define("tpl!taoQtiItem/qtiCreator/tpl/notifications/genericFeedbackPopup",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s,l="",c="function",d=this.escapeExpression,h=i.helperMissing;return l+='<div class="feedback-',(o=i.type)?r=o.call(e,{hash:{},data:a}):(o=e&&e.type,r=typeof o===c?o.call(e,{hash:{},data:a}):o),l+=d(r)+' popup">\n    <span class="icon-info"></span>\n    ',(o=i.message)?r=o.call(e,{hash:{},data:a}):(o=e&&e.message,r=typeof o===c?o.call(e,{hash:{},data:a}):o),l+=d(r)+'\n    <span title="'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Remove Message",s):h.call(e,"__","Remove Message",s)))+'" class="icon-close close-trigger"></span>\n</div>'})}),define("taoQtiItem/qtiCreator/widgets/item/Widget",["lodash","jquery","helpers","taoQtiItem/qtiCreator/widgets/Widget","taoQtiItem/qtiCreator/widgets/item/states/states","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/helper/creatorRenderer","taoQtiItem/qtiCreator/model/helper/container","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/helper/xmlRenderer","taoQtiItem/qtiCreator/helper/devTools","taoQtiItem/qtiCreator/widgets/static/text/Widget","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","tpl!taoQtiItem/qtiCreator/tpl/notifications/genericFeedbackPopup","taoQtiItem/qtiCreator/editor/jquery.gridEditor"],function(t,e,i,n,a,r,o,s,l,c,d,h,u,p,f){var m=n.clone();m.initCreator=function(t){if(this.registerStates(a),n.initCreator.call(this),!t||!t.uri)throw new Error("missing required config parameter uri in item widget initialization");this.renderer=t.renderer,this.itemUri=t.uri,this.initUiComponents(),this.initTextWidgets(),this.initGridEditor(),this.debug()},m.buildContainer=function(){this.$container=this.$original},m.save=function(){return e.ajax({url:i._url("saveItem","QtiCreator","taoQtiItem"),type:"POST",dataType:"json",data:{uri:this.itemUri,xml:c.render(this.element)}})},m.initUiComponents=function(){var t=this;u.initTitle(this.$container.find(".qti-title"),this.element),e("#save-trigger").on("click",function(){var i=e(this);i.addClass("active"),e.when(p.save(),t.save()).done(function(){var t={message:"Your item has been saved",type:"success"},e=arguments.length;for(i.removeClass("active");e--;)if("success"!==arguments[e][1].toLowerCase()){t={message:"Failed to save item",type:"error"};break}v(t)})})},m.initGridEditor=function(){var t=this,i=this.element,n=this.$container.find(".qti-itemBody");n.gridEditor(),n.gridEditor("resizable"),n.gridEditor("addInsertables",e(".tool-list > [data-qti-class]:not(.disabled)"),{helper:function(){return e(this).find("span").clone().addClass("dragging")}}),n.on("beforedragoverstart.gridEdit",function(){n.removeClass("hoverable").addClass("inserting")}).on("dragoverstop.gridEdit",function(){n.addClass("hoverable").removeClass("inserting")}).on("dropped.gridEdit.insertable",function(e,i,n){n.removeAttr("id"),"rubricBlock"===i&&(n=n.parent(".col-12").parent(".grid-row")),n.addClass("widget-box"),n.attr({"data-new":!0,"data-qti-class":i});var a=n.parent().closest(".widget-box, .qti-item"),c=n.closest("[data-html-editable], .qti-itemBody"),d=a.data("widget"),h=d.element,u=r.isA(h,"_container")?h:h.getBody();if(!h||!c.length)throw new Error("cannot create new element");s.createElements(u,l.getContent(c),function(e){o.get().load(function(){for(var i in e){var a,o,s=e[i],l=n.parent();s.setRenderer(this),r.isA(s,"_container")?(l.empty(),l.html(s.render()),o=t.initTextWidget(s,l),a=o.$container):(s.render(n),o=s.postRender(),a=r.isA(s,"blockInteraction")?o.$container:o.$original),a.trigger("contentChange.gridEdit"),o.changeState(r.isA(s,"interaction")?"question":"active")}},this.getUsedClasses())})}).on("resizestop.gridEdit",function(){i.body(n.gridEditor("getContent"))})},m.initTextWidgets=function(){var i=this,n=this.element,a=this.$container,r=1,o=[];a.find(".qti-itemBody > .grid-row").each(function(){var t=e(this);t.hasClass("widget-box")||t.children().each(function(){var t=e(this),i=!1;t.contents().each(function(){return 3===this.nodeType&&this.nodeValue&&this.nodeValue.trim()?(i=!0,!1):void 0});var n=t.children();(n.length>1||!n.hasClass("widget-blockInteraction"))&&(i=!0),i&&(t.attr("data-text-block-id","text-block-"+r),r++)})});var c=a.clone();c.find(".qti-itemBody > .grid-row > [data-text-block-id]").each(function(){var t=e(this),i=t.data("text-block-id"),n=t.clone(),r=l.serializeElements(n),s=n.html();t.removeAttr("data-text-block-id").html("{{_container:new}}"),o.push({body:s,elements:r,$original:a.find('[data-text-block-id="'+i+'"]').removeAttr("data-text-block-id")})}),l.serializeElements(c);var d=c.find(".qti-itemBody").html(),h=n.getBody();s.createElements(h,d,function(e){if(t.size(e)!==o.length)throw"numbers of subcontainers mismatch";t.each(e,function(t){var e=o.shift(),n=g(h,e.elements);t.setElements(n,e.body),i.initTextWidget(t,e.$original)})})};var g=function(e,i){var n={};return t.each(i,function(t){n[t]=e.elements[t],delete e.elements[t]}),n};m.initTextWidget=function(t,e){return h.build(t,e,this.renderer.getOption("textOptionForm"),{})},m.debug=function(){d.listenStateChange();var t=e("<code>",{"class":"language-markup"}),i=e("<pre>",{"class":"line-numbers"}).append(t);e("#item-editor-wrapper").append(i),d.liveXmlPreview(this.element,t)};var v=function(t){var i=e(f(t)),n=i.find(".close-trigger");return e("body").append(i),n.on("click",function(){i.fadeOut(function(){e(this).remove()})}),setTimeout(function(){n.trigger("click")},2e3),i};return m}),define("tpl!taoQtiItem/qtiCreator/tpl/item",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l="function",c=this.escapeExpression;return s+='<div class="tao-scope qti-item item-editor-item clearfix" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'" data-identifier="'+c((r=e&&e.attributes,r=null==r||r===!1?r:r.identifier,typeof r===l?r.apply(e):r))+'">\n    <div id="modalFeedbacks"></div>\n    <h1 class="item-title col-12 qti-title">'+c((r=e&&e.attributes,r=null==r||r===!1?r:r.title,typeof r===l?r.apply(e):r))+'</h1>\n    <div class="qti-itemBody item-editor-drop-area hoverable">',(o=i.body)?r=o.call(e,{hash:{},data:a}):(o=e&&e.body,r=typeof o===l?o.call(e,{hash:{},data:a}):o),(r||0===r)&&(s+=r),s+="</div>\n</div>"})}),define("taoQtiItem/qtiCreator/renderers/Item",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Item","taoQtiItem/qtiCreator/widgets/item/Widget","tpl!taoQtiItem/qtiCreator/tpl/item"],function(t,e,i,n){var a=t.clone(e),r=function(t){return t.children().each(function(){var t=$(this);t.hasClass("grid-row")||t.wrap('<div class="grid-row"><div class="col-12"></div></div>')}),t};return a.template=n,a.render=function(t,n){var a=e.getContainer(t);return r(a.find(".qti-itemBody")),n=n||{},n.state="active",n.renderer=this,i.build(t,a,this.getOption("itemOptionForm"),n)},a}),define("taoQtiItem/qtiCreator/widgets/static/math/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep"],function(t,e){var i=t.extend(e,function(){},function(){});return i}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/math",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s,l="",c=i.helperMissing,d=this.escapeExpression,h="function";return l+='<div class="panel">\n    <label for="display" class="has-icon">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Display",s):c.call(e,"__","Display",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"How the math expression should be displayed.",s):c.call(e,"__","How the math expression should be displayed.",s)))+'</div>\n\n    <select name="display" class="select2" data-has-search="false">\n        <option value="inline">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"inline",s):c.call(e,"__","inline",s)))+'</option>\n        <option value="block">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"block",s):c.call(e,"__","block",s)))+'</option>\n    </select>\n</div>\n\n<div class="panel">\n    <label for="editMode" class="has-icon">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Editing Mode",s):c.call(e,"__","Editing Mode",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"How the math expression should be edited",s):c.call(e,"__","How the math expression should be edited",s)))+'.</div>\n\n    <select name="editMode" class="select2" data-has-search="false">\n        <option value="latex">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"LaTex",s):c.call(e,"__","LaTex",s)))+'</option>\n        <option value="mathml">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"MathML",s):c.call(e,"__","MathML",s)))+'</option>\n    </select>\n\n</div>\n\n<div class="panel" data-role="latex" style="display:none;">\n    <label for="sidebar-latex-field" class="has-icon">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Latex",s):c.call(e,"__","Latex",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Edit math expression using LaTex type setting system, e.g. e^{i \\pi} = -1",s):c.call(e,"__","Edit math expression using LaTex type setting system, e.g. e^{i \\pi} = -1",s)))+'</div>\n\n    <input id="sidebar-latex-field" type="text" name="latex" value="',(o=i.latex)?r=o.call(e,{hash:{},data:a}):(o=e&&e.latex,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" placeholder="e.g. e^{i \\pi} = -1"/>\n    <a href="#latex" class="math-editor-trigger">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Display larger editor",s):c.call(e,"__","Display larger editor",s)))+'</a>\n</div>\n\n<div class="panel sidebar-popup-container-box" data-role="mathml" style="display:none;">\n    <label for="sidebar-mathml-field" class="has-icon">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"MathML",s):c.call(e,"__","MathML",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Edit math expression using MathML",s):c.call(e,"__","Edit math expression using MathML",s)))+'</div>\n\n    <textarea id="sidebar-mathml-field" name="mathml">',(o=i.mathml)?r=o.call(e,{hash:{},data:a}):(o=e&&e.mathml,r=typeof o===h?o.call(e,{hash:{},data:a}):o),(r||0===r)&&(l+=r),l+='</textarea>\n\n    <div class="math-buffer" style="visibility:hidden;"></div>\n    <a href="#mathml" class="math-editor-trigger">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Display larger editor",s):c.call(e,"__","Display larger editor",s)))+'</a>\n</div>\n\n<div class="sidebar-popup-container-box">    \n\n    <div id="math-editor-container" class="sidebar-popup">\n        <h3 id="math-editor-title"></h3>\n        <span class="icon-grip-h dragger"></span>\n        <textarea id="math-editor-textarea" data-target="mathml"></textarea>\n        <input id="math-editor-input" data-target="latex"/>\n        <a class="closer" href="#" title="'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Close",s):c.call(e,"__","Close",s)))+'"></a>\n    </div>\n    <div class="math-buffer" style="visibility:hidden;"></div>\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/static/math/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCreator/editor/MathEditor","tpl!taoQtiItem/qtiCreator/tpl/forms/static/math","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/static/helpers/inline","lodash","i18n"],function(t,e,i,n,a,r,o,s){var l=300,c=t.extend(e,function(){this.initForm()},function(){this.widget.$form.empty()});c.prototype.initForm=function(){var t=this.widget,e=t.$form,i=t.element,r=i.mathML||"",o=i.getAnnotation("latex")||"",s=i.attr("display")||"inline",l="latex";!o.trim()&&r.trim()&&(l="mathml"),e.html(n({editMode:l,latex:o,mathml:r})),e.find("select[name=display]").val(s),e.find("select[name=editMode]").val(l),e.children('.panel[data-role="'+l+'"]').show(),d(e,l),a.initWidget(e),this.initFormChangeListener()},c.prototype.initFormChangeListener=function(){var t=this.widget,e=t.$form,n=t.element,s=n.mathML,c=n.getAnnotation("latex"),h=n.attr("display")||"inline",u={mathml:e.find("textarea[name=mathml]"),latex:e.find("input[name=latex]")},p=e.find(".math-editor-trigger"),f=e.find("#math-editor-container"),m={mathml:f.find('textarea[data-target="mathml"]'),latex:f.find('input[data-target="latex"]')},g=f.find("h3"),v=f.find(".closer"),C=f.find(".dragger"),I=e.find("select[name=editMode]");p.on("click",function(t){t.preventDefault(),f.hide();var e=this.hash.substring(1),i=u[e],n=m[e];g.text(i.parent().find("label").text()),n.val(i.val()),i.prop("disabled",!0),I.prop("disabled",!0),f.data("target",e),f.removeClass("mathml latex").addClass(e),f.removeAttr("style"),f.show(),p.hide()}),o(m).forEach(function(t,e){t.on("keyup",function(){u[e].val(m[e].val()),u[e].trigger("keyup")}),t.attr("placeholder",u[e].attr("placeholder"))}),v.on("click",function(){var t=f.data("target");u[t].val(m[f.data("target")].val()),u[t].prop("disabled",!1),I.prop("disabled",!1),f.hide(),p.show()}),f.draggable({handle:C});var b=new i({tex:c,mathML:s,display:h,buffer:e.find(".math-buffer"),target:t.$original});a.initDataBinding(e,n,{display:function(e,i){"block"===i?e.attr("display","block"):e.removeAttr("display"),t.rebuild({ready:function(t){t.changeState("active")}})},editMode:function(t,i){d(e,i)},latex:o.throttle(function(e,i){b.setTex(i).renderFromTex(function(){e.setAnnotation("latex",i),u.mathml.html(b.mathML),e.setMathML(b.mathML),r.togglePlaceholder(t)})},l),mathml:o.throttle(function(e,i){b.setMathML(i).renderFromMathML(function(){e.setMathML(i),u.latex.val(""),e.removeAnnotation("latex"),r.togglePlaceholder(t)})},l)})};var d=function(t,e){var i={mathml:t.children('.panel[data-role="mathml"]'),latex:t.children('.panel[data-role="latex"]')},n={mathml:t.find("textarea[name=mathml]"),latex:t.find("input[name=latex]")},a=t.find("select[name=editMode]");i.mathml.hide(),i.latex.hide(),"latex"===e?i.latex.show():"mathml"===e&&(i.mathml.show(),n.latex.val()&&(n.mathml.hasClass("tooltipstered")||h(n.mathml),n.mathml.tooltipster("show"),a.off("change.editMode").one("change.editMode",function(){n.mathml.tooltipster("hide")})))},h=function(t){var e=$("<span>").html(s("Currently conversion from MathML to LaTeX is not available. Editing MathML here will have the LaTex code discarded."));t.tooltipster({theme:"tao-warning-tooltip",content:e,delay:200,trigger:"custom"}),t.on("focus.mathwarning",function(){t.tooltipster("hide")}),setTimeout(function(){t.tooltipster("hide")},3e3)};return c}),define("taoQtiItem/qtiCreator/widgets/static/math/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/math/states/Sleep","taoQtiItem/qtiCreator/widgets/static/math/states/Active"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/static/math/Widget",["taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/math/states/states","taoQtiItem/qtiCreator/widgets/static/helpers/widget","tpl!taoQtiItem/qtiCreator/tpl/toolbars/media","taoQtiItem/qtiCreator/widgets/static/helpers/inline"],function(t,e,i,n,a){var r=t.clone();return r.initCreator=function(){this.registerStates(e),t.initCreator.call(this),a.togglePlaceholder(this)},r.buildContainer=function(){return"block"===this.element.attr("display")?i.buildBlockContainer(this):i.buildInlineContainer(this),this},r.createToolbar=function(){return i.createToolbar(this,n),this},r}),define("taoQtiItem/qtiCreator/renderers/Math",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Math","taoQtiItem/qtiCreator/widgets/static/math/Widget","taoQtiItem/qtiCreator/widgets/static/helpers/inline"],function(t,e,i){var n=t.clone(e);return n.render=function(t,n){return e.render(t),i.build(t,e.getContainer(t),this.getOption("bodyElementOptionForm"),n)},n}),define("taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Sleep"],function(t,e){return t.create(e,function(){},function(){})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/modalFeedback",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s,l="",c=i.helperMissing,d=this.escapeExpression,h="function";return l+='<div class="panel">\n    <label for="" class="has-icon">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Identifier",s):c.call(e,"__","Identifier",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,'The identifier of the modal feedback. This identifier must not be used by any other modal feedback or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',s):c.call(e,"__",'The identifier of the modal feedback. This identifier must not be used by any other modal feedback or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',s)))+'</div>\n\n    <input type="text" \n           name="identifier" \n           value="',(o=i.identifier)?r=o.call(e,{hash:{},data:a}):(o=e&&e.identifier,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" \n           placeholder="e.g. modal-feedback_1" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+');">\n</div>\n'
})}),define("taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCommonRenderer/renderers/ModalFeedback","taoQtiItem/qtiCommonRenderer/helpers/sizeFinder","tpl!taoQtiItem/qtiCreator/tpl/forms/static/modalFeedback","taoQtiItem/qtiCreator/widgets/helpers/formElement","jquery","ui/modal"],function(t,e,i,n,a,r,o){var s=function(){var t,e={sidebar:"#item-editor-item-widget-bar",cke:".cke",ckeBase:".cke_inner",ckeNose:".cke_nose",ckeToolbar:".cke_toolbar"},i=!1,n={};return{raise:function(i){var a,r;i=parseInt(i,10);for(t in e)a=o(e[t]),r=parseInt(a.css("z-index"),10),isNaN(r)&&(r=100),n[t]={element:a,index:r},a.css("z-index",n[t].index+i)},reset:function(){if(i)for(t in n)n[t].element.css("z-index",n[t].index)}}}(),l=function(t){var e=new o.Deferred,i=0,n=function(){var a=t.data("editor");i>20||(a?e.resolve():setTimeout(n,200))};return n(),e.promise()},c=t.extend(e,function(){var t=this.widget,e=this.widget.$container,a=e.find("[data-html-editable]");n.measure(e,null,function(n){e.modal({startClosed:!0,width:Math.min(n.width,i.maxWidth)}),e.modal("open"),o.when(l(a)).then(function(){s.raise(e.css("z-index"))}),e.on("closed.modal",function(){t.changeState("sleep")})}),this.widget.offEvents("otherActive"),this.initForm(),this.widget.$form.show()},function(){var t=this.widget.$container;t.off("opened.modal").off(".active"),t.modal("close"),s.reset(),t.find(".tlb-button.active[data-role=cke-launcher]").click(),this.widget.$form.empty().hide()});return c.prototype.initForm=function(){var t=this.widget;t.$form.html(a({serial:t.element.getSerial(),identifier:t.element.id()})),r.initWidget(t.$form),r.initDataBinding(t.$form,t.element,{identifier:function(t,e){t.id(e)}})},c}),define("taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/Sleep","taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/Active"],function(t,e){return t.createBundle(e,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/htmlEditorTrigger",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l="function",c=this.escapeExpression;return s+='<div class="mini-tlb" data-edit="',(o=i.state)?r=o.call(e,{hash:{},data:a}):(o=e&&e.state,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'" data-for="',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'">\n    <div class="rgt tlb-button" data-role="cke-launcher" title="Formatting options">\n        <span class="icon-font"></span>\n    </div>\n</div>'})}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/okButton",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l=i.helperMissing,c=this.escapeExpression;return s+='<button class="btn-info small widget-ok" data-edit="active">'+c((r=i.__||e&&e.__,o={hash:{},data:a},r?r.call(e,"done",o):l.call(e,"__","done",o)))+"</button>"})}),define("taoQtiItem/qtiCreator/widgets/static/modalFeedback/Widget",["taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/states","tpl!taoQtiItem/qtiCreator/tpl/toolbars/htmlEditorTrigger","tpl!taoQtiItem/qtiCreator/tpl/toolbars/okButton","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/helper/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content"],function(t,e,i,n,a,r,o){var s=t.clone();return s.initCreator=function(){t.initCreator.call(this),this.registerStates(e),this.buildEditor(),this.createOkButton()},s.buildContainer=function(){this.$container=this.$original.addClass("widget-box")},s.createToolbar=function(){return this.$container.find(".modal-body").append(i({serial:this.serial,state:"active"})),this},s.buildEditor=function(){var t=this,e=t.$container.find(".modal-body"),i=t.element,n=i.getBody();e.attr("data-html-editable-container",!0),r.hasEditor(e)||r.buildEditor(e,{change:o.getChangeCallback(n),data:{container:n,widget:t}}),a.initTitle(this.$original.find(".qti-title"),i)},s.createOkButton=function(){var t=this;this.$container.append($(n()).on("click.qti-widget",function(e){e.stopPropagation(),t.changeState("sleep")}))},s}),define("taoQtiItem/qtiCreator/renderers/ModalFeedback",["lodash","taoQtiItem/qtiCommonRenderer/renderers/ModalFeedback","taoQtiItem/qtiCreator/widgets/static/modalFeedback/Widget"],function(t,e,i){var n=t.clone(e);return n.render=function(t,n){n=n||{};var a=i.build(t,e.getContainer(t),this.getOption("modalFeedbackOptionForm"),n);return a},n}),define("taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep"],function(t,e){var i=t.extend(e,function(){},function(){});return i}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/rubricBlock",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s,l="",c=i.helperMissing,d=this.escapeExpression,h="function";return l+='<!--currently only visible to the candidate-->\n<div class="panel">\n    <label for="view">Visible by</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">\n        '+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"A rubric block identifies part of an assessmentItem's itemBody that represents instructions to one or more of the actors that view the item. Although rubric blocks are defined as simpleBlocks they must not contain interactions.",s):c.call(e,"__","A rubric block identifies part of an assessmentItem's itemBody that represents instructions to one or more of the actors that view the item. Although rubric blocks are defined as simpleBlocks they must not contain interactions.",s)))+'\n    </div>\n    <select name="view" class="select2" data-has-search="false">\n        <option value="author">author</option>\n        <option value="candidate">candidate</option>\n        <option value="proctor">proctor</option>\n        <option value="scorer">scorer</option>\n        <option value="testConstructor">test constructor</option>\n        <option value="tutor">tutor</option>\n    </select>\n</div>\n\n<div class="panel">\n    <label for="use">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Description",s):c.call(e,"__","Description",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"The purpose for which the rubric is intended to be used. As a reading passage for multiple items, or instructions for a particular section, for example.",s):c.call(e,"__","The purpose for which the rubric is intended to be used. As a reading passage for multiple items, or instructions for a particular section, for example.",s)))+'</div>\n    <input type="text" name="use" value="',(o=i.use)?r=o.call(e,{hash:{},data:a}):(o=e&&e.use,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" />\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCreator/helper/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content","tpl!taoQtiItem/qtiCreator/tpl/forms/static/rubricBlock","taoQtiItem/qtiCreator/widgets/helpers/formElement"],function(t,e,i,n,a,r){var o=t.extend(e,function(){this.buildEditor(),this.initForm()},function(){this.destroyEditor(),this.widget.$form.empty()});return o.prototype.buildEditor=function(){var t=this.widget,e=t.$container,a=t.element.getBody();e.attr("data-html-editable-container",!0),i.hasEditor(e)||i.buildEditor(e,{change:n.getChangeCallback(a),data:{widget:t,container:a}})},o.prototype.destroyEditor=function(){i.destroyEditor(this.widget.$container)},o.prototype.initForm=function(){var t=this.widget,e=t.$form,i=t.element;e.html(a({view:i.attr("view"),use:i.attr("use")})),r.initWidget(e),r.initDataBinding(e,i,{view:r.getAttributeChangeCallback(),use:r.getAttributeChangeCallback()})},o}),define("taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/Sleep","taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/Active"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/static/rubricBlock/Widget",["taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/states","tpl!taoQtiItem/qtiCreator/tpl/toolbars/textBlock"],function(t,e,i){var n=t.clone();return n.buildContainer=function(){this.$container=this.$original.addClass("widget-box widget-rubricBlock")},n.initCreator=function(){this.registerStates(e),t.initCreator.call(this)},n.createToolbar=function(){var t=$(i({serial:this.serial,state:"active"})),e=this;return this.$container.find(".qti-rubricBlock-body").append(t),t.find('[data-role="delete"]').on("click.widget-box",function(t){t.stopPropagation(),e.changeState("deleting")}),this},n}),define("taoQtiItem/qtiCreator/renderers/RubricBlock",["lodash","taoQtiItem/qtiCommonRenderer/renderers/RubricBlock","taoQtiItem/qtiCreator/widgets/static/rubricBlock/Widget"],function(t,e,i){var n=t.clone(e);return n.render=function(t,n){return i.build(t,e.getContainer(t),this.getOption("bodyElementOptionForm"),n)},n}),define("taoQtiItem/qtiCreator/renderers/choices/InlineChoice",function(){}),define("taoQtiItem/qtiCreator/widgets/choices/Widget",["taoQtiItem/qtiCreator/widgets/Widget"],function(t){var e=t.clone();return e.buildContainer=function(){this.$container=this.$original},e.initCreator=function(){if(t.initCreator.call(this),this.interaction=this.element.getInteraction(),!this.interaction)throw new Error("cannot find related interaction");this.listenToInteractionStates()},e.listenToInteractionStates=function(){var t=this;this.afterStateInit(function(e,i,n){if(i.is("interaction")&&i.getSerial()===t.interaction.getSerial()&&n.name!==t.getCurrentState().name)switch(n.name){case"answer":case"sleep":case"question":t.changeState(n.name);break;case"delete":t.changeState("sleep")}}),this.beforeStateExit(function(e,i,n){i.is("interaction")&&i.getSerial()===t.interaction.getSerial()&&"choice"===n.name&&t.changeState("question")})},e}),define("taoQtiItem/qtiCreator/widgets/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory"],function(t){return t.create("answer",["active"],function(){throw new Error('state "answer" prototype init method must be implemented')},function(){throw new Error('state "answer" prototype exit method must be implemented')})}),define("taoQtiItem/qtiCreator/widgets/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory"],function(t){return t.create("choice",["question","active"],function(){throw new Error('state "choice" prototype init method must be implemented')},function(){throw new Error('state "choice" prototype exit method must be implemented')})}),define("taoQtiItem/qtiCreator/widgets/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory"],function(t){return t.create("correct",["answer","active"],function(){throw new Error('state "correct" prototype init method must be implemented')},function(){throw new Error('state "correct" prototype exit method must be implemented')})}),define("taoQtiItem/qtiCreator/widgets/states/Map",["taoQtiItem/qtiCreator/widgets/states/factory"],function(t){return t.create("map",["answer","active"],function(){throw new Error('state "map" prototype init method must be implemented')},function(){throw new Error('state "map" prototype exit method must be implemented')})}),define("taoQtiItem/qtiCreator/widgets/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory"],function(t){return t.create("question",["active"],function(){throw new Error('state "question" prototype init method must be implemented')},function(){throw new Error('state "question" prototype exit method must be implemented')})}),define("taoQtiItem/qtiCreator/widgets/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Active","taoQtiItem/qtiCreator/widgets/states/Answer","taoQtiItem/qtiCreator/widgets/states/Choice","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCreator/widgets/states/Deleting","taoQtiItem/qtiCreator/widgets/states/Inactive","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/states/Question","taoQtiItem/qtiCreator/widgets/states/Sleep"],function(t){return t.createBundle(arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Sleep"],function(t,e){var i=t.create(e,function(){},function(){});return i}),define("taoQtiItem/qtiCreator/widgets/choices/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Active"],function(t,e){var i=t.create(e,function(){},function(){});return i}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.content",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(){var t="";return t}function o(){return"display:none;"}function s(){return"icon-pin"}function l(){return"icon-shuffle"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var c,d,h="",u="function",p=this.escapeExpression,f=this;return h+='<div class="mini-tlb" data-edit="question" data-for="',(d=i.serial)?c=d.call(e,{hash:{},data:a}):(d=e&&e.serial,c=typeof d===u?d.call(e,{hash:{},data:a}):d),h+=p(c)+'">\n    <div class="rgt tlb-button" title="Delete" data-role="delete">\n        <span class="icon-bin"></span>\n    </div>\n    <div class="rgt tlb-button" data-role="shuffle-pin" title="Shuffle/Pin" style="',c=i["if"].call(e,e&&e.interactionShuffle,{hash:{},inverse:f.program(3,o,a),fn:f.program(1,r,a),data:a}),(c||0===c)&&(h+=c),h+='">\n        <span class="',c=i["if"].call(e,e&&e.fixed,{hash:{},inverse:f.program(7,l,a),fn:f.program(5,s,a),data:a}),(c||0===c)&&(h+=c),h+='"></span>\n    </div>\n    <div class="rgt tlb-button" data-role="cke-launcher" title="Formatting options">\n        <span class="icon-font"></span>\n    </div>\n</div>'})}),define("taoQtiItem/qtiCreator/widgets/choices/helpers/formElement",[],function(){var t={initShufflePinToggle:function(t){var e=t.$container,i=t.element,n=i.getInteraction(),a=e.find('[data-role="shuffle-pin"]');a.on("mousedown",function(t){t.stopPropagation();var e=$(this).children();0===e.length&&(e=$(this)),e.hasClass("icon-shuffle")?(e.removeClass("icon-shuffle").addClass("icon-pin"),i.attr("fixed",!0)):(e.removeClass("icon-pin").addClass("icon-shuffle"),i.attr("fixed",!1))});var r=function(t){t?a.show():a.hide(),$(".qti-item").trigger("toolbarchange")};r(n.attr("shuffle")),t.on("attributeChange",function(t){t.element.serial===n.serial&&"shuffle"===t.key&&r(t.value)})},initDelete:function(t){var e=t.$container;e.find('[data-role="delete"]:not([data-html-editable] *)').on("mousedown",function(e){e.stopPropagation(),t.changeState("deleting")})}};return t}),define("taoQtiItem/qtiCreator/widgets/choices/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Question","tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.content","taoQtiItem/qtiCreator/widgets/choices/helpers/formElement"],function(t,e,i,n){var a=t.create(e,function(){var t=this.widget;t.$container.on("click.question",function(){t.changeState("choice")}).on("mouseenter.question",function(){$(this).addClass("hover")}).on("mouseleave.question",function(){$(this).removeClass("hover")}),this.createToolbar().show()},function(){this.removeToolbar(),this.widget.$container.off(".question")});return a.prototype.createToolbar=function(){var t,e=this.widget,a=e.$container,r=e.element,o=a.find(".mini-tlb").not("[data-html-editable] *");return o.length||(t=r.getInteraction(),o=$(i({choiceSerial:r.getSerial(),interactionSerial:t.getSerial(),fixed:r.attr("fixed"),interactionShuffle:t.attr("shuffle")})),a.append(o),n.initShufflePinToggle(e),n.initDelete(e)),o},a.prototype.removeToolbar=function(){this.widget.$container.find(".mini-tlb[data-edit=question]").remove()},a}),define("taoQtiItem/qtiCreator/widgets/choices/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Answer"],function(t,e){var i=t.create(e,function(){},function(){});return i}),define("taoQtiItem/qtiCreator/widgets/choices/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/states","taoQtiItem/qtiCreator/widgets/choices/states/Sleep","taoQtiItem/qtiCreator/widgets/choices/states/Active","taoQtiItem/qtiCreator/widgets/choices/states/Question","taoQtiItem/qtiCreator/widgets/choices/states/Answer"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Question","tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.content","taoQtiItem/qtiCreator/widgets/choices/helpers/formElement"],function(t,e,i,n){var a=t.extend(e,function(){},function(){});return a.prototype.createToolbar=function(){var t,e=this.widget,a=e.$container,r=e.element,o=a.find(".mini-tlb").not("[data-html-editable] *");return o.length||(t=r.getInteraction(),o=$(i({choiceSerial:r.getSerial(),interactionSerial:t.getSerial(),fixed:r.attr("fixed"),interactionShuffle:t.attr("shuffle")})),a.children(".inner-wrapper").append(o),n.initShufflePinToggle(e),n.initDelete(e)),o},a}),define("taoQtiItem/qtiCreator/widgets/choices/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Choice","taoQtiItem/qtiItem/core/Element"],function(t,e,i){var n=t.create(e,function(){var t=this.widget;t.beforeStateInit(function(e,n,a){i.isA(n,"choice")&&t.interaction.getChoice(n.serial)?"choice"===a.name&&n.serial!==t.serial?t.changeState("question"):"active"===a.name&&t.changeState("question"):(n.is("img")||n.is("math")||n.is("object"))&&"active"===a.name&&t.changeState("question")}),this.initForm(),this.widget.$form.show()},function(){this.widget.$form.empty().hide()});return n.prototype.initForm=function(){t.throwMissingRequiredImplementationError("initForm")},n}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/simpleAssociableChoice",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s,l="",c=i.helperMissing,d=this.escapeExpression,h="function";return l+='<div class="panel">\n    <label for="">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Identifier",s):c.call(e,"__","Identifier",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',s):c.call(e,"__",'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',s)))+'</div>\n\n    <input type="text" \n           name="identifier" \n           value="',(o=i.identifier)?r=o.call(e,{hash:{},data:a}):(o=e&&e.identifier,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" \n           placeholder="e.g. my-choice_1" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+');">\n</div>\n\n<div class="panel">\n    <h3 class="has-icon">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Allowed number of uses",s):c.call(e,"__","Allowed number of uses",s)))+'\n    </h3>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n        '+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"The maximum number of choices this choice may be associated with. If matchMax is 0 there is no restriction.",s):c.call(e,"__","The maximum number of choices this choice may be associated with. If matchMax is 0 there is no restriction.",s)))+'\n    </span>\n\n    <!--not supported yet-->\n    <div style="display:none;">\n        <label for="matchMin" class="spinner">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Min",s):c.call(e,"__","Min",s)))+'</label>\n        <input name="matchMin" value="',(o=i.matchMin)?r=o.call(e,{hash:{},data:a}):(o=e&&e.matchMin,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-increment="1" data-min="0" data-max="100" type="text" />\n    </div>\n\n    <div>\n        <label for="matchMax" class="spinner">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Max",s):c.call(e,"__","Max",s)))+'</label>\n        <input name="matchMax" value="',(o=i.matchMax)?r=o.call(e,{hash:{},data:a}):(o=e&&e.matchMax,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-increment="1" data-min="0" data-max="100" type="text" />\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/helpers/identifier",["lodash"],function(t){var e=function(e,i,n){var a=i.replace(/([.-])/g,"\\$1"),r=new RegExp("\\b("+a+")\\b");for(var o in e.correctResponse)e.correctResponse[o]=e.correctResponse[o].replace(r,n);var s={};t.forIn(e.mapEntries,function(t,e){e=e.replace(r,n),s[e]=t}),e.mapEntries=s},i=t.throttle(function(t,i,n){var a=t.id();if(a!==i){e(n,a,i),t.id(i);var r=o("interactionFromChoice",t,function(){return t.getInteraction()});try{t.getContainer(null,t.qtiClass+"."+r.qtiClass).attr("data-identifier",t.id())}catch(s){}}},500),n=[],a=function(t,e,i){n[t]||(n[t]={}),n[t][e.getSerial()]=i},r=function(t,e){var i=e.getSerial();return i&&n[t]&&n[t][i]?n[t][i]:null},o=function(t,e,i){var n=r(t,e);return n||(n=i.call(e),a(t,e,n)),n};return{updateChoiceIdentifier:function(t,e){var n=o("responseFromChoice",t,function(){var e=o("interactionFromChoice",t,function(){return t.getInteraction()});return e.getResponseDeclaration()});i(t,e,n)},updateResponseIdentifier:function(){throw"to be implemented"}}}),define("taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Choice","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/simpleAssociableChoice","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","taoQtiItem/qtiCreator/helper/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content"],function(t,e,i,n,a,r,o){var s=t.extend(e,function(){this.buildEditor()},function(){this.destroyEditor()});return s.prototype.initForm=function(){var t=this.widget,e=t.$form,r=t.element;e.html(i({serial:r.getSerial(),identifier:r.id(),matchMin:r.attr("matchMin"),matchMax:r.attr("matchMax")})),n.initWidget(e);var o=n.getMinMaxAttributeCallbacks(this.widget.$form,"matchMin","matchMax");o.identifier=a.updateChoiceIdentifier,n.initDataBinding(e,r,o)},s.prototype.buildEditor=function(){var t=this.widget,e=t.element.getBody(),i=t.$container;i.attr("data-html-editable-container",!0),r.hasEditor(i)||r.buildEditor(i,{change:o.getChangeCallback(e),data:{container:e,widget:t}})},s.prototype.destroyEditor=function(){r.destroyEditor(this.widget.$container)},s}),define("taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/states","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/Question","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/Choice"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/Widget",["taoQtiItem/qtiCreator/widgets/choices/Widget","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){this.registerStates(e),t.initCreator.call(this),this.$container.wrapInner($("<div>",{"class":"inner-wrapper"})),this.$container.closest("table.matrix").find("input[type=checkbox]:enabled").prop("disabled","disabled")},i}),define("taoQtiItem/qtiCreator/renderers/choices/SimpleAssociableChoice.AssociateInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.AssociateInteraction","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/Widget"],function(t,e,i){var n=t.clone(e);return n.render=function(t,n){i.build(t,e.getContainer(t),this.getOption("choiceOptionForm"),n)},n}),define("taoQtiItem/qtiCreator/renderers/choices/SimpleAssociableChoice.MatchInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.MatchInteraction","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/Widget"],function(t,e,i){var n=t.clone(e);return n.render=function(t,n){i.build(t,e.getContainer(t),this.getOption("choiceOptionForm"),n)},n}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/choice",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s,l="",c=i.helperMissing,d=this.escapeExpression,h="function";return l+='<div class="panel">\n    <label for="" class="has-icon">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Identifier",s):c.call(e,"__","Identifier",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',s):c.call(e,"__",'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',s)))+'</div>\n\n    <input type="text" \n           name="identifier" \n           value="',(o=i.identifier)?r=o.call(e,{hash:{},data:a}):(o=e&&e.identifier,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" \n           placeholder="e.g. my-choice_1" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+');">\n</div>'})}),define("taoQtiItem/qtiCreator/widgets/choices/simpleChoice/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Choice","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/choice","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","taoQtiItem/qtiCreator/helper/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content"],function(t,e,i,n,a,r,o){var s=t.extend(e,function(){this.buildEditor()},function(){this.destroyEditor()});return s.prototype.initForm=function(){var t=this.widget;t.$form.html(i({serial:t.element.getSerial(),identifier:t.element.id()})),n.initWidget(t.$form),n.initDataBinding(t.$form,t.element,{identifier:a.updateChoiceIdentifier})},s.prototype.buildEditor=function(){var t=this.widget,e=t.element.getBody(),i=t.$container;i.attr("data-html-editable-container",!0),r.hasEditor(i)||r.buildEditor(i,{change:o.getChangeCallback(e),data:{container:e,widget:t}})},s.prototype.destroyEditor=function(){r.destroyEditor(this.widget.$container)},s}),define("taoQtiItem/qtiCreator/widgets/choices/simpleChoice/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/states","taoQtiItem/qtiCreator/widgets/choices/simpleChoice/states/Choice"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/simpleChoice/Widget",["taoQtiItem/qtiCreator/widgets/choices/Widget","taoQtiItem/qtiCreator/widgets/choices/simpleChoice/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){t.initCreator.call(this),this.registerStates(e);var i=this.$container.find(".real-label");i.children("input").prop("disabled","disabled")},i}),define("taoQtiItem/qtiCreator/renderers/choices/SimpleChoice.ChoiceInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.ChoiceInteraction","taoQtiItem/qtiCreator/widgets/choices/simpleChoice/Widget"],function(t,e,i){var n=t.clone(e);return n.render=function(t,n){i.build(t,e.getContainer(t),this.getOption("choiceOptionForm"),n)},n}),define("taoQtiItem/qtiCreator/renderers/choices/SimpleChoice.OrderInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.OrderInteraction","taoQtiItem/qtiCreator/widgets/choices/simpleChoice/Widget"],function(t,e,i){var n=t.clone(e);return n.render=function(t,n){i.build(t,e.getContainer(t),this.getOption("choiceOptionForm"),n)},n}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/grip",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l="function",c=this.escapeExpression;return s+='<span class="common-tlb" data-for="',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'">\n    <span class="tlb-button" title="move" data-role="move">\n        <span class="icon-grip"></span>\n    </span>\n</span>'})}),define("taoQtiItem/qtiCreator/widgets/helpers/movable",["jquery","taoQtiItem/qtiCreator/editor/gridEditor/draggable","tpl!taoQtiItem/qtiCreator/tpl/toolbars/grip"],function(t,e,i){var n={create:function(n){var a,r=n.element.getRelatedItem(),o=n.$container,s=t(i({serial:n.serial}));o.append(s),s.on("mouseenter.qti-widget",function(){a&&a.length||(a=r.data("widget").$container),e.createMovable(o,a)}).on("mouseleave.qti-widget",function(){e.destroy(o)})}};return n}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/interaction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a,r="";return r+='\n        <div class="state-switcher">\n            <span class="selected" data-state="question">'+h((n=i.__||t&&t.__,a={hash:{},data:e},n?n.call(t,"Question",a):d.call(t,"__","Question",a)))+'</span>\n            <span class="separator"> | </span>\n            <span class="link" data-state="answer">'+h((n=i.__||t&&t.__,a={hash:{},data:e},n?n.call(t,"Response",a):d.call(t,"__","Response",a)))+"</span>\n        </div>\n        "}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};
var o,s,l,c="",d=i.helperMissing,h=this.escapeExpression,u="function",p=this;return c+='<div class="tlb-wrapper" style="" data-edit="active" data-for="',(s=i.serial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.serial,o=typeof s===u?s.call(e,{hash:{},data:a}):s),c+=h(o)+'">\n    <span class="tlb-title" title="',(s=i.title)?o=s.call(e,{hash:{},data:a}):(s=e&&e.title,o=typeof s===u?s.call(e,{hash:{},data:a}):s),c+=h(o)+'">',(s=i.title)?o=s.call(e,{hash:{},data:a}):(s=e&&e.title,o=typeof s===u?s.call(e,{hash:{},data:a}):s),c+=h(o)+'</span>\n    <div class="tlb">\n        <div class="rgt tlb-button" data-role="delete" title="'+h((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"delete",l):d.call(e,"__","delete",l)))+'">\n            <span class="icon-bin"></span>\n        </div>\n        ',o=i["if"].call(e,e&&e.switcher,{hash:{},inverse:p.noop,fn:p.program(1,r,a),data:a}),(o||0===o)&&(c+=o),c+="\n    </div>\n</div>"})}),define("taoQtiItem/qtiCreator/widgets/interactions/Widget",["jquery","taoQtiItem/qtiCreator/widgets/Widget","taoQtiItem/qtiCreator/widgets/helpers/movable","tpl!taoQtiItem/qtiCreator/tpl/toolbars/interaction","tpl!taoQtiItem/qtiCreator/tpl/toolbars/okButton"],function(t,e,i,n,a){var r=e.clone();return r.init=function(t,i,n,a,r){return e.init.call(this,t,i,n,r),this.$responseForm=a,this},r.build=function(t,e,i,n,a){return this.clone().init(t,e,i,n,a)},r.initCreator=function(){e.initCreator.call(this),this.createToolbar(),this.createOkButton(),this.listenToChoiceStates()},r.buildContainer=function(){var e=t("<div>",{"data-serial":this.element.serial,"class":"widget-box widget-blockInteraction clearfix","data-qti-class":this.element.qtiClass}),i=this.$original.wrap(e);return this.$container=i.parent(),this},r.createToolbar=function(){var e,i=this;return e=t(n({title:this.element.qtiClass,serial:this.element.serial,switcher:!!this.registeredStates.answer})),this.$container.append(e),e.hide(),e.find('[data-role="delete"]').click(function(t){t.stopPropagation(),i.changeState("deleting")}),this.registeredStates.answer&&(e.on("click",".link",function(){var e=t(this),n=e.data("state");e.siblings(".selected").removeClass("selected").addClass("link"),e.removeClass("link").addClass("selected"),i.changeState(n)}),this.beforeStateInit(function(t,n,a){if(n.getSerial()===i.serial){var r=e.find('.link[data-state="'+a.name+'"]');r.length&&(r.siblings(".selected").removeClass("selected").addClass("link"),r.removeClass("link").addClass("selected"))}})),this},r.createOkButton=function(){var e=this,i=t(a()).on("click.qti-widget",function(t){t.stopPropagation(),e.changeState("sleep")});this.$container.append(i)},r.listenToChoiceStates=function(){var t=this;this.afterStateInit(function(e,i,n){var a=t.getCurrentState();if(i.is("choice")&&t.element.getChoice(i.getSerial())&&a&&n.name!==a.name)switch(n.name){case"choice":t.changeState(n.name)}})},r}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Sleep"],function(t,e){var i=t.extend(e,function(){var t=this.widget;t.$container.on("click.qti-widget.sleep",function(e){e.stopPropagation(),t.changeState("question")})},function(){var t=this.widget;t.$container.off(".sleep")});return i}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Active","lodash"],function(t,e,i){var n=function(t,e){var n=!1,a=[];return i.each(t.feedbackRules,function(t){t.feedbackThen&&"modalFeedback"===t.feedbackThen.qtiClass&&a.push(t.feedbackThen),t.feedbackElse&&"modalFeedback"===t.feedbackElse.qtiClass&&a.push(t.feedbackElse)}),i.each(a,function(t){var i=t.getBody().getElement(e);return i?(n=!0,!1):void 0}),n},a=t.extend(e,function(){var t=this.widget,e=t.$container,i=t.element,a=i.getResponseDeclaration();t.$container.attr("contenteditable",!1),t.beforeStateInit(function(e,r,o){var s=r.getSerial();if("modalFeedback"===r.qtiClass)return!1;if("active"===o.name&&s!==t.serial){var l=i.getComposingElements(),c=n(a,s);l[s]||c||t.changeState("sleep")}},"otherActive"),e.on("mouseenter.active",function(t){t.stopPropagation(),e.parent().trigger("mouseleave.sleep")}).on("mouseleave.active",function(t){t.stopPropagation(),e.parent().trigger("mouseenter.sleep")}).on("click.active",function(t){t.stopPropagation()})},function(){this.widget.offEvents("otherActive")});return a}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/addChoice",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l="function",c=this.escapeExpression;return s+='<li class="add-option" data-edit="question" data-for="',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'" data-role="add-option">\n    <span class="icon-add"></span>\n    ',(o=i.text)?r=o.call(e,{hash:{},data:a}):(o=e&&e.text,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+"\n</li>"})}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Question","tpl!taoQtiItem/qtiCreator/tpl/toolbars/addChoice","i18n"],function(t,e,i,n){var a=t.create(e,function(){this.initForm(),this.widget.$form.show(),this.addNewChoiceButton(this.widget)},function(){this.widget.$form.empty().hide()});return a.prototype.addNewChoiceButton=function(){var t=this.widget,e=t.$container.find(".choice-area"),a=t.element;e.length&&!e.children(".add-option").length&&(e.append(i({serial:this.serial,text:n("Add choice")})),e.children(".add-option").show().on("click.qti-widget",function(t){t.stopPropagation();var e=a.createChoice(),i=$("<li>"),n=e.qtiClass+"."+a.qtiClass,r={interaction:{attributes:a.attributes}};$(this).before(i),e.render(r,i,n),e.postRender({ready:function(t){t.changeState("choice")}},n)}))},a.prototype.initForm=function(){t.throwMissingRequiredImplementationError("initForm")},a}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Choice","taoQtiItem/qtiCreator/widgets/helpers/content"],function(t,e,i){var n=t.create(e,function(){var t=this.widget;t.$container.on("click.choice",function(e){$(e.target).closest(".qti-choice").length||t.changeState("question")}),i.changeInnerWidgetState(this.widget,"sleep")},function(){this.widget.$container.off(".choice")});return n}),define("taoQtiItem/qtiItem/helper/response",["lodash"],function(t){var e={MATCH_CORRECT:"http://www.imsglobal.org/question/qti_v2p1/rptemplates/match_correct",MAP_RESPONSE:"http://www.imsglobal.org/question/qti_v2p1/rptemplates/map_response",MAP_RESPONSE_POINT:"http://www.imsglobal.org/question/qti_v2p1/rptemplates/map_response_point"};return{isUsingTemplate:function(i,n){return!t.isString(n)||n!==i.template&&e[n]!==i.template?!1:!0},isValidTemplateName:function(t){return!!this.getTemplateUriFromName(t)},getTemplateUriFromName:function(t){return e[t]?e[t]:""},getTemplateNameFromUri:function(i){var n="";return t.forIn(e,function(t,e){return t===i?(n=e,!1):void 0}),n}}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/response/responseForm",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var i,n="";return n+='\n        <option value="'+f((i=null==e||e===!1?e:e.key,typeof i===p?i.apply(t):i))+'">'+f(typeof t===p?t.apply(t):t)+"</option>\n        "}function o(t,e){var n,a,r,o="";return o+='\n<hr/>\n\n<div class="panel" data-editx="map">\n    <h3>'+f((a=i.__||t&&t.__,r={hash:{},data:e},a?a.call(t,"Score range",r):m.call(t,"__","Score range",r)))+'\n    </h3>\n    <div>\n        <label for="lowerBound" class="spinner">Min</label>\n        <input name="lowerBound" value="',(a=i.lowerBound)?n=a.call(t,{hash:{},data:e}):(a=t&&t.lowerBound,n=typeof a===p?a.call(t,{hash:{},data:e}):a),o+=f(n)+'" class="score" type="text" data-validate="$numeric" data-validate-option="$allowEmpty; $event(type=keyup)" />\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">'+f((a=i.__||t&&t.__,r={hash:{},data:e},a?a.call(t,"Minimal  score for this interaction.",r):m.call(t,"__","Minimal  score for this interaction.",r)))+'</span>\n    </div>\n    <div>\n        <label for="upperBound" class="spinner">Max</label>\n        <input name="upperBound" value="',(a=i.upperBound)?n=a.call(t,{hash:{},data:e}):(a=t&&t.upperBound,n=typeof a===p?a.call(t,{hash:{},data:e}):a),o+=f(n)+'" class="score" type="text" data-validate="$numeric" data-validate-option="$allowEmpty; $event(type=keyup)" />\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">'+f((a=i.__||t&&t.__,r={hash:{},data:e},a?a.call(t,"Maximal score for this interaction.",r):m.call(t,"__","Maximal score for this interaction.",r)))+'</span>\n    </div>\n</div>\n\n<div class="panel" data-editx="map">\n    <label for="defaultValue" class="spinner">'+f((a=i.__||t&&t.__,r={hash:{},data:e},a?a.call(t,"Mapping default",r):m.call(t,"__","Mapping default",r)))+'</label>\n    <input name="defaultValue" value="',(a=i.defaultValue)?n=a.call(t,{hash:{},data:e}):(a=t&&t.defaultValue,n=typeof a===p?a.call(t,{hash:{},data:e}):a),o+=f(n)+'" class="score" type="text" data-validate="$notEmpty; $numeric;" data-validate-option="$lazy; $event(type=keyup)" />\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+f((a=i.__||t&&t.__,r={hash:{},data:e},a?a.call(t,"The default value from the target set to be used when no explicit mapping for a source value is given.",r):m.call(t,"__","The default value from the target set to be used when no explicit mapping for a source value is given.",r)))+'</span>\n</div>\n\n<div class="panel" data-editx="map">\n    <label>\n        <input name="defineCorrect" type="checkbox" data-role="defineCorrect"',n=i["if"].call(t,t&&t.defineCorrect,{hash:{},inverse:g.noop,fn:g.program(4,s,e),data:e}),(n||0===n)&&(o+=n),o+=' />\n        <span class="icon-checkbox"></span>\n        '+f((a=i.__||t&&t.__,r={hash:{},data:e},a?a.call(t,"Define correct response",r):m.call(t,"__","Define correct response",r)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+f((a=i.__||t&&t.__,r={hash:{},data:e},a?a.call(t,"Define the correct response.",r):m.call(t,"__","Define the correct response.",r)))+"</span>\n</div>\n"}function s(){return' checked="checked"'}function l(){return'\n<hr/>\n\n<div class="panel feedbackRule-panel"></div>\n'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var c,d,h,u="",p="function",f=this.escapeExpression,m=i.helperMissing,g=this;return u+='<div class="panel">\n    <label for="" class="has-icon">'+f((d=i.__||e&&e.__,h={hash:{},data:a},d?d.call(e,"Response identifier",h):m.call(e,"__","Response identifier",h)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+f((d=i.__||e&&e.__,h={hash:{},data:a},d?d.call(e,'The identifier of the choice. This identifier must not be used by any other response or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',h):m.call(e,"__",'The identifier of the choice. This identifier must not be used by any other response or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',h)))+'</div>\n\n    <input type="text" \n           name="identifier" \n           value="',(d=i.identifier)?c=d.call(e,{hash:{},data:a}):(d=e&&e.identifier,c=typeof d===p?d.call(e,{hash:{},data:a}):d),u+=f(c)+'" \n           placeholder="RESPONSE" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(d=i.serial)?c=d.call(e,{hash:{},data:a}):(d=e&&e.serial,c=typeof d===p?d.call(e,{hash:{},data:a}):d),u+=f(c)+');">\n</div>\n\n<div class="panel">\n    <label for="" class="has-icon">'+f((d=i.__||e&&e.__,h={hash:{},data:a},d?d.call(e,"Response processing",h):m.call(e,"__","Response processing",h)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+f((d=i.__||e&&e.__,h={hash:{},data:a},d?d.call(e,"Select the way the response of your interaction should be processed",h):m.call(e,"__","Select the way the response of your interaction should be processed",h)))+'</div>\n\n    <select name="template" class="select2" data-has-search="false">\n        ',c=i.each.call(e,e&&e.templates,{hash:{},inverse:g.noop,fn:g.program(1,r,a),data:a}),(c||0===c)&&(u+=c),u+="\n    </select>\n</div>\n\n",c=i["if"].call(e,e&&e.editMapping,{hash:{},inverse:g.noop,fn:g.program(3,o,a),data:a}),(c||0===c)&&(u+=c),u+="\n\n",c=i["if"].call(e,e&&e.editFeedbacks,{hash:{},inverse:g.noop,fn:g.program(6,l,a),data:a}),(c||0===c)&&(u+=c),u+="\n"})}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement",["lodash","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiItem/core/Element","tooltipster"],function(t,e,i){var n={required:"this is required",invalid:"the score format is not numeric"},a={init:function(t){e.initWidget(t.$form)},syncMaxChoices:function(e){var n="minChoices",a="maxChoices",r=e.$form.find("input[name="+n+"]"),o=e.$form.find("input[name="+a+"]"),s=function(){var i={max:t.size(e.element.getChoices())};r.incrementer("options",i).keyup(),o.incrementer("options",i).keyup()};e.on("choiceCreated",function(t){t.interaction.serial===e.element.serial&&s()}).on("deleted",function(t){t.parent.serial===e.element.serial&&i.isA(t.element,"choice")&&s()})},setScore:function(e,i){i=t.defaults(i||{},{required:!1,empty:function(){},set:function(){},key:function(){return $(this).attr("name")},tooltipContent:n}),e.hasClass("tooltipstered")||e.tooltipster({theme:"tao-error-tooltip",content:i.tooltipContent.invalid,delay:350,trigger:"custom"});var a=e.val(),r=parseFloat(a),o=i.key.call(e[0]);""===a?i.required?(e.tooltipster("content",i.tooltipContent.required),e.tooltipster("show")):(e.tooltipster("hide"),i.empty(o)):isNaN(r)?(e.tooltipster("content",i.tooltipContent.invalid),e.tooltipster("show")):(e.tooltipster("hide"),i.set(o,r))}};return a}),define("tpl!taoQtiItem/qtiCreator/tpl/modalFeedback/rule",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e,n){var a,r,s,l="";return l+='\n            <option value="',(r=i.name)?a=r.call(t,{hash:{},data:e}):(r=t&&t.name,a=typeof r===f?r.call(t,{hash:{},data:e}):r),l+=m(a)+'" ',r=i.equal||t&&t.equal,s={hash:{},inverse:g.noop,fn:g.program(2,o,e),data:e},a=r?r.call(t,t&&t.name,n&&n.condition,s):v.call(t,"equal",t&&t.name,n&&n.condition,s),(a||0===a)&&(l+=a),l+=">",(r=i.label)?a=r.call(t,{hash:{},data:e}):(r=t&&t.label,a=typeof r===f?r.call(t,{hash:{},data:e}):r),l+=m(a)+"</option>\n            "}function o(){return'selected="selected"'}function s(){return'style="display:none"'}function l(t,e){var n,a,r="";return r+='\n    <a title="'+m((n=i.__||t&&t.__,a={hash:{},data:e},n?n.call(t,"Add else feedback",a):v.call(t,"__","Add else feedback",a)))+'" href="#" class="adder feedbackRule-add-else">else</a>\n    '}function c(t,e){var n,a,r="";return r+='\n     <div class="feedbackRule-then-else">\n            <span class="feedbackRule-desc i">else</span>\n            <button class="btn-info small" type="button" data-feedback="else">'+m((n=i.__||t&&t.__,a={hash:{},data:e},n?n.call(t,"Feedback",a):v.call(t,"__","Feedback",a)))+'</button>\n            <span class="feedbackRule-button-delete icon-bin" title="'+m((n=i.__||t&&t.__,a={hash:{},data:e},n?n.call(t,"Delete else statement",a):v.call(t,"__","Delete else statement",a)))+'" data-role="else"></span>\n        </div>\n    '}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var d,h,u,p="",f="function",m=this.escapeExpression,g=this,v=i.helperMissing;return p+='<div class="feedbackRule-container" data-serial="',(h=i.serial)?d=h.call(e,{hash:{},data:a}):(h=e&&e.serial,d=typeof h===f?h.call(e,{hash:{},data:a}):h),p+=m(d)+'">\n    <div class="feedbackRule-rule-if">\n        <span class="feedbackRule-desc i">if</span>\n        <select class="feedbackRule-condition select2" data-has-search="false">\n            ',d=i.each.call(e,e&&e.availableConditions,{hash:{},inverse:g.noop,fn:g.programWithDepth(1,r,a,e),data:a}),(d||0===d)&&(p+=d),p+='\n        </select>\n        <input class="feedbackRule-compared-value score" type="text" value="',(h=i.comparedValue)?d=h.call(e,{hash:{},data:a}):(h=e&&e.comparedValue,d=typeof h===f?h.call(e,{hash:{},data:a}):h),p+=m(d)+'" ',d=i["if"].call(e,e&&e.hideScore,{hash:{},inverse:g.noop,fn:g.program(4,s,a),data:a}),(d||0===d)&&(p+=d),p+='/>\n    </div>\n    <div class="feedbackRule-then-else">\n        <span class="feedbackRule-desc i">then</span>\n        <button class="btn-info small" type="button" data-feedback="then">'+m((h=i.__||e&&e.__,u={hash:{},data:a},h?h.call(e,"Feedback",u):v.call(e,"__","Feedback",u)))+"</button>\n    </div>\n    ",d=i["if"].call(e,e&&e.addElse,{hash:{},inverse:g.noop,fn:g.program(6,l,a),data:a}),(d||0===d)&&(p+=d),p+="\n    ",d=i["if"].call(e,e&&e.feedbackElse,{hash:{},inverse:g.noop,fn:g.program(8,c,a),data:a}),(d||0===d)&&(p+=d),p+='\n    <span class="feedbackRule-button-delete icon-bin" title="'+m((h=i.__||e&&e.__,u={hash:{},data:a},h?h.call(e,"Delete this modal feedback",u):v.call(e,"__","Delete this modal feedback",u)))+'" data-role="rule"></span>\n</div>'})}),define("tpl!taoQtiItem/qtiCreator/tpl/modalFeedback/panel",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l=i.helperMissing,c=this.escapeExpression;return s+='<h3 class="has-icon">'+c((r=i.__||e&&e.__,o={hash:{},data:a},r?r.call(e,"Modal Feedbacks",o):l.call(e,"__","Modal Feedbacks",o)))+'</h3>\n<span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n<span class="tooltip-content">'+c((r=i.__||e&&e.__,o={hash:{},data:a},r?r.call(e,"Modal feedback is shown to the candidate directly following response processing.",o):l.call(e,"__","Modal feedback is shown to the candidate directly following response processing.",o)))+'</span>\n<div class="feedbackRules">\n    <p><i>'+c((r=i.__||e&&e.__,o={hash:{},data:a},r?r.call(e,"None defined yet.",o):l.call(e,"__","None defined yet.",o)))+'</i></p>\n</div>\n<a href="#" class="adder feedbackRule-add">'+c((r=i.__||e&&e.__,o={hash:{},data:a},r?r.call(e,"Add a modal feedback",o):l.call(e,"__","Add a modal feedback",o)))+"</a>"})}),define("taoQtiItem/qtiCreator/widgets/helpers/modalFeedbackRule",["lodash","jquery","i18n","ui/selecter","taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/modalFeedback/rule","tpl!taoQtiItem/qtiCreator/tpl/modalFeedback/panel"],function(t,e,i,n,a,r,o){var s=[{name:"correct",label:i("correct")},{name:"incorrect",label:i("incorrect")},{name:"lt",label:"<"},{name:"lte",label:"<="},{name:"equal",label:"="},{name:"gte",label:">="},{name:"gt",label:">"}],l=function(t){var i,a,o=t.feedbackElse,a=!o;o&&(i=o.serial);var l=r({availableConditions:s,serial:t.serial,condition:t.condition,comparedValue:t.comparedValue,feedbackThen:t.feedbackThen.serial,feedbackElse:i,addElse:a,hideScore:"correct"===t.condition||"incorrect"===t.condition}),c=e(l);return n(c),c},c=function(t,i){var n=t.find(".feedbackRules");t.on("click",".feedbackRule-add",function(t){t.preventDefault();var e=i.createFeedbackRule(),a=n.children(".feedbackRule-container:last");a.length?a.after(l(e)):n.html(l(e))}).on("click",".feedbackRule-add-else",function(t){t.preventDefault();{var n=e(this).parents(".feedbackRule-container"),a=n.data("serial"),r=i.getFeedbackRule(a);i.createFeedbackElse(r)}n.replaceWith(l(r))}).on("click",".feedbackRule-button-delete",function(){var t=e(this),n=t.parents(".feedbackRule-container"),a=n.data("serial"),r=i.getFeedbackRule(a);switch(t.data("role")){case"rule":i.deleteFeedbackRule(r),n.remove();break;case"else":i.deleteFeedbackElse(r),n.replaceWith(l(r))}}).on("change",".feedbackRule-condition",function(){var t=e(this),n=t.val(),r=t.siblings(".feedbackRule-compared-value"),o=i.getFeedbackRule(e(this).parents(".feedbackRule-container").data("serial"));("correct"===o.condition||"incorrect"===o.condition)&&r.val("0"),"correct"===n||"incorrect"===n?r.hide():r.show(),a.setScore(r,{required:!0,set:function(t,e){i.setCondition(o,n,e)}})}).on("keyup",".feedbackRule-compared-value",function(){var t=i.getFeedbackRule(e(this).parents(".feedbackRule-container").data("serial"));a.setScore(e(this),{required:!0,set:function(e,n){i.setCondition(t,t.condition,n)}})}).on("click","[data-feedback]",function(){var t,n,a=e(this),r=i.getFeedbackRule(a.parents(".feedbackRule-container").data("serial"));switch(a.data("feedback")){case"then":t=r.feedbackThen;break;case"else":t=r.feedbackElse}t&&(n=h(t),n.changeState("active"))})},d={},h=function(t){var i=e("#modalFeedbacks");return d[t.serial]||(i.append(t.render()),d[t.serial]=t.postRender()),d[t.serial]};return{initFeedbacksPanel:function(e,i){e.html(o());var n=e.find(".feedbackRules"),a=i.getFeedbackRules();a&&t.size(a)&&(n.empty(),t.each(a,function(t){n.append(l(t))})),c(e,i)},renderFeedbackRule:l}}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState",["lodash","taoQtiItem/qtiItem/helper/response","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/response/responseForm","taoQtiItem/qtiCreator/widgets/helpers/modalFeedbackRule"],function(t,e,i,n,a){var r={mappingAttr:function(t,e,i){""===e?t.removeMappingAttribute(i):t.setMappingAttribute(i,e)}},o={forward:function(t){var i=t.element.getResponseDeclaration();t.changeState(e.isUsingTemplate(i,"MATCH_CORRECT")?"correct":e.isUsingTemplate(i,"MAP_RESPONSE")||e.isUsingTemplate(i,"MAP_RESPONSE_POINT")?"map":"custom")},defineCorrect:function(i,n){var a=!1,r=e.getTemplateNameFromUri(i.template),o=i.getCorrect();return void 0===n?"MAP_RESPONSE"===r||"MAP_RESPONSE_POINT"===r?void 0!==i.data("defineCorrect")?a=!!i.data("defineCorrect"):(a=o&&t.size(o),i.data("defineCorrect",a)):"MATCH_CORRECT"===r&&(a=!0):(n||(i.correctResponse=[]),i.data("defineCorrect",n)),a},initResponseForm:function(l){var c=l.element,d=c.getRelatedItem(),h=d.responseProcessing,u=c.getResponseDeclaration(),p=e.getTemplateNameFromUri(u.template),f=t.indexOf(["MAP_RESPONSE","MAP_RESPONSE_POINT"],p)>=0,m=o.defineCorrect(u),g=$();if(!p){if("custom"!==h.processingType)throw"invalid response template";p="CUSTOM"}l.$responseForm.html(n({identifier:u.id(),serial:u.getSerial(),defineCorrect:m,editMapping:f,editFeedbacks:"CUSTOM"!==p,template:p,templates:s(c),defaultValue:u.getMappingAttribute("defaultValue"),lowerBound:u.getMappingAttribute("lowerBound"),upperBound:u.getMappingAttribute("upperBound")})),l.$responseForm.find("select[name=template]").val(p);var v=function(t){g.length||(g=l.$container.find("[data-edit=correct]")),t?g.show():g.hide()};f&&v(m),i.initDataBinding(l.$responseForm,u,{identifier:function(t,e){t.id(e),c.attr("responseIdentifier",e)},defaultValue:r.mappingAttr,lowerBound:r.mappingAttr,upperBound:r.mappingAttr,template:function(t,e){h.setProcessingType("templateDriven"),t.setTemplate(e),o.forward(l),o.initResponseForm(l)},defineCorrect:function(t,e){v(e),o.defineCorrect(t,!!e)}}),a.initFeedbacksPanel($(".feedbackRule-panel",l.$responseForm),u),i.initWidget(l.$responseForm)},isCorrectDefined:function(e){var i=e.element.getResponseDeclaration();return!!t.size(i.getCorrect())}},s=function(t){var e={CUSTOM:"custom",MATCH_CORRECT:"match correct",MAP_RESPONSE:"map response",MAP_RESPONSE_POINT:"map response"},i=t.getRelatedItem().responseProcessing;switch(t.qtiClass){case"orderInteraction":case"graphicOrderInteraction":case"extendedTextInteraction":delete e.MAP_RESPONSE,delete e.MAP_RESPONSE_POINT;break;case"selectPointInteraction":case"extendedTextInteraction":delete e.MATCH_CORRECT,delete e.MAP_RESPONSE;break;case"sliderInteraction":delete e.MAP_RESPONSE_POINT,delete e.MAP_RESPONSE;break;default:delete e.MAP_RESPONSE_POINT}return"templateDriven"===i.processingType&&delete e.CUSTOM,e};return o}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","taoQtiItem/qtiCreator/widgets/helpers/content"],function(t,e,i,n){var a=t.create(e,function(){this.widget.$container.addClass("runtime"),this.initResponseForm(),this.widget.$responseForm.show(),n.changeInnerWidgetState(this.widget,"inactive")},function(){this.widget.$container.removeClass("runtime"),this.widget.$responseForm.empty().hide(),n.changeInnerWidgetState(this.widget,"sleep")});return a.prototype.initResponseForm=function(){var t=this.widget;i.initResponseForm(t),t.on("responseTemplateChange",function(){i.forward(t)})},a}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct"],function(t,e){var i=t.create(e,function(){},function(){});return i}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Map",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e,i){var n=t.create(e,function(){var t=this.widget.$container.find('[data-edit="correct"]');i.isCorrectDefined(this.widget)?t.show():t.hide()},function(){this.widget.$container.find('[data-edit="correct"]').hide()});return n}),define("taoQtiItem/qtiCreator/widgets/states/Custom",["taoQtiItem/qtiCreator/widgets/states/factory"],function(t){return t.create("custom",["answer","active"],function(){throw new Error('state "custom" prototype init method must be implemented')},function(){throw new Error('state "custom" prototype exit method must be implemented')})}),define("tpl!taoQtiItem/qtiCreator/tpl/notifications/widgetOverlay",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l="function",c=this.escapeExpression;return s+='<span class="overlay">\n    <span class="message">',(o=i.message)?r=o.call(e,{hash:{},data:a}):(o=e&&e.message,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+"</span>\n</span>"})}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Custom",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Custom","tpl!taoQtiItem/qtiCreator/tpl/notifications/widgetOverlay","i18n"],function(t,e,i,n){var a=t.create(e,function(){this.widget.$container.append(i({message:n("Custom Response Processing Mode")}));this.widget.$container.find("[data-edit=map], [data-edit=correct]").hide()},function(){this.widget.$container.children(".overlay").remove()});return a}),define("taoQtiItem/qtiCreator/widgets/interactions/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/states","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/states/Active","taoQtiItem/qtiCreator/widgets/interactions/states/Question","taoQtiItem/qtiCreator/widgets/interactions/states/Choice","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/states/Map","taoQtiItem/qtiCreator/widgets/interactions/states/Custom"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Question","taoQtiItem/qtiCreator/helper/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content","tpl!taoQtiItem/qtiCreator/tpl/toolbars/htmlEditorTrigger","i18n"],function(t,e,i,n,a,r){var o=t.extend(e,function(){this.buildPromptEditor()},function(){this.destroyPromptEditor()});return o.prototype.buildPromptEditor=function(){var t=this.widget,e=t.$container.find(".qti-prompt-container"),o=e.find(".qti-prompt"),s=t.element.prompt.getBody();if(e.attr("data-html-editable-container",!0),o.attr("data-html-editable",!0),!i.hasEditor(e)){var l=$(a({serial:t.serial,state:"question"}));e.append(l),l.show(),i.buildEditor(e,{placeholder:r("define prompt"),change:n.getChangeCallback(s),data:{container:s,widget:t}})}},o.prototype.destroyPromptEditor=function(){var t=this.widget.$container.find(".qti-prompt-container");t.find(".mini-tlb").remove(),i.destroyEditor(t)},o}),define("taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/states","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question"],function(t,e){return t.createBundle(e,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/associate",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l,c="",d=this,h=i.helperMissing,u=this.escapeExpression,p="function";return c+='<div class="panel">\n    <label>\n        <input name="shuffle" type="checkbox" ',o=i["if"].call(e,e&&e.shuffle,{hash:{},inverse:d.noop,fn:d.program(1,r,a),data:a}),(o||0===o)&&(c+=o),c+='/>\n        <span class="icon-checkbox"></span>\n        '+u((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"Shuffle choices",l):h.call(e,"__","Shuffle choices",l)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n'+u((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be “shuffled” of “fixed” individually.",l):h.call(e,"__","If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be “shuffled” of “fixed” individually.",l)))+'\n    </span>\n</div>\n\n<div class="panel">\n    <h3>'+u((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"Number of associations",l):h.call(e,"__","Number of associations",l)))+'</h3>\n\n    <div>\n        <label for="minAssociations" class="spinner">Min</label>\n        <input name="minAssociations" value="',(s=i.minAssociations)?o=s.call(e,{hash:{},data:a}):(s=e&&e.minAssociations,o=typeof s===p?s.call(e,{hash:{},data:a}):s),c+=u(o)+'" data-increment="1" data-min="0" data-max="100" type="text" />\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+u((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"The minimum number of choices that the candidate is required to select to form a valid response.",l):h.call(e,"__","The minimum number of choices that the candidate is required to select to form a valid response.",l)))+'\n        </span>\n    </div>\n    <div>\n        <label for="maxAssociations" class="spinner">Max</label>\n        <input name="maxAssociations" value="',(s=i.maxAssociations)?o=s.call(e,{hash:{},data:a}):(s=e&&e.maxAssociations,o=typeof s===p?s.call(e,{hash:{},data:a}):s),c+=u(o)+'" data-increment="1" data-min="0" data-max="100" type="text" />\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n'+u((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"The maximum number of choices that the candidate is allowed to select to form a valid response.",l):h.call(e,"__","The maximum number of choices that the candidate is allowed to select to form a valid response.",l)))+"\n        </span>\n    </div>\n</div>"
})}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/associate"],function(t,e,i,n){var a=t.extend(e);return a.prototype.initForm=function(){var t=this.widget,e=t.$form,a=t.element;e.html(n({shuffle:!!a.attr("shuffle"),minAssociations:parseInt(a.attr("minAssociations")),maxAssociations:parseInt(a.attr("maxAssociations"))})),i.initWidget(e);var r=i.getMinMaxAttributeCallbacks(this.widget.$form,"minAssociations","maxAssociations");r.shuffle=i.getAttributeChangeCallback(),i.initDataBinding(e,a,r)},a}),define("taoQtiItem/qtiCreator/helper/adaptSize",["jquery","lodash"],function(t){"use strict";function e(t){return t.charAt(0).toUpperCase()+t.substr(1)}var i=function(){var i=function(t){r(t,{height:0})},n=function(t){r(t,{width:0})},a=function(t){r(t,{height:0,width:0})},r=function(i,n){var a;i instanceof t||(i=t(i)),i.each(function(){var e=t(this);for(a in n)e[a]("auto")}),i.each(function(){var i=t(this);for(a in n)n[a]=Math.max(n[a],i["outer"+e(a)]())}),i.css(n)};return{width:n,height:i,both:a}}();return i}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Choice","taoQtiItem/qtiCreator/helper/adaptSize","jquery.sizechange"],function(t,e,i){var n=t.extend(e,function(){var t=this.widget.$container,e=this.widget.$container.find(".result-area"),n=this.widget.$container.find(".choice-area"),a=n.find(".add-option"),r=function(){return n.find(".qti-choice").add(e.find(".target")).add(a)};t.sizeChange(function(){i.height(r())})},function(){this.widget.$container.off(".choice")});return n}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e,i){var n=t.extend(e,function(){i.forward(this.widget)},function(){});return n}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/ResponseWidget",["taoQtiItem/qtiCommonRenderer/renderers/interactions/AssociateInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","lodash","i18n"],function(t,e,i,n){var a={create:function(i,a){var r=i.element;t.destroy(r),a?(e.appendInstruction(i.element,n("Please define association pairs and their scores below.")),r.responseMappingMode=!0):e.appendInstruction(i.element,n("Please define the correct association pairs below.")),t.render(r)},setResponse:function(e,i){t.setResponse(e,this.formatResponse(i))},destroy:function(e){var i=e.element;t.destroy(i),delete i.responseMappingMode,t.renderEmptyPairs(i)},getResponseSummary:function(t){var e=[],n=i.values(t.getCorrect()),a=t.getMapEntries();return i.each(n,function(t){var i=t.split(" ").sort(),n=i.join(" ");e[n]={pair:i,correct:!0,score:void 0}}),i.forIn(a,function(t,i){var n=i.split(" ").sort(),a=n.join(" ");e[a]?e[a].score=t:e[a]={pair:n,correct:!1,score:t}}),e},formatResponse:function(t){var e={list:{pair:[]}};return i.each(t,function(t){var i=t.split(" ");e.list.pair.push(i)}),e},unformatResponse:function(t){var e=[];return t.list&&t.list.pair?i.each(t.list.pair,function(t){e.push(t.join(" "))}):t.base&&t.base.pair&&e.push(t.base.pair.join(" ")),e}};return a}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/ResponseWidget","lodash"],function(t,e,i,n){var a=t.create(e,function(){var t=this.widget.element,e=t.getResponseDeclaration();i.create(this.widget,!1),i.setResponse(t,n.values(e.getCorrect())),this.widget.$container.on("responseChange.qti-widget",function(t,n){e.setCorrect(i.unformatResponse(n.response))})},function(){this.widget.$container.off("responseChange.qti-widget"),i.destroy(this.widget)});return a}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/associableChoice.answer",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l="",c="function",d=this.escapeExpression,h=this;return l+='<div class="mini-tlb" data-edit="answer" data-for="',(s=i.choiceSerial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.choiceSerial,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'">\n    <label class="tlb-button right" title="This answer is correct" data-edit="correct">\n        <input \n            type="checkbox" \n            data-role="correct"\n            name="correct_',(s=i.interactionSerial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.interactionSerial,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'[]" \n            value="',(s=i.choiceIdentifier)?o=s.call(e,{hash:{},data:a}):(s=e&&e.choiceIdentifier,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'" \n            ',o=i["if"].call(e,e&&e.correct,{hash:{},inverse:h.noop,fn:h.program(1,r,a),data:a}),(o||0===o)&&(l+=o),l+='/>\n        <span class="icon-checkbox"></span>\n    </label>\n    <label class="tlb-button right" title="Score of this answer" data-edit="map">\n        <input value="',(s=i.score)?o=s.call(e,{hash:{},data:a}):(s=e&&e.score,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'" type="text" data-for="',(s=i.choiceIdentifier)?o=s.call(e,{hash:{},data:a}):(s=e&&e.choiceIdentifier,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'" name="score" class="score" data-validate="$numeric" data-validate-option="$allowEmpty; $event(type=keyup)" />\n    </label>\n</div>'})}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Map",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/ResponseWidget","lodash","tpl!taoQtiItem/qtiCreator/tpl/toolbars/associableChoice.answer"],function(t,e,i,n,a){var r=t.create(e,function(){var t=this.widget,e=t.element,a=e.getResponseDeclaration();i.create(t,!0),this.bindResponseChangeListener(),i.setResponse(e,n.keys(i.getResponseSummary(a)))},function(){this.widget.$container.off("responseChange.qti-widget"),i.destroy(this.widget),this.widget.$container.find(".mini-tlb").remove()});return r.prototype.bindResponseChangeListener=function(){var t=this.widget,e=t.element,n=e.getResponseDeclaration(),r=0,o=function(){var e=[];$('input[name="correct_'+t.serial+'[]"]:checked').each(function(){e.push($(this).data("pairIdentifier"))}),n.setCorrect(e)};t.$container.on("responseChange.qti-widget",function(t,s,l){if("added"===l.type){var c=[],d=[],h=l.$pair.children(".filled");if(2===h.length){d=i.getResponseSummary(n),h.each(function(){var t=$(this).data("serial"),i=e.getChoice(t);c.push(i.id())}),c.sort();var u=c.join(" "),p=l.$pair.children(".mini-tlb");p.length||(l.$pair.append(a({interactionSerial:e.getSerial(),choiceSerial:"n/a",choiceIdentifier:"n/a"})),p=l.$pair.children(".mini-tlb")),p.show(),p.data("pairIdentifier",u);var f=p.find("[data-role=correct]").data("pairIdentifier",u);d[u]&&d[u].correct?f.prop("checked",!0):f.prop("checked",!1);var m=p.find("[data-role=score]").data("pairIdentifier",u);m.val(d[u]&&d[u].score?d[u].score:r)}}else p=l.$pair.children(".mini-tlb"),p.hide(),n.removeMapEntry(p.data("pairIdentifier")),p.removeData("pairIdentifier"),p.find("[data-role=correct]").prop("checked",!1).removeData("pairIdentifier"),p.find("[data-role=score]").val(r).removeData("pairIdentifier"),o()}),t.$container.find(".result-area").on("change","[data-role=correct]",o).on("keyup","[data-role=score]",function(){var t=$(this);n.setMapEntry(t.data("pairIdentifier"),t.val())})},r}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Choice","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Map"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){this.registerStates(e),t.initCreator.call(this)},i}),define("taoQtiItem/qtiCreator/renderers/interactions/AssociateInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/AssociateInteraction","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/Widget"],function(t,e,i){var n=t.clone(e);return n.render=function(t,n){return e.renderEmptyPairs(t),i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),n)},n}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/choice",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l,c="",d=this,h=i.helperMissing,u=this.escapeExpression,p="function";return c+='<div class="panel">\n    <label>\n        <input name="shuffle" type="checkbox" ',o=i["if"].call(e,e&&e.shuffle,{hash:{},inverse:d.noop,fn:d.program(1,r,a),data:a}),(o||0===o)&&(c+=o),c+='/>\n        <span class="icon-checkbox"></span>\n        '+u((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"Shuffle choices",l):h.call(e,"__","Shuffle choices",l)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n        '+u((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,'If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be "shuffled" of "fixed" individually.',l):h.call(e,"__",'If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be "shuffled" of "fixed" individually.',l)))+'\n    </span>\n</div>\n\n<div class="panel">\n    <h3>'+u((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"Number of choices",l):h.call(e,"__","Number of choices",l)))+'</h3>\n\n    <div>\n        <label for="minChoices" class="spinner">Min</label>\n        <input name="minChoices" value="',(s=i.minChoices)?o=s.call(e,{hash:{},data:a}):(s=e&&e.minChoices,o=typeof s===p?s.call(e,{hash:{},data:a}):s),c+=u(o)+'" data-increment="1" data-min="0" data-max="',(s=i.choicesCount)?o=s.call(e,{hash:{},data:a}):(s=e&&e.choicesCount,o=typeof s===p?s.call(e,{hash:{},data:a}):s),c+=u(o)+'" type="text" />\n\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+u((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"The minimum number of choices that the candidate is required to select to form a valid response.",l):h.call(e,"__","The minimum number of choices that the candidate is required to select to form a valid response.",l)))+'\n        </span>\n    </div>\n    <div>\n        <label for="maxChoices" class="spinner">Max</label>\n        <input name="maxChoices" value="',(s=i.maxChoices)?o=s.call(e,{hash:{},data:a}):(s=e&&e.maxChoices,o=typeof s===p?s.call(e,{hash:{},data:a}):s),c+=u(o)+'" data-increment="1" data-min="0" data-max="',(s=i.choicesCount)?o=s.call(e,{hash:{},data:a}):(s=e&&e.choicesCount,o=typeof s===p?s.call(e,{hash:{},data:a}):s),c+=u(o)+'" type="text" />\n\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n            <span class="tooltip-content">\n            '+u((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"The maximum number of choices that the candidate is allowed to select to form a valid response.",l):h.call(e,"__","The maximum number of choices that the candidate is allowed to select to form a valid response.",l)))+"\n        </span>\n    </div>\n</div>\n"})}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/choice","lodash"],function(t,e,i,n,a,r){var o=t.extend(e);return o.prototype.initForm=function(t){var e=this.widget,o=e.$form,s=e.element;o.html(a({shuffle:!!s.attr("shuffle"),maxChoices:parseInt(s.attr("maxChoices")),minChoices:parseInt(s.attr("minChoices")),choicesCount:r.size(e.element.getChoices())})),i.initWidget(o);var l=i.getMinMaxAttributeCallbacks(this.widget.$form,"minChoices","maxChoices",t);l.shuffle=i.getAttributeChangeCallback(),i.initDataBinding(o,s,l),n.syncMaxChoices(e),e.on("attributeChange",function(t){var i=e.$container.find(".real-label > span");t.element.serial===s.serial&&"maxChoices"===t.key&&(1===parseInt(t.value)?i.removeClass("icon-checkbox").addClass("icon-radio"):i.removeClass("icon-radio").addClass("icon-checkbox"))})},o}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e,i){var n=t.extend(e,function(){i.forward(this.widget)},function(){});return n}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.score",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l="function",c=this.escapeExpression;return s+='<div class="mini-tlb" data-edit="answer" data-for="',(o=i.choiceSerial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.choiceSerial,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'">\n    <label class="tlb-button right" title="Score of this answer" data-edit="map">\n        <input value="',(o=i.score)?r=o.call(e,{hash:{},data:a}):(o=e&&e.score,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'" \n       title="Score of this answer" \n       type="text" \n       data-for="',(o=i.choiceIdentifier)?r=o.call(e,{hash:{},data:a}):(o=e&&e.choiceIdentifier,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'" \n       name="score" \n       class="score" \n       placeholder = "',(o=i.placeholder)?r=o.call(e,{hash:{},data:a}):(o=e&&e.placeholder,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'"\n       data-validate="$numeric" \n       data-validate-option="$allowEmpty; $event(type=keyup)" />\n    </label>\n</div>'})}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.label",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(){return'style="display:block;"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l="",c=this,d="function",h=this.escapeExpression;return l+='<div class="mini-tlb-label" data-edit="answer" ',o=i["if"].call(e,e&&e.show,{hash:{},inverse:c.noop,fn:c.program(1,r,a),data:a}),(o||0===o)&&(l+=o),l+='>\n    <label class="right">',(s=i.label)?o=s.call(e,{hash:{},data:a}):(s=e&&e.label,o=typeof s===d?s.call(e,{hash:{},data:a}):s),l+=h(o)+"</label>\n</div>"})}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/ResponseWidget",["taoQtiItem/qtiCommonRenderer/renderers/interactions/ChoiceInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.score","tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.label","lodash","i18n","polyfill/placeholders"],function(t,e,i,n,a,r,o,s,l){var c=function(t){1===t.element.attr("maxChoices")?t.$container.find(".real-label > :checkbox").replaceWith(function(){var t=$(this);return $("<input>",{type:"radio",value:t.attr("value"),name:t.attr("name")})}):t.$container.find(".real-label > :radio").replaceWith(function(){var t=$(this);return $("<input>",{type:"checkbox",value:t.attr("value"),name:t.attr("name")})})},d={create:function(i,n){var a=i.element;t.destroy(a),c(i),n?(e.appendInstruction(i.element,l("Please define the correct response and the score below.")),a.data("responseMappingMode",!0),d.createScoreWidgets(i),d.createCorrectWidgets(i)):(e.appendInstruction(i.element,l("Please define the correct response below.")),d.createCorrectWidgets(i)),t.render(a)},setResponse:function(e,n){t.setResponse(e,i.serialize(s.values(n),e))},destroy:function(e){var i=e.element;t.destroy(i),i.removeData("responseMappingMode"),e.$container.off("responseChange.qti-widget"),e.$container.find(".real-label > input").prop("disabled","disabled"),e.$container.find(".mini-tlb-label[data-edit=answer], .mini-tlb[data-edit=answer]").remove()},createScoreWidgets:function(t){var e=t.$container,i=t.element,a=i.getResponseDeclaration(),s=a.getMapEntries(),c=a.getMappingAttribute("defaultValue"),d=$(o({label:l("score"),show:!0})).css({right:3,left:"auto"});e.find(".qti-choice:first .pseudo-label-box").append(d),e.find(".qti-choice").each(function(){var t,e=$(this),n=e.data("identifier"),a=e.data("serial");t=$(r({serial:i.getSerial(),choiceSerial:a,choiceIdentifier:n,score:s[n]?s[n]:"",placeholder:c})),e.find(".pseudo-label-box").append(t),t.show().on("click",function(t){t.stopPropagation(),t.preventDefault()})});var h=e.find(".score");t.on("mappingAttributeChange",function(t){"defaultValue"===t.key&&h.attr("placeholder",t.value)}),n.initDataBinding(e,a,{score:function(t,e){var i=$(this).data("for");""===e?t.removeMapEntry(i):t.setMapEntry(i,e,!0)}})},createCorrectWidgets:function(t){var e=t.$container,n=t.element,r=n.getResponseDeclaration(),s=e.find(".real-label > input");e.find(".qti-choice:first .pseudo-label-box").append(o({label:l("correct"),show:!1})),e.on("responseChange.qti-widget",function(t,e){r.setCorrect(i.unserialize(e.response,n))});var c=function(t){t?s.removeProp("disabled"):s.prop("disabled",!0).removeProp("checked")};c(a.defineCorrect(r)),t.on("metaChange",function(t){t.element.serial===r.serial&&"defineCorrect"===t.key&&c(t.value)})},formatResponse:function(t){return i.serialize(s.values(t))},unformatResponse:function(t){return i.unserialize(t)}};return d}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/ResponseWidget","lodash"],function(t,e,i,n){var a=t.create(e,function(){var t=this.widget,e=t.element,a=e.getResponseDeclaration();i.create(t),i.setResponse(e,n.values(a.getCorrect()))},function(){i.destroy(this.widget)});return a}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Map",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/ResponseWidget","lodash"],function(t,e,i,n){var a=t.create(e,function(){var t=this.widget,e=t.element,a=e.getResponseDeclaration();i.create(t,!0),i.setResponse(e,n.values(a.getCorrect()))},function(){i.destroy(this.widget)});return a}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Map"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){this.registerStates(e),t.initCreator.call(this)},i}),define("taoQtiItem/qtiCreator/renderers/interactions/ChoiceInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/ChoiceInteraction","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/Widget"],function(t,e,i){var n=t.clone(e);return n.render=function(t,n){return i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),n)},n}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/extendedText",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l=i.helperMissing,c=this.escapeExpression;return s+='<div class="panel">\n    <label for="format" class="spinner">'+c((r=i.__||e&&e.__,o={hash:{},data:a},r?r.call(e,"Format",o):l.call(e,"__","Format",o)))+'</label>\n    <select name="format" class="select2" data-has-search="false">\n    	<option value="plain">'+c((r=i.__||e&&e.__,o={hash:{},data:a},r?r.call(e,"Plain text",o):l.call(e,"__","Plain text",o)))+'</option>\n        <option value="preFormatted">'+c((r=i.__||e&&e.__,o={hash:{},data:a},r?r.call(e,"Pre-formatted text",o):l.call(e,"__","Pre-formatted text",o)))+'</option>\n        <option value="xhtml">'+c((r=i.__||e&&e.__,o={hash:{},data:a},r?r.call(e,"XHTML",o):l.call(e,"__","XHTML",o)))+'</option>\n    </select>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+c((r=i.__||e&&e.__,o={hash:{},data:a},r?r.call(e,"Used to control the format of the text entered by the candidate.",o):l.call(e,"__","Used to control the format of the text entered by the candidate.",o)))+"</span>\n</div>"})}),define("taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/extendedText"],function(t,e,i,n,a){var r=t.extend(e);return r.prototype.initForm=function(){var t=this.widget,e=t.$form,r=t.element;e.html(a({format:parseFloat(r.attr("format"))})),i.initWidget(e);var o={};o.format=function(t,e){var i=t.getResponseDeclaration(),a=_.values(i.getCorrect()),r=t.attr("format");t.attr("format",e),n.updateFormat(t,r),"xhtml"==r&&"undefined"!=typeof a[0]&&i.setCorrect($("<p>"+a[0]+"</p>").text())},i.initDataBinding(e,r,o)},r}),define("taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e){var i=t.extend(e,function(){this.widget.changeState("correct")},function(){});return i}),define("taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","lodash","i18n"],function(t,e,i,n,a,r){var o=t.create(e,function(){s(this.widget)},function(){l(this.widget)}),s=function(t){var e=t.element,o=e.getResponseDeclaration(),s=a.values(o.getCorrect());i.enable(e),i.setText(e,s[0]),n.appendInstruction(e,r("Please type the correct response below.")),t.$container.on("responseChange.qti-widget",function(){o.setCorrect([i.getResponse(e).base.string])})},l=function(t){var e=t.element;i.clearText(e),i.disable(e),n.removeInstructions(t.element),t.$container.off("responseChange.qti-widget")};return o}),define("taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Correct"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){this.registerStates(e),t.initCreator.call(this),this.$container.find("input, textarea").attr("disabled","disabled")},i}),define("taoQtiItem/qtiCreator/renderers/interactions/ExtendedTextInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction","taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/Widget"],function(t,e,i){var n=t.clone(e);return n.render=function(t,n){return e.render(t),i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),n)},n}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeHandlers",["jquery","lodash","raphael"],function(t,e,i){var n=function(t,n){var a=function(t){var n,a=t.getBBox(),r=a.width>25?6:4,o=r/2,s=a.width/2,l=a.height/2;switch(t.type){case"circle":n={midTop:[a.x+s-o,a.y-r,r,r],midRight:[a.x+a.width,a.y+l-o,r,r],midBot:[a.x+s-o,a.y+a.height,r,r],midLeft:[a.x-r,a.y+l-o,r,r]};break;case"path":n={},e.forEach(i.parsePathString(t.attr("path")),function(t,e){3===t.length&&(n["point"+e]=t.slice(1).concat(o))});break;case"rect":case"ellipse":n={topLeft:[a.x-r,a.y-r,r,r],midTop:[a.x+s-o,a.y-r,r,r],topRight:[a.x+a.width,a.y-r,r,r],midRight:[a.x+a.width,a.y+l-o,r,r],botRight:[a.x+a.width,a.y+a.height,r,r],midBot:[a.x+s-o,a.y+a.height,r,r],botLeft:[a.x-r,a.y+a.height,r,r],midLeft:[a.x-r,a.y+l-o,r,r]}}return n};return e.map(a(n),function(e,i){var a,r,o;if("path"===n.type)a="move",o="circle";else switch(o="rect",i){case"topLeft":a="nw-resize",r={ix:!0,iy:!0};break;case"midTop":a="ns-resize",r={iy:!0};break;case"topRight":a="ne-resize",r={x:!0,iy:!0};break;case"midRight":a="ew-resize",r={x:!0};break;case"botRight":a="se-resize";break;case"midBot":a="ns-resize",r={y:!0};break;case"botLeft":a="sw-resize",r={ix:!0,y:!0};break;case"midLeft":a="ew-resize",r={ix:!0}}return t[o].apply(t,e).attr({fill:"#eeeeee",cursor:a}).data("constraints",r)})};return n}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeResizer",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic"],function(t,e){var i=function(t,i){function a(){var e;switch(t.type){case"circle":e={x:t.attrs.cx,y:t.attrs.cy};break;case"ellipse":case"rect":e=t.getBBox()}return e}var r;t&&t.type&&i.stop&&(r=e.bind(n[t.type],n),i.start||(i.start=a(t)),e.isFunction(r)&&t.animate(r(i)))},n={rect:function(t){var e=t.start,i=t.stop,n=t.constraints,a={};return(!n||n.x)&&(a.width=i.x-e.x,a.width<0&&(a.x=i.x,a.width=-1*a.width)),(!n||n.y)&&(a.height=i.y-e.y,a.height<0&&(a.y=i.y,a.height=-1*a.height)),n&&n.ix&&(a.x=i.x,a.width=e.width-(i.x-e.x),a.width<0&&(a.x=i.x,a.width=-1*a.width)),n&&n.iy&&(a.y=i.y,a.height=e.height-(i.y-e.y),a.height<0&&(a.y=i.y,a.height=-1*a.height)),a.width<10&&(a.width=10),a.height<10&&(a.height=10),a},circle:function(t){var e=t.start,i=t.stop,n=i.x>e.x?i.x-e.x:e.x-i.x,a=i.y>e.y?i.y-e.y:e.y-i.y,r=Math.floor(Math.sqrt(Math.pow(n,2)+Math.pow(a,2)));return{r:5>r?5:r}},ellipse:function(t){var e={},i=this.rect(t);return i.x&&(e.x=i.x),i.y&&(e.y=i.y),i.width&&(e.rx=i.width/2),i.height&&(e.ry=i.height/2),e},path:function(t){var i={};return t.path&&t.start&&(i.path="",e.forEach(t.path,function(e,n){i.path+=e[0],3===e.length&&(i.path+=n===t.pointIndex||0===t.pointIndex&&1===n?t.stop.x+","+t.stop.y:e[1]+","+e[2])})),i}};return i}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeMover",["jquery","lodash"],function(t,e){var i=function(t,i,a){var r;t&&t.type&&(r=e.bind(n[t.type],n),e.isFunction(r)&&t.animate(r(i,a)))},n={rect:function(t,e){return{x:e.x-t.x,y:e.y-t.y}},circle:function(t,e){return{cx:e.x,cy:e.y}},ellipse:function(t,e){return{cx:e.x,cy:e.y}},path:function(t,i){var n={path:""};return e.forEach(t.path,function(e){n.path+=e[0],3===e.length&&(n.path+=e[1]+i.x-t.x+","+(e[2]+i.y-t.y))}),n}};return i}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/pathBuilder",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic"],function(t,e,i){var n=function(t){var n={_path:null,closed:!1,set:null,points:[],getPath:function(){return this._path},start:function(t){return this.points=[],this.add(t)},add:function(e){var n,a=this;return n=t.circle(e.x,e.y,3).attr({stroke:"black","stroke-width":1,fill:"white",opacity:.7,cursor:"pointer"}).click(function(t){t.preventDefault(),t.stopPropagation(),a.points.length>2&&(this.attr("fill","green"),a.close())}),0===this.points.length&&(n.attr("fill","red"),this.set=t.set(),this._path=t.path("M"+e.x+","+e.y).attr(i._style.active).attr("opacity",.3),this.set.push(this._path)),this.points.push(e),this.set.push(n),this._path.animate({path:this._path.attr("path")+"L"+e.x+","+e.y}),this},close:function(){return this._path.attr({path:this._path.attr("path")+"Z"}).attr(i._style.active).attr("opacity",1),this.set.forEach(function(t){"circle"===t.type&&t.remove()}),this.closed=!0,e.isFunction(this.closeCb)&&this.closeCb(),this},onClose:function(t){return this.closeCb=t,this}};return n};return n}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeFactory",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeHandlers","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeResizer","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeMover","taoQtiItem/qtiCreator/widgets/interactions/helpers/pathBuilder"],function(t,e,i,n,a,r,o){var s=function(t){var n=t.paper,r=t.background,s=t.$container,l=t.isResponsive||!1,c=t.type||"rect",d={states:{drawing:!1},_events:{},on:function(t,i){e.isFunction(i)&&(this._events[t]=i)},is:function(t){return this.states[t]===!0},setState:function(t,e){this.states[t]=e},start:function(){switch(c){case"path":this.startDrawingPath();break;case"target":this.startPositionTarget();break;default:this.startWithMouse()}},startPositionTarget:function(){var t=this;t.setState("drawing",!0),r.click(function(e){e.preventDefault(),e.stopPropagation();var a=i.getPoint(e,n,s,l);i.createTarget(n,{point:a,create:function(e){t.setState("drawing",!1),r.unclick(),t._events["created.qti-widget"]&&t._events["created.qti-widget"].call(this,e)},remove:!1})})},startDrawingPath:function(){function t(){e.setState("drawing",!1),r.unclick(),e._events["created.qti-widget"]&&e._events["created.qti-widget"].call(this,a.getPath())}var e=this,a=o(n);e.setState("drawing",!0),a.onClose(t),r.click(function(t){t.preventDefault(),t.stopPropagation(),e.is("drawing")&&a.add(i.getPoint(t,n,s,l))
})},startWithMouse:function(){function t(){u.setState("drawing",!1),r.unmousedown().unmousemove().unmouseup(),h.unmousedown().unmouseup().unmousemove(),u._events["created.qti-widget"]&&u._events["created.qti-widget"].call(this,h)}function o(t){u.is("drawing")&&a(h,{start:d,stop:i.getPoint(t,n,s,l)})}var d,h,u=this,p=e.throttle(o,10);r.mousedown(function(e){e.preventDefault(),u.is("drawing")||(u.setState("drawing",!0),d=i.getPoint(e,n,s,l),h=i.createElement(n,c,[d.x,d.y,25,25],{style:"creator",hover:!1,touchEffect:!1,qtiCoords:!1}),h.mouseup(t),r.mouseup(t),h.mousemove(p),r.mousemove(p))})},stop:function(){r.unmousedown().unmousemove().unmouseup().unclick()}};return d};return s}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeEditor",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeHandlers","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeResizer","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeMover","taoQtiItem/qtiCreator/widgets/interactions/helpers/pathBuilder"],function(t,e,i,n,a,r){var o=function(o,s){var l=s.paper,c=s.background,d=s.$container,h=s.isResponsive||!1,u={shape:null,handlers:[],states:{drawing:!1,handling:!1,resizing:!1,moving:!1},_events:{},on:function(t,i){return e.isFunction(i)&&(this._events[t]=i),this},trigger:function(t){return e.isFunction(this._events[t])&&this._events[t].apply(this,Array.prototype.slice.call(arguments,1)),this},is:function(t){return this.states[t]===!0},setState:function(t,e){return this.states[t]=e,this},_init:function(t){var e=this;return t&&t.type&&(e.shape=t,c.click(function(){!e.is("resizing")&&e.is("handling")&&e.quitHandling()}),e.shape.click(function(){e.is("resizing")||(e.is("handling")?e.quitHandling():e.enterHandling())})),this},enterHandling:function(){function s(){var t=this;C.setState("resizing",!0).trigger("shapechanging.qti-widget"),C.layer=C.shape.clone(),C.layer.attr(i._style.basic),C.layer.attr("cursor",t.attrs.cursor),"path"===C.shape.type&&e.forEach(C.shape.attr("path"),function(t,e){return 3===t.length&&t[1]===this.attr("cx")&&t[2]===this.attr("cy")?(this.pointIndex=e,!1):void 0},t),e.invoke(e.reject(e.clone(C.handlers),function(e){return e===t}),"hide")}function u(t,n,r,o,s){var c,u;C.is("resizing")&&(c=i.getPoint(s,l,d,h),u={stop:c,constraints:this.data("constraints")},"path"===C.shape.type&&(u.start=e.pick(this.attrs,["cx","cy"]),u.path=C.layer.attr("path"),u.pointIndex=this.pointIndex),a(C.layer,u),this.animate("circle"===this.type?{cx:c.x,cy:c.y}:c))}function p(){C.shape.animate(e.pick(C.layer.attrs,["x","y","cx","cy","r","rx","ry","width","height","path"]),200,function(){C.setState("resizing",!1).trigger("shapechange.qti-widget")}),C.layer.remove(),e.invoke(C.handlers,"remove"),C.handlers=[]}function f(t){var i,n,a;if(!C.is("moving")){switch(C.setState("moving",!0),e.invoke(C.handlers,"remove"),i=o.attr(),C.shape.type){case"rect":a={x:0,y:0},n={x:39===t?i.x+1:37===t?i.x-1:i.x,y:40===t?i.y+1:38===t?i.y-1:i.y};break;case"ellipse":case"circle":a={x:0,y:0},n={x:39===t?i.cx+1:37===t?i.cx-1:i.cx,y:40===t?i.cy+1:38===t?i.cy-1:i.cy};break;case"path":a={path:i.path},n={}}r(C.shape,a,n),C.setState("moving",!1).trigger("shapechange.qti-widget")}}function m(t,n,a){C.setState("moving",!0).trigger("shapechanging.qti-widget");var r=i.getPoint(a,l,d,h);this.startPoint={x:r.x-this.attr("x"),y:r.y-this.attr("y")},"path"===this.type&&(this.startPoint.path=this.attr("path")),C.shape.attr("cursor","move"),c.attr("cursor","move"),e.invoke(C.handlers,"remove")}function g(t,e,n,a,o){C.is("moving")&&r(this,this.startPoint,i.getPoint(o,l,d,h))}function v(){delete this.startPoint,C.shape.attr("cursor","pointer"),c.attr("cursor","default"),C.setState("moving",!1).trigger("shapechange.qti-widget")}var C=this;if(C.setState("handling",!0).trigger("enterhandling.qti-widget"),"set"!==C.shape.type){C.handlers=n(l,C.shape),e.forEach(C.handlers,function(t){t.drag(u,s,p)}),C.shape.drag(g,m,v);var I=e.throttle(f,20);return t(document).on("keydown.qti-widget",function(t){var e=t.which;e>=37&&40>=e&&(t.preventDefault(),I(e))}),this}},quitHandling:function(){return t(document).off("keydown.qti-widget"),this.shape.undrag(),e.invoke(this.handlers,"remove"),this.handlers=[],this.setState("moving",!1).setState("resizing",!1).setState("handling",!1).trigger("quithandling.qti-widget"),this},removeShape:function(){var t,e;return this.shape&&(this.quitHandling(),t=this.shape.id,e=this.shape.data,this.shape.remove(),this.trigger("remove.qti-widget",t,e)),this},destroy:function(){return this.is("handling")&&this.quitHandling(),this.shape&&(this.shape.unclick(),c.unclick()),this.shape=null,this.handlers=[],this._events={},this}};return u._init(o)};return o}),define("tpl!taoQtiItem/qtiCreator/tpl/graphicInteraction/sidebar",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(){return"tall"}function o(t,e){var n,a,r="";return r+='\n        <li class="separator"></li>\n        <li data-type="target"><span title="'+u((n=i.__||t&&t.__,a={hash:{},data:e},n?n.call(t,"Drop the target to select a point",a):h.call(t,"__","Drop the target to select a point",a)))+'" class="icon-target"></span></li>\n        '}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var s,l,c,d="",h=i.helperMissing,u=this.escapeExpression,p=this;return d+='<div class="image-sidebar lft  ',s=i["if"].call(e,e&&e.showTarget,{hash:{},inverse:p.noop,fn:p.program(1,r,a),data:a}),(s||0===s)&&(d+=s),d+='">\n    <ul class="none forms solid">\n        <li data-type="rect"><span title="'+u((l=i.__||e&&e.__,c={hash:{},data:a},l?l.call(e,"Draw a rectangle on the image",c):h.call(e,"__","Draw a rectangle on the image",c)))+'" class="icon-rectangle"></span></li>\n        <li data-type="circle"><span title="'+u((l=i.__||e&&e.__,c={hash:{},data:a},l?l.call(e,"Draw a circle on the image",c):h.call(e,"__","Draw a circle on the image",c)))+'" class="icon-circle"></span></li>\n        <li data-type="ellipse"><span title="'+u((l=i.__||e&&e.__,c={hash:{},data:a},l?l.call(e,"Draw an ellipsis on the image",c):h.call(e,"__","Draw an ellipsis on the image",c)))+'" class="icon-ellipsis"></span></li>\n        <li data-type="path"><span title="'+u((l=i.__||e&&e.__,c={hash:{},data:a},l?l.call(e,"Draw a free form on the image",c):h.call(e,"__","Draw a free form on the image",c)))+'" class="icon-free-form"></span></li>\n    \n        ',s=i["if"].call(e,e&&e.showTarget,{hash:{},inverse:p.noop,fn:p.program(3,o,a),data:a}),(s||0===s)&&(d+=s),d+='\n\n        <li class="separator"></li>\n        <li class="bin disabled"><span title="'+u((l=i.__||e&&e.__,c={hash:{},data:a},l?l.call(e,"Remove the selected shape",c):h.call(e,"__","Remove the selected shape",c)))+'" class="icon-bin"></span></li>\n    </ul>\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeSideBar",["jquery","lodash","tpl!taoQtiItem/qtiCreator/tpl/graphicInteraction/sidebar"],function(t,e,i){var n={create:function(e,n){var a=e.find(".image-editor"),r=t(".main-image-box",a),o=t(i({showTarget:!!n})).insertBefore(a),s=t("li[data-type]",o),l=t("li.bin",o),c=parseInt(r.width(),10)-parseInt(o.outerWidth(),10)-2;return r.width(c),a.width(c),o.on("enablebin.qti-widget",function(){l.removeClass("disabled").on("click",function(t){t.preventDefault(),o.trigger("bin.qti-widget")})}),o.on("disablebin.qti-widget",function(){l.addClass("disabled").off("click")}),s.click(function(e){e.preventDefault();var i=t(this);i.hasClass("active")?(s.removeClass("active"),o.trigger("shapedeactive.qti-widget")):(s.removeClass("active"),i.addClass("active"),o.trigger("shapeactive.qti-widget",[i,i.data("type")]))}),e.on("resize.qti-widget",function(){o.find(".forms").height(a.innerHeight())}),e.trigger("resize.qti-widget",c),o},remove:function(e){var i=t(".image-sidebar",e),n=e.find(".image-editor"),a=t(".main-image-box",n);i.length&&(i.remove(),a.css("width","auto"),n.css("width","auto"),e.trigger("resize"))}};return n}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicAssociate",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s,l="",c=i.helperMissing,d=this.escapeExpression,h="function";return l+='<div class="panel">\n\n    \n    <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Interaction Background",s):c.call(e,"__","Interaction Background",s)))+'</h3>\n\n    <div class="panel">\n        <label for="data">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"File",s):c.call(e,"__","File",s)))+'</label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"The file path to the image.",s):c.call(e,"__","The file path to the image.",s)))+'</div>\n        <input type="text" name="data" value="',(o=i.data)?r=o.call(e,{hash:{},data:a}):(o=e&&e.data,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(o=i.baseUrl)?r=o.call(e,{hash:{},data:a}):(o=e&&e.baseUrl,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+')"/>\n        <button class="btn-info small block" data-role="upload-trigger">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Select image",s):c.call(e,"__","Select image",s)))+'</button>\n    </div>\n\n    <div>\n        <label for="width">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Width",s):c.call(e,"__","Width",s)))+'</label>\n        <input name="width" value="',(o=i.width)?r=o.call(e,{hash:{},data:a}):(o=e&&e.width,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n\n    <div>\n        <label for="height">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Height",s):c.call(e,"__","Height",s)))+'</label>\n        <input name="height" value="',(o=i.height)?r=o.call(e,{hash:{},data:a}):(o=e&&e.height,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n\n    <div>\n        <label for="type">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Mime Type",s):c.call(e,"__","Mime Type",s)))+'</label>\n        <input name="type" value="',(o=i.type)?r=o.call(e,{hash:{},data:a}):(o=e&&e.type,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n</div>\n'})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/hotspot",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s,l="",c=i.helperMissing,d=this.escapeExpression,h="function";return l+='\n<div class="panel">\n    <label for="">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"identifier",s):c.call(e,"__","identifier",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',s):c.call(e,"__",'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',s)))+'</div>\n\n    <input type="text" \n           name="identifier" \n           value="',(o=i.identifier)?r=o.call(e,{hash:{},data:a}):(o=e&&e.identifier,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" \n           placeholder="e.g. my-hotspot_1" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+');">\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Question",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeFactory","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeEditor","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeSideBar","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicAssociate","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/hotspot"],function(t,e,i,n,a,r,o,s,l,c,d,h,u){var p=[],f=function(){function n(t,n){var a=o(t,E);a.on("enterhandling.qti-widget",function(){e.invoke(e.reject(p,a),"quitHandling"),y.trigger("enablebin.qti-widget").on("bin.qti-widget",function(){a.removeShape(),a.destroy(),p=e.reject(p,a),a=void 0}),c(a.shape.id)}).on("shapechange.qti-widget",function(){var e=v.getChoice(t.id);e&&e.attr("coords",i.qtiCoords(t))}).on("quithandling.qti-widget",function(){h(),y.trigger("disablebin.qti-widget").off("click").off("bin.qti-widget")}).on("remove.qti-widget",function(t){v.removeChoice(t)}),p.push(a),n&&a.enterHandling()}function a(t,i){var n=f[t];f[t]||(n=r(e.merge({type:t},E)),f[t]=n),n.on("created.qti-widget",i),"path"===t?n.startDrawingPath():n.startWithMouse()}function c(t){var e=v.getChoice(t);e&&(b.empty().html(u({identifier:e.id(),fixed:e.attr("fixed"),serial:t})),l.initWidget(b),l.initDataBinding(b,e,{identifier:d.updateChoiceIdentifier,fixed:l.getAttributeChangeCallback()}))}function h(){b.empty()}var f={},m=this.widget,g=m.$container,v=m.element,C=v.paper,I=C.getById("bg-image-"+v.serial),b=m.choiceForm;e.forEach(v.getChoices(),function(t){var e=C.getById(t.serial);e&&e.attr(i._style.creator).unmouseover().unmouseout()}),t(window).on("resize.changestate",function(){m.changeState("sleep")});var E={paper:v.paper,background:I,$container:g.find(".main-image-box"),isResponsive:g.hasClass("responsive")},y=s.create(g);y.on("shapeactive.qti-widget",function(t,e,r){a(r,function(t){var a=v.createChoice({shape:"path"===r?"poly":r,coords:i.qtiCoords(t)});t.id=a.serial,e.removeClass("active"),n(t,!0)})}),e.forEach(this.widget.element.getChoices(),function(t){var e=C.getById(t.serial);e&&n(e)})},m=function(){var n=this.widget.$container,a=this.widget.element,r=a.paper;t(window).off("resize.changestate"),s.remove(n),e.invoke(p,"destroy"),p=[],e.forEach(a.getChoices(),function(t){var e=r.getById(t.serial);e&&e.attr(i._style.basic).hover(function(){e.flashing||i.updateElementState(this,"hover")},function(){e.flashing||i.updateElementState(this,this.active?"active":this.selectable?"selectable":"basic")})})},g=n.extend(a,f,m);return g.prototype.initForm=function(){var t=this.widget,i=t.$form,n=t.element;i.html(h({maxChoices:parseInt(n.attr("maxChoices")),minChoices:parseInt(n.attr("minChoices")),choicesCount:e.size(t.element.getChoices())})),l.initWidget(i);var a=l.getMinMaxAttributeCallbacks(this.widget.$form,"minChoices","maxChoices");l.initDataBinding(i,n,a),c.syncMaxChoices(t)},g}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e,i){function n(){i.forward(this.widget)}function a(){}return t.extend(e,n,a)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(t,e,i,n,a,r,o){function s(){var i=this.widget,n=i.element,s=n.getResponseDeclaration();a.destroy(n),r.appendInstruction(n,e("Please select the correct graphicAssociate choices below.")),a.render.call(n.getRenderer(),n),a.setResponse(n,o.serialize(t.values(s.getCorrect()),n)),i.$container.on("responseChange.qti-widget",function(t,e){s.setCorrect(o.unserialize(e,n))})}function l(){var t=this.widget,e=t.element;t.$container.off("responseChange.qti-widget"),r.removeInstructions(e),a.destroy(e),this.widget.createPaper()}return i.create(n,s,l)}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/response/graphicScoreMappingForm",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a,r,s="";return s+='\n        <div class="panel" data-edit="correct">\n            <label>\n                '+u((a=i.__||t&&t.__,r={hash:{},data:e},a?a.call(t,"Correct",r):h.call(t,"__","Correct",r)))+'\n                <input name="correct" type="checkbox" ',n=i["if"].call(t,t&&t.correct,{hash:{},inverse:p.noop,fn:p.program(2,o,e),data:e}),(n||0===n)&&(s+=n),s+=' />\n                <span class="icon-checkbox"></span>\n            </label>\n            <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n            <span class="tooltip-content">'+u((a=i.__||t&&t.__,r={hash:{},data:e},a?a.call(t,"Is this choice the correct response?",r):h.call(t,"__","Is this choice the correct response?",r)))+"</span>\n        </div>\n"}function o(){return' checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var s,l,c,d="",h=i.helperMissing,u=this.escapeExpression,p=this,f="function";return d+='    <a class="closer" href="#" data-close=":parent .graphic-mapping-editor"></a>\n    <div class="form-container">\n        <h2>',(l=i.identifier)?s=l.call(e,{hash:{},data:a}):(l=e&&e.identifier,s=typeof l===f?l.call(e,{hash:{},data:a}):l),d+=u(s)+"</h2>\n\n",s=i.unless.call(e,e&&e.noCorrect,{hash:{},inverse:p.noop,fn:p.program(1,r,a),data:a}),(s||0===s)&&(d+=s),d+='\n        <div class="panel">\n            <label for="score">'+u((l=i.__||e&&e.__,c={hash:{},data:a},l?l.call(e,"Score",c):h.call(e,"__","Score",c)))+'</label>\n            <input value="',(l=i.score)?s=l.call(e,{hash:{},data:a}):(l=e&&e.score,s=typeof l===f?l.call(e,{hash:{},data:a}):l),d+=u(s)+'" type="text" data-for="',(l=i.identifier)?s=l.call(e,{hash:{},data:a}):(l=e&&e.identifier,s=typeof l===f?l.call(e,{hash:{},data:a}):l),d+=u(s)+'" name="score" class="score" data-validate="$numeric" data-validate-option="$allowEmpty; $event(type=keyup)" />\n            <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n            <span class="tooltip-content">'+u((l=i.__||e&&e.__,c={hash:{},data:a},l?l.call(e,"Set the score for this response",c):h.call(e,"__","Set the score for this response",c)))+'</span>\n        </div>\n        <span class="arrow"></span>\n        <span class="arrow-cover"></span>\n    </div>\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Map",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","tpl!taoQtiItem/qtiCreator/tpl/forms/response/graphicScoreMappingForm","taoQtiItem/qtiCreator/widgets/helpers/formElement","ui/incrementer","ui/tooltipster"],function(t,e,i,n,a,r,o,s,l,c,d,h,u,p){function f(){var t=this.widget,n=t.element,a=n.getResponseDeclaration();r.destroy(n),o.appendInstruction(n,i("Please the score of each graphicAssociate choice.")),n.responseMappingMode=!0,t.createPaper(),g(t),r.setResponse(n,l.serialize(e.values(a.getCorrect()),n))}function m(){var t=this.widget,e=t.element;o.removeInstructions(e),r.destroy(e),this.widget.createPaper()}function g(i){var n={},a={},r=i.element,o=i.$container,l=r.getResponseDeclaration(),f=l.getMapEntries(),m=e.values(l.getCorrect()),g=t(".main-image-box",o),v=g.offset();e.forEach(r.getChoices(),function(u){var p=r.paper.getById(u.serial),C=t(p.node),I=t('<div class="graphic-mapping-editor"></div>'),b=C.offset(),E=p.getBBox();a[u.serial]=s.createShapeText(r.paper,p,{id:"score-"+u.serial,content:l.mappingAttributes.defaultValue||"0",style:"score-text-default",shapeClick:!0}).data("default",!0);var y=t(d({identifier:u.id(),correctDefined:c.isCorrectDefined(i),correct:e.contains(l.getCorrect(),u.id()),score:f[u.id()]||l.mappingAttributes.defaultValue,scoreMin:l.getMappingAttribute("lowerBound"),scoreMax:l.getMappingAttribute("upperBound")}));h.initDataBinding(y,l,{score:function(t,e){var i=a[u.serial];""===e?(t.removeMapEntry(u.id()),i.attr({text:l.mappingAttributes.defaultValue}).data("default",!0),s.updateElementState(i,"score-text-default")):(t.setMapEntry(u.id(),e,!0),i.attr({text:e}).data("default",!1),s.updateElementState(i,"score-text"))},correct:function(t,i){i===!0?e.contains(m,u.id())||(m.push(u.id()),p.active=!0,s.updateElementState(p,"active")):(m=e.without(m,u.id()),p.active=!1,s.updateElementState(p,"basic")),t.setCorrect(m)}}),I.css({display:"none",position:"absolute",width:"150px",height:"150px",background:"white",border:"solid 1px grey","text-align":"left","z-index":10009,top:b.top-v.top,left:b.left-v.left+E.width}).appendTo(g).append(y),g.css("overflow","visible"),n[u.serial]=I,p.click(function(){t(".graphic-mapping-editor",o).hide(),I.show()})}),u(o),p(o),r.paper.getById("bg-image-"+r.serial).click(function(){e.invoke(n,"hide")}),i.on("mappingAttributeChange",function(t){"defaultValue"===t.key&&e.forEach(a,function(e){e.data("default")===!0&&e.attr({text:t.value})})})}return n.create(a,f,m)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Map"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/Widget",["jquery","lodash","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/states","taoQtiItem/qtiCommonRenderer/helpers/Graphic"],function(t,e,i,n,a){var r=e.extend(i.clone(),{initCreator:function(t){this.baseUrl=t.baseUrl,this.choiceForm=t.choiceForm,this.registerStates(n),i.initCreator.call(this),this.createPaper()},destroy:function(){var e=this.$original,n=e.parents(".qti-itemBody");n.off("resizestop.gridEdit."+this.element.serial),t(window).off("resize.qti-widget"),i.destroy.call(this)},createPaper:function(){var i=this.$original,n=this.element.object.attributes;this.element.paper=a.responsivePaper("graphic-paper-"+this.element.serial,{width:n.width,height:n.height,img:this.baseUrl+n.data,imgId:"bg-image-"+this.element.serial,diff:t(".image-editor",i).outerWidth()-t(".main-image-box",i).outerWidth(),container:i}),e.forEach(this.element.getChoices(),this._currentChoices,this)},_currentChoices:function(t){a.createElement(this.element.paper,t.attr("shape"),t.attr("coords"),{id:t.serial,touchEffect:!1})}});return r}),define("taoQtiItem/qtiCreator/renderers/interactions/GraphicAssociateInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/Widget"],function(t,e,i){var n=t.clone(e);return n.render=function(t,n){return n=n||{},n.baseUrl=this.getOption("baseUrl"),n.choiceForm=this.getOption("choiceOptionForm"),i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),n)},n}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function(t,e){var i=function(){var t=this.widget,e=t.element;t.on("metaChange",function(i){"responsive"===i.key&&(i.value===!0?e.addClass("responsive"):e.removeClass("responsive"),t.rebuild())})},n=function(){};return t.extend(e,i,n)}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeSideBar","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeFactory","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeEditor"],function(t,e,i,n,a,r){return function(t,o){var s={editors:[],create:function(){function s(t,i){var n=r(t,C);n.on("enterhandling.qti-widget",function(){e.invoke(e.reject(d,n),"quitHandling"),I.trigger("enablebin.qti-widget").on("bin.qti-widget",function(){n.removeShape(),n.destroy(),d=e.reject(d,n),n=void 0}),e.isFunction(o.enterHandling)&&o.enterHandling(t)}).on("shapechanging.qti-widget",function(){e.isFunction(o.shapeChanging)&&o.shapeChanging(t)}).on("shapechange.qti-widget",function(){e.isFunction(o.shapeChange)&&o.shapeChange(t)}).on("quithandling.qti-widget",function(){e.isFunction(o.quitHandling)&&o.quitHandling(t),I.trigger("disablebin.qti-widget").off("click").off("bin.qti-widget")}).on("remove.qti-widget",function(t,i){e.isFunction(o.shapeRemoved)&&o.shapeRemoved(t,i),e.remove(v,t)}),d.push(n),i&&n.enterHandling()}function l(t,i){var n=h[t];h[t]||(n=a(e.merge({type:t},C)),h[t]=n),n.on("created.qti-widget",i),n.start()}function c(t,e,i){var n,a;"target"!==t?s(e,i):(n=m.getById("layer-"+e.id),a=m.set(e,n),a.id=e.id,a.data=e.data(),s(a,i))}var d=this.editors,h={},u=t.$container,p=t.$original,f=t.element,m=f.paper,g=m.getById("bg-image-"+f.serial),v=o.currents||e.pluck(f.getChoices(),"serial"),C={paper:f.paper,background:g,$container:u.find(".main-image-box"),isResponsive:p.hasClass("responsive")},I=n.create(u,!!o.target);I.on("shapeactive.qti-widget",function(t,i,n){l(n,function(t){e.isFunction(o.shapeCreated)&&o.shapeCreated(t,n),i.removeClass("active"),c(n,t)})}),e.forEach(v,function(t){var e=m.getById(t);e&&(e.attr(i._style.creator).unmouseover().unmouseout(),/^target/.test(e.id)?c("target",e):c(e.type,e,!1))})},destroy:function(){var a=t.$container,r=t.element,s=r.paper,l=o.currents||e.pluck(r.getChoices(),"serial");n.remove(a),e.invoke(this.editors,"destroy"),e.forEach(l,function(t){var e=s.getById(t);e&&e.attr(i._style.basic).hover(function(){e.flashing||i.updateElementState(this,"hover")},function(){e.flashing||i.updateElementState(this,this.active?"active":this.selectable?"selectable":"basic")})})}};return s}}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector",["jquery","util/image","ui/resourcemgr"],function(t,e){return function(i,n){var a=t('[data-role="upload-trigger"]',i),r=t("input[name=data]",i),o=t("input[name=width]",i),s=t("input[name=height]",i),l=t("input[name=type]",i);a.on("click",function(){a.resourcemgr({appendContainer:n.mediaManager.appendContainer,root:"/",browseUrl:n.mediaManager.browseUrl,uploadUrl:n.mediaManager.uploadUrl,deleteUrl:n.mediaManager.deleteUrl,downloadUrl:n.mediaManager.downloadUrl,params:{uri:n.uri,lang:n.lang,filters:"image/jpeg,image/png,image/gif"},pathParam:"path",select:function(t,i){var a;i.length>0&&(a=i[0],e.getSize(n.baseUrl+i[0].file,function(t){t&&t.width>=0&&(o.val(t.width).trigger("change"),s.val(t.height).trigger("change")),r.val(a.file).trigger("change"),l.val(a.mime).trigger("change")}))}})})}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicGapMatch",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s,l="",c=i.helperMissing,d=this.escapeExpression,h="function";return l+='<div class="panel">\n\n    \n    <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Interaction Background",s):c.call(e,"__","Interaction Background",s)))+'</h3>\n\n    <div class="panel">\n        <label for="data">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"File",s):c.call(e,"__","File",s)))+'</label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"The file path to the image.",s):c.call(e,"__","The file path to the image.",s)))+'</div>\n        <input type="text" name="data" value="',(o=i.data)?r=o.call(e,{hash:{},data:a}):(o=e&&e.data,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(o=i.baseUrl)?r=o.call(e,{hash:{},data:a}):(o=e&&e.baseUrl,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+')"/>\n        <button class="btn-info small block" data-role="upload-trigger">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Select image",s):c.call(e,"__","Select image",s)))+'</button>\n    </div>\n\n    <div>\n        <label for="width">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Width",s):c.call(e,"__","Width",s)))+'</label>\n        <input name="width" value="',(o=i.width)?r=o.call(e,{hash:{},data:a}):(o=e&&e.width,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n\n    <div>\n        <label for="height">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Height",s):c.call(e,"__","Height",s)))+'</label>\n        <input name="height" value="',(o=i.height)?r=o.call(e,{hash:{},data:a}):(o=e&&e.height,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n\n    <div>\n        <label for="type">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Mime Type",s):c.call(e,"__","Mime Type",s)))+'</label>\n        <input name="type" value="',(o=i.type)?r=o.call(e,{hash:{},data:a}):(o=e&&e.type,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n</div>\n'})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/associableHotspot",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s,l="",c=i.helperMissing,d=this.escapeExpression,h="function";return l+='\n<div class="panel">\n    <label for="">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"identifier",s):c.call(e,"__","identifier",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',s):c.call(e,"__",'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',s)))+'</div>\n\n    <input type="text" \n           name="identifier" \n           value="',(o=i.identifier)?r=o.call(e,{hash:{},data:a}):(o=e&&e.identifier,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" \n           placeholder="e.g. my-hotspot_1" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+');">\n</div>\n\n\n<h3>'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Allowed number of matches",s):c.call(e,"__","Allowed number of matches",s)))+'\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n        '+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"The maximum number of choices this choice may be associated with.",s):c.call(e,"__","The maximum number of choices this choice may be associated with.",s)))+"<br>\n        "+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"The minimum number of choices this choice must be associated with to form a valid response.",s):c.call(e,"__","The minimum number of choices this choice must be associated with to form a valid response.",s)))+'\n    </span>\n</h3>\n\n<div>\n    <label for="matchMin" class="spinner">Min</label>\n    <input name="matchMin" value="',(o=i.matchMin)?r=o.call(e,{hash:{},data:a}):(o=e&&e.matchMin,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-increment="1" data-min="0" data-max="',(o=i.choicesCount)?r=o.call(e,{hash:{},data:a}):(o=e&&e.choicesCount,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n</div>\n<div>\n    <label for="matchMax" class="spinner">Max</label>\n    <input name="matchMax" value="',(o=i.matchMax)?r=o.call(e,{hash:{},data:a}):(o=e&&e.matchMax,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-increment="1" data-min="0" data-max="',(o=i.choicesCount)?r=o.call(e,{hash:{},data:a}):(o=e&&e.choicesCount,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n</div>\n'
})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/gapImg",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s,l="",c=i.helperMissing,d=this.escapeExpression,h="function";return l+='<div class="panel">\n\n    \n    <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Interaction Background",s):c.call(e,"__","Interaction Background",s)))+'</h3>\n\n    <div class="panel">\n        <label for="data">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"File",s):c.call(e,"__","File",s)))+'</label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"The file path to the image.",s):c.call(e,"__","The file path to the image.",s)))+'</div>\n        <input type="text" name="data" value="',(o=i.data)?r=o.call(e,{hash:{},data:a}):(o=e&&e.data,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(o=i.baseUrl)?r=o.call(e,{hash:{},data:a}):(o=e&&e.baseUrl,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+')"/>\n        <button class="btn-info small block" data-role="upload-trigger">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Select image",s):c.call(e,"__","Select image",s)))+'</button>\n    </div>\n\n    <div>\n        <label for="width">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Width",s):c.call(e,"__","Width",s)))+'</label>\n        <input name="width" value="',(o=i.width)?r=o.call(e,{hash:{},data:a}):(o=e&&e.width,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n\n    <div>\n        <label for="height">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Height",s):c.call(e,"__","Height",s)))+'</label>\n        <input name="height" value="',(o=i.height)?r=o.call(e,{hash:{},data:a}):(o=e&&e.height,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n\n    <div>\n        <label for="type">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Mime type",s):c.call(e,"__","Mime type",s)))+'</label>\n        <input name="type" value="',(o=i.type)?r=o.call(e,{hash:{},data:a}):(o=e&&e.type,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n\n    <hr>\n\n    <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Allowed number of matches",s):c.call(e,"__","Allowed number of matches",s)))+'\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"The maximum number of choices this choice may be associated with.",s):c.call(e,"__","The maximum number of choices this choice may be associated with.",s)))+"<br>\n            "+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"The minimum number of choices this choice must be associated with to form a valid response.",s):c.call(e,"__","The minimum number of choices this choice must be associated with to form a valid response.",s)))+'\n        </span>\n    </h3>\n\n    <div>\n        <label for="matchMin" class="spinner">Min</label>\n        <input name="matchMin" value="',(o=i.matchMin)?r=o.call(e,{hash:{},data:a}):(o=e&&e.matchMin,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-increment="1" data-min="0" data-max="',(o=i.choicesCount)?r=o.call(e,{hash:{},data:a}):(o=e&&e.choicesCount,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n    <div>\n        <label for="matchMax" class="spinner">Max</label>\n        <input name="matchMax" value="',(o=i.matchMax)?r=o.call(e,{hash:{},data:a}):(o=e&&e.matchMax,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-increment="1" data-min="0" data-max="',(o=i.choicesCount)?r=o.call(e,{hash:{},data:a}):(o=e&&e.choicesCount,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Question",["jquery","lodash","i18n","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor","taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicGapMatch","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/associableHotspot","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/gapImg","tpl!taoQtiItem/qtiCreator/tpl/toolbars/media","taoQtiItem/qtiCreator/helper/dummyElement","taoQtiItem/qtiCreator/editor/editor"],function(t,e,i,n,a,r,o,s,l,c,d,h,u,p,f,m,g){var v=function(){function a(){var e=t("ul.source",C.$original),i=t('<li class="empty add-option"><div><span class="icon-add"></span></div></li>');i.on("click",function(){var t=I.createGapImg({});t.object.removeAttr("type"),r(t)}),i.appendTo(e)}function r(e,n){var a=t("ul.source",C.$original),r=t(".empty",a),o=t('[data-serial="'+e.serial+'"]',a);o.length||(o=t("<li></li>").insertBefore(r),o.data("serial",e.serial).attr("data-serial",e.serial)),e.object&&e.object.attributes.data?n===!0&&o.replaceWith(e.render()):o.empty().append(m.get({icon:"image",css:{width:60,height:60},title:i("Select an image.")})),o.addClass("widget-box"),t(f()).appendTo(o).show().click(function(t){t.preventDefault(),t.stopPropagation(),o.remove(),I.removeGapImg(e)}),o.off("click").on("click",function(){v(e.serial)})}function c(t){var i=I.getChoice(t);if(i){y.empty().html(u({identifier:i.id(),fixed:i.attr("fixed"),serial:t,matchMin:i.attr("matchMin"),matchMax:i.attr("matchMax"),choicesCount:e.size(I.getChoices())})),l.initWidget(y);var n=l.getMinMaxAttributeCallbacks(y,"matchMin","matchMax");n.identifier=d.updateChoiceIdentifier,n.fixed=l.getAttributeChangeCallback(),l.initDataBinding(y,i,n),R.show(),g.openSections(R.children("section")),g.closeSections(T.children("section"))}}function h(){"none"!==R.css("display")&&(g.openSections(T.children("section")),R.hide(),y.empty())}function v(t){var i,n=I.getGapImg(t);n&&(y.empty().html(p({identifier:n.id(),fixed:n.attr("fixed"),serial:t,matchMin:n.attr("matchMin"),matchMax:n.attr("matchMax"),choicesCount:e.size(I.getChoices()),baseUrl:b.baseUrl,data:n.object.attr("data"),width:n.object.attr("width"),height:n.object.attr("height"),type:n.object.attr("type")})),s(y,b),l.initWidget(y),i=l.getMinMaxAttributeCallbacks(y,"matchMin","matchMax"),i.identifier=d.updateChoiceIdentifier,i.fixed=l.getAttributeChangeCallback(),i.data=function(t,e){n.object.attr("data",e),r(n,!0)},i.width=function(t,e){n.object.attr("width",e)},i.height=function(t,e){n.object.attr("height",e)},i.type=function(t,e){e&&""!==e?n.object.attr("type",e):I.object.removeAttr("type")},l.initDataBinding(y,n,i),R.show(),g.openSections(R.children("section")),g.closeSections(T.children("section")),"function"==typeof window.scroll&&window.scroll(0,y.offset().top))}var C=this.widget,I=C.element,b=C.options,E=I.paper;if(E){var y=C.choiceForm,T=t("#item-editor-interaction-property-bar"),R=t("#item-editor-choice-property-bar");C._editor=o(C,{shapeCreated:function(t,e){var i=I.createChoice({shape:"path"===e?"poly":e,coords:n.qtiCoords(t)});t.id=i.serial},shapeRemoved:function(t){I.removeChoice(t)},enterHandling:function(t){c(t.id)},quitHandling:function(){h()},shapeChange:function(t){var e=I.getChoice(t.id);e&&e.attr("coords",n.qtiCoords(t))}}),C._editor.create(),e.forEach(I.getGapImgs(),r),a(),t(window).on("resize.changestate",function(){C.changeState("sleep")})}},C=function(){var e=this.widget,i=e.element,n=i.paper;n&&(t(window).off("resize.changestate"),e._editor&&e._editor.destroy(),t("ul.source .empty",e.$original).remove())},I=a.extend(r,v,C);return I.prototype.initForm=function(){var t=this.widget,e=t.options,i=t.element,n=t.$form;n.html(h({baseUrl:e.baseUrl,data:i.object.attr("data"),width:i.object.attr("width"),height:i.object.attr("height"),type:i.object.attr("type")})),s(n,e),l.initWidget(n);var a={};a.data=function(e,n){i.object.attr("data",n),t.rebuild({ready:function(t){t.changeState("question")}})},a.width=function(t,e){i.object.attr("width",e)},a.height=function(t,e){i.object.attr("height",e)},a.type=function(t,e){e&&""!==e?i.object.attr("type",e):i.object.removeAttr("type")},l.initDataBinding(n,i,a)},I}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e,i){function n(){i.forward(this.widget)}function a(){}return t.extend(e,n,a)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(t,e,i,n,a,r,o){function s(){var i=this.widget,n=i.element,s=n.getResponseDeclaration(),l=t.values(s.getCorrect());a.destroy(n),n.paper&&(r.appendInstruction(n,e("Please fill the gap with the correct choices below.")),i._createGapImgs(),a.render.call(n.getRenderer(),n),a.setResponse(n,o.serialize(t.invoke(l,String.prototype.split," "),n)),i.$container.on("responseChange.qti-widget",function(e,i){i.response&&i.response.list&&s.setCorrect(t.map(i.response.list.directedPair,function(t){return t.join(" ")}))}))}function l(){var t=this.widget,e=t.element;e.paper&&(t.$container.off("responseChange.qti-widget"),r.removeInstructions(e),a.destroy(e),this.widget.createPaper())}return i.create(n,s,l)}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/pairScorePopup",["jquery","lodash"],function(t){return function(e){var i=t('<div class="graphic-mapping-editor arrow-top-left"></div>'),n=(e.offset(),e.innerWidth()),a=e.innerHeight();return i.css({top:a-50,width:n-100}).appendTo(e),e.css({overflow:"visible",position:"relative"}),i}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/response/graphicGapMatchScoreMappingForm",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a,r="";return r+='\n            <div class="col-2" data-edit="correct">\n                <span>'+m((n=i.__||t&&t.__,a={hash:{},data:e},n?n.call(t,"Correct",a):f.call(t,"__","Correct",a)))+'</span>\n                <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n                <span class="tooltip-content">'+m((n=i.__||t&&t.__,a={hash:{},data:e},n?n.call(t,"Is this choice the correct response?",a):f.call(t,"__","Is this choice the correct response?",a)))+"</span>\n            </div>\n            "}function o(t,e){var n,a,r="";return r+='\n        <div class="panel grid-row">\n            <div class="col-4">\n               ',(a=i.choice)?n=a.call(t,{hash:{},data:e}):(a=t&&t.choice,n=typeof a===g?a.call(t,{hash:{},data:e}):a),r+=m(n)+'\n            </div>\n            <div class="col-4">\n               ',(a=i.gapImg)?n=a.call(t,{hash:{},data:e}):(a=t&&t.gapImg,n=typeof a===g?a.call(t,{hash:{},data:e}):a),r+=m(n)+"\n               ",n=i["if"].call(t,t&&t.gapImgSrc,{hash:{},inverse:v.noop,fn:v.program(4,s,e),data:e}),(n||0===n)&&(r+=n),r+="\n            </div>\n            \n            ",n=i.unless.call(t,t&&t.noCorrect,{hash:{},inverse:v.noop,fn:v.program(6,l,e),data:e}),(n||0===n)&&(r+=n),r+='\n\n            <div class="col-2">\n                <input value="',(a=i.score)?n=a.call(t,{hash:{},data:e}):(a=t&&t.score,n=typeof a===g?a.call(t,{hash:{},data:e}):a),r+=m(n)+'" type="text" name="',(a=i.id)?n=a.call(t,{hash:{},data:e}):(a=t&&t.id,n=typeof a===g?a.call(t,{hash:{},data:e}):a),r+=m(n)+'-score" class="score" data-validate="$numeric" data-validate-option="$allowEmpty; $event(type=keyup)" />\n            </div>\n        </div>\n        <hr>\n        '}function s(t,e){var n,a,r="";return r+='\n               <img src="',(a=i.gapImgSrc)?n=a.call(t,{hash:{},data:e}):(a=t&&t.gapImgSrc,n=typeof a===g?a.call(t,{hash:{},data:e}):a),r+=m(n)+'" width="32" alt="',(a=i.gapImg)?n=a.call(t,{hash:{},data:e}):(a=t&&t.gapImg,n=typeof a===g?a.call(t,{hash:{},data:e}):a),r+=m(n)+'" />\n               '}function l(t,e){var n,a,r="";return r+='\n            <div class="col-2" data-edit="correct">\n                <label>\n                    <input name="',(a=i.id)?n=a.call(t,{hash:{},data:e}):(a=t&&t.id,n=typeof a===g?a.call(t,{hash:{},data:e}):a),r+=m(n)+'-correct" type="checkbox" ',n=i["if"].call(t,t&&t.correct,{hash:{},inverse:v.noop,fn:v.program(7,c,e),data:e}),(n||0===n)&&(r+=n),r+=' />\n                    <span class="icon-checkbox"></span>\n                </label>\n            </div>\n            '}function c(){return' checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var d,h,u,p="",f=i.helperMissing,m=this.escapeExpression,g="function",v=this;return p+='    <div class="form-container">\n        <h2>',(h=i.title)?d=h.call(e,{hash:{},data:a}):(h=e&&e.title,d=typeof h===g?h.call(e,{hash:{},data:a}):h),p+=m(d)+'</h2>\n\n        <div class="panel grid-row">\n             <div class="col-4">'+m((h=i.__||e&&e.__,u={hash:{},data:a},h?h.call(e,"Gap",u):f.call(e,"__","Gap",u)))+'</div>\n             <div class="col-4">'+m((h=i.__||e&&e.__,u={hash:{},data:a},h?h.call(e,"Image",u):f.call(e,"__","Image",u)))+"</div>\n            \n            ",d=i.unless.call(e,e&&e.noCorrect,{hash:{},inverse:v.noop,fn:v.program(1,r,a),data:a}),(d||0===d)&&(p+=d),p+='\n\n            <div class="col-2">\n                <span>'+m((h=i.__||e&&e.__,u={hash:{},data:a},h?h.call(e,"Score",u):f.call(e,"__","Score",u)))+'</span>\n                <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n                <span class="tooltip-content">'+m((h=i.__||e&&e.__,u={hash:{},data:a},h?h.call(e,"Set the score for this response",u):f.call(e,"__","Set the score for this response",u)))+"</span>\n            </div>\n        </div>\n        ",d=i.each.call(e,e&&e.mappings,{hash:{},inverse:v.noop,fn:v.program(3,o,a),data:a}),(d||0===d)&&(p+=d),p+='\n\n        <span class="arrow"></span>\n        <span class="arrow-cover"></span>\n    </div>\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Map",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","taoQtiItem/qtiCreator/widgets/interactions/helpers/pairScorePopup","tpl!taoQtiItem/qtiCreator/tpl/forms/response/graphicGapMatchScoreMappingForm","taoQtiItem/qtiCreator/widgets/helpers/formElement","ui/deleter","ui/tooltipster"],function(t,e,i,n,a,r,o,s,l,c,d,h,u){function p(){var t=this.widget,n=t.element,a=n.getResponseDeclaration(),s=e.values(a.getCorrect());r.destroy(n),n.paper&&(o.appendInstruction(n,i("Please fill the gap with the images below, then edit the score for each gap/image pair.")),n.responseMappingMode=!0,t._createGapImgs(),r.render.call(n.getRenderer(),n),0===e.size(a.getMapEntries())?(r.setResponse(n,l.serialize(e.invoke(s,String.prototype.split," "),n)),m(t,s)):(r.setResponse(n,l.serialize(e.invoke(e.keys(a.getMapEntries()),String.prototype.split," "),n)),m(t)),t.$container.on("responseChange.qti-widget",function(i,n){m(t,e.map(n.response.list.directedPair,function(t){return t.join(" ")}))}))}function f(){var e=this.widget,i=e.element;i.paper&&(t(".graphic-mapping-editor").remove(),o.removeInstructions(i),r.destroy(i),this.widget.createPaper())}function m(n,a){var r=[],o=n.$container,s=n.element,l=n.options,p=s.getResponseDeclaration(),f=c.isCorrectDefined(n),m=e.values(p.getCorrect()),g=p.getMapEntries(),v={};e.forEach(s.getGapImgs(),function(t){v[t.id()]=t}),a?(p.removeMapEntries(),e.forEach(a,function(t){var i=t.split(" "),n=(e.contains(m,t),g[t]||p.mappingAttributes.defaultValue);r.push({score:n,choice:i[0],gapImg:i[1],gapImgSrc:l.baseUrl+v[i[1]].object.attr("data"),id:t.replace(" ","__"),correctDefined:f,correct:e.contains(m,t)}),p.setMapEntry(t,n)})):e.forEach(g,function(t,i){var n=i.split(" ");r.push({score:t,choice:n[0],gapImgId:n[1],gapImgSrc:l.baseUrl+v[n[1]].object.attr("data"),id:i.replace(" ","__"),correctDefined:f,correct:e.contains(m,i)})}),t(".graphic-mapping-editor").remove();var C=d(o),I=t(h({title:i("Pair scoring"),correctDefined:c.isCorrectDefined(n),scoreMin:p.getMappingAttribute("lowerBound"),scoreMax:p.getMappingAttribute("upperBound"),mappings:r})),b={};e.forEach(r,function(t){var i=t.id.replace("__"," ");b[t.id+"-score"]=function(t,e){t.setMapEntry(i,e)},b[t.id+"-correct"]=function(t,n){n===!0?e.contains(m,i)||m.push(i):m=e.without(m,i),t.setCorrect(m)}}),u.initDataBinding(I,p,b),C.empty().html(I)}return n.create(a,p,f)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Map"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/Widget",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/states","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/helper/dummyElement","tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gapImg"],function(t,e,i,n,a,r,o){var s=e.extend(n.clone(),{initCreator:function(t){this.baseUrl=t.baseUrl,this.choiceForm=t.choiceForm,this.registerStates(a),n.initCreator.call(this),this.createPaper()},destroy:function(){var e=this.$original,i=e.parents(".qti-itemBody");i.off("resizestop.gridEdit."+this.element.serial),t(window).off("resize.qti-widget"),n.destroy.call(this)},createPaper:function(){var i,n=this.$original,a=n.parents(".qti-itemBody"),o=t("ul.source",n),s=t(".main-image-box",n),l=this.element.object.attributes;l.data?(i=t(".image-editor",n).outerWidth(!0)-s.innerWidth(),this.element.paper=r.responsivePaper("graphic-paper-"+this.element.serial,{width:l.width,height:l.height,img:this.baseUrl+l.data,imgId:"bg-image-"+this.element.serial,diff:i,container:n,resize:function(t){var e=s.innerWidth()-i;l.width<e&&(e=l.width),o.width((e>t?t:e)+"px")}}),a.on("resizestop.gridEdit."+this.element.serial,function(){n.trigger("resize.qti-widget")}),e.forEach(this.element.getChoices(),this._currentChoices,this),this._createGapImgs()):this._createPlaceholder()},_createPlaceholder:function(){var t=this.$original,e=t.find(".main-image-box");o.get({icon:"image",css:{width:t.innerWidth()-35,height:200},title:i("Select an image first.")}).appendTo(e)},_currentChoices:function(t){r.createElement(this.element.paper,t.attr("shape"),t.attr("coords"),{id:t.serial,touchEffect:!1})},_createGapImgs:function(){var i=this.element,n=this.$original,a=t("ul.source",n);a.empty(),e.forEach(i.gapImgs,function(t){a.append(t.render())})}});return s}),define("taoQtiItem/qtiCreator/renderers/interactions/GraphicGapMatchInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/Widget"],function(t,e,i){var n=t.clone(e);return n.render=function(t,n){return n=n||{},n.baseUrl=this.getOption("baseUrl"),n.choiceForm=this.getOption("choiceOptionForm"),n.uri=this.getOption("uri"),n.lang=this.getOption("lang"),n.mediaManager=this.getOption("mediaManager"),i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),n)},n}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function(t,e){var i=function(){var t=this.widget,e=t.element;t.on("metaChange",function(i){"responsive"===i.key&&(i.value===!0?e.addClass("responsive"):e.removeClass("responsive"),t.rebuild())})},n=function(){};return t.extend(e,i,n)}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicOrder",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s,l="",c=i.helperMissing,d=this.escapeExpression,h="function";return l+='<div class="panel">\n\n    \n    <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Interaction Background",s):c.call(e,"__","Interaction Background",s)))+'</h3>\n\n    <div class="panel">\n        <label for="data">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"File",s):c.call(e,"__","File",s)))+'</label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"The file path to the image.",s):c.call(e,"__","The file path to the image.",s)))+'</div>\n        <input type="text" name="data" value="',(o=i.data)?r=o.call(e,{hash:{},data:a}):(o=e&&e.data,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(o=i.baseUrl)?r=o.call(e,{hash:{},data:a}):(o=e&&e.baseUrl,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+')"/>\n        <button class="btn-info small block" data-role="upload-trigger">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Select image",s):c.call(e,"__","Select image",s)))+'</button>\n    </div>\n\n    <div>\n        <label for="width">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Width",s):c.call(e,"__","Width",s)))+'</label>\n        <input name="width" value="',(o=i.width)?r=o.call(e,{hash:{},data:a}):(o=e&&e.width,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n\n    <div>\n        <label for="height">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Height",s):c.call(e,"__","Height",s)))+'</label>\n        <input name="height" value="',(o=i.height)?r=o.call(e,{hash:{},data:a}):(o=e&&e.height,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n\n    <div>\n        <label for="type">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Mime Type",s):c.call(e,"__","Mime Type",s)))+'</label>\n        <input name="type" value="',(o=i.type)?r=o.call(e,{hash:{},data:a}):(o=e&&e.type,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n\n    <hr>\n\n    <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Allowed number of choices",s):c.call(e,"__","Allowed number of choices",s)))+'\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"The minimum number of choices that the candidate is required to select to form a valid response.",s):c.call(e,"__","The minimum number of choices that the candidate is required to select to form a valid response.",s)))+"<br>\n            "+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"The maximum number of choices that the candidate is allowed to select.",s):c.call(e,"__","The maximum number of choices that the candidate is allowed to select.",s)))+'\n        </span>\n    </h3>\n\n    <div>\n        <label for="minChoices" class="spinner">Min</label>\n        <input name="minChoices" value="',(o=i.minChoices)?r=o.call(e,{hash:{},data:a}):(o=e&&e.minChoices,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-increment="1" data-min="0" data-max="',(o=i.choicesCount)?r=o.call(e,{hash:{},data:a}):(o=e&&e.choicesCount,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n    <div>\n        <label for="maxChoices" class="spinner">Max</label>\n        <input name="maxChoices" value="',(o=i.maxChoices)?r=o.call(e,{hash:{},data:a}):(o=e&&e.maxChoices,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-increment="1" data-min="0" data-max="',(o=i.choicesCount)?r=o.call(e,{hash:{},data:a}):(o=e&&e.choicesCount,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Question",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor","taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicOrder","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/hotspot","taoQtiItem/qtiCreator/editor/editor"],function(t,e,i,n,a,r,o,s,l,c,d,h,u){var p=function(){function e(t){var e=o.getChoice(t);e&&(d.empty().html(h({identifier:e.id(),fixed:e.attr("fixed"),serial:t})),s.initWidget(d),s.initDataBinding(d,e,{identifier:c.updateChoiceIdentifier,fixed:s.getAttributeChangeCallback()}),f.show(),u.openSections(f.children("section")),u.closeSections(p.children("section")))}function n(){"none"!==f.css("display")&&(u.openSections(p.children("section")),f.hide(),d.empty())}var a=this.widget,o=a.element,l=o.paper;if(l){var d=a.choiceForm,p=t("#item-editor-interaction-property-bar"),f=t("#item-editor-choice-property-bar");a._editor=r(a,{shapeCreated:function(t,e){var n=o.createChoice({shape:"path"===e?"poly":e,coords:i.qtiCoords(t)});t.id=n.serial},shapeRemoved:function(t){o.removeChoice(t)},enterHandling:function(t){e(t.id)},quitHandling:function(){n()},shapeChange:function(t){var e=o.getChoice(t.id);e&&e.attr("coords",i.qtiCoords(t))}}),a._editor.create(),t(window).on("resize.changestate",function(){a.changeState("sleep")}),a.on("attributeChange",function(t){"maxChoices"===t.key&&a.renderOrderList()})}},f=function(){var e=this.widget,i=e.element,n=i.paper;n&&(t(window).off("resize.changestate"),e._editor&&e._editor.destroy())},m=n.extend(a,p,f);return m.prototype.initForm=function(){var t=this.widget,i=t.options,n=t.element,a=t.$form;a.html(d({baseUrl:i.baseUrl,maxChoices:parseInt(n.attr("maxChoices")),minChoices:parseInt(n.attr("minChoices")),choicesCount:e.size(n.getChoices()),data:n.object.attr("data"),width:n.object.attr("width"),height:n.object.attr("height"),type:n.object.attr("type")})),o(a,i),s.initWidget(a);var r=s.getMinMaxAttributeCallbacks(this.widget.$form,"minChoices","maxChoices");r.data=function(e,i){n.object.attr("data",i),t.rebuild({ready:function(t){t.changeState("question")}})},r.width=function(t,e){n.object.attr("width",e)},r.height=function(t,e){n.object.attr("height",e)},r.type=function(t,e){e&&""!==e?n.object.attr("type",e):n.object.removeAttr("type")},s.initDataBinding(a,n,r),l.syncMaxChoices(t)},m}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e,i){function n(){i.forward(this.widget)}function a(){}return t.extend(e,n,a)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicOrderInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(t,e,i,n,a,r,o){function s(){var i=this.widget,n=i.element,s=n.getResponseDeclaration();a.destroy(n),n.paper&&(r.appendInstruction(n,e("Please order the choices below to set the correct answer")),a.render.call(n.getRenderer(),n),a.setResponse(n,o.serialize(t.values(s.getCorrect()),n)),i.$container.on("responseChange.qti-widget",function(t,e){s.setCorrect(o.unserialize(e.response,n))}))}function l(){var t=this.widget,e=t.element;e.paper&&(t.$container.off("responseChange.qti-widget"),r.removeInstructions(e),a.destroy(e),this.widget.createPaper())}return i.create(n,s,l)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Correct"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/Widget",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/states","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/helper/dummyElement"],function(t,e,i,n,a,r,o){var s=e.extend(n.clone(),{initCreator:function(t){this.baseUrl=t.baseUrl,this.choiceForm=t.choiceForm,this.registerStates(a),n.initCreator.call(this),this.createPaper()},destroy:function(){var e=this.$original,i=e.parents(".qti-itemBody");i.off("resizestop.gridEdit."+this.element.serial),t(window).off("resize.qti-widget"),n.destroy.call(this)},createPaper:function(){var i=this.element,n=this.$original,a=n.parents(".qti-itemBody"),o=t("ul.block-listing",n),s=i.object.attributes;s.data?(this.element.paper=r.responsivePaper("graphic-paper-"+i.serial,{width:s.width,height:s.height,img:this.baseUrl+s.data,imgId:"bg-image-"+i.serial,diff:t(".image-editor",n).outerWidth(!0)-t(".main-image-box",n).innerWidth(),container:n,resize:function(t){var e=o.outerWidth(!0)-o.width(),i=(t<s.width?t:s.width)-(e>0?e:0)+8;o.width(i)}}),a.on("resizestop.gridEdit."+i.serial,function(){n.trigger("resize.qti-widget")}),e.forEach(i.getChoices(),this._currentChoices,this),this.renderOrderList()):this._createPlaceholder()},_createPlaceholder:function(){var t=this.$original,e=t.find(".main-image-box");o.get({icon:"image",css:{width:t.innerWidth()-35,height:200},title:i("Select an image first.")}).appendTo(e)},_currentChoices:function(t){r.createElement(this.element.paper,t.attr("shape"),t.attr("coords"),{id:t.serial,touchEffect:!1})},renderOrderList:function(){var i=this.element,n=e.size(i.getChoices()),a=i.attr("minChoices"),r=i.attr("maxChoices"),o=t("ul.block-listing",this.$original);r>0&&n>r?n=r:a>0&&n>a&&(n=a),o.empty(),e.times(n,function(e){var i=e+1,n=t('<li class="selectable" data-number="'+i+'">'+i+"</li>");
0===e&&n.addClass("active"),o.append(n)})}});return s}),define("taoQtiItem/qtiCreator/renderers/interactions/GraphicOrderInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicOrderInteraction","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/Widget"],function(t,e,i){var n=t.clone(e);return n.render=function(t,n){return n=n||{},n.baseUrl=this.getOption("baseUrl"),n.choiceForm=this.getOption("choiceOptionForm"),n.uri=this.getOption("uri"),n.lang=this.getOption("lang"),n.mediaManager=this.getOption("mediaManager"),i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),n)},n}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function(t,e){var i=function(){var t=this.widget,e=t.element;t.on("metaChange",function(i){"responsive"===i.key&&(i.value===!0?e.addClass("responsive"):e.removeClass("responsive"),t.rebuild())})},n=function(){};return t.extend(e,i,n)}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/hotspot",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s,l="",c=i.helperMissing,d=this.escapeExpression,h="function";return l+='<div class="panel">\n\n    \n    <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Interaction Background",s):c.call(e,"__","Interaction Background",s)))+'</h3>\n\n    <div class="panel">\n        <label for="data">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"File",s):c.call(e,"__","File",s)))+'</label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"The file path to the image.",s):c.call(e,"__","The file path to the image.",s)))+'</div>\n        <input type="text" name="data" value="',(o=i.data)?r=o.call(e,{hash:{},data:a}):(o=e&&e.data,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(o=i.baseUrl)?r=o.call(e,{hash:{},data:a}):(o=e&&e.baseUrl,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+')"/>\n        <button class="btn-info small block" data-role="upload-trigger">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Select image",s):c.call(e,"__","Select image",s)))+'</button>\n    </div>\n\n    <div>\n        <label for="width">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Width",s):c.call(e,"__","Width",s)))+'</label>\n        <input name="width" value="',(o=i.width)?r=o.call(e,{hash:{},data:a}):(o=e&&e.width,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n\n    <div>\n        <label for="height">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Height",s):c.call(e,"__","Height",s)))+'</label>\n        <input name="height" value="',(o=i.height)?r=o.call(e,{hash:{},data:a}):(o=e&&e.height,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n\n    <div>\n        <label for="type">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Mime Type",s):c.call(e,"__","Mime Type",s)))+'</label>\n        <input name="type" value="',(o=i.type)?r=o.call(e,{hash:{},data:a}):(o=e&&e.type,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n\n    <hr>\n\n    <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Allowed number of choices",s):c.call(e,"__","Allowed number of choices",s)))+'\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            The minimum number of choices that the candidate is required to select to form a valid response.\n            The maximum number of choices that the candidate is allowed to select.\n        </span>\n    </h3>\n\n    <div>\n        <label for="minChoices" class="spinner">Min</label>\n        <input name="minChoices" value="',(o=i.minChoices)?r=o.call(e,{hash:{},data:a}):(o=e&&e.minChoices,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-increment="1" data-min="0" data-max="',(o=i.choicesCount)?r=o.call(e,{hash:{},data:a}):(o=e&&e.choicesCount,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n    <div>\n        <label for="maxChoices" class="spinner">Max</label>\n        <input name="maxChoices" value="',(o=i.maxChoices)?r=o.call(e,{hash:{},data:a}):(o=e&&e.maxChoices,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-increment="1" data-min="0" data-max="',(o=i.choicesCount)?r=o.call(e,{hash:{},data:a}):(o=e&&e.choicesCount,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Question",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor","taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/hotspot","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/hotspot","taoQtiItem/qtiCreator/editor/editor"],function(t,e,i,n,a,r,o,s,l,c,d,h,u){var p=function(){function e(t){var e=o.getChoice(t);e&&(d.empty().html(h({identifier:e.id(),fixed:e.attr("fixed"),serial:t})),s.initWidget(d),s.initDataBinding(d,e,{identifier:c.updateChoiceIdentifier,fixed:s.getAttributeChangeCallback()}),f.show(),u.openSections(f.children("section")),u.closeSections(p.children("section")))}function n(){"none"!==f.css("display")&&(u.openSections(p.children("section")),f.hide(),d.empty())}var a=this.widget,o=a.element,l=o.paper;if(l){var d=a.choiceForm,p=t("#item-editor-interaction-property-bar"),f=t("#item-editor-choice-property-bar");a._editor=r(a,{shapeCreated:function(t,e){var n=o.createChoice({shape:"path"===e?"poly":e,coords:i.qtiCoords(t)});t.id=n.serial},shapeRemoved:function(t){o.removeChoice(t)},enterHandling:function(t){e(t.id)},quitHandling:function(){n()},shapeChange:function(t){var e=o.getChoice(t.id);e&&e.attr("coords",i.qtiCoords(t))}}),a._editor.create(),t(window).on("resize.changestate",function(){a.changeState("sleep")})}},f=function(){var e=this.widget,i=e.element,n=i.paper;n&&(t(window).off("resize.changestate"),e._editor&&e._editor.destroy())},m=n.extend(a,p,f);return m.prototype.initForm=function(){var t=this.widget,i=t.options,n=t.element,a=t.$form;a.html(d({baseUrl:i.baseUrl,maxChoices:parseInt(n.attr("maxChoices")),minChoices:parseInt(n.attr("minChoices")),choicesCount:e.size(n.getChoices()),data:n.object.attr("data"),width:n.object.attr("width"),height:n.object.attr("height"),type:n.object.attr("type")})),o(a,i),s.initWidget(a);var r=s.getMinMaxAttributeCallbacks(this.widget.$form,"minChoices","maxChoices");r.data=function(e,i){n.object.attr("data",i),t.rebuild({ready:function(t){t.changeState("question")}})},r.width=function(t,e){n.object.attr("width",e)},r.height=function(t,e){n.object.attr("height",e)},r.type=function(t,e){e&&""!==e?n.object.attr("type",e):n.object.removeAttr("type")},s.initDataBinding(a,n,r),l.syncMaxChoices(t)},m}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e,i){function n(){i.forward(this.widget)}function a(){}return t.extend(e,n,a)}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(t,e,i,n,a,r,o){function s(){var i=this.widget,n=i.element,s=n.getResponseDeclaration();a.destroy(n),n.paper&&(r.appendInstruction(n,e("Please select the correct hotspot choices below.")),a.render.call(n.getRenderer(),n),a.setResponse(n,o.serialize(t.values(s.getCorrect()),n)),i.$container.on("responseChange.qti-widget",function(t,e){s.setCorrect(o.unserialize(e.response,n))}))}function l(){var t=this.widget,e=t.element;e.paper&&(t.$container.off("responseChange.qti-widget"),r.removeInstructions(e),a.destroy(e),this.widget.createPaper())}return i.create(n,s,l)}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicScorePopup",["jquery","lodash"],function(t){return function(e,i,n,a){var r,o=10,s=t(i.node),l=t('<div class="graphic-mapping-editor arrow-left-top"></div>'),c=n.offset(),d=s.offset(),h=i.getBBox(),u=h.width;return a&&(r=e.w/e.width,u=2*Math.round(u*(2-r))),l.css({top:d.top-c.top-o,left:d.left-c.left+u+o}).appendTo(n),n.css("overflow","visible"),l}}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Map",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicScorePopup","tpl!taoQtiItem/qtiCreator/tpl/forms/response/graphicScoreMappingForm","taoQtiItem/qtiCreator/widgets/helpers/formElement","ui/deleter","ui/tooltipster"],function(t,e,i,n,a,r,o,s,l,c,d,h,u,p,f){function m(){var t=this.widget,n=t.element,a=n.getResponseDeclaration();r.destroy(n),n.paper&&(o.appendInstruction(n,i("Please the score of each hotspot choice.")),n.responseMappingMode=!0,t.createPaper(),v(t),r.setResponse(n,l.serialize(e.values(a.getCorrect()),n)))}function g(){var t=this.widget,e=t.element;e.paper&&(o.removeInstructions(e),r.destroy(e),this.widget.createPaper())}function v(i){var n={},a=i.element,r=i.$original,o=r.hasClass("responsive"),l=t(".main-image-box",r),m=a.getResponseDeclaration(),g=m.getMapEntries(),v=e.values(m.getCorrect());e.forEach(a.getChoices(),function(p){var f=a.paper.getById(p.serial),C=d(a.paper,f,l,o),I=g[p.id()]||m.mappingAttributes.defaultValue||"0";n[p.serial]=s.createShapeText(a.paper,f,{id:"score-"+p.serial,content:I,style:"score-text-default",shapeClick:!0}).data("default",!0);var b=t(h({identifier:p.id(),correctDefined:c.isCorrectDefined(i),correct:e.contains(m.getCorrect(),p.id()),score:I,scoreMin:m.getMappingAttribute("lowerBound"),scoreMax:m.getMappingAttribute("upperBound")}));u.initDataBinding(b,m,{score:function(t,e){var i=n[p.serial];""===e?(t.removeMapEntry(p.id()),i.attr({text:t.mappingAttributes.defaultValue}).data("default",!0),s.updateElementState(i,"score-text-default")):(t.setMapEntry(p.id(),e,!0),i.attr({text:e}).data("default",!1),s.updateElementState(i,"score-text"))},correct:function(t,i){i===!0?e.contains(v,p.id())||(v.push(p.id()),f.active=!0,s.updateElementState(f,"active")):(v=e.without(v,p.id()),f.active=!1,s.updateElementState(f,"basic")),t.setCorrect(v)}}),f.click(function(){t(".graphic-mapping-editor",r).hide(),C.show()}),C.append(b)}),p(r),f(r),a.paper.getById("bg-image-"+a.serial).click(function(){t(".graphic-mapping-editor",r).hide()}),i.on("mappingAttributeChange",function(t){"defaultValue"===t.key&&e.forEach(n,function(e){e.data("default")===!0&&e.attr({text:t.value})})})}return n.create(a,m,g)}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Map"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/Widget",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/states","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/helper/dummyElement"],function(t,e,i,n,a,r,o){var s=e.extend(n.clone(),{initCreator:function(t){this.baseUrl=t.baseUrl,this.choiceForm=t.choiceForm,this.registerStates(a),n.initCreator.call(this),this.createPaper()},destroy:function(){var e=this.$original,i=e.parents(".qti-itemBody");i.off("resizestop.gridEdit."+this.element.serial),t(window).off("resize.qti-widget"),n.destroy.call(this)},createPaper:function(){var i=this.$original,n=i.parents(".qti-itemBody"),a=this.element.object.attributes;a.data?(this.element.paper=r.responsivePaper("graphic-paper-"+this.element.serial,{width:a.width,height:a.height,img:this.baseUrl+a.data,imgId:"bg-image-"+this.element.serial,diff:t(".image-editor",i).outerWidth(!0)-t(".main-image-box",i).innerWidth(),container:i}),n.on("resizestop.gridEdit."+this.element.serial,function(){i.trigger("resize.qti-widget")}),e.forEach(this.element.getChoices(),this._currentChoices,this)):this._createPlaceholder()},_createPlaceholder:function(){var t=this.$original,e=t.find(".main-image-box");o.get({icon:"image",css:{width:t.innerWidth()-35,height:200},title:i("Select an image first.")}).appendTo(e)},_currentChoices:function(t){r.createElement(this.element.paper,t.attr("shape"),t.attr("coords"),{id:t.serial,touchEffect:!1})}});return s}),define("taoQtiItem/qtiCreator/renderers/interactions/HotspotInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/Widget"],function(t,e,i){var n=t.clone(e);return n.render=function(t,n){return n=n||{},n.baseUrl=this.getOption("baseUrl"),n.choiceForm=this.getOption("choiceOptionForm"),n.uri=this.getOption("uri"),n.lang=this.getOption("lang"),n.mediaManager=this.getOption("mediaManager"),i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),n)},n}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget"],function(t){var e=t.clone();return e.destroy=function(){this.$original.off(".qti-widget"),this.$container.remove(),this.offEvents()},e}),define("taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/Question",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Question","taoQtiItem/qtiCreator/widgets/choices/helpers/formElement","lodash"],function(t,e,i,n,a){var r=e.extend(i,function(){this.buildEditor()},function(){this.destroyEditor()});return r.prototype.createToolbar=function(){var t=this.widget,e=t.$container.find("td:last");return n.initShufflePinToggle(t),n.initDelete(t),e},r.prototype.buildEditor=function(){var e=this.widget,i=e.$container.children("td:first");i.attr("contentEditable",!0),i.on("keyup.qti-widget",a.throttle(function(){e.element.val(t(this).text()),e.$original.width(t(this).width())},200)).on("focus.qti-widget",function(){e.changeState("choice")}).on("keypress.qti-widget",function(i){13===i.which&&(i.preventDefault(),t(this).blur(),e.changeState("question"))})},r.prototype.destroyEditor=function(){var t=this.widget.$container;t.find("td").removeAttr("contentEditable"),t.children("td:first").off("keyup.qti-widget")},r}),define("taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Choice","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/choice","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier"],function(t,e,i,n,a){var r=t.extend(e);return r.prototype.initForm=function(){var t=this.widget;t.$form.html(i({serial:t.element.getSerial(),identifier:t.element.id()})),n.initDataBinding(t.$form,t.element,{identifier:a.updateChoiceIdentifier})},r}),define("taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/states","taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/Question","taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/Choice"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/inlineChoice/Widget",["taoQtiItem/qtiCreator/widgets/choices/Widget","taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){t.initCreator.call(this),this.registerStates(e)},i}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function(t,e){var i=t.create(e,function(){var t=this.widget,e=this.widget.$original;e.on("click.qti-widget.sleep",function(e){e.stopPropagation(),t.changeState("question")}),e.on("mouseenter.sleep",function(){e.addClass("hover"),e.parent().trigger("mouseleave.sleep")}).on("mouseleave.sleep",function(){e.removeClass("hover"),e.parent().trigger("mouseenter.sleep")})},function(){this.widget.$original.removeClass("hover").off(".sleep")});return i}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/Active",["jquery","lodash","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Active"],function(t,e,i,n){var a=i.extend(n,function(){var i=this;t(window).on("resize.active",e.throttle(function(){i.positionWidget()},200)),this.positionWidget()},function(){t(window).off(".active"),this.widget.$container.hide()});return a.prototype.positionWidget=function(){var t=this.widget,e=t.$itemContainer.offset(),i=t.$original.offset();t.$container.show().css({position:"absolute",top:i.top-e.top-22,left:i.left-e.left-32})},a}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/states","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/Active"],function(t,e){return t.createBundle(e,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/inlineChoice",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l,c="",d=this,h=i.helperMissing,u=this.escapeExpression;return c+='<div class="panel">\n    <label>\n        <input name="shuffle" type="checkbox" ',o=i["if"].call(e,e&&e.shuffle,{hash:{},inverse:d.noop,fn:d.program(1,r,a),data:a}),(o||0===o)&&(c+=o),c+='/>\n        <span class="icon-checkbox"></span>\n        '+u((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"Shuffle choices",l):h.call(e,"__","Shuffle choices",l)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n'+u((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be “shuffled” of “fixed” individually.",l):h.call(e,"__","If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be “shuffled” of “fixed” individually.",l)))+'\n    </span>\n</div>\n<div class="panel">\n    <label>\n        <input name="required" type="checkbox" ',o=i["if"].call(e,e&&e.required,{hash:{},inverse:d.noop,fn:d.program(1,r,a),data:a}),(o||0===o)&&(c+=o),c+='/>\n        <span class="icon-checkbox"></span>\n        '+u((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"required",l):h.call(e,"__","required",l)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n'+u((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"Define whether a choice must be selected by the candidate in order to form a valid response to the interaction.",l):h.call(e,"__","Define whether a choice must be selected by the candidate in order to form a valid response to the interaction.",l)))+"\n    </span>\n</div>\n"})}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/inlineChoice"],function(t,e,i,n){var a=t.extend(e,function(){var t=this.widget.$container.find(".main-option"),e=this.widget.$original;$(document).on("choiceTextChange.qti-widget.question",function(){e.width(t.width())})},function(){$(document).off(".qti-widget.question")});return a.prototype.addNewChoiceButton=function(){var t=this.widget,e=t.$container.find(".add-option"),i=t.element;e.data("initialized")||(e.on("click.qti-widget",function(e){e.stopPropagation();var n=i.createChoice();$(this).closest("tr").before(t.renderChoice(n)),t.buildChoice(n,{ready:function(t){t.changeState("question")}})}),e.data("initialized",!0))},a.prototype.initForm=function(){var t=this.widget,e=t.$form,a=t.element;e.html(n({shuffle:!!a.attr("shuffle"),maxChoices:parseInt(a.attr("maxChoices")),minChoices:parseInt(a.attr("minChoices")),choicesCount:_.size(t.element.getChoices())})),i.initWidget(e),i.initDataBinding(e,a,{shuffle:i.getAttributeChangeCallback(),required:i.getAttributeChangeCallback()})},a}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e,i){var n=t.extend(e,function(){i.forward(this.widget)},function(){});return n}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/ResponseWidget",["taoQtiItem/qtiCommonRenderer/renderers/Renderer","taoQtiItem/qtiCommonRenderer/helpers/Helper","lodash","i18n"],function(t,e,i,n){var a={create:function(e,i){var a=this,r=e.element,o=$("<select>"),s=e.$container.find(".widget-response").append(o);this.commonRenderer=new t({shuffleChoices:!1}),this.commonRenderer.load(function(){r.render({},o,"",this),r.postRender({allowEmpty:!1,placeholderText:n("select correct choice")},"",this),i.call(a,this),s.siblings(".padding").width(s.width()+50)},["inlineChoice","inlineChoiceInteraction"])},setResponse:function(t,e){this.commonRenderer.setResponse(t.element,this.formatResponse(e))},destroy:function(t){t.$container.find(".widget-response").empty(),t.$container.find(".padding").removeAttr("style")},formatResponse:function(t){return i.isString(t)||(t=i.values(t),t&&t.length&&(t=t[0])),{base:{identifier:t}}},unformatResponse:function(t){var e=[];return t.base&&t.base.identifier&&e.push(t.base.identifier),e}};return a}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/ResponseWidget","lodash"],function(t,e,i,n){var a=t.create(e,function(){var t=this.widget,e=this.widget.element.getResponseDeclaration();t.$container.find("table").hide(),i.create(t,function(){i.setResponse(t,n.values(e.getCorrect())),t.$container.on("responseChange.qti-widget",function(t,n){e.setCorrect(i.unformatResponse(n.response))})})},function(){var t=this.widget.$container;t.find("table").show(),t.off("responseChange.qti-widget"),i.destroy(this.widget)});return a}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Map",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiItem/helper/interactionHelper","lodash"],function(t,e,i,n,a,r){var o=e.create(i,function(){var e=this.widget,i=e.$container,o=e.element,s=o.getResponseDeclaration();i.find("[data-edit=map]").show();var l=r.values(s.getCorrect());if(l.length){var c=o.getChoiceByIdentifier(l.pop());c&&i.find('input[name=correct][value="'+c.serial+'"]').prop("checked",!0)}n.initDataBinding(i,s,{correct:function(t,e){t.setCorrect(a.serialToIdentifier(o,e))},score:function(e,i){var n=parseFloat(i);isNaN(n)||e.setMapEntry(a.serialToIdentifier(o,t(this).data("for")),n)}})},function(){});return o}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Map"],function(t,e){return t.createBundle(e,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoiceInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t){var e;return e=typeof t===d?t.apply(t):t,e||0===e?e:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l,c="",d="function",h=this.escapeExpression,u=i.helperMissing,p=this,f=i.blockHelperMissing;return c+='<div class="widget-box widget-inline widget-inlineChoiceInteraction" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.serial,o=typeof s===d?s.call(e,{hash:{},data:a}):s),c+=h(o)+'" data-edit="active">\n    <div class="qti-interaction qti-inlineChoiceInteraction">\n        <table>\n            <colgroup>\n                <col class="text">\n                <col class="icon">\n                <col class="icon">\n            </colgroup>\n            <tbody>\n                <tr>\n                    <td class="main-option"><div>-- '+h((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"edit choices",l):u.call(e,"__","edit choices",l)))+' --<span class="icon-down"></span></div></td>\n                    <td class="icon-title" data-edit="map">correct</td>\n                    <td class="icon-title" data-edit="map">score</td>\n                </tr>\n                ',l={hash:{},inverse:p.noop,fn:p.program(1,r,a),data:a},(s=i.choices)?o=s.call(e,l):(s=e&&e.choices,o=typeof s===d?s.call(e,l):s),i.choices||(o=f.call(e,o,{hash:{},inverse:p.noop,fn:p.program(1,r,a),data:a})),(o||0===o)&&(c+=o),c+='\n                <tr data-edit="question">\n                    <td>\n                        <div class="add-option">\n                            <span class="icon-add"></span>\n                            '+h((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"new option",l):u.call(e,"__","new option",l)))+'\n                        </div>\n                    </td>\n                    <td colspan="2"></td>\n                </tr>\n            </tbody>\n        </table>\n        <div>\n            <div class="widget-response" data-edit="correct"></div>\n            <div class="padding"></div>\n        </div>\n    </div>\n</div>'})}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoice",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(){return"pin"}function o(){return"shuffle"}function s(){var t="";return t}function l(){return"display:none;"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var c,d,h="",u="function",p=this.escapeExpression,f=this;return h+='<tr class="widget-box widget-inlineChoice qti-choice" data-edit="active" data-serial="',(d=i.serial)?c=d.call(e,{hash:{},data:a}):(d=e&&e.serial,c=typeof d===u?d.call(e,{hash:{},data:a}):d),h+=p(c)+'">\n    <td class="option" contenteditable="true">',(d=i.body)?c=d.call(e,{hash:{},data:a}):(d=e&&e.body,c=typeof d===u?d.call(e,{hash:{},data:a}):d),h+=p(c)+'</td>\n    <td class="mini-tlb">\n        <span data-edit="question" class="tlb-button">\n            <span  class="icon-',c=i["if"].call(e,(c=e&&e.attributes,null==c||c===!1?c:c.fixed),{hash:{},inverse:f.program(3,o,a),fn:f.program(1,r,a),data:a}),(c||0===c)&&(h+=c),h+='" data-role="shuffle-pin" style="',c=i["if"].call(e,e&&e.interactionShuffle,{hash:{},inverse:f.program(7,l,a),fn:f.program(5,s,a),data:a}),(c||0===c)&&(h+=c),h+='"></span>\n        </span>\n        <label data-edit="map">\n            <input name="correct" type="radio" value="',(d=i.serial)?c=d.call(e,{hash:{},data:a}):(d=e&&e.serial,c=typeof d===u?d.call(e,{hash:{},data:a}):d),h+=p(c)+'">\n            <span class="icon-radio"></span>\n        </label>\n    </td>\n    <td class="mini-tlb">\n        <span data-edit="question" class="icon-bin" data-role="delete"></span>\n        <input class="score" name="score" data-edit="map" value="',(d=i.score)?c=d.call(e,{hash:{},data:a}):(d=e&&e.score,c=typeof d===u?d.call(e,{hash:{},data:a}):d),h+=p(c)+'" data-for="',(d=i.serial)?c=d.call(e,{hash:{},data:a}):(d=e&&e.serial,c=typeof d===u?d.call(e,{hash:{},data:a}):d),h+=p(c)+'" data-validate="$numeric" data-validate-option="$allowEmpty; $event(type=keyup)"/>\n    </td>\n</tr>'})}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/Widget",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/Widget","taoQtiItem/qtiCreator/widgets/choices/inlineChoice/Widget","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/states","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoiceInteraction","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoice"],function(t,e,i,n,a,r,o){var s=i.clone();return s.initCreator=function(e){var n=this;this.registerStates(a),i.initCreator.call(this),this.$choiceOptionForm=e.choiceOptionForm,t.each(this.element.getChoices(),function(t){n.buildChoice(t)}),this.$container.find(".tlb-title").remove()},s.renderChoice=function(t,e){var i={tag:t.qtiClass,serial:t.serial,attributes:t.attributes,body:t.text,interactionShuffle:e};return o(i)},s.renderInteraction=function(){var i=this,n=this.element,a=n.attr("shuffle"),o={tag:n.qtiClass,serial:n.serial,attributes:n.attributes,choices:[]};return t.each(n.getChoices(),function(t){e.isA(t,"choice")&&o.choices.push(i.renderChoice(t,a))}),r(o)},s.buildChoice=function(t,e){n.build(t,this.$container.find('.widget-inlineChoice[data-serial="'+t.serial+'"]'),this.$choiceOptionForm,e)},s.buildContainer=function(){this.$original.before("&nbsp;").after("&nbsp;"),this.$itemContainer=this.$original.parents(".item-editor-item"),this.$itemContainer.append(this.renderInteraction()),this.$container=this.$itemContainer.find(".widget-inlineChoiceInteraction[data-serial="+this.element.getSerial()+"]")},s}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoiceInteraction.placeholder",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};
var r,o,s,l="",c="function",d=this.escapeExpression,h=i.helperMissing;return l+='<span class="widget-box inlineChoiceInteraction-placeholder" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-qti-class="inlineChoiceInteraction">\n    <label>-- '+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"edit choices",s):h.call(e,"__","edit choices",s)))+' --</label>\n    <span class="icon-down"></span>\n</span>'})}),define("taoQtiItem/qtiCreator/renderers/interactions/InlineChoiceInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/InlineChoiceInteraction","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/Widget","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoiceInteraction.placeholder"],function(t,e,i,n){var a=t.clone(e);return a.template=n,a.render=function(t,e){return e=e||{},e.choiceOptionForm=this.getOption("choiceOptionForm"),i.build(t,$('.inlineChoiceInteraction-placeholder[data-serial="'+t.serial+'"]'),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),e)},a}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/matchInteraction.adder",["handlebars"],function(t){return t.template(function(t,e,i,n,a){return this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{},'<div class="clearfix add-options" data-edit="question">\n    <div class="rgt">\n        <span class="add-option" data-role="add-row"><span class="icon-add"></span>Add new row</span>\n        <span class="add-option" data-role="add-col"><span class="icon-add"></span>Add new column</span>\n    </div>\n</div>'})}),define("tpl!taoQtiItem/qtiCreator/tpl/interactions/matchInteraction.row",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(){return'\n    <td>\n        <label>\n            <input type="checkbox" >\n            <span class="icon-checkbox cross"></span>\n        </label>\n    </td>\n    '}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l,c="",d="function",h=this,u=i.helperMissing;return c+="<tr>\n    ",(s=i.choice)?o=s.call(e,{hash:{},data:a}):(s=e&&e.choice,o=typeof s===d?s.call(e,{hash:{},data:a}):s),(o||0===o)&&(c+=o),c+="\n    ",s=i["for"]||e&&e["for"],l={hash:{},inverse:h.noop,fn:h.program(1,r,a),data:a},o=s?s.call(e,0,e&&e.otherMatchSetCount,1,l):u.call(e,"for",0,e&&e.otherMatchSetCount,1,l),(o||0===o)&&(c+=o),c+="\n</tr>"})}),define("tpl!taoQtiItem/qtiCreator/tpl/interactions/matchInteraction.cell",["handlebars"],function(t){return t.template(function(t,e,i,n,a){return this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{},'<td>\n    <label>\n        <input type="checkbox" >\n        <span class="icon-checkbox cross"></span>\n    </label>\n</td>'})}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Question","tpl!taoQtiItem/qtiCreator/tpl/toolbars/matchInteraction.adder","tpl!taoQtiItem/qtiCreator/tpl/interactions/matchInteraction.row","tpl!taoQtiItem/qtiCreator/tpl/interactions/matchInteraction.cell","taoQtiItem/qtiCreator/helper/adaptSize","lodash","jquery.sizechange"],function(t,e,i,n,a,r,o,s){var l=t.extend(e);return l.prototype.initForm=i.prototype.initForm,l.prototype.addNewChoiceButton=function(){var t=this.widget.element,e=this.widget.$container.find(".match-interaction-area"),i="simpleAssociableChoice.matchInteraction",l=function(t){t.postRender({ready:function(t){t.changeState("question")}},i)};e.find(".add-option").length||(e.append(n()),e.find(".add-options").show(),e.find(".add-option[data-role=add-col]").on("click",function(){var n=t.createChoice(0);e.find("thead > tr").append(n.render(i)),e.find("tbody > tr").append(r({})),l(n)}),e.find(".add-option[data-role=add-row]").on("click",function(){var n=t.createChoice(1);e.find("tbody").append(a({choice:n.render(i),otherMatchSetCount:s.size(t.choices[0])})),l(n)})),$(".qti-item").on("toolbarchange",function(){e.find("tbody .mini-tlb").each(function(){var t=$(this);t.css("left",-1*(t.width()+10))})}),e.find("tr").each(function(){var t=$(this).find("[data-html-editable=true]");t.sizeChange(function(){o.height(t)})})},l}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e,i){var n=t.extend(e,function(){i.forward(this.widget)},function(){});return n}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/matchInteraction.score",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l="function",c=this.escapeExpression;return s+='<input value="',(o=i.score)?r=o.call(e,{hash:{},data:a}):(o=e&&e.score,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'" \n       title="Score of this answer" \n       type="text" \n       data-for="',(o=i.choiceIdentifier)?r=o.call(e,{hash:{},data:a}):(o=e&&e.choiceIdentifier,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'" \n       name="score" \n       class="score" \n       placeholder = "',(o=i.placeholder)?r=o.call(e,{hash:{},data:a}):(o=e&&e.placeholder,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'"\n       data-validate="$numeric" \n       data-validate-option="$allowEmpty; $event(type=keyup)" />'})}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/ResponseWidget",["taoQtiItem/qtiCommonRenderer/renderers/interactions/MatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/toolbars/matchInteraction.score","lodash","i18n","polyfill/placeholders"],function(t,e,i,n,a,r){var o={create:function(i,n){var a=i.element;t.destroy(a),n?(e.appendInstruction(i.element,r("Please define the correct response and the score below.")),a.data("responseMappingMode",!0),o.createScoreWidgets(i),o.createCorrectWidgets(i)):(e.appendInstruction(i.element,r("Please define the correct response below.")),o.createCorrectWidgets(i)),t.render(a),i.$container.find("table.matrix input[type=checkbox]").removeProp("disabled").attr("data-edit","correct").attr("data-role","correct")},setResponse:function(e,i){t.setResponse(e,o.formatResponse(i))},destroy:function(e){var i=e.element;t.destroy(i),i.removeData("responseMappingMode"),e.$container.find("table.matrix input[type=checkbox]").prop("disabled","disabled"),e.$container.find("table.matrix .score").remove(),e.$container.off("responseChange.qti-widget")},createScoreWidgets:function(e){var a=e.$container,r=e.element,o=r.getResponseDeclaration(),s=o.getMapEntries(),l=o.getMappingAttribute("defaultValue");a.find("table.matrix td>label").each(function(){var e=t.inferValue(this).join(" ");$(this).append(n({serial:r.getSerial(),choiceIdentifier:e,score:s[e]?s[e]:"",placeholder:l}))});var c=a.find("table.matrix .score");c.on("click",function(t){t.stopPropagation(),t.preventDefault()}),e.on("mappingAttributeChange",function(t){"defaultValue"===t.key&&c.attr("placeholder",t.value)}),i.initDataBinding(a,o,{score:function(t,e){var i=$(this).data("for");""===e?t.removeMapEntry(i):t.setMapEntry(i,e,!0)}})},createCorrectWidgets:function(t){var e=t.element,i=e.getResponseDeclaration();t.$container.on("responseChange.qti-widget",function(t,e){i.setCorrect(o.unformatResponse(e.response))})},formatResponse:function(t){var e={list:{directedPair:[]}};if(1===a.size(t)){var i=a.values(t).pop().split(" ");e={base:{directedPair:i}}}else e={list:{directedPair:[]}},a.each(t,function(t){var i=t.split(" ");e.list.directedPair.push(i)});return e},unformatResponse:function(t){var e=[];return t.list&&t.list.directedPair?a.each(t.list.directedPair,function(t){e.push(t.join(" "))}):t.base&&t.base.directedPair&&e.push(t.base.directedPair.join(" ")),e}};return o}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/ResponseWidget","lodash"],function(t,e,i,n){var a=t.create(e,function(){var t=this.widget,e=t.element,a=e.getResponseDeclaration();i.create(t),i.setResponse(e,n.values(a.getCorrect()))},function(){i.destroy(this.widget)});return a}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Map",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/ResponseWidget","lodash"],function(t,e,i,n){var a=t.create(e,function(){var t=this.widget,e=t.element,a=e.getResponseDeclaration();i.create(t,!0),i.setResponse(e,n.values(a.getCorrect()))},function(){i.destroy(this.widget)});return a}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Map"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){this.registerStates(e),t.initCreator.call(this)},i}),define("taoQtiItem/qtiCreator/renderers/interactions/MatchInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/MatchInteraction","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/Widget"],function(t,e,i){var n=t.clone(e);return n.render=function(t,n){return i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),n)},n}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/media",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l,c="",d=i.helperMissing,h=this.escapeExpression,u="function",p=this;return c+='<!--\n<div class="panel">\n      TO BE COMPLETED : add "object" editor (see : http://www.imsglobal.org/question/qtiv2p1/imsqti_infov2p1.html#element10173)\n</div>\n-->\n\n<div class="panel">\n    \n    <div>\n        <label>\n            <div>'+h((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"Media file path or YouTube video address",l):d.call(e,"__","Media file path or YouTube video address",l)))+'</div>\n            <input type="text" name="data" placeholder="Please select media file" value="',(s=i.data)?o=s.call(e,{hash:{},data:a}):(s=e&&e.data,o=typeof s===u?s.call(e,{hash:{},data:a}):s),c+=h(o)+'" />\n            <div><button class=\'selectMediaFile small\'>Select media file</button></div>\n        </label>\n    </div>\n    \n    <div>\n        <label for="width" class="spinner">Width</label>\n        <input name="width" value="',(s=i.width)?o=s.call(e,{hash:{},data:a}):(s=e&&e.width,o=typeof s===u?s.call(e,{hash:{},data:a}):s),c+=h(o)+'" type="text"   data-increment="1" data-min="0" data-max="1920" style=\'min-width: 55px!important;\' />\n    </div>\n    \n    <div>\n        <label for="height" class="spinner">Height</label>\n        <input name="height" value="',(s=i.height)?o=s.call(e,{hash:{},data:a}):(s=e&&e.height,o=typeof s===u?s.call(e,{hash:{},data:a}):s),c+=h(o)+'" type="text"  data-increment="1" data-min="0" data-max="1080" style=\'min-width: 55px!important;\' />\n    </div>\n    \n</div>\n\n<div class="panel">\n    <label>\n        <input name="autostart" type="checkbox" ',o=i["if"].call(e,e&&e.autostart,{hash:{},inverse:p.noop,fn:p.program(1,r,a),data:a}),(o||0===o)&&(c+=o),c+='/>\n        <span class="icon-checkbox"></span>\n        '+h((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"autostart",l):d.call(e,"__","autostart",l)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+h((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"The autostart attribute determines if the media object should begin as soon as the candidate starts the attempt (checked) or if the media object should be started under the control of the candidate (unchecked).",l):d.call(e,"__","The autostart attribute determines if the media object should begin as soon as the candidate starts the attempt (checked) or if the media object should be started under the control of the candidate (unchecked).",l)))+'\n    </span>\n</div>\n\n<div class="panel">\n    <label>\n        <input name="loop" type="checkbox" ',o=i["if"].call(e,e&&e.loop,{hash:{},inverse:p.noop,fn:p.program(1,r,a),data:a}),(o||0===o)&&(c+=o),c+='/>\n        <span class="icon-checkbox"></span>\n        '+h((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"loop",l):d.call(e,"__","loop",l)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n       '+h((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"The loop attribute is used to set continuous play mode. In continuous play mode, once the media object has started to play it should play continuously (subject to maxPlays).",l):d.call(e,"__","The loop attribute is used to set continuous play mode. In continuous play mode, once the media object has started to play it should play continuously (subject to maxPlays).",l)))+'\n    </span>\n</div>\n\n<div class="panel">\n    <!--\n    <h3>'+h((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"Allowed number of choices",l):d.call(e,"__","Allowed number of choices",l)))+'\n        \n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            The minPlays attribute indicates that the media object should be played a minimum number of times by the candidate. \n            The maxPlays attribute indicates that the media object can be played at most maxPlays times - it must not be possible for the candidate to play the media object more than maxPlay times. A value of 0 (the default) indicates that there is no limit.\n        </span>\n        \n    </h3>\n    -->\n\n    <!--\n    <div>\n        <label for="minPlays" class="spinner">Min</label>\n        <input name="minPlays" value="',(s=i.minPlays)?o=s.call(e,{hash:{},data:a}):(s=e&&e.minPlays,o=typeof s===u?s.call(e,{hash:{},data:a}):s),c+=h(o)+'" data-increment="1" data-min="0" data-max="1000" type="text" />\n    </div>\n    -->\n    <div>\n        <label for="maxPlays" class="spinner">Max plays count</label>\n        <input name="maxPlays" value="',(s=i.maxPlays)?o=s.call(e,{hash:{},data:a}):(s=e&&e.maxPlays,o=typeof s===u?s.call(e,{hash:{},data:a}):s),c+=h(o)+'" data-increment="1" data-min="0" data-max="1000" type="text" style=\'min-width: 55px!important;\' />\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+h((s=i.__||e&&e.__,l={hash:{},data:a},s?s.call(e,"The maxPlays attribute indicates that the media object can be played at most maxPlays times - it must not be possible for the candidate to play the media object more than maxPlay times. A value of 0 (the default) indicates that there is no limit.",l):d.call(e,"__","The maxPlays attribute indicates that the media object can be played at most maxPlays times - it must not be possible for the candidate to play the media object more than maxPlay times. A value of 0 (the default) indicates that there is no limit.",l)))+"\n        </span>\n    </div>\n</div>\n"})}),define("taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/Question",["jquery","lodash","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/media","taoQtiItem/qtiCommonRenderer/renderers/interactions/MediaInteraction","ui/resourcemgr"],function(t,e,i,n,a,r,o){var s=i.extend(n,e.noop,e.noop);return s.prototype.initForm=function(){var e=this.widget,i=e.$form,n=e.options,s=e.element;i.html(r({autostart:!!s.attr("autostart"),loop:!!s.attr("loop"),maxPlays:parseInt(s.attr("maxPlays")),data:s.object.attr("data"),type:s.object.attr("type"),width:s.object.attr("width"),height:s.object.attr("height")})),a.initWidget(i);var l=[];l.autostart=a.getAttributeChangeCallback(),l.loop=a.getAttributeChangeCallback(),l.maxPlays=a.getAttributeChangeCallback(),l.width=function(t,e,i){t.object.attr(i,e),t.attr("responseIdentifier",t.attr("responseIdentifier"))},l.height=function(t,e,i){t.object.attr(i,e),t.attr("responseIdentifier",t.attr("responseIdentifier"))},l.data=function(t,e,i){t.object.attr(i,e),t.attr("responseIdentifier",t.attr("responseIdentifier"));var n=e.trim().toLowerCase();(0===n.indexOf("http://www.youtube.com")||0===n.indexOf("http://www.youtu.be")||0===n.indexOf("http://youtube.com")||0===n.indexOf("http://youtu.be"))&&t.object.attr("type","video/youtube"),o.destroy(t),o.render(t,!0)},a.initDataBinding(i,s,l);var c=t(e.$form).find(".selectMediaFile");c.on("click",function(){t(this).resourcemgr({appendContainer:n.mediaManager.appendContainer,root:"/",browseUrl:n.mediaManager.browseUrl,uploadUrl:n.mediaManager.uploadUrl,deleteUrl:n.mediaManager.deleteUrl,downloadUrl:n.mediaManager.downloadUrl,params:{uri:n.uri,lang:n.lang,filters:"video/mp4,video/avi,video/ogv,video/mpeg,video/ogg,video/quicktime,video/webm,video/x-ms-wmv,video/x-flv,audio/mp3,audio/vnd.wav,audio/ogg,audio/vorbis,audio/webm,audio/mpeg"},pathParam:"path",select:function(e,n){if(n.length>0){var a=t(i.find("input[name=data]"));a.val(n[0].file),a.trigger("change"),s.object.attr("type",n[0].mime)}}})})},s}),define("taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep","taoQtiItem/qtiCommonRenderer/renderers/interactions/MediaInteraction"],function(t,e,i){var n=function(){var t=this.widget,e=t.element;0==t.$container.find(".instruction-container .mejs-container").length&&i.render(e,!0),t.on("metaChange",function(){})},a=function(){};return t.extend(e,n,a)}),define("taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/Sleep"],function(t,e){return t.createBundle(e,arguments,["answer","correct","map"])}),define("taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){this.registerStates(e),t.initCreator.call(this),this.functionToInitMyInteractionCreatorWidget()},i.functionToInitMyInteractionCreatorWidget=function(){},i}),define("tpl!taoQtiItem/qtiCreator/tpl/interactions/mediaInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a;return(a=i.prompt)?n=a.call(t,{hash:{},data:e}):(a=t&&t.prompt,n=typeof a===c?a.call(t,{hash:{},data:e}):a),n||0===n?n:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l="",c="function",d=this.escapeExpression,h=this;return l+='<div class="qti-interaction qti-blockInteraction qti-mediaInteraction" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.serial,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'">\n	',o=i["if"].call(e,e&&e.prompt,{hash:{},inverse:h.noop,fn:h.program(1,r,a),data:a}),(o||0===o)&&(l+=o),l+='\n	<div class="instruction-container"></div>\n    \n</div>'})}),define("taoQtiItem/qtiCreator/renderers/interactions/MediaInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/MediaInteraction","taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/Widget","tpl!taoQtiItem/qtiCreator/tpl/interactions/mediaInteraction"],function(t,e,i,n){var e=t.clone(e);return e.template=n,e.render=function(t,n){return n=n||{},n.baseUrl=this.getOption("baseUrl"),n.uri=this.getOption("uri"),n.lang=this.getOption("lang"),n.mediaManager=this.getOption("mediaManager"),i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),n)},e}),define("taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Question"],function(t,e,i){var n=t.extend(e);return n.prototype.initForm=function(){i.prototype.initForm.call(this,!1)},n}),define("taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer"],function(t,e){var i=t.extend(e,function(){this.widget.changeState("correct")},function(){});return i}),define("taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/OrderInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","lodash","i18n"],function(t,e,i,n,a,r){var o=t.create(e,function(){s(this.widget)},function(){l(this.widget)}),s=function(t){var e=t.element,o=e.getResponseDeclaration(),s=a.values(o.getCorrect());n.appendInstruction(t.element,r("Please define the correct order in the box to the right.")),i.render(t.element),i.setResponse(e,c(s)),t.$container.on("responseChange.qti-widget",function(t,e){o.setCorrect(d(e.response))})},l=function(t){t.$container.off("responseChange.qti-widget"),i.destroy(t.element)},c=function(t){return{list:{identifier:t}}},d=function(t){var e=[];return t.list&&t.list.identifier&&(e=t.list.identifier),e};return o}),define("taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/Correct"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){this.registerStates(e),t.initCreator.call(this)},i}),define("taoQtiItem/qtiCreator/renderers/interactions/OrderInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/OrderInteraction","taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/Widget"],function(t,e,i){var n=t.clone(e);return n.render=function(t,n){return i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),n)},n}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function(t,e){var i=function(){var t=this.widget,e=t.element;t.on("metaChange",function(t){"responsive"===t.key&&(t.value===!0?e.addClass("responsive"):e.removeClass("responsive"))})},n=function(){};return t.extend(e,i,n)}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/selectPoint",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s,l="",c=i.helperMissing,d=this.escapeExpression,h="function";return l+='<div class="panel">\n\n    \n    <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Interaction Background",s):c.call(e,"__","Interaction Background",s)))+'</h3>\n\n    <div class="panel">\n        <label for="data">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"File",s):c.call(e,"__","File",s)))+'</label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"The file path to the image.",s):c.call(e,"__","The file path to the image.",s)))+'</div>\n        <input type="text" name="data" value="',(o=i.data)?r=o.call(e,{hash:{},data:a}):(o=e&&e.data,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(o=i.baseUrl)?r=o.call(e,{hash:{},data:a}):(o=e&&e.baseUrl,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+')"/>\n        <button class="btn-info small block" data-role="upload-trigger">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Select image",s):c.call(e,"__","Select image",s)))+'</button>\n    </div>\n\n    <div>\n        <label for="width">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Width",s):c.call(e,"__","Width",s)))+'</label>\n        <input name="width" value="',(o=i.width)?r=o.call(e,{hash:{},data:a}):(o=e&&e.width,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n\n    <div>\n        <label for="height">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Height",s):c.call(e,"__","Height",s)))+'</label>\n        <input name="height" value="',(o=i.height)?r=o.call(e,{hash:{},data:a}):(o=e&&e.height,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n\n    <div>\n        <label for="type">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Mime Type",s):c.call(e,"__","Mime Type",s)))+'</label>\n        <input name="type" value="',(o=i.type)?r=o.call(e,{hash:{},data:a}):(o=e&&e.type,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\n    </div>\n\n    <hr>\n\n    <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Allowed number of choices",s):c.call(e,"__","Allowed number of choices",s)))+'\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"The minimum number of choices that the candidate is required to select to form a valid response.",s):c.call(e,"__","The minimum number of choices that the candidate is required to select to form a valid response.",s)))+"<br>\n            "+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"The maximum number of choices that the candidate is allowed to select.",s):c.call(e,"__","The maximum number of choices that the candidate is allowed to select.",s)))+'\n        </span>\n    </h3>\n\n    <div>\n        <label for="minChoices" class="spinner">Min</label>\n        <input name="minChoices" value="',(o=i.minChoices)?r=o.call(e,{hash:{},data:a}):(o=e&&e.minChoices,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-increment="1" data-min="0" type="text" />\n    </div>\n    <div>\n        <label for="maxChoices" class="spinner">Max</label>\n        <input name="maxChoices" value="',(o=i.maxChoices)?r=o.call(e,{hash:{},data:a}):(o=e&&e.maxChoices,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-increment="1" data-min="0" type="text" />\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Question",["jquery","lodash","util/image","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/selectPoint"],function(t,e,i,n,a,r,o,s,l){var c=n.extend(a);return c.prototype.initForm=function(){var t=this.widget,i=t.options,n=t.element,a=t.$form;a.html(l({baseUrl:i.baseUrl,maxChoices:parseInt(n.attr("maxChoices")),minChoices:parseInt(n.attr("minChoices")),choicesCount:e.size(n.getChoices()),data:n.object.attr("data"),width:n.object.attr("width"),height:n.object.attr("height"),type:n.object.attr("type")})),r(a,i),o.initWidget(a);var c=o.getMinMaxAttributeCallbacks(this.widget.$form,"minChoices","maxChoices");c.data=function(e,i){n.object.attr("data",i),t.rebuild({ready:function(t){t.changeState("question")}})},c.width=function(t,e){n.object.attr("width",e)},c.height=function(t,e){n.object.attr("height",e)},c.type=function(t,e){e&&""!==e?n.object.attr("type",e):n.object.removeAttr("type")},o.initDataBinding(a,n,c),s.syncMaxChoices(t)},c}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e){function i(){this.widget.changeState("map")}function n(){}return t.extend(e,i,n)}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Map",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCommonRenderer/renderers/interactions/SelectPointInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicScorePopup","tpl!taoQtiItem/qtiCreator/tpl/forms/response/graphicScoreMappingForm","taoQtiItem/qtiCreator/widgets/helpers/formElement","ui/incrementer","ui/tooltipster"],function(t,e,i,n,a,r,o,s,l,c,d,h,u,p){function f(){var t=this.widget,n=t.element,a=(t.$original,n.getResponseDeclaration());t._targets=[],n.paper&&(r.destroy(n),o.appendInstruction(n,i("Please create areas that correspond to the response and associate them a score.\nYou can also position the target to the exact point as the correct response.")),n.responseMappingMode=!0,e.isPlainObject(a.mapEntries)&&(a.mapEntries=e.values(a.mapEntries)),t.createPaper(),v(t),t._editor=C(t),b(t))}function m(t){return t.shape+"-"+t.coords.replace(/,*/g,"-")}function g(t,i){var n=!1;return e.forEach(t.mapEntries,function(t,e){return m(t)===i?(n=e,!1):void 0}),n}function v(i){var n=i.element,a=i.$original,r=n.getResponseDeclaration();e.forEach(r.mapEntries,function(t){var e=i.createResponseArea(t.shape,t.coords);I(i,t,e,!1)}),c.isCorrectDefined(i)&&r.getCorrect().length&&e.forEach(r.getCorrect(),function(t){var e=t.split(",");if(e.length>=2){var a=s.createTarget(n.paper,{point:{x:e[0],y:e[1]}});i._targets.push(a.id)}}),n.paper.getById("bg-image-"+n.serial).click(function(){t(".graphic-mapping-editor",a).hide()
})}function C(i){var n=i.element,a=n.getResponseDeclaration(),r=d(i,{currents:a.mapEntries.map(m).concat(i._targets),target:!0,shapeCreated:function(t,e){var n,r,o;"target"===e?(n=t.data("target"),r=a.getCorrect()||[],r.push(n.x+","+n.y),a.setCorrect(r)):(o={shape:"path"===e?"poly":e,coords:s.qtiCoords(t),mappedValue:a.mappingAttributes.defaultValue||"0"},I(i,o,t,!0),a.mapEntries.push(o))},shapeRemoved:function(i,r){var o;/^target/.test(i)&&r.target?a.setCorrect(e.without(a.getCorrect(),r.target.x+","+r.target.y)):(o=n.paper.getById("score-"+i),o&&o.remove(),t("#score-popup-"+i).remove(),e.remove(a.mapEntries,function(t){return i&&m(t)===i}))},enterHandling:function(e){e.toFront(),t("#score-popup-"+e.id).show()},quitHandling:function(e){var i=n.paper.getById("score-"+e.id);i&&i.show().toFront(),t("#score-popup-"+e.id).hide()},shapeChanging:function(e){var i=n.paper.getById("score-"+e.id);i&&i.remove(),t("#score-popup-"+e.id).remove()},shapeChange:function(t){var e,n=g(a,t.id);n!==!1&&(e=a.mapEntries[n],a.mapEntries[n].coords=s.qtiCoords(t),I(i,e,t,e.mappedValue===a.mappingAttributes.defaultValue),t.id=m(e))}});return r.create(),r}function I(e,n,a,r){var o=e.element,l=e.$original,c=l.hasClass("responsive"),d=o.getResponseDeclaration(),f=m(n),g=t(".main-image-box",l),v=h(o.paper,a,g,c),C=(n.mappedValue||d.mappingAttributes.defaultValue||"0",s.createShapeText(o.paper,a,{id:"score-"+f,content:n.mappedValue+"",style:"score-text-default",title:i("Score value"),shapeClick:!0}));C.data("default",!!r),a.id=f,v.attr("id","score-popup-"+f);var I=t(u({score:n.mappedValue,scoreMin:d.getMappingAttribute("lowerBound"),scoreMax:d.getMappingAttribute("upperBound"),noCorrect:!0}));p.initDataBinding(I,d,{score:function(t,e){""===e?(C.attr({text:t.mappingAttributes.defaultValue}).data("default",!0),s.updateElementState(C,"score-text-default")):(C.attr({text:e}).data("default",!1),s.updateElementState(C,"score-text")),n.mappedValue=parseFloat(e)}}),I.appendTo(v)}function b(t){var i=t.element,n=t.$container,a=n.find('[data-type="target"]'),r=a.prev(".separator");t.on("mappingAttributeChange",function(t){"defaultValue"===t.key&&i.paper.forEach(function(e){/^score/.test(e.id)&&e.data("default")===!0&&e.attr({text:t.value})})}),t.on("metaChange",function(n){"defineCorrect"===n.key&&(n.value?(a.show(),r.show()):(a.hide(),r.hide(),e.forEach(t._targets,function(t){var e=i.paper.getById(t),n=i.paper.getById("layer-"+t);e.remove(),n.remove()})))})}function E(){var t=this.widget,e=t.element;e.paper&&(t._editor&&t._editor.destroy(),o.removeInstructions(e),r.destroy(e),this.widget.createPaper())}return n.create(a,f,E)}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Map"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/Widget",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/states","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/helper/dummyElement"],function(t,e,i,n,a,r,o){var s=e.extend(n.clone(),{initCreator:function(t){this.baseUrl=t.baseUrl,this.choiceForm=t.choiceForm,this.registerStates(a),n.initCreator.call(this),this.createPaper()},destroy:function(){var e=this.$original,i=e.parents(".qti-itemBody");i.off("resizestop.gridEdit."+this.element.serial),t(window).off("resize.qti-widget"),n.destroy.call(this)},createPaper:function(){var e=this.$original,i=e.parents(".qti-itemBody"),n=this.element.object.attributes;n.data?(this.element.paper=r.responsivePaper("graphic-paper-"+this.element.serial,{width:n.width,height:n.height,img:this.baseUrl+n.data,imgId:"bg-image-"+this.element.serial,diff:t(".image-editor",e).outerWidth(!0)-t(".main-image-box",e).innerWidth(),container:e}),i.on("resizestop.gridEdit."+this.element.serial,function(){e.trigger("resize.qti-widget")})):this._createPlaceholder()},_createPlaceholder:function(){var t=this.$original,e=t.find(".main-image-box");o.get({icon:"image",css:{width:t.innerWidth()-35,height:200},title:i("Select an image first.")}).appendTo(e)},createResponseArea:function(t,e){return r.createElement(this.element.paper,t,e,{touchEffect:!1})}});return s}),define("taoQtiItem/qtiCreator/renderers/interactions/SelectPointInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/SelectPointInteraction","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/Widget"],function(t,e,i){var n=t.clone(e);return n.render=function(t,n){return n=n||{},n.baseUrl=this.getOption("baseUrl"),n.choiceForm=this.getOption("choiceOptionForm"),n.uri=this.getOption("uri"),n.lang=this.getOption("lang"),n.mediaManager=this.getOption("mediaManager"),i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),n)},n}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/slider",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s,l="",c=i.helperMissing,d=this.escapeExpression,h="function";return l+='\n<div class="panel">\n    <label for="lowerBound" class="spinner">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Lower Bound",s):c.call(e,"__","Lower Bound",s)))+'</label>\n    <input name="lowerBound" value="',(o=i.lowerBound)?r=o.call(e,{hash:{},data:a}):(o=e&&e.lowerBound,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-increment="1" data-min="0" type="text" />\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"The lower bound of the slider",s):c.call(e,"__","The lower bound of the slider",s)))+'</span>\n    <label for="upperBound" class="spinner">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Upper Bound",s):c.call(e,"__","Upper Bound",s)))+'</label>\n    <input name="upperBound" value="',(o=i.upperBound)?r=o.call(e,{hash:{},data:a}):(o=e&&e.upperBound,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-increment="1" data-min="0" type="text" />\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"The upper bound of the slider",s):c.call(e,"__","The upper bound of the slider",s)))+'</span>\n</div>\n\n<div class="panel">\n    <label for="step" class="spinner">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Step",s):c.call(e,"__","Step",s)))+'</label>\n    <input name="step" value="',(o=i.step)?r=o.call(e,{hash:{},data:a}):(o=e&&e.step,r=typeof o===h?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-increment="1" data-min="1" type="text" />\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"The number of units corresponding to a step on the slider",s):c.call(e,"__","The number of units corresponding to a step on the slider",s)))+"</span>\n</div>\n"})}),define("taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/slider"],function(t,e,i,n){var a=t.extend(e);return a.prototype.initForm=function(){var t=this.widget,e=t.$form,a=t.element;e.html(n({lowerBound:parseFloat(a.attr("lowerBound")),upperBound:parseFloat(a.attr("upperBound")),orientation:a.attr("orientation"),reverse:!!a.attr("reverse"),step:parseInt(a.attr("step")),stepLabel:!!a.attr("stepLabel")})),i.initWidget(e);var r={};r.lowerBound=function(e,i){e.attr("lowerBound",parseFloat(i));var n=e.attr("lowerBound"),a=e.attr("upperBound"),r=!!e.attr("reverse");t.$container.find(r?".slider-max":".slider-min").text(i),t.$container.find("span.qti-slider-cur-value").text(n),t.$container.find(".qti-slider").noUiSlider({range:{min:n,max:a}},!0),t.$container.find(".qti-slider").val(n)},r.upperBound=function(e,i){e.attr("upperBound",parseFloat(i));var n=(e.attr("lowerBound"),e.attr("upperBound"),!!e.attr("reverse"));t.$container.find(n?".slider-min":".slider-max").text(i),t.$container.find(".qti-slider").noUiSlider({range:{min:e.attr("lowerBound"),max:e.attr("upperBound")}},!0)},r.orientation=function(e,i){e.attr("orientation",i);e.attr("orientation")?e.attr("orientation"):"horizontal",e.attr("reverse");t.$container.find(".qti-slider").noUiSlider({orientation:e.attr("orientation")},!0)},r.reverse=function(e,i){e.attr("reverse",!!i);var n=e.attr("reverse"),a=parseInt(e.attr("lowerBound")),r=parseInt(e.attr("upperBound")),o=t.$container.find(".qti-slider"),s=n?r:a;o.noUiSlider({start:s},!0),t.$container.find("span.qti-slider-cur-value").text(a),t.$container.find(".slider-min").text(n?r:a),t.$container.find(".slider-max").text(n?a:r)},r.step=function(e,i){e.attr("step",parseInt(i)),t.$container.find(".qti-slider").noUiSlider({step:e.attr("step")},!0)},r.stepLabel=function(e,i){if(e.attr("stepLabel",!!i),t.$container.find("span.slider-middle").remove(),1==e.attr("stepLabel")){var n=e.attr("upperBound"),a=e.attr("lowerBound"),r=e.attr("step"),o=e.attr("reverse"),s=parseInt((n-a)/r),l=parseInt(s/2),c=100/s*l,d=o?n-l*r:a+l*r;t.$container.find(".slider-min").after('<span class="slider-middle" style="left:'+c+'%">'+d+"</span>")}},i.initDataBinding(e,a,r)},a}),define("taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e){var i=t.extend(e,function(){this.widget.changeState("correct")},function(){});return i}),define("taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/SliderInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","lodash","i18n"],function(t,e,i,n,a,r){var o=t.create(e,function(){s(this.widget)},function(){l(this.widget)}),s=function(t){var e=t.element,o=e.getResponseDeclaration(),s=a.values(o.getCorrect());i.setResponse(e,c(s));var l=t.$container.find(".qti-slider");l.removeAttr("disabled"),n.appendInstruction(e,r("Please define the correct response using the slider.")),t.$container.on("responseChange.qti-widget",function(t,e){o.setCorrect(d(e.response))})},l=function(t){var e=t.$container.find(".qti-slider"),i=t.element.attributes.lowerBound;e.attr("disabled","disabled"),e.val(i),t.$container.find("span.qti-slider-cur-value").text(""+i),n.removeInstructions(t.element),t.$container.off("responseChange.qti-widget")},c=function(t){return{base:{integer:t}}},d=function(t){return[t.base.integer]};return o}),define("taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/Correct"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){this.registerStates(e),t.initCreator.call(this),this.$container.find(".qti-slider").attr("disabled","disabled")},i}),define("taoQtiItem/qtiCreator/renderers/interactions/SliderInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/SliderInteraction","taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/Widget"],function(t,e,i){var n=t.clone(e);return n.render=function(t,n){return e.render(t),i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),n)},n}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/textEntry",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s,l="",c="function",d=this.escapeExpression,h=i.helperMissing;return l+='<div class="panel">\r\n    <label for="placeholderText" class="spinner">Placeholder Text</label>\r\n    <input name="placeholderText" value="',(o=i.placeholderText)?r=o.call(e,{hash:{},data:a}):(o=e&&e.placeholderText,r=typeof o===c?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\r\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\r\n    <span class="tooltip-content">\r\n        '+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"In visual environments, string interactions are typically represented by empty boxes into which the candidate writes or types.  Delivery engines should use the value of this attribute (if provided) instead of their default placeholder text when this is required.",s):h.call(e,"__","In visual environments, string interactions are typically represented by empty boxes into which the candidate writes or types.  Delivery engines should use the value of this attribute (if provided) instead of their default placeholder text when this is required.",s)))+'\r\n    </span>\r\n</div>\r\n<div class="panel">\r\n    <label for="patternMask" class="spinner">Pattern Mask</label>\r\n    <input name="patternMask" value="',(o=i.patternMask)?r=o.call(e,{hash:{},data:a}):(o=e&&e.patternMask,r=typeof o===c?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" type="text" />\r\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\r\n    <span class="tooltip-content">\r\n        '+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"If given, the pattern mask specifies a regular expression that the candidate's response must match in order to be considered valid.Care is needed to ensure that the format of the required input is clear to the candidate, especially when validity checking of responses is required for progression through a test. This could be done by providing an illustrative sample response in the prompt, for example.",s):h.call(e,"__","If given, the pattern mask specifies a regular expression that the candidate's response must match in order to be considered valid.Care is needed to ensure that the format of the required input is clear to the candidate, especially when validity checking of responses is required for progression through a test. This could be done by providing an illustrative sample response in the prompt, for example.",s)))+'\r\n    </span>\r\n</div>\r\n<div class="panel">\r\n    <label for="expectedLength" class="spinner">Expected Length</label>\r\n    <input name="expectedLength" value="',(o=i.expectedLength)?r=o.call(e,{hash:{},data:a}):(o=e&&e.expectedLength,r=typeof o===c?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-increment="1" data-min="1" data-max="100" type="text" />\r\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\r\n    <span class="tooltip-content">\r\n        '+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"The expectedLength attribute provides a hint to the candidate as to the expected overall length of the desired response measured in number of characters. This is not a validity constraint.",s):h.call(e,"__","The expectedLength attribute provides a hint to the candidate as to the expected overall length of the desired response measured in number of characters. This is not a validity constraint.",s)))+'\r\n    </span>\r\n</div>\r\n<div class="panel">\r\n    <label for="base" class="spinner">Base</label>\r\n    <input name="base" value="',(o=i.base)?r=o.call(e,{hash:{},data:a}):(o=e&&e.base,r=typeof o===c?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-increment="1" data-min="1" data-max="100" type="text" />\r\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\r\n    <span class="tooltip-content">\r\n        '+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"If the string interaction is bound to a numeric response variable then the base attribute must be used to set the number base in which to interpret the value entered by the candidate.",s):h.call(e,"__","If the string interaction is bound to a numeric response variable then the base attribute must be used to set the number base in which to interpret the value entered by the candidate.",s)))+"\r\n    </span>\r\n</div>\r\n"})}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/textEntry"],function(t,e,i,n){var a=t.extend(e);return a.prototype.initForm=function(){var t=this.widget,e=t.$form,a=t.element;e.html(n({base:parseInt(a.attr("base")),patternMask:a.attr("patternMask"),placeholderText:a.attr("placeholderText"),expectedLength:parseInt(a.attr("expectedLength"))})),i.initWidget(e),i.initDataBinding(e,a,{base:i.getAttributeChangeCallback(),patternMask:i.getAttributeChangeCallback(),placeholderText:i.getAttributeChangeCallback(),expectedLength:i.getAttributeChangeCallback()})},a}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e,i){var n=t.extend(e,function(){i.forward(this.widget)},function(){});return n}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Correct",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","lodash"],function(t,e,i,n){var a=e.create(i,function(){var e=this.widget.$container,i=this.widget.element.getResponseDeclaration(),a=n.values(i.getCorrect()).pop()||"";e.find("tr[data-edit=correct] input[name=correct]").focus().val(a),e.on("keyup.correct","tr[data-edit=correct] input[name=correct]",function(){var e=t(this).val();i.setCorrect(e)})},function(){this.widget.$container.off(".correct")});return a}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntry",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l="",c="function",d=this.escapeExpression,h=this;return l+='<tr class="" data-edit="map">\r\n    <td data-text><input type="text" name="text" value="',(s=i.text)?o=s.call(e,{hash:{},data:a}):(s=e&&e.text,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'" data-old-text="',(s=i.text)?o=s.call(e,{hash:{},data:a}):(s=e&&e.text,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'"/></td>\r\n    <td class="mini-tlb" colspan="2">\r\n        <label>\r\n            <input name="correct" type="radio" ',o=i["if"].call(e,e&&e.correct,{hash:{},inverse:h.noop,fn:h.program(1,r,a),data:a}),(o||0===o)&&(l+=o),l+=' />\r\n            <span class="icon-radio"></span>\r\n        </label>\r\n        <input name="score" class="score" value="',(s=i.score)?o=s.call(e,{hash:{},data:a}):(s=e&&e.score,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'" data-for="',(s=i.serial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.serial,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'" data-validate="$numeric" data-validate-option="$allowEmpty; $event(type=keyup)"/>\r\n        <span class="icon-bin" data-role="delete-option"></span>\r\n    </td>\r\n</tr>'})}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Map",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntry","lodash"],function(t,e,i,n,a,r){var o=function(t){return t.closest("tr").find("input[name=text]").val()},s=e.create(i,function(){this.initMapEntries(),this.initFormCallbacks(),this.hideCorrectInput()},function(){this.widget.$container.off(".map"),this.widget.$container.find("tr[data-edit=map]:not([data-add-option])").remove()});return s.prototype.hideCorrectInput=function(){var t=this.widget.$container.find("tr[data-edit=correct]");this.widget.on("metaChange",function(e){"defineCorrect"===e.key&&t.hide()}),t.hide(),r.delay(function(){t.hide()},200)},s.prototype.initFormCallbacks=function(){var e=this.widget.$container,i=this.widget.element.getResponseDeclaration();n.initDataBinding(e,i,{text:r.throttle(function(e,i){var n=t(this),a=n.data("old-text"),r=n.closest("tr"),o=!!r.find("input[name=correct]:checked").length,s=parseInt(r.find(".score").val());isNaN(s)||(e.removeMapEntry(a),e.setMapEntry(i,s),n.data("old-text",i),o&&e.setCorrect(i))},600),correct:function(e){var i=o(t(this));e.setCorrect(i)},score:function(e,i){var n=o(t(this)),a=parseFloat(i);isNaN(a)||e.setMapEntry(n,a)}})},s.prototype.initMapEntries=function(){var e=this,i=this.widget.element.getResponseDeclaration(),n=r.values(i.getCorrect()).pop(),s=this.widget.$container.find("tr[data-add-option]"),l=function(e,i){var r=t(a({text:e||"",score:i||0,correct:e===n}));r.show(),s.before(r)};r.size(i.mapEntries)||(i.mapEntries={"":0}),r.forIn(i.mapEntries,function(t,e){l(e,t)}),this.widget.$container.on("click.map","[data-role=delete-option]",function(){var e=t(this),n=o(e),a=!!e.closest("tr").find("input[name=correct]:checked").length;i.removeMapEntry(n),e.closest("tr").remove(),a&&i.resetCorrect()}).on("click.map",".add-option",function(){l("",0),e.initFormCallbacks()})},s}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Map"],function(t,e){return t.createBundle(e,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntryInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s,l="",c="function",d=this.escapeExpression,h=i.helperMissing;return l+='<div class="widget-box widget-inline widget-textEntryInteraction" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" data-edit="active">\r\n\r\n    <div class="qti-interaction qti-textEntryInteraction">\r\n        <table>\r\n            <colgroup>\r\n                <col class="text">\r\n                <col class="icon">\r\n                <col class="icon">\r\n            </colgroup>\r\n            <tbody>\r\n                <tr data-edit="question">\r\n                    <td class="main-option"></td>\r\n                    <td colspan="2"></td>\r\n                </tr>\r\n                <tr data-edit="correct">\r\n                    <td data-text><input type="text" name="correct" value="',(o=i.text)?r=o.call(e,{hash:{},data:a}):(o=e&&e.text,r=typeof o===c?o.call(e,{hash:{},data:a}):o),l+=d(r)+'" /></td>\r\n                    <td class="mini-tlb" colspan="2">\r\n                    </td>\r\n                </tr>\r\n                <tr data-add-option data-edit="map">\r\n                    <td>\r\n                        <div class="add-option">\r\n                            <span class="icon-add"></span>\r\n                            '+d((o=i.__||e&&e.__,s={hash:{},data:a},o?o.call(e,"Add another option",s):h.call(e,"__","Add another option",s)))+'\r\n                        </div>\r\n                    </td>\r\n                    <td colspan="2"></td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n    </div>\r\n\r\n</div>'})}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/Widget",["lodash","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/Widget","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/states","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntryInteraction"],function(t,e,i,n){var a=e.clone();return a.initCreator=function(){this.registerStates(i),e.initCreator.call(this),this.$container.find(".tlb-title").remove()},a.renderInteraction=function(){var t=this.element,e={tag:t.qtiClass,serial:t.serial,attributes:t.attributes};return n(e)},a.buildContainer=function(){this.$original.before("&nbsp;").after("&nbsp;"),this.$itemContainer=this.$original.parents(".item-editor-item"),this.$itemContainer.append(this.renderInteraction()),this.$container=this.$itemContainer.find(".widget-textEntryInteraction[data-serial="+this.element.getSerial()+"]")},a}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntryInteraction.placeholder",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l="function",c=this.escapeExpression;return s+='<span class="widget-box textEntryInteraction-placeholder" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:a}):(o=e&&e.serial,r=typeof o===l?o.call(e,{hash:{},data:a}):o),s+=c(r)+'" data-qti-class="textEntryInteraction">\r\n    <label>&nbsp;</label>\r\n</span>'})}),define("taoQtiItem/qtiCreator/renderers/interactions/TextEntryInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/TextEntryInteraction","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/Widget","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntryInteraction.placeholder"],function(t,e,i,n){var a=t.clone(e);return a.template=n,a.render=function(t,e){return e=e||{},i.build(t,$('.textEntryInteraction-placeholder[data-serial="'+t.serial+'"]'),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),e)},a}),define("taoQtiItem/qtiCreator/helper/uploadMime",["i18n"],function(t){var e={getMimeTypes:function(){return[{mime:"application/zip",label:t("ZIP file")},{mime:"text/plain",label:t("Plain text")},{mime:"application/pdf",label:t("PDF file")},{mime:"image/jpeg",label:t("JPEG image")},{mime:"image/png",label:t("PNG image")},{mime:"image/gif",label:t("GIF image")},{mime:"image/svg+xml",label:t("SVG image")},{mime:"application/ogg",label:t("audio/mpeg")},{mime:"audio/x-ms-wma",label:t("Windows Media audio")},{mime:"audio/x-wav",label:t("WAV audio")},{mime:"video/mpeg",label:t("MPEG video")},{mime:"video/mp4",label:t("MP4 video")},{mime:"video/quicktime",label:t("Quicktime video")},{mime:"video/x-ms-wmv",label:t("Windows Media video")},{mime:"video/x-flv",label:t("Flash video")},{mime:"text/csv",label:t("CSV file")},{mime:"application/msword",label:t("Microsoft Word file")},{mime:"application/vnd.ms-excel",label:t("Microsoft Excel file")},{mime:"application/vnd.ms-powerpoint",label:t("Microsoft Powerpoint file")}]}};return e}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/upload",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a,r="";return r+='\n    		<option value="',(a=i.mime)?n=a.call(t,{hash:{},data:e}):(a=t&&t.mime,n=typeof a===h?a.call(t,{hash:{},data:e}):a),r+=u(n)+'" ',n=i["if"].call(t,t&&t.selected,{hash:{},inverse:p.noop,fn:p.program(2,o,e),data:e}),(n||0===n)&&(r+=n),r+=">",(a=i.label)?n=a.call(t,{hash:{},data:e}):(a=t&&t.label,n=typeof a===h?a.call(t,{hash:{},data:e}):a),r+=u(n)+"</option>\n    	"}function o(){return'selected="selected"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var s,l,c,d="",h="function",u=this.escapeExpression,p=this,f=i.helperMissing;return d+="<h3>"+u((l=i.__||e&&e.__,c={hash:{},data:a},l?l.call(e,"MIME-type",c):f.call(e,"__","MIME-type",c)))+'</h3>\n<span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n<div class="tooltip-content">'+u((l=i.__||e&&e.__,c={hash:{},data:a},l?l.call(e,"The MIME-type attribute describes which kind of file may be uploaded.",c):f.call(e,"__","The MIME-type attribute describes which kind of file may be uploaded.",c)))+'</div>\n\n<div class="reset-group">\n    <select name="type" class="select2" data-has-search="false">\n    	',s=i.each.call(e,e&&e.types,{hash:{},inverse:p.noop,fn:p.program(1,r,a),data:a}),(s||0===s)&&(d+=s),d+="\n    </select>\n</div>\n"})}),define("taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/states/Question",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/helper/uploadMime","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/upload"],function(t,e,n,a,r,o,s){var l=n.extend(a);return l.prototype.initForm=function(){var t=this.widget,n=t.$form,a=t.element,l=o.getMimeTypes();if(l.unshift({mime:"any/kind",label:e("-- Any kind of file --")}),"undefined"!=typeof a.attr("type"))if(""==a.attr("type"))delete a.attributes.type;else for(i in l)a.attr("type")==l[i].mime&&(l[i].selected=!0);n.html(s({types:l})),r.initWidget(n),callbacks={},callbacks.type=function(t,e){"any/kind"==e?t.removeAttr("type"):t.attr("type",e)},r.initDataBinding(n,a,callbacks)},l}),define("taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/states/Question"],function(t,e){return t.createBundle(e,arguments,["answer","correct","map"])}),define("taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){this.registerStates(e),t.initCreator.call(this)},i}),define("tpl!taoQtiItem/qtiCreator/tpl/interactions/uploadInteraction",["handlebars"],function(t){return t.template(function(t,e,i,n,a){function r(t,e){var n,a;return(a=i.prompt)?n=a.call(t,{hash:{},data:e}):(a=t&&t.prompt,n=typeof a===c?a.call(t,{hash:{},data:e}):a),n||0===n?n:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var o,s,l="",c="function",d=this.escapeExpression,h=this;return l+='<div class="qti-interaction qti-blockInteraction qti-uploadInteraction" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:a}):(s=e&&e.serial,o=typeof s===c?s.call(e,{hash:{},data:a}):s),l+=d(o)+'">\n	',o=i["if"].call(e,e&&e.prompt,{hash:{},inverse:h.noop,fn:h.program(1,r,a),data:a}),(o||0===o)&&(l+=o),l+='\n	<div class="instruction-container"></div>\n    <div class="grid-row file-upload">\n        <span class="btn-info small col-4"></span>\n        <span class="file-name placeholder col-8 truncate"></span>\n    </div>\n</div>'
})}),define("taoQtiItem/qtiCreator/renderers/interactions/UploadInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/UploadInteraction","taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/Widget","tpl!taoQtiItem/qtiCreator/tpl/interactions/uploadInteraction"],function(t,e,i,n){var e=t.clone(e);return e.template=n,e.render=function(t,n){return e.resetGui(t),i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),n)},e}),define("taoQtiItem/qtiCreator/helper/simpleParser",["lodash","jquery","taoQtiItem/qtiItem/helper/util","taoQtiItem/qtiItem/core/Loader"],function(t,e,i,n){function a(t,e){return e?e+"\\:"+t:t}function r(t){var e=t.prop("tagName").toLowerCase();return e=e.replace(/.*:/,""),h[e]?h[e]:e}function o(t){var n=r(t),a={qtiClass:n,serial:i.buildSerial(n+"_"),attributes:{}};return e.each(t[0].attributes,function(){this.specified&&(a.attributes[this.name]=this.value)}),a}function s(t,i){var n=o(t);return n.mathML=t.html(),n.annotations={},t.find(a("annotation",i.ns.math)).each(function(){var t=e(this),i=t.attr("encoding");i&&(n.annotations[i]=t.html())}),n.ns={name:"m",uri:"http://www.w3.org/1998/Math/MathML"},n}function l(n,r){var l=t.merge(t.clone(u),r||{}),h={serial:i.buildSerial("_container_"),body:"",elements:{}};return t.each(d,function(t){n.find(t).each(function(){var t=e(this),i=o(t,r);h.elements[i.serial]=i,t.replaceWith(c(i))})}),n.find(a("math",l.ns.math)).each(function(){var t=e(this),i=s(t,r);h.elements[i.serial]=i,t.replaceWith(c(i))}),h.body=n.html(),h}function c(t){return"{{"+t.serial+"}}"}var d=["img","object"],h={rubricblock:"rubricBlock"},u={ns:{math:""},loaded:null,model:null},p={parse:function(i,a){var r=e(i),s=o(r,a),c=l(r,a);if(c.body&&(s.body=c),t.isFunction(a.loaded)&&a.model){var d=(new n).setClassesLocation(a.model);d.loadElement(s,a.loaded)}return s}};return p}),define("taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/media","taoQtiItem/qtiCreator/widgets/helpers/formElement"],function(t,e){var i=t.extend(e,function(){{var t=this.widget;t.element}},function(){this.widget});return i.prototype.initResponseForm=function(){{var t=this.widget;t.$form,t.element}},i}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/math-popup",["handlebars"],function(t){return t.template(function(t,e,i,n,a){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),a=a||{};var r,o,s="",l=i.helperMissing,c=this.escapeExpression;return s+='<div id="item-editor-math-editor" class="sidebar-popup-container-box">\n    <div id="math-editor-container" class="sidebar-popup">\n        <h3 id="math-editor-title">'+c((r=i.__||e&&e.__,o={hash:{},data:a},r?r.call(e,"Title",o):l.call(e,"__","Title",o)))+'</h3>\n        <span class="icon-grip-h"></span>\n        <textarea id="math-editor-textarea"></textarea>\n        <a class="closer" href="#" data-close="#math-editor-container"></a>\n    </div>\n    <div class="clearfix">\n\n        <!-- this would be the content of static/math.tpl -->\n        <label>'+c((r=i.__||e&&e.__,o={hash:{},data:a},r?r.call(e,"Label",o):l.call(e,"__","Label",o)))+'</label>\n        <input name="latex" id="math-inp" value="" type="text">\n        <span>…</span>\n\n    </div>\n</div>\n'})});